/*!*  filename: sf-richtexteditor.min.js 
*     version : 31.2.12 
*     Copyright Syncfusion Inc. 2001 - 2025. All rights reserved. 
*     Use of this code is subject to the terms of our license.
*     A copy of the current license can be obtained at any time by e-mailing 
*     licensing@syncfusion.com. Any infringement will be prosecuted under 
*     applicable laws. 
*/
(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{"./bundles/sf-richtexteditor.js":function(e,t,n){"use strict";n.r(t);n("./modules/sf-richtexteditor.js")},"./modules/sf-richtexteditor.js":function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.sfBlazor=window.sfBlazor||{},window.sfBlazor.RichTextEditor=function(){"use strict";var e="e-img-caption",t="initial-end",i="destroy",s="bind-on-end",r="keyUp",o="keyDown",a="selection-save",l="selection-restore",d="mouseDown",c="editAreaClick",h="paste-content",p="docClick",u="checkUndoStack",f={px:{px:1,em:.0625,rem:.0625,pt:.75,cm:.0264583,mm:.0026458,in:.0104167,pc:.0625,vw:.00625,vh:.00625,vmin:.00625,vmax:.00625},em:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:.0625,vw:1,vh:1,vmin:1,vmax:1},rem:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:.0625,vw:1,vh:1,vmin:1,vmax:1},pt:{px:1.33333,em:.0833333,rem:.0833333,pt:1,cm:.0352778,mm:.0035278,in:.0138889,pc:.0416667,vw:.00416667,vh:.00416667,vmin:.00416667,vmax:.00416667},cm:{px:37.7953,em:2.3622,rem:2.3622,pt:28.3465,cm:1,mm:.1,in:.393701,pc:.148148,vw:.0377953,vh:.0377953,vmin:.0377953,vmax:.0377953},mm:{px:3.77953,em:.23622,rem:.23622,pt:2.83465,cm:10,mm:1,in:.0393701,pc:.0148148,vw:.00377953,vh:.00377953,vmin:.00377953,vmax:.00377953},in:{px:96,em:6,rem:6,pt:72,cm:2.54,mm:25.4,in:1,pc:.375,vw:.09375,vh:.09375,vmin:.09375,vmax:.09375},pc:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:1,vw:.0625,vh:.0625,vmin:.0625,vmax:.0625},vw:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vh:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vmin:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vmax:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1}},m=["px","em","rem","pt","cm","mm","in","pc","vw","vh","vmin","vmax"],g=function(){function e(e){this.parent=e,this.renderCount()}return e.prototype.renderCount=function(){this.parent.showCharCount&&(this.addEventListener(),this.appendCount(),-1!==this.parent.maxLength&&this.charCountBackground(this.htmlLength))},e.prototype.appendCount=function(){if(this.countElement=sf.base.createElement("span",{className:"e-rte-character-count",styles:"display: block"}),"Bottom"===this.parent.toolbarSettings.position){var e=this.parent.inputElement.parentElement;e&&e.parentNode&&e.insertAdjacentElement("afterend",this.countElement)}else this.parent.rootContainer.appendChild(this.countElement);this.parent.rootContainer.classList.add("e-count-enabled"),this.parent.iframeSettings.enable&&this.parent.inputElement.classList.add("e-count-enabled"),this.updateCount()},e.prototype.updateCount=function(){var e="Markdown"===this.parent.editorMode?this.parent.getEditPanel().value:sf.base.isNullOrUndefined(this.parent.getText())?"":this.parent.getText().replace(/(\r\n|\n|\r|\t)/gm,"");"Markdown"!==this.parent.editorMode&&-1!==e.indexOf("​")?this.htmlLength=e.replace(/\u200B/g,"").length:this.htmlLength=e.length;var t=-1===this.parent.maxLength?this.htmlLength:this.htmlLength+" / "+this.parent.maxLength;this.countElement.innerHTML=t},e.prototype.charCountBackground=function(e){this.countElement=this.parent.element.querySelector(".e-rte-character-count");var t=e/this.parent.maxLength*100;t<85?(this.countElement.classList.remove("e-warning"),this.countElement.classList.remove("e-error")):t>85&&t<=90?(this.countElement.classList.remove("e-error"),this.countElement.classList.add("e-warning")):t>90&&(this.countElement.classList.remove("e-warning"),this.countElement.classList.add("e-error"))},e.prototype.refresh=function(){!sf.base.isNullOrUndefined(this.parent.element)&&this.parent.showCharCount&&(this.updateCount(),-1!==this.parent.maxLength&&this.charCountBackground(this.htmlLength))},e.prototype.destroy=function(){this.parent&&this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-count-enabled")&&this.parent.rootContainer.classList.remove("e-count-enabled"),this.parent.iframeSettings.enable&&!sf.base.isNullOrUndefined(this.parent.inputElement)&&this.parent.inputElement.classList.remove("e-count-enabled"),sf.base.detach(this.countElement),this.countElement=null,this.removeEventListener()},e.prototype.toggle=function(e){this.parent.showCharCount&&(this.countElement.style.display="viewSource"===e.member?"none":"block")},e.prototype.addEventListener=function(){this.parent.observer.on(r,this.refresh,this),this.parent.observer.on("count",this.refresh,this),this.parent.observer.on("refresh-begin",this.refresh,this),this.parent.observer.on(d,this.refresh,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on("sourceCode",this.toggle,this),this.parent.observer.on("updateSource",this.toggle,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(r,this.refresh),this.parent.observer.off("refresh-begin",this.refresh),this.parent.observer.off("count",this.refresh),this.parent.observer.off(d,this.refresh),this.parent.observer.off(i,this.destroy),this.parent.observer.off("sourceCode",this.toggle),this.parent.observer.off("updateSource",this.toggle)},e}(),b=function(){function e(e){this.iframeMouseUpBoundFn=this.iframeMouseUp.bind(this),this.parent=e,this.renderResizable(),this.isResizing=!1}return e.prototype.addEventListener=function(){this.parent.observer.on(i,this.destroy,this)},e.prototype.renderResizable=function(){var e=this;if(this.parent.enableResize){var t="e-icons e-resize-handle ";t+=this.parent.enableRtl?"e-south-west":"e-south-east",this.resizer=sf.base.createElement("div",{id:this.parent.id+"-resizable",className:t}),this.parent.element.classList.add("e-rte-resize"),this.parent.rootContainer.classList.add("e-resize-enabled"),this.parent.iframeSettings.enable&&(this.parent.inputElement.classList.add("e-resize-enabled"),this.parent.getDocument().addEventListener("mouseup",this.iframeMouseUpBoundFn)),this.parent.rootContainer.appendChild(this.resizer),this.iframeElement=this.parent.getDocument().querySelectorAll("iframe"),sf.base.isNullOrUndefined(this.iframeElement)||this.iframeElement.forEach((function(t){sf.base.EventHandler.add(t,"load",e.onIFrameLoad,e)})),this.touchStartEvent="msie"===sf.base.Browser.info.name?"pointerdown":"touchstart",sf.base.EventHandler.add(this.resizer,"mousedown",this.resizeStart,this),sf.base.EventHandler.add(this.resizer,this.touchStartEvent,this.resizeStart,this)}this.addEventListener()},e.prototype.onIFrameLoad=function(e){var t=e.target;"IFRAME"===t.nodeName&&t.contentDocument&&sf.base.EventHandler.add(t.contentDocument,"mouseup",this.stopResize,this)},e.prototype.removeMouseUpEventListener=function(e){e.contentDocument&&sf.base.EventHandler.remove(e.contentDocument,"mouseup",this.stopResize)},e.prototype.resizeStart=function(e){var t=this;this.isResizing=!1,e.cancelable&&e.preventDefault(),this.wireResizeEvents(),this.parent.observer.notify("resizeInitialized",{});this.parent.onResizeStartEnabled&&this.parent.dotNetRef.invokeMethodAsync("ResizeStartEvent",{requestType:"editor"}).then((function(e){e.cancel&&t.unwireResizeEvents()}))},e.prototype.performResize=function(e){this.isResizing=!0;var t=this.parent.element.getBoundingClientRect();if(this.isMouseEvent(e)){this.parent.element.style.height=e.clientY-t.top+"px",this.parent.element.style.width=(this.parent.enableRtl?t.right-e.clientX:e.clientX-t.left)+"px";var n=this.parent.getToolbarElement();if(null!==n&&n.classList.contains("e-rte-tb-float")&&this.parent.toolbarSettings.enableFloating&&this.parent.getToolbar()&&!this.parent.inlineMode.enable){var i=this.parent.contentPanel.getBoundingClientRect().width;n.style.width=i+"px"}}else{var s="msie"!==sf.base.Browser.info.name?e.touches[0]:e;this.parent.element.style.height=s.clientY-t.top+"px",this.parent.element.style.width=(this.parent.enableRtl?t.right-s.clientX:s.clientX-t.left)+"px"}var r=this.parent.element.querySelector("#"+this.parent.element.id+"_source-view");sf.base.isNullOrUndefined(r)||(r.style.height=this.parent.element.style.height),this.parent.refresh()},e.prototype.stopResize=function(e){this.isResizing=!1,this.parent.refresh(),this.unwireResizeEvents();this.parent.onResizeStopEnabled&&this.parent.dotNetRef.invokeMethodAsync("ResizeStopEvent",{requestType:"editor"})},e.prototype.getEventType=function(e){return e.indexOf("mouse")>-1?"mouse":"touch"},e.prototype.isMouseEvent=function(e){var t=!1;return("mouse"===this.getEventType(e.type)||!sf.base.isNullOrUndefined(e.pointerType)&&"mouse"===this.getEventType(e.pointerType))&&(t=!0),t},e.prototype.wireResizeEvents=function(){sf.base.EventHandler.add(document,"mousemove",this.performResize,this),sf.base.EventHandler.add(document,"mouseup",this.stopResize,this),this.touchMoveEvent="msie"===sf.base.Browser.info.name?"pointermove":"touchmove",this.touchEndEvent="msie"===sf.base.Browser.info.name?"pointerup":"touchend",sf.base.EventHandler.add(document,this.touchMoveEvent,this.performResize,this),sf.base.EventHandler.add(document,this.touchEndEvent,this.stopResize,this)},e.prototype.unwireResizeEvents=function(){sf.base.EventHandler.remove(document,"mousemove",this.performResize),sf.base.EventHandler.remove(document,"mouseup",this.stopResize),sf.base.EventHandler.remove(document,this.touchMoveEvent,this.performResize),sf.base.EventHandler.remove(document,this.touchEndEvent,this.stopResize)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.removeEventListener=function(){var e=this;this.parent&&this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-resize-enabled")&&this.parent.rootContainer.classList.remove("e-resize-enabled"),this.parent.iframeSettings.enable&&!sf.base.isNullOrUndefined(this.parent.inputElement)&&(this.parent.inputElement.classList.remove("e-resize-enabled"),this.parent.getDocument().removeEventListener("mouseup",this.iframeMouseUpBoundFn)),this.iframeMouseUpBoundFn=null,this.parent.element.classList.remove("e-rte-resize"),sf.base.EventHandler.remove(this.resizer,"mousedown",this.resizeStart),sf.base.EventHandler.remove(this.resizer,this.touchStartEvent,this.resizeStart),sf.base.isNullOrUndefined(this.iframeElement)||this.iframeElement.forEach((function(t){e.removeMouseUpEventListener(t),sf.base.EventHandler.remove(t,"load",e.onIFrameLoad)})),this.resizer&&sf.base.detach(this.resizer),this.parent.observer.off(i,this.destroy)},e.prototype.iframeMouseUp=function(e){this.isResizing&&this.stopResize(e)},e}(),v="internal_destroy",y=function(){function e(){}return e.prototype.getFormattedNode=function(e,t,n){var i=this.getFormatParent(e,t,n);return null!==i&&i!==n?i:null},e.prototype.getFormatParent=function(e,t,n){do{e=e.parentNode}while(e&&e!==n&&!this.isFormattedNode(e,t));return e},e.prototype.isFormattedNode=function(t,n){switch(n){case"bold":return e.isBold(t);case"italic":return e.isItalic(t);case"underline":return e.isUnderline(t);case"strikethrough":return e.isStrikethrough(t);case"superscript":return e.isSuperscript(t);case"subscript":return e.isSubscript(t);case"fontcolor":return this.isFontColor(t);case"fontname":return this.isFontName(t);case"fontsize":return this.isFontSize(t);case"backgroundcolor":return this.isBackgroundColor(t);case"inlinecode":return e.isCode(t);default:return!1}},e.isBold=function(e){return-1!==["strong","b"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"bold"!==e.style.fontWeight)},e.isItalic=function(e){return-1!==["em","i"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"italic"!==e.style.fontStyle)},e.isUnderline=function(e){return-1!==["u"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"underline"!==e.style.textDecoration&&"underline"!==e.style.textDecorationLine)},e.isStrikethrough=function(e){return-1!==["del","strike","s"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"line-through"!==e.style.textDecoration&&"line-through"!==e.style.textDecorationLine)},e.isSuperscript=function(e){return-1!==["sup"].indexOf(e.nodeName.toLowerCase())},e.isSubscript=function(e){return-1!==["sub"].indexOf(e.nodeName.toLowerCase())},e.prototype.isFontColor=function(t){var n=t.style&&t.style.color;return-1!==e.inlineTags.indexOf(t.nodeName.toLowerCase())&&null!==n&&""!==n&&void 0!==n},e.prototype.isBackgroundColor=function(t){var n=t.style&&t.style.backgroundColor;return-1!==e.inlineTags.indexOf(t.nodeName.toLowerCase())&&null!==n&&""!==n&&void 0!==n},e.prototype.isFontSize=function(t){var n=t.style&&t.style.fontSize;return-1!==e.inlineTags.indexOf(t.nodeName.toLowerCase())&&null!==n&&""!==n&&void 0!==n},e.prototype.isFontName=function(t){var n=t.style&&t.style.fontFamily;return-1!==e.inlineTags.indexOf(t.nodeName.toLowerCase())&&null!==n&&""!==n&&void 0!==n},e.isCode=function(e){return!(-1===["code"].indexOf(e.nodeName.toLowerCase())||e.parentElement&&"PRE"===e.parentElement.nodeName&&e.parentElement.hasAttribute("data-language"))},e.inlineTags=["a","abbr","acronym","b","bdo","big","cite","code","dfn","em","font","i","kbd","label","q","samp","small","span","strong","sub","sup","tt","u","var","del"],e}();function C(){var e=!1;return sf.base.Browser.isDevice&&sf.base.Browser.isIos&&(e=!0),e}function N(e,t){if("BODY"===e.nodeName&&!sf.base.isNullOrUndefined(t)){var n=top.window.document.querySelector(t);sf.base.isNullOrUndefined(n)||n.contentWindow.focus()}}function E(e,t){var n="BODY"===t.nodeName?t.ownerDocument.defaultView.frameElement.closest(".e-richtexteditor"):t.closest(".e-richtexteditor"),i=n.style.height;if(0!==e.getSelection().rangeCount){var s=e.getSelection().getRangeAt(0),r="#text"===s.startContainer.nodeName?s.startContainer.parentElement:s.startContainer,o=r.getBoundingClientRect(),a=o.top,l=o.bottom,d=n.getBoundingClientRect(),c=n.querySelectorAll(".e-count-enabled, .e-resize-enabled").length>0;"BODY"===t.nodeName?"auto"===i?window.innerHeight<a?r.scrollIntoView({block:"end",inline:"nearest"}):l>r.getBoundingClientRect().top&&r.scrollIntoView({block:"nearest",inline:"nearest"}):((a>t.getBoundingClientRect().height||l>d.bottom)&&r.scrollIntoView({block:"nearest",inline:"nearest"}),l>r.getBoundingClientRect().top&&r.scrollIntoView({block:"nearest",inline:"nearest"})):"auto"===i?(window.innerHeight<a&&r.scrollIntoView({block:"end",inline:"nearest"}),a>r.getBoundingClientRect().top&&r.scrollIntoView({block:"nearest",inline:"nearest"})):(l>r.getBoundingClientRect().top&&r.scrollIntoView({block:"nearest",inline:"nearest"}),l>d.bottom&&(n.querySelector(".e-rte-content").scrollTop+=l-d.bottom+(c?20:0)));var h=t.closest('div[style*="overflow-y: scroll"]');if(!sf.base.isNullOrUndefined(h)){var p=h.getBoundingClientRect();l>p.bottom&&(h.scrollTop+=l-p.bottom)}}}function S(e,t,n){for(var i=0;i<t.length;i++)0===i?e.splice(n+i,1,t[i]):e.splice(n+i,0,t[i]);return e}function T(e,t){sf.base.removeClass(e,t);for(var n=0;n<e.length;n++)0===e[n].classList.length&&e[n].hasAttribute("class")&&e[n].removeAttribute("class");return e}function L(e){for(var t=[],n=e.rows,i=0;i<=n.length-1;i++)for(var s=n[i],r=0,o=0;o<=s.children.length-1;o++){var a=s.children[o],l=parseInt(a.getAttribute("colspan"),10)||1,d=parseInt(a.getAttribute("rowspan"),10)||1;r=O(t,a,i,r,l,d),r+=l}return t}function O(e,t,n,i,s,r){for(var o=n;o<n+r;o++){e[o]||(e[o]=[]);for(var a=i;a<i+s;a++)e[o][a]?i++:e[o][a]=t}return i}function k(e,t){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(t[n][i]===e)return[n,i];return[]}function x(e,t){if((void 0===t&&(t=!1),e)&&(!w(e)||t)){for(var n=A(e),i=new Array(n),s=sf.base.createElement("colgroup"),r=new Map,o=0;o<e.rows.length;o++)for(var a=0,l=0;l<e.rows[o].cells.length;l++){for(var d=1;d<e.rows[o].cells[l].rowSpan;d++){var c=""+(o+d)+a;r.set(c,e.rows[o].cells[l])}(g=B(r,o,l))>a&&(a=g);var h=e.rows[o].cells[l].offsetWidth;(!i[a]||h<i[a])&&(i[a]=h),a+=1+e.rows[o].cells[l].colSpan-1}for(var p=0;p<i.length;p++){(b=sf.base.createElement("col")).appendChild(sf.base.createElement("br")),b.style.width=M(i[p],parseInt(getComputedStyle(e).width,10))+"%",s.appendChild(b)}if(t){var u=w(e);u&&sf.base.detach(u)}e.insertBefore(s,e.firstChild);for(var f=0;f<e.rows.length;f++)for(var m=e.rows[f],g=0;g<m.cells.length;g++){var b;(b=m.cells[g]).style.width=""}(sf.base.isNullOrUndefined(e.style.width)||""===e.style.width)&&(e.style.width=e.offsetWidth+"px")}}function w(e){return e&&e.children&&Array.from(e.children).find((function(e){return"COLGROUP"===e.tagName}))||null}function A(e){if(!e||!e.rows||0===e.rows.length)return 0;for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;return n}function B(e,t,n){var i=""+t+n,s=e.get(i);return s?B(e,t,n+s.colSpan):n}function M(e,t){return 0===t?0:e/t*100}function R(e,t){if(t&&"HTML"===t&&e){var n=document.createElement("div");n.innerHTML=e.trim(),n.querySelectorAll(".e-img-inner").forEach((function(e){e.setAttribute("contenteditable","true")})),e=n.innerHTML,n.remove()}return e}function D(e,t){if(e&&t){var n=document.createElement("div");if("HTML"===t){n.innerHTML=e,n.querySelectorAll(".e-img-inner").forEach((function(e){e.setAttribute("contenteditable","false")}));var i=n.querySelectorAll(".e-column-resize, .e-row-resize, .e-table-box, .e-table-rhelper, .e-img-resize, .e-vid-resize, .e-tb-row-insert, .e-tb-col-insert");if(i.length>0)for(var s=0;s<i.length;s++)sf.base.detach(i[s]);I(n)}else n.textContent=e;return"Markdown"===t?n.innerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):n.innerHTML}return e}function I(e){for(var t=["e-img-focus","e-cell-select","e-multi-cells-select","e-cell-select-end","e-video-focus","e-audio-focus","e-resize","e-rte-drag-image"],n=0;n<t.length;n++){var i=e.querySelectorAll("."+t[n]);if(sf.base.removeClass(i,t[n]),0!==i.length)for(var s=0;s<i.length;s++)0===i[s].classList.length&&i[s].removeAttribute("class"),"IMG"!==i[s].nodeName&&"VIDEO"!==i[s].nodeName||""===i[s].style.outline||(i[s].style.outline="")}e.querySelectorAll('[class=""]').forEach((function(e){e.removeAttribute("class")}))}function U(e,t,n){if(n||"br"===t.toLowerCase()||sf.base.isNullOrUndefined(e))return e;var i=document.createElement("div");i.innerHTML=e;var s=t.toLowerCase();!function e(t,n){for(var i=new Set(["DIV","TH","TD","LI","BLOCKQUOTE","OL","UL","TABLE","TBODY","TR","THEAD","TFOOT"]),s=new Set(["DIV","P","SECTION","ARTICLE","HEADER","FOOTER","ASIDE","NAV","MAIN","FIGURE","FIGCAPTION","BLOCKQUOTE","OL","UL","LI","TABLE","TBODY","TR","TD","TH","THEAD","TFOOT","H1","H2","H3","H4","H5","H6","SVG","PRE","COLGROUP"]),r=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","IMG","LABEL","IFRAME","VIDEO","AUDIO","OBJECT","EMBED","CANVAS","METER","PROGRESS","OBJECT"]),o=new Set(["BASE","AREA","LINK"]),a=Array.from(t.childNodes),l=null,d=function(a){var d=!0;if(a.parentElement&&"LI"===a.parentElement.nodeName&&(d=function(e,t){var n=!1,i=!1;return e.childNodes.forEach((function(e){if(e.nodeType===Node.ELEMENT_NODE){var s=e.nodeName;if(t.has(s)&&"OL"!==s&&"UL"!==s)(o=e.nextSibling)&&-1!==["UL","OL"].indexOf(o.nodeName)||(n=!0);else if(-1!==["OL","UL"].indexOf(s)){var r=e.previousSibling,o=e.nextSibling;r&&t.has(r.nodeName)&&o&&o.nodeType===Node.TEXT_NODE&&o.textContent.trim().length>0&&(n=!0)}else if(!t.has(s)&&"LI"!==s){(o=e.nextSibling)&&-1!==["UL","OL"].indexOf(o.nodeName)||(i=!0)}}else e.nodeType===Node.TEXT_NODE&&e.textContent.trim().length>0&&(i=!0)})),n&&i}(a.parentElement,s)),a.nodeType===Node.TEXT_NODE)a.nodeValue&&a.nodeValue.trim()&&d&&(l||(l=document.createElement(n),t.insertBefore(l,a)),l.appendChild(a));else if(a.nodeType===Node.ELEMENT_NODE){var c=(u=a).tagName.toUpperCase();if(P(s,c)&&!P(r,c)){l=null;var h=Array.from(u.childNodes),p=!1;h.forEach((function(e){var t=e.tagName;e.nodeType===Node.ELEMENT_NODE&&P(s,t)&&(p=!0)})),P(i,c)&&h.length>0&&p&&e(u,n)}else P(s,c)||P(r,c)||o.has(c)||"HR"===c||a.parentNode&&d&&a.parentNode.childNodes.length>1&&(l||(l=document.createElement(n),t.insertBefore(l,a)),l.appendChild(a))}if(a.nodeType===Node.ELEMENT_NODE){c=(u=a).tagName.toUpperCase();for(var u,f=!1,m=s.values(),g=m.next();!g.done;){if(g.value===c){f=!0;break}g=m.next()}if(f)if(1===u.childNodes.length&&u.firstChild&&u.firstChild.nodeType===Node.ELEMENT_NODE&&"P"===u.firstChild.nodeName&&"DIV"!==u.nodeName&&1===u.firstChild.childNodes.length&&u.firstChild.firstChild&&u.firstChild.firstChild.nodeType!==Node.ELEMENT_NODE&&0===u.firstChild.attributes.length)u.replaceChild(u.firstChild.firstChild,u.firstChild);else if("P"===u.nodeName&&u.parentElement&&"LI"===u.parentElement.nodeName&&!d&&0===u.attributes.length){var b=void 0,v=function(e){for(;e;){if((e.nodeType!==Node.TEXT_NODE||""!==e.textContent.trim())&&"OL"!==e.nodeName&&"UL"!==e.nodeName)return e;e=e.nextSibling}return null}(u.nextSibling),y=function(e){for(;e;){if((e.nodeType!==Node.TEXT_NODE||""!==e.textContent.trim())&&"OL"!==e.nodeName&&"UL"!==e.nodeName)return e;e=e.previousSibling}return null}(u.previousSibling);if(v||y||(b=!0),b){for(;u.firstChild;)u.parentElement.insertBefore(u.firstChild,u);u.parentElement.removeChild(u)}}}},c=0,h=a;c<h.length;c++){var p=h[c];d(p)}}(i,["div","p"].indexOf(s)>=0?s:"div");var r=i.innerHTML;return i.remove(),r}function P(e,t){for(var n=e.values(),i=n.next();!i.done;){if(i.value===t)return!0;i=n.next()}return!1}function H(e,t){var n=!1;if("pre-wrap"===getComputedStyle(t).whiteSpace||"pre"===getComputedStyle(t).whiteSpace)return e;function i(e){return"pre-line"===e.style.whiteSpace}function s(e){return"PRE"===e.tagName||("pre"===e.style.whiteSpace||"pre-wrap"===e.style.whiteSpace)}"pre-line"===getComputedStyle(t).whiteSpace&&(n=!0);var r=document.createElement("div");return r.innerHTML=e,function e(t,n){if(void 0===n&&(n=!1),null!=t)for(var r=t.firstChild;null!=r;)3===r.nodeType?n?(r.nodeValue=r.nodeValue.replace(/[\t]/g," "),r.nodeValue=r.nodeValue.replace(/[ ]{2,}/g," ")):(r.nodeValue=r.nodeValue.replace(/[\n\r\t]/g," "),r.nodeValue=r.nodeValue.replace(/[ ]{2,}/g," ")):1===r.nodeType&&(s(r)||i(r)||e(r,n),i(r)&&e(r,!0)),r=r.nextSibling}(r,n),r.innerHTML}function q(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],i=atob(t[1]),s=i.length,r=new Uint8Array(s);s--;)r[s]=i.charCodeAt(s);return new Blob([r],{type:n})}function F(e){return function e(t,n){var i=new Set(["address","article","aside","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hr","li","main","nav","noscript","ol","p","pre","section","table","tfoot","ul","thead","tbody","tr","th","td","colgroup"]),s=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr"]),r="   ".repeat(n),o="";return t.childNodes.forEach((function(t){if(t.nodeType===Node.TEXT_NODE){var a=t.textContent;0===a.trim().length&&(a=a.trim()),a&&(a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),o+=a)}else if(t.nodeType===Node.ELEMENT_NODE){var l=t,d=l.tagName.toLowerCase(),c=Array.from(l.attributes).map((function(e){return e.name+'="'+(e.value.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"')})).join(" "),h=c?" "+c:"",p=c?"<"+d+" "+c+">":"<"+d+">",u="</"+d+">",f=i.has(d);if(s.has(d))"col"===d?"\n"===o[o.length-1]?o+=r+"<"+d+h+">\n":o+="\n"+r+"<"+d+h+">\n":o+="<"+d+h+"/>";else if(f){"\n"===o[o.length-1]?o+=""+r+p:o+="\n"+r+p;var m=e(t,n+1);m&&(o+=""+m),"\n"===o[o.length-1]?o+=""+r+u+"\n":o+=u+"\n"}else o+=""+p+e(t,0)+u}})),o}((new DOMParser).parseFromString(e,"text/html").body,0).trim()}var z,V,j,W,_=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","strike","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"],Q={bold:{command:"Style",subCommand:"Bold",value:"strong"},italic:{command:"Style",subCommand:"Italic",value:"em"},underline:{command:"Style",subCommand:"Underline",value:"span"},strikeThrough:{command:"Style",subCommand:"StrikeThrough",value:"span"},insertCode:{command:"Formats",subCommand:"Pre",value:"pre"},superscript:{command:"Effects",subCommand:"SuperScript",value:"sup"},subscript:{command:"Effects",subCommand:"SubScript",value:"sub"},uppercase:{command:"Casing",subCommand:"UpperCase"},lowercase:{command:"Casing",subCommand:"LowerCase"},fontColor:{command:"font",subCommand:"fontcolor",value:"#ff0000"},fontName:{command:"font",subCommand:"fontname",value:"Segoe UI"},fontSize:{command:"font",subCommand:"fontsize",value:"10pt"},backColor:{command:"font",subCommand:"backgroundcolor",value:"#ffff00"},justifyCenter:{command:"Alignments",subCommand:"JustifyCenter"},justifyFull:{command:"Alignments",subCommand:"JustifyFull"},justifyLeft:{command:"Alignments",subCommand:"JustifyLeft"},justifyRight:{command:"Alignments",subCommand:"JustifyRight"},undo:{command:"Actions",subCommand:"Undo"},redo:{command:"Actions",subCommand:"Redo"},createLink:{command:"Links",subCommand:"createLink"},editLink:{command:"Links",subCommand:"createLink"},createImage:{command:"Images",subCommand:"Images"},formatBlock:{command:"Formats",value:"P"},heading:{command:"Formats",value:"H1"},indent:{command:"Indents",subCommand:"Indent"},outdent:{command:"Indents",subCommand:"Outdent"},insertHTML:{command:"InsertHTML",subCommand:"InsertHTML",value:""},insertText:{command:"InsertText",subCommand:"InsertText",value:""},insertHorizontalRule:{command:"InsertHTML",subCommand:"InsertHTML",value:"<hr/>"},insertImage:{command:"Images",subCommand:"Image"},insertAudio:{command:"Audios",subCommand:"Audio"},insertVideo:{command:"Videos",subCommand:"Video"},editImage:{command:"Images",subCommand:"Image"},insertTable:{command:"Table",subCommand:"CreateTable"},insertBrOnReturn:{command:"InsertHTML",subCommand:"InsertHTML",value:"<br/>"},insertOrderedList:{command:"Lists",value:"OL"},insertUnorderedList:{command:"Lists",value:"UL"},insertParagraph:{command:"Formats",value:"P"},removeFormat:{command:"Clear",subCommand:"ClearFormat"},insertCodeBlock:{command:"CodeBlock",subCommand:"CodeBlock"},numberFormatList:{command:"Lists",subCommand:"NumberFormatList"},bulletFormatList:{command:"Lists",subCommand:"BulletFormatList"}};function K(e,t){if(t.enableHtmlSanitizer){var n=sf.base.SanitizeHtmlHelper.beforeSanitize();n.selectors.tags[2]&&n.selectors.tags[2].indexOf("iframe")>-1&&(n.selectors.tags[2]="iframe:not(.e-rte-embed-url)");if(sf.base.extend(n,n,{cancel:!1,helper:null}),!sf.base.isNullOrUndefined(t.deniedSanitizeSelectors)&&t.deniedSanitizeSelectors.length>0)for(var i=function(e){for(var i=0;i<n.selectors.tags.length;i++)n.selectors.tags[i]===t.deniedSanitizeSelectors[e]&&(n.selectors.tags=n.selectors.tags.filter((function(n){return n!==t.deniedSanitizeSelectors[e]})));for(var s=function(i){(n.selectors.attributes[i].attribute||n.selectors.attributes[i].selector)===t.deniedSanitizeSelectors[e]&&(n.selectors.attributes=n.selectors.attributes.filter((function(e){return e!==n.selectors.attributes[i]})))},r=0;r<n.selectors.attributes.length;r++)s(r)},s=0;s<t.deniedSanitizeSelectors.length;s++)i(s);!sf.base.isNullOrUndefined(t.additionalSanitizeAttributes)&&t.additionalSanitizeAttributes.length>0&&(n.selectors.attributes=n.selectors.attributes.concat(t.additionalSanitizeAttributes)),!sf.base.isNullOrUndefined(t.additionalSanitizeTags)&&t.additionalSanitizeTags.length>0&&(n.selectors.tags=n.selectors.tags.concat(t.additionalSanitizeTags)),n.cancel||(e=sf.base.SanitizeHtmlHelper.serializeValue(n,e))}return e=function(e){var t=sf.base.createElement("div");e=e.replace(/&(times|divide|ne)/g,"&amp;amp;$1"),t.innerHTML=e,t.querySelectorAll("font").forEach((function(e){var t=document.createElement("span"),n=(e.getAttribute("style")||"").replace(/style:/gi,"").trim();sf.base.isNullOrUndefined(n)||""===n.trim()||n.endsWith(";")||(n+=";"),Array.from(e.attributes).forEach((function(e){var t=e.name.toLowerCase(),i=e.value;switch(t){case"size":n+="font-size:"+i+";";break;case"face":n+="font-family:"+i+";";break;case"bgcolor":n+="background-color:"+i+";";break;case"style":break;default:n+=t+":"+i+";"}})),sf.base.isNullOrUndefined(n)||""===n.trim()||(n=n.replace(/;;+/g,";"),t.style.cssText=n),t.innerHTML=e.innerHTML,sf.base.isNullOrUndefined(e.parentNode)||e.parentNode.replaceChild(t,e)}));var n=t.innerHTML;return t.remove(),n}(e)}function X(e,t){var n=-1;return t.some((function(t,i){return!sf.base.isNullOrUndefined(t)&&"string"==typeof t.subCommand&&e===t.subCommand.toLocaleLowerCase()&&(n=i,!0)})),n}function G(e,t,n,i){for(var s,r,o=0;o<e.length;o++){if("value"===n&&e[o].value.toLocaleLowerCase()===t.toLocaleLowerCase()){s=e[o];break}if("text"===n&&e[o].text.toLocaleLowerCase()===t.toLocaleLowerCase()){s=e[o];break}if("subCommand"===n&&e[o].subCommand.toLocaleLowerCase()===t.toLocaleLowerCase()){s=e[o];break}}if(!sf.base.isNullOrUndefined(s))switch(i){case"text":r=s.text;break;case"value":r=s.value;break;case"cssClass":r=s.cssClass}return r}function Y(e,t){var n;return null!==e&&""!==e?(n=t.enableHtmlEncode?t.encode(J(Z(e),t)):J(e,t),t.value=n):n="DIV"===t.enterKey?t.enableHtmlEncode?"&lt;div&gt;&lt;br/&gt;&lt;/div&gt;":"<div><br/></div>":"BR"===t.enterKey?t.enableHtmlEncode?"&lt;br/&gt;":"<br/>":t.enableHtmlEncode?"&lt;p&gt;&lt;br/&gt;&lt;/p&gt;":"<p><br/></p>",n}function $(e){return"DIV"===e.enterKey?"<div><br/></div>":"BR"===e.enterKey?"<br/>":"<p><br/></p>"}function J(e,t){var n=document.createElement("div"),i=document.createElement("div"),s=n.childNodes;if(n.innerHTML=e.trim(),n.setAttribute("class","tempDiv"),s.length>0){for(var r=void 0,o=void 0,a=void 0;n.firstChild;){var l=!1;if("#text"===n.firstChild.nodeName&&" "===n.firstChild.textContent){l=!(!sf.base.isNullOrUndefined(n.firstChild.nextSibling)&&-1!==["A","ABBR","ACRONYM","B","BDO","BIG","BR","BUTTON","CITE","CODE","DFN","EM","I","INPUT","KBD","LABEL","MAP","OBJECT","Q","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","TT","U","VAR","WBR"].indexOf(n.firstChild.nextSibling.nodeName))}"BR"!==t.enterKey&&("#text"===n.firstChild.nodeName&&(n.firstChild.textContent.indexOf("\n")<0||""!==n.firstChild.textContent.trim())||_.indexOf(n.firstChild.nodeName.toLocaleLowerCase())>=0)&&!l?(r?o.appendChild(n.firstChild):(a="DIV"===t.enterKey?sf.base.createElement("div"):sf.base.createElement("p"),i.appendChild(a),a.appendChild(n.firstChild)),o=a,r=!0):"#text"!==n.firstChild.nodeName||!("\n"===n.firstChild.textContent||n.firstChild.textContent.indexOf("\n")>=0&&""===n.firstChild.textContent.trim()||l)||!sf.base.isNullOrUndefined(t.viewSourceModule)&&sf.base.isNullOrUndefined(t.viewSourceModule)?(i.appendChild(n.firstChild),r=!1):sf.base.detach(n.firstChild)}for(var d=i.querySelectorAll("img"),c=0;c<d.length;c++)d[c].classList.contains("e-rte-image")||d[c].classList.add("e-rte-image"),d[c].classList.contains("e-imginline")||d[c].classList.contains("e-imgbreak")||d[c].classList.add("e-imginline")}return i.innerHTML}function Z(e){return e.replace(/&amp;/g,"&").replace(/&amp;lt;/g,"<").replace(/&lt;/g,"<").replace(/&amp;gt;/g,">").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;nbsp;/g," ").replace(/&quot;/g,"")}function ee(e,t){var n=new Event(t,{bubbles:!1,cancelable:!0});e.dispatchEvent(n)}function te(e,t){var n=!1;return e.classList.contains(t)&&(n=!0),n}function ne(e){var t=sf.base.createElement("template");return t.innerHTML=e,t.content instanceof DocumentFragment?t.content:document.createRange().createContextualFragment(e)}function ie(e){return sf.base.isNullOrUndefined(e)?"":e}function se(e,t){e.dropDownModule;for(var n,i,s,r,o,a,l,d=e.args,c=0,h=Object.keys(e.args);c<h.length;c++)for(var p=h[c],u=0;u<e.tbItems.length;u++){var f=e.tbItems[u]&&e.tbItems[u].subCommand,m=f&&f.toLocaleLowerCase();if(f&&m===p||"UL"===f&&"unorderedlist"===p||"OL"===f&&"orderedlist"===p||"CodeBlock"===f&&"isCodeBlock"===p||"pre"===m&&"insertcode"===p||"NumberFormatList"===f&&"numberFormatList"===p||"BulletFormatList"===f&&"bulletFormatList"===p)if("boolean"==typeof d[p])!0===d[p]?sf.base.addClass([e.tbElements[u]],["e-active"]):sf.base.removeClass([e.tbElements[u]],["e-active"]);else if(("string"==typeof d[p]||null===d[p])&&X(p,e.parent.toolbarSettings.items)>=-1){var g=d[p]?d[p]:"",b="",v=void 0;switch(p){case"formats":l=e.parent.format.items,b="empty"===g?"":G(l,g,"subCommand","text"),a=sf.base.isNullOrUndefined(e.parent.format.default)?l[0].text:e.parent.format.default,(v=e.tbElements[u].querySelector(".e-rte-dropdown-btn-text")).innerText=sf.base.isNullOrUndefined(b)?a:b,v.parentElement.style.width=e.parent.format.width;break;case"alignments":b=G(e.parent.alignments,g,"subCommand","cssClass"),v=e.tbElements[u].querySelector(".e-btn-icon.e-icons"),sf.base.removeClass([v],["e-justify-left","e-justify-center","e-justify-right","e-justify-full"]),sf.base.addClass([v],sf.base.isNullOrUndefined(b)?["e-icons","e-justify-left"]:b.split(" "));break;case"fontname":o=e.parent.fontFamily.items,b="empty"===g?"":G(o,g,"value","text"),r=sf.base.isNullOrUndefined(e.parent.fontFamily.default)?o[0].text:e.parent.fontFamily.default,s=sf.base.isNullOrUndefined(b)?r:b,(v=e.tbElements[u].querySelector(".e-rte-dropdown-btn-text")).innerText=s===e.parent.localeData.default?e.parent.localeData.fontFamily:s,v.parentElement.style.width=e.parent.fontFamily.width;break;case"fontsize":i=e.parent.fontSize.items,n=sf.base.isNullOrUndefined(e.parent.fontSize.default)?i[0].value:e.parent.fontSize.default,b="empty"===g?"":G(i,""===g?n.replace(/\s/g,""):g,"value","text"),(v=e.tbElements[u].querySelector(".e-rte-dropdown-btn-text")).innerText=ie(b)===e.parent.localeData.default?e.parent.localeData.fontSize:ie(b),v.parentElement.style.width=e.parent.fontSize.width;break;case"bulletFormatList":case"numberFormatList":""!==g?sf.base.addClass([e.tbElements[u]],["e-active"]):sf.base.removeClass([e.tbElements[u]],["e-active"])}}}}function re(e,t,n){return n?window.scrollY+t.getBoundingClientRect().top+e.clientY:e.pageY}!function(e){e.InsertLink="InsertLink",e.InsertImage="InsertImage",e.InsertAudio="InsertAudio",e.InsertVideo="InsertVideo",e.InsertTable="InsertTable"}(z||(z={})),function(e){e.Expand="Expand",e.MultiRow="MultiRow",e.Scrollable="Scrollable",e.Popup="Popup"}(V||(V={})),function(e){e.Uploaded="Uploaded",e.Dropped="Dropped",e.Pasted="Pasted"}(j||(j={})),function(e){e.Uploaded="Uploaded",e.Dropped="Dropped",e.Pasted="Pasted"}(W||(W={}));var oe,ae,le=function(){function e(e){this.isToolbar=!1,this.isTransformChild=!1,this.parent=e,this.tbElement=this.parent.getToolbarElement(),this.checkIsTransformChild(),this.addEventListener()}return e.prototype.getToolbarHeight=function(){return this.parent.getToolbar().offsetHeight},e.prototype.getExpandTBarPopHeight=function(){var e=0;if(this.parent.toolbarSettings.type===V.Expand&&this.parent.getToolbar().classList.contains("e-extended-toolbar")){var t=sf.base.select(".e-toolbar-extended",this.parent.getToolbar());t&&this.parent.getToolbar().classList.contains("e-expand-open")||t&&t.classList.contains("e-popup-open")?(sf.base.addClass([t],["e-visible"]),e+=t.offsetHeight,sf.base.removeClass([t],["e-visible"])):sf.base.removeClass([this.parent.getToolbar()],["e-expand-open"])}return e},e.prototype.updateToolbarStatus=function(e){this.parent.getToolbarElement()&&(!this.parent.inlineMode.enable||!C()&&sf.base.Browser.isDevice)&&se("Popup"===this.parent.toolbarSettings.type?{args:e,dropDownModule:null,parent:this.parent,tbElements:sf.base.selectAll(".e-toolbar-item:not(.e-rte-custom-toolbar):not(.e-separator)",this.parent.getToolbarElement()),tbItems:this.parent.toolbarSettings.items.filter((function(e){return null!==e}))}:{args:e,dropDownModule:null,parent:this.parent,tbElements:sf.base.selectAll(".e-toolbar-item:not(.e-rte-custom-toolbar)",this.parent.getToolbarElement()),tbItems:this.parent.toolbarSettings.items},this.parent.inlineMode.enable)},e.prototype.checkIsTransformChild=function(){this.isTransformChild=!1;for(var e=sf.base.selectAll('[style*="transform"]',document),t=0;t<e.length;t++)if(!sf.base.isNullOrUndefined(e[t].contains)&&e[t].contains(this.parent.element)){this.isTransformChild=!0;break}},e.prototype.toggleFloatClass=function(e){if(this.tbElement&&this.tbElement.parentElement){var t=this.parent.floatingToolbarOffset;this.parent.toolbarSettings.enableFloating?(sf.base.addClass([this.tbElement.parentElement],["e-rte-tb-float"]),sf.base.setStyleAttribute(this.tbElement.parentElement,{top:t+"px"})):(sf.base.removeClass([this.tbElement.parentElement],["e-rte-tb-float"]),sf.base.setStyleAttribute(this.tbElement.parentElement,{top:""}))}},e.prototype.showFixedTBar=function(){this.tbElement=this.parent.getToolbarElement(),sf.base.addClass([this.tbElement],["e-show"]),sf.base.Browser.isIos&&sf.base.addClass([this.tbElement],["e-tbar-ios-fixed"])},e.prototype.hideFixedTBar=function(){this.tbElement=this.parent.getToolbarElement(),this.isToolbar?this.isToolbar=!1:sf.base.removeClass([this.tbElement],["e-show","e-tbar-ios-fixed"])},e.prototype.dropDownBeforeOpenHandler=function(e){this.isToolbar=!0,!sf.base.isNullOrUndefined(sf.base.closest(e.element,".e-rte-toolbar"))&&sf.base.isNullOrUndefined(sf.base.closest(e.element,".e-rte-quick-toolbar"))&&this.parent.hideTableQuickToolbar()},e.prototype.addEventListener=function(){this.parent.observer.on("refresh-begin",this.onRefresh,this),this.parent.observer.on(d,this.mouseDownHandler,this),this.parent.observer.on("focusChange",this.focusChangeHandler,this),this.parent.observer.on("toolbar-updated",this.updateToolbarStatus,this),this.parent.observer.on("beforeDropDownOpen",this.dropDownBeforeOpenHandler,this),this.parent.observer.on(t,this.wireEvents,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("refresh-begin",this.onRefresh),this.parent.observer.off(d,this.mouseDownHandler),this.parent.observer.off("focusChange",this.focusChangeHandler),this.parent.observer.off("toolbar-updated",this.updateToolbarStatus),this.parent.observer.off("beforeDropDownOpen",this.dropDownBeforeOpenHandler),this.parent.observer.off(t,this.wireEvents)},e.prototype.wireEvents=function(){this.parent.inlineMode.enable||this.toggleFloatClass(),this.parent.inlineMode.enable&&C()||(this.tbElement=this.parent.getToolbarElement(),this.tbElement&&(sf.base.EventHandler.add(this.tbElement,"focusin",this.tbFocusHandler,this),this.parent.inlineMode.enable||(this.keyBoardModule=new sf.base.KeyboardEvents(this.tbElement,{eventName:"keydown",keyAction:this.toolBarKeyDown.bind(this),keyConfigs:this.parent.formatter&&this.parent.formatter.keyConfig}))))},e.prototype.unWireEvents=function(){this.tbElement&&(sf.base.EventHandler.remove(this.tbElement,"focusin",this.tbFocusHandler),this.parent.inlineMode.enable||this.keyBoardModule&&this.keyBoardModule.destroy())},e.prototype.onRefresh=function(){this.parent.dotNetRef.invokeMethodAsync("RefreshToolbarOverflow")},e.prototype.tbFocusHandler=function(e){var t=document.activeElement,n=sf.base.closest(t,".e-rte-toolbar");if(t===this.parent.getToolbarElement()||n===this.parent.getToolbarElement())for(var i=this.parent.getToolbarElement().querySelectorAll(".e-expended-nav"),s=0;s<i.length;s++)sf.base.isNullOrUndefined(this.parent.getToolbarElement().querySelector(".e-insert-table-btn"))?i[s].setAttribute("tabindex","0"):i[s].setAttribute("tabindex","1")},e.prototype.toolBarKeyDown=function(e){switch(e.action){case"escape":this.parent.getEditPanel().focus()}},e.prototype.mouseDownHandler=function(){sf.base.Browser.isDevice&&this.parent.inlineMode.enable&&!C()&&this.showFixedTBar()},e.prototype.focusChangeHandler=function(){sf.base.Browser.isDevice&&this.parent.inlineMode.enable&&!C()&&(this.isToolbar=!1,this.hideFixedTBar())},e.prototype.destroy=function(){this.removeEventListener(),this.unWireEvents()},e}(),de="INSERT-IMAGE",ce="INSERT-AUDIO",he="INSERT-VIDEO",pe="INSERT-TABLE",ue="INSERT-LINK",fe=["address","article","aside","audio","blockquote","canvas","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul","video","body"],me=["td","th"],ge=["table","tbody","td","tfoot","th","thead","tr"],be=["area","base","br","embed","hr","img","input","param","source","track","wbr","iframe","td","table"],ve=["word","excel","onenote"],ye=["article","aside","blockquote","body","canvas","details","div","fieldset","figure","footer","form","header","li","main","nav","noscript","section"],Ce={h6:"###### ",h5:"##### ",h4:"#### ",h3:"### ",h2:"## ",h1:"# ",blockquote:"> ",pre:"```\n",p:""},Ne={Bold:"**",Italic:"*",StrikeThrough:"~~",InlineCode:"`",SubScript:"<sub>",SuperScript:"<sup>",UpperCase:"A-Z",LowerCase:"a-z"},Ee={OL:"1. ",UL:"- "},Se={"toolbar-focus":"alt+f10",escape:"escape",backspace:"backspace","insert-link":"ctrl+k","insert-image":"ctrl+shift+i","insert-audio":"ctrl+shift+a","insert-video":"ctrl+alt+v","insert-table":"ctrl+shift+e",undo:"ctrl+z",redo:"ctrl+y",copy:"ctrl+c",cut:"ctrl+x",paste:"ctrl+v",bold:"ctrl+b",italic:"ctrl+i",underline:"ctrl+u",strikethrough:"ctrl+shift+s",uppercase:"ctrl+shift+u",lowercase:"ctrl+shift+l",superscript:"ctrl+shift+=",subscript:"ctrl+=",indents:"ctrl+]",outdents:"ctrl+[","html-source":"ctrl+shift+h","full-screen":"ctrl+shift+f","decrease-fontsize":"ctrl+shift+<","increase-fontsize":"ctrl+shift+>","justify-center":"ctrl+e","justify-full":"ctrl+j","justify-left":"ctrl+l","justify-right":"ctrl+r","clear-format":"ctrl+shift+r","ordered-list":"ctrl+shift+o","unordered-list":"ctrl+alt+o",space:"space",enter:"enter",tab:"tab","shift-tab":"shift+tab",delete:"delete","format-copy":"alt+shift+c","format-paste":"alt+shift+v",inlinecode:"ctrl+`","code-block":"ctrl+shift+b",checklist:"ctrl+shift+9",print:"ctrl+p"},Te={"toolbar-focus":"alt+f10",escape:"27","insert-link":"ctrl+k","insert-image":"ctrl+shift+i","insert-table":"ctrl+shift+e",undo:"ctrl+z",redo:"ctrl+y",copy:"ctrl+c",cut:"ctrl+x",paste:"ctrl+v",bold:"ctrl+b",italic:"ctrl+i",strikethrough:"ctrl+shift+s",uppercase:"ctrl+shift+u",lowercase:"ctrl+shift+l",superscript:"ctrl+shift+=",subscript:"ctrl+=","full-screen":"ctrl+shift+f","ordered-list":"ctrl+shift+o","unordered-list":"ctrl+alt+o"},Le={b:["strong"],strong:["b"],i:["emp","cite"],emp:["i","cite"],cite:["i","emp"]},Oe=["BR","IMG"],ke={topLeft:[-1,-1],topRight:[1,-1],botRight:[1,1],botLeft:[-1,1]},xe=["ArrowUp","ArrowDown","Enter","Tab","Escape"],we=["Enter","ArrowRight","ArrowLeft"],Ae=function(){function e(e,t){this.BLOCK_TAGS=["p","h1","h2","h3","h4","h5","h6","blockquote","li","pre","td","th","div","hr","section","figure"],this.BASIC_FORMATS=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.root=e,this.currentDocument=t}return e.prototype.getBlockNodes=function(){var e=[];if(sf.base.isNullOrUndefined(this.root.querySelector(".e-cell-select")))return e;var t=this.root.querySelector(".e-cell-select").closest("table").querySelectorAll(".e-cell-select");if(sf.base.isNullOrUndefined(t)||t.length<2)return e;for(var n=0;n<t.length;n++)this.addBlockNodes(t[n],e);return this.wrapParagraphNodes(e),e},e.prototype.addBlockNodes=function(e,t){var n=e.childNodes;if(0!==n.length)for(var i=0;i<n.length;i++){var s=n[i];t.indexOf(s.parentElement)>=0||(!s.parentElement||"TD"!==s.parentElement.nodeName&&"TH"!==s.parentElement.nodeName||1!==s.parentElement.childNodes.length||"BR"===s.nodeName||(s.nodeType,Node.TEXT_NODE),t.push(s.parentElement))}else t.push(e)},e.prototype.getTextNodes=function(){var e=[];if(sf.base.isNullOrUndefined(this.root.querySelector(".e-cell-select")))return e;var t=this.root.querySelector(".e-cell-select").closest("table").querySelectorAll(".e-cell-select");if(sf.base.isNullOrUndefined(t)||t.length<2)return e;for(var n=0;n<t.length;n++)this.addTextNodes(t[n],e);return e},e.prototype.addTextNodes=function(e,t){var n=e.childNodes;if(0===n.length&&("TD"===e.nodeName||"TH"===e.nodeName)){var i=this.currentDocument.createTextNode("​");return e.appendChild(i),void t.push(i)}if(1===n.length&&("TD"===e.nodeName||"TH"===e.nodeName)&&"BR"===n[0].nodeName){i=this.currentDocument.createTextNode("​");return e.insertBefore(i,n[0]),void t.push(i)}for(var s=0;s<n.length;s++){var r=n[s];r.nodeType===Node.TEXT_NODE?t.push(r):r.nodeType===Node.ELEMENT_NODE&&this.addTextNodes(r,t)}},e.prototype.wrapParagraphNodes=function(e){for(var t=Array.from(e),n=0;n<t.length;n++){var i=t[n];if("TD"===i.nodeName||"TH"===i.nodeName)if(1!==i.childNodes.length||"BR"!==i.childNodes[0].nodeName&&i.childNodes[0].nodeType!==Node.TEXT_NODE){var s=e.indexOf(i);this.wrapInlineNodes(i,e,s)}else{var r=i.childNodes[0],o=sf.base.createElement("p");r.parentElement.insertBefore(o,r),o.appendChild(r);var a=e.indexOf(i);e[a]=o}}for(n=0;n<e.length;n++){var l=e[n];if("LI"===l.nodeName&&1===l.childNodes.length){var d=l.childNodes[0];d.nodeType===Node.ELEMENT_NODE&&this.BASIC_FORMATS.indexOf(d.nodeName.toLocaleLowerCase())>=0&&d.textContent===l.textContent&&(e[n]=d)}}},e.prototype.wrapInlineNodes=function(e,t,n){var i=e.childNodes[0],s=sf.base.createElement("p"),r=[];if(sf.base.isNullOrUndefined(i))return e.appendChild(s),r.push(s),void S(t,r,n);for(;i;)if("BR"===i.nodeName)i.parentNode.insertBefore(s,i),s.appendChild(i),s.childNodes.length>0&&r.indexOf(s)<0&&r.push(s),i=s.nextSibling,s=sf.base.createElement("p");else if(this.BLOCK_TAGS.indexOf(i.nodeName.toLocaleLowerCase())>=0)if(r.push(i),s.childNodes.length>0)i=(s=i).nextSibling;else{if(i&&"LI"===i.nodeName&&i.querySelectorAll("li").length>0)for(var o=i.querySelectorAll("li"),a=0;a<o.length;a++)r.push(o[a]);i="LI"===i.nodeName&&sf.base.isNullOrUndefined(i.nextSibling)?i.parentElement.nextSibling:i.nextSibling}else if(i.nodeType===Node.TEXT_NODE){if(""===i.textContent.trim()&&i.textContent.indexOf("​")<0){var l=i.nextSibling;sf.base.detach(i),i=l;continue}i.parentNode.insertBefore(s,i);var d=i;s.appendChild(d),s.childNodes.length>0&&r.indexOf(s)<0&&r.push(s),i=s.nextSibling}else if("TABLE"===i.nodeName||"UL"===i.nodeName||"OL"===i.nodeName)if("TABLE"===i.nodeName){var c=[],h=i.querySelectorAll("td, th");for(a=0;a<h.length;a++)this.addBlockNodes(h[a],c);this.wrapParagraphNodes(c);for(a=0;a<c.length;a++)r.push(c[a]);i=i.nextSibling}else i=i.firstElementChild;else this.BLOCK_TAGS.indexOf(i.nodeName.toLocaleLowerCase())<0&&(i.parentNode.insertBefore(s,i),s.appendChild(i),s.childNodes.length>0&&r.indexOf(s)<0&&r.push(s),i=s.nextSibling);S(t,r,n)},e}(),Be="e-editor-select-start",Me="e-editor-select-end",Re=function(){function e(e,t){this.parent=e,this.nodeSelection=new et(e),this.currentDocument=t,this.tableSelection=new Ae(e,t)}return e.prototype.contents=function(e){return e&&"IFRAME"!==e.tagName?Array.prototype.slice.call(e.childNodes||[]):[]},e.prototype.isBlockNode=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&fe.indexOf(e.tagName.toLowerCase())>=0},e.prototype.isLink=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&"a"===e.tagName.toLowerCase()},e.prototype.blockParentNode=function(e){for(;e&&e.parentNode!==this.parent&&(!e.parentNode||!this.hasClass(e.parentNode,"e-node-inner"));null)if(e=e.parentNode,this.isBlockNode(e))return e;return e},e.prototype.rawAttributes=function(e){var t={},n=e.attributes;if(n.length>0)for(var i=0;i<n.length;i++){var s=n[i];t[s.nodeName]=s.value}return t},e.prototype.attributes=function(e){if(!e)return"";for(var t="",n=this.rawAttributes(e),i=Object.keys(n).sort(),s=0;s<i.length;s++){var r=i[s],o=n[""+r];o.indexOf("'")<0&&o.indexOf('"')>=0?t+=" "+r+"='"+o+"'":o.indexOf('"')>=0&&o.indexOf("'")>=0?t+=" "+r+'="'+(o=o.replace(/"/g,"&quot;"))+'"':t+=" "+r+'="'+o+'"'}return t},e.prototype.clearAttributes=function(e){for(var t=e.attributes,n=t.length-1;n>=0;n--){var i=t[n];e.removeAttribute(i.nodeName)}},e.prototype.openTagString=function(e){return"<"+e.tagName.toLowerCase()+this.attributes(e)+">"},e.prototype.closeTagString=function(e){return"</"+e.tagName.toLowerCase()+">"},e.prototype.createTagString=function(e,t,n){return"<"+e.toLowerCase()+this.attributes(t)+">"+n+"</"+e.toLowerCase()+">"},e.prototype.isList=function(e){return!!e&&["UL","OL"].indexOf(e.tagName)>=0},e.prototype.isElement=function(e){return e===this.parent},e.prototype.isEditable=function(e){return(!e.getAttribute||"true"===e.getAttribute("contenteditable"))&&["STYLE","SCRIPT"].indexOf(e.tagName)<0},e.prototype.hasClass=function(e,t){return e&&e.classList&&e.classList.contains(t)},e.prototype.replaceWith=function(e,t){var n=e.parentNode;null!==n&&n.insertBefore(this.parseHTMLFragment(t),e),sf.base.detach(e)},e.prototype.parseHTMLFragment=function(e){var t=sf.base.createElement("template");return t.innerHTML=e,t.content instanceof DocumentFragment?t.content:document.createRange().createContextualFragment(e)},e.prototype.wrap=function(e,t){return e.parentNode.insertBefore(t,e),(t=e.previousSibling).appendChild(e),t},e.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},e.prototype.wrapInner=function(e,t){for(e.appendChild(t),(t=e.querySelector(".e-rte-wrap-inner")).classList.remove("e-rte-wrap-inner"),0===t.classList.length&&t.removeAttribute("class");e.firstChild!==t;)t.appendChild(e.firstChild);return t},e.prototype.unWrap=function(e){var t=e&&e.parentNode;if(!t)return[];for(var n=[];e.firstChild&&" "!==e.textContent;)n.push(e.firstChild),t.insertBefore(e.firstChild,e);return n=n.length>0?n:[e.parentNode],t.removeChild(e),n},e.prototype.getSelectedNode=function(e,t){return e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>0&&e.childNodes[t-1]&&e.childNodes[t-1].nodeType===Node.ELEMENT_NODE&&(e.childNodes[t-1].classList.contains(Be)||e.childNodes[t-1].classList.contains(Me))?e=e.childNodes[t-1]:e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>0&&e.childNodes[t]&&(e=e.childNodes[t]),e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),e},e.prototype.nodeFinds=function(e,t){for(var n=[],i=0;i<t.length;i++)e.contains(t[i])&&e!==t[i]&&n.push(t[i]);return n},e.prototype.isEditorArea=function(){var e;for(e=this.getRangePoint(0).commonAncestorContainer;e&&!this.isElement(e);null)e=e.parentNode;return!!this.isElement(e)},e.prototype.getRangePoint=function(e){var t=this.getSelection(),n=[];if(t&&t.getRangeAt&&t.rangeCount){n=[];for(var i=0;i<t.rangeCount;i++)n.push(t.getRangeAt(i))}else n=[this.currentDocument.createRange()];return void 0!==e?n[e]:n},e.prototype.getSelection=function(){return this.nodeSelection.get(this.currentDocument)},e.prototype.getPreviousNode=function(e){for(e=e.previousElementSibling;e&&"\n"===e.textContent;null)e=e.previousElementSibling;return e},e.prototype.encode=function(e){var t=document.createElement("div");return t.innerText=e,t.innerHTML.replace(/<br\s*[\/]?>/gi,"\n")},e.prototype.saveMarker=function(e){var t,n,i=this.parent.querySelector("."+Be),s=this.parent.querySelector("."+Me);if(this.hasClass(i,Be)&&i.classList.length>1){var r=this.createTagString("p",i,this.encode(i.textContent));this.replaceWith(i,r),(i=this.parent.querySelector("."+Be)).classList.remove(Be),t=i.childNodes[0]}else t=this.unWrap(i)[0];if(this.hasClass(s,Me)&&s.classList.length>1){r=this.createTagString("p",s,this.encode(s.textContent));this.replaceWith(s,r),(s=this.parent.querySelector("."+Me)).classList.remove(Me),n=s.childNodes[0]}else n=s?this.unWrap(s)[0]:t;return e.startContainer=e.getNodeArray(t,!0),e.endContainer=e.getNodeArray(n,!1),e},e.prototype.marker=function(e,t){return'<span class="'+e+'">'+t+"</span>"},e.prototype.setMarker=function(e){var t=e.range,n=t.startContainer.childNodes,i=n.length>1&&"TABLE"===n[0].nodeName&&0===t.startOffset,s=n.length>1&&"IMAGE"===n[0].nodeName&&1===t.endOffset&&"#text"===t.endContainer.nodeName&&0===t.endContainer.textContent.length,r=(i?function(e){var t=e;do{t.childNodes.length>0&&(t=t.childNodes[0])}while(t.childNodes.length>0);return t}(n[t.startOffset+1]):n[t.startOffset>0?t.startOffset-1:t.startOffset])||t.startContainer,o=t.endContainer.childNodes[t.endOffset>0?s?t.endOffset:t.endOffset-1:t.endOffset]||t.endContainer;if(r.nodeType===Node.ELEMENT_NODE&&o.nodeType===Node.ELEMENT_NODE&&(r.contains(o)||o.contains(r))){var a=r.contains(o)?r:o;if(a.nodeType!==Node.TEXT_NODE){for(var l=[],d=[],c=a;a.contains(c);null)l.indexOf(c)<0&&c.childNodes&&c.childNodes.length?(l.push(c),c=c.childNodes[0]):c.nextSibling?c=c.nextSibling:c.parentNode&&(c=c.parentNode,l.push(c)),d.indexOf(c)<0&&(c.nodeType===Node.TEXT_NODE||me.indexOf(c.parentNode.tagName.toLocaleLowerCase())>=0&&("BR"===c.tagName||"IMG"===c.tagName))&&d.push(c);d.length&&(r=r.contains(o)?d[0]:r,o=d[d.length-1])}}if(r!==o){if(r.nodeType!==Node.TEXT_NODE&&("BR"===r.tagName&&me.indexOf(r.parentNode.tagName.toLocaleLowerCase())>=0||"IMG"===r.tagName))this.replaceWith(r,this.marker(Be,this.encode(r.textContent))),t.startContainer.querySelector("."+Be).appendChild(r);else if(3!==r.nodeType&&"#text"!==r.nodeName&&"BR"!==r.nodeName){var h=this.marker(Be,"");sf.base.append([this.parseHTMLFragment(h)],r)}else this.replaceWith(r,this.marker(Be,this.encode(r.textContent)));if(o.nodeType!==Node.TEXT_NODE&&"BR"===o.tagName&&me.indexOf(o.parentNode.tagName.toLocaleLowerCase())>=0)this.replaceWith(o,this.marker(Me,this.encode(o.textContent))),t.endContainer.querySelector("."+Me).appendChild(o);else this.ensureSelfClosingTag(o,Me,t)}else this.ensureSelfClosingTag(r,Be,t)},e.prototype.ensureSelfClosingTag=function(e,t,n){var i=!1;if(3===e.nodeType)this.replaceWith(e,this.marker(t,this.encode(e.textContent)));else if("BR"===e.tagName){this.replaceWith(e,this.marker(t,this.encode(e.textContent)));var s=n.startContainer.querySelector("."+t);s&&s.parentElement.appendChild(e)}else{var r=sf.base.isNullOrUndefined(e.parentElement)?"":e.parentElement.tagName.toLocaleLowerCase();if("IMG"===e.tagName&&"p"!==r&&"div"!==r){var o=document.createElement("p");e.parentElement.insertBefore(o,e),o.appendChild(e),e=o.children[0]}if("TABLE"===e.tagName)if(i=!0,""===e.textContent){var a=e.querySelectorAll("td");e=a[a.length-1],e=sf.base.isNullOrUndefined(e.childNodes[0])?e:e.childNodes[0]}else{for(var l=e.lastChild;3!==l.nodeType&&"#text"!==l.nodeName&&"BR"!==l.nodeName;)l=l.lastChild;e=l}for(var d=0;d<Oe.length;d++)e=e.tagName!==Oe[d]||i?e:e.parentNode;if(3===e.nodeType&&"#text"===e.nodeName)this.replaceWith(e,this.marker(t,this.encode(e.textContent)));else if("BR"===e.nodeName){this.replaceWith(e,this.marker(Me,this.encode(e.textContent))),n.endContainer.querySelector("."+Me).appendChild(e)}else if("HR"!==e.nodeName){var c=this.marker(t,"");sf.base.append([this.parseHTMLFragment(c)],e)}}},e.prototype.createTempNode=function(e){var t=e.textContent;if("BR"===e.tagName){var n="<p></p>",i=e.parentNode;me.indexOf(i.tagName.toLocaleLowerCase())>=0&&(e=this.wrap(e,this.parseHTMLFragment(n)))}else if(e.nodeType!==Node.TEXT_NODE&&(e.classList.contains(Be)||e.classList.contains(Me))||t.replace(/\n/g,"").replace(/(^ *)|( *$)/g,"").length>0||t.length&&t.indexOf("\n")<0&&" "!==t){n="<p></p>";if(e.parentNode&&!this.isBlockNode(e.parentNode))for(var s=this.getImmediateBlockNode(e),r=0,o=Array.from(s.childNodes);r<o.length;r++){var a=o[r];if(a&&a.contains(e)){e=a;break}}var l=e;e=this.wrap(e,this.parseHTMLFragment(n)),!(l.nodeType===Node.ELEMENT_NODE&&l.firstChild&&"BR"===l.firstChild.nodeName&&(l.classList.contains(Be)||l.classList.contains(Me)))&&e.nextElementSibling&&"BR"===e.nextElementSibling.tagName&&e.appendChild(e.nextElementSibling)}return e},e.prototype.getImageTagInSelection=function(){var e=this.getSelection();return this.isEditorArea()&&e.rangeCount?e.focusNode.querySelectorAll("img"):null},e.prototype.gatherElementsAround=function(e,t){var n=sf.base.createElement(t),i=e.previousSibling,s=e.parentElement;"e-editor-select-start"===s.className?s.parentNode.insertBefore(n,s):s&&s.insertBefore(n,e);for(var r=0;null!==i&&"BR"!==i.nodeName&&!this.isBlockNode(i);){var o=i.previousSibling;3!==i.nodeType&&1!==i.nodeType||(0===r?n.appendChild(i):n.insertBefore(i,n.firstChild)),i=o,r++}for(n.appendChild(e),i=n.nextSibling?n.nextSibling:n.parentElement.nextSibling;null!==i&&"BR"!==i.nodeName&&!this.isBlockNode(i);){var a=i.nextSibling?i.nextSibling:i.parentElement.nextSibling;3!==i.nodeType&&1!==i.nodeType||n.appendChild(i),i=a}return n},e.prototype.convertToBlockNodes=function(e,t){if(e.length>1)for(var n=0,i=e[0];!sf.base.isNullOrUndefined(i);){if("BR"===i.nodeName){var s=i.nextSibling;sf.base.detach(i),i=s}if(!sf.base.isNullOrUndefined(i)){e[n]=t?"LI"===i.nodeName||this.isBlockNode(i)?i:this.gatherElementsAround(i,t?"p":"div"):this.isBlockNode(e[n])?e[n]:this.gatherElementsAround(i,t?"p":"div");var r="LI"===e[n].nodeName?e[n].parentElement:e[n],o="#text"===r.nodeName?r.parentElement:r;null!==(i=sf.base.isNullOrUndefined(o.querySelector(".e-editor-select-end"))&&sf.base.isNullOrUndefined(sf.base.closest(i,".e-editor-select-end"))?r.nextSibling:null)||sf.base.isNullOrUndefined(r.nextSibling)||"BR"!==r.nextSibling.nodeName||sf.base.detach(r.nextSibling)}n++}else this.isBlockNode(e[0])||(e[0]=this.gatherElementsAround(e[0],t?"p":"div"),sf.base.isNullOrUndefined(e[0].nextSibling)||"BR"!==e[0].nextSibling.nodeName||(""===e[0].textContent?e[0].appendChild(e[0].nextSibling):sf.base.detach(e[0].nextSibling)));return e},e.prototype.blockNodes=function(e){var t=[],n=this.getSelection(),i=this.tableSelection.getBlockNodes();if(i.length>0)return i;if(this.isEditorArea()&&n.rangeCount)for(var s=this.getRangePoint(),r=function(n){var i=void 0,r=s[n],a=o.getSelectedNode(r.startContainer,r.startOffset),l=o.getSelectedNode(r.endContainer,r.endOffset);o.isBlockNode(a)&&t.indexOf(a)<0&&t.push(a),i=o.blockParentNode(a);var d=o.blockParentNode(l);if(i&&t.indexOf(i)<0)if(!sf.base.isNullOrUndefined(e)&&e){var c=["TD","TH"];if([r.commonAncestorContainer,i,d].some((function(e){return-1!==c.indexOf(e.nodeName)}))){var h=o.getPreBlockNodeCollection(r);h.length>1?o.wrapWithBlockNode(h,t):h.length>0&&(a!==l&&"BR"!==a.nodeName||a===l&&"SPAN"===a.nodeName&&(a.classList.contains(Be)||a.classList.contains(Me)))&&t.push(o.createTempNode(a))}else t.push(i)}else if(me.indexOf(i.tagName.toLocaleLowerCase())>=0&&("BR"===a.tagName||a.nodeType===Node.TEXT_NODE||a.classList.contains(Be)||a.classList.contains(Me))){var p=a.previousSibling&&a.previousSibling.nodeType===Node.TEXT_NODE?a.previousSibling:a;a.nextSibling||a.previousSibling||"BR"!==a.tagName?t.push(o.createTempNode(p)):t.push(p)}else t.push(i);for(var u=[],f=a;f!==l&&f!==o.parent;null)u.indexOf(f)<0&&f.childNodes&&f.childNodes.length?(u.push(f),f=f.childNodes[0]):f&&8!==f.nodeType&&("BR"===f.tagName||f.nodeType===Node.TEXT_NODE&&""!==f.textContent.trim()||f.nodeType!==Node.TEXT_NODE&&(f.classList.contains(Be)||f.classList.contains(Me)))&&me.indexOf(f.parentNode.tagName.toLocaleLowerCase())>=0?f=o.createTempNode(f):f.nextSibling&&8!==f.nextSibling.nodeType&&("BR"===f.nextSibling.tagName||f.nextSibling.nodeType===Node.TEXT_NODE||f.nextSibling.classList.contains(Be)||f.nextSibling.classList.contains(Me))&&me.indexOf(f.nextSibling.parentNode.tagName.toLocaleLowerCase())>=0?f=o.createTempNode(f.nextSibling):f.nextSibling?f=f.nextSibling:f.parentNode&&(f=f.parentNode,u.push(f)),t.indexOf(f)<0&&f.nodeType===Node.ELEMENT_NODE&&me.indexOf(f.parentNode.tagName.toLocaleLowerCase())>=0&&(f.classList.contains(Be)||f.classList.contains(Me))&&t.push(o.createTempNode(f)),o.isBlockNode(f)&&o.ignoreTableTag(f)&&u.indexOf(f)<0&&t.indexOf(f)<0&&(f!==l||r.endOffset>0)&&t.push(f),"IMG"===f.nodeName&&"true"===f.parentElement.contentEditable&&t.push(f);(i=o.blockParentNode(l))&&o.ignoreTableTag(i)&&t.indexOf(i)<0&&!sf.base.isNullOrUndefined(i.previousElementSibling)&&"IMG"!==i.previousElementSibling.tagName&&t.push(i)},o=this,a=0;a<s.length;a++)r(a);for(var l=t.length-1;l>0;l--){if(this.nodeFinds(t[l],t).length){var d=t[l].querySelectorAll("ul, ol");if("LI"===t[l].tagName&&d.length>0)continue;t.splice(l,1)}}return t},e.prototype.ignoreTableTag=function(e){return!(ge.indexOf(e.tagName.toLocaleLowerCase())>=0)},e.prototype.getPreBlockNodeCollection=function(e){var t=this.getSelectedNode(e.startContainer,e.startOffset),n=this.getSelectedNode(e.endContainer,e.endOffset),i=[],s=t.closest("td, th");if(sf.base.isNullOrUndefined(s))return i;for(var r=Array.from(s.childNodes),o=!0,a=this.getClosestInlineParent(t,s,!0),l=this.getClosestInlineParent(n,s,!1),d=0;d<r.length;d++){var c=r[d];a===l&&c===a?(i.push(c),o=!0):c===a?o=!1:c===l&&(i.push(c),o=!0),o||i.push(c)}return i},e.prototype.getClosestInlineParent=function(e,t,n){if(e.nodeType===Node.TEXT_NODE)return e;if(this.isBlockNode(e))return e;for(var i=e,s=!1;i;){var r=i;if(s){if(this.isBlockNode(i))return r;if(n&&i.previousSibling){if(this.isBlockNode(i.previousSibling)||"BR"===i.previousSibling.nodeName)return r;i=i.previousSibling}else{if(n||!i.nextSibling)return i;if(this.isBlockNode(i.nextSibling)||"BR"===i.nextSibling.nodeName)return r;i=i.nextSibling}}else(i=i.parentElement)===t&&(i=r,s=!0)}return null},e.prototype.wrapWithBlockNode=function(e,t){for(var n=sf.base.createElement("p"),i=0;i<e.length;i++){var s=e[i];if("BR"===s.nodeName)s.parentNode.insertBefore(n,s),n.appendChild(s),n.childNodes.length>0&&t.push(n),n=sf.base.createElement("p");else{if(this.isBlockNode(s))t.push(s);else{if("#text"===s.nodeName&&""===s.textContent.trim())continue;0===n.childElementCount?(s.parentNode.insertBefore(n,s),n.appendChild(s)):n.appendChild(s)}i===e.length-1&&n.nextElementSibling&&0===n.querySelectorAll("br").length&&"BR"===n.nextElementSibling.nodeName&&n.appendChild(n.nextElementSibling)}}n.childNodes.length>0&&t.indexOf(n)<0&&t.push(n)},e.prototype.getImmediateBlockNode=function(e){for(;e&&fe.indexOf(e.nodeName.toLocaleLowerCase())<0;)e=e.parentNode;return e},e}(),De=function(){function e(){}return e.WrapBefore=function(e,t,n){return t.innerText=e.textContent,n?this.AppendBefore(t,e,!0):this.AppendBefore(t,e),e.parentNode&&e.parentNode.removeChild(e),t.childNodes[0]},e.Wrap=function(e,t){return this.AppendBefore(t,e),t.appendChild(e),e},e.unwrap=function(e){var t,n=e.parentNode,i=e.ownerDocument.defaultView.getSelection(),s=null,r=0,o=null,a=0;i&&i.rangeCount&&(s=(t=i.getRangeAt(0)).startContainer,r=t.startOffset,o=t.endContainer,a=t.endOffset);for(var l=[];e.firstChild;null)l.push(n.insertBefore(e.firstChild,e));return n.removeChild(e),i&&s&&o&&l.length>0&&(s===e&&(s=l[Math.min(r,l.length-1)],r=0),o===e&&(o=l[Math.min(a,l.length-1)],a=0),i.removeAllRanges(),t.setStart(s,r),t.setEnd(o,a),i.addRange(t)),l},e.AppendBefore=function(e,t,n){return t.parentNode?n?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.insertBefore(e,t):t},e}(),Ie=function(){function e(){this.enterAction="P",this.position=-1,this.nodeSelection=new et}return e.prototype.GetSpliceNode=function(e,t){return t=this.SplitNode(e,t,!0),t=this.SplitNode(e,t,!1)},e.prototype.SplitNode=function(e,t,n){if(t){var i=e.cloneRange(),s=t.parentNode,r=this.nodeSelection.getIndex(t);i.collapse(n),n?i.setStartBefore(t):i.setEndAfter(t);var o=i.extractContents();if(n){if(t=s.childNodes[r],(o=this.spliceEmptyNode(o,!1))&&o.childNodes.length>0)if(!!(1!==o.childNodes.length||"IMG"===o.childNodes[0].nodeName||o.querySelectorAll("img").length>0||!this.isRteElm(o)||""!==o.textContent.trim()||32===o.textContent.charCodeAt(0)||160===o.textContent.charCodeAt(0)))if(t)De.AppendBefore(o,t);else s.appendChild(o),(a=document.createElement("div")).innerHTML="&#65279;&#65279;",t=a.firstChild,s.appendChild(t)}else if(t=s.childNodes.length>1?s.childNodes[r]:s.childNodes[0],(o=this.spliceEmptyNode(o,!0))&&o.childNodes.length>0)if(!!(1!==o.childNodes.length||"IMG"===o.childNodes[0].nodeName||!this.isRteElm(o)||""!==o.textContent.trim()||32===o.textContent.charCodeAt(0)||160===o.textContent.charCodeAt(0)))if(t)De.AppendBefore(o,t,!0);else if(s.childNodes.length>1&&s.childNodes.length!==r)t=s.childNodes[s.childNodes.length-1],De.AppendBefore(o,t,!0),t=t.nextSibling;else{var a;s.appendChild(o),(a=document.createElement("div")).innerHTML="&#65279;&#65279;",s.insertBefore(a.firstChild,s.firstChild),t=s.firstChild}return t}return null},e.prototype.isRteElm=function(e){var t=!0;if(1===e.childNodes.length&&"IMG"!==e.childNodes[0].nodeName)for(var n=e.childNodes[0],i=0;!sf.base.isNullOrUndefined(n.childNodes)&&i<n.childNodes.length;i++)("IMG"===n.childNodes[i].nodeName||"SPAN"===n.childNodes[i].nodeName&&(n.childNodes[i].classList.contains("e-video-wrap")||n.childNodes[i].classList.contains("e-embed-video-wrap")||n.childNodes[i].classList.contains("e-audio-wrap"))||"TABLE"===n.childNodes[i].nodeName||"HR"===n.childNodes[i].nodeName)&&(t=!1);else t=!0;return t},e.prototype.spliceEmptyNode=function(e,t){var n;return(n=1===e.childNodes.length&&"#text"===e.childNodes[0].nodeName&&""===e.childNodes[0].textContent||""===e.textContent?-1:e.childNodes.length-1)>-1&&!t?this.spliceEmptyNode(e.childNodes[n],t):n>-1?this.spliceEmptyNode(e.childNodes[0],t):3===e.nodeType||11===e.nodeType||"IMG"===e.nodeName||e.querySelectorAll("img").length>0||e.classList.contains("e-video-wrap")||e.classList.contains("e-audio-wrap")||e.parentNode.removeChild(e),e},e.prototype.GetCursorStart=function(e,t,n){for(var i=(e=n?e:e.reverse())[0],s=0;s<e.length&&(n?e[s]<t:e[s]>=t);s++)i=e[s];return i},e.prototype.GetCursorRange=function(e,t,n){var i=e.createRange(),s=[];s.push(0);for(var r=this.TrimLineBreak(n.data),o=r.indexOf(" ",0);-1!==o;)s.indexOf(o)<0&&s.push(o),new RegExp("\\s").test(r[o-1])&&s.indexOf(o-1)<0&&s.push(o-1),new RegExp("\\s").test(r[o+1])&&s.push(o+1),o=r.indexOf(" ",o+1);if(s.push(r.length),s.indexOf(t.startOffset)>=0||s.indexOf(t.startOffset-1)>=0&&(1!==t.startOffset||1===t.startOffset&&new RegExp("\\s").test(r[0]))||s[s.length-1]-1===t.startOffset&&t.endOffset!==r.length-1&&!new RegExp("\\s").test(r[0]))i=t,this.position=1;else{var a=this.GetCursorStart(s,t.startOffset,!0);0!==a&&r[a]&&" "===r[a]&&(a+=1),this.position=t.startOffset-a,i.setStart(t.startContainer,a),i.setEnd(t.startContainer,this.GetCursorStart(s,t.startOffset,!1))}return i},e.prototype.GetCursorNode=function(e,t,n){return this.GetSpliceNode(this.GetCursorRange(e,t,n),n)},e.prototype.TrimLineBreak=function(e){return e.replace(/(\r\n\t|\n|\r\t)/gm," ")},e}(),Ue=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),s=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,a=r.length;o<a;o++,s++)i[s]=r[o];return i},Pe=function(){function e(){}return e.Insert=function(e,t,n,i,s,r){var o=this.prepareInsertNode(t,i,n),a=sf.base.isNullOrUndefined(n)?0:n.scrollHeight,l=new et(n),d=new Ie,c=l.getRange(e);c=this.adjustSelectionRange(l,e,n,c);var h=this.isCursorAtStartPoint(c),p=c.collapsed,u=this.getNodeCollection(c,l,o),f="table"===o.nodeName.toLowerCase(),m=this.findRelevantParentNode(u,f,c,n);if(m&&"BR"===m.nodeName&&(m=m.parentNode),m&&"LI"===m.nodeName&&f)this.handleTableInListItem(c,o,m,u,l,d,n);else{var g="#text"!==o.nodeName&&!sf.base.isNullOrUndefined(o.children[0])&&!sf.base.isNullOrUndefined(o.children[0].tagName)&&"IMG"===o.children[0].tagName&&1===o.children.length;h&&""===c.startContainer.textContent&&"BR"!==c.startContainer.nodeName&&"BR"!==s&&g&&(c.startContainer.innerHTML="");var b=i||!sf.base.isNullOrUndefined(o)&&!sf.base.isNullOrUndefined(o.classList)&&o.classList.contains("pasteContent"),v=e.querySelectorAll("td.e-cell-select, th.e-cell-select");if(v&&v.length>1&&this.clearTargetCells(v),b){if(r&&r.tableObj&&r.tableObj.tablePastingObj){var y=r.tableObj.tablePastingObj,C=y.getValidTableFromPaste(o);if(v&&v.length>0&&C)return void y.handleTablePaste(C,v)}this.pasteInsertHTML(u,o,c,l,d,e,p,m,n,s)}else this.shouldInsertOutsideRange(n,c,p,m,o)?this.handleContentInsertionOutsideRange(e,n,c,l,d,p,m,o,u,t,h,s):this.handleContentInsertionInsideRange(e,c,l,m,o,h),this.shouldScrollToCursor(n,a,o)&&E(e,n)}},e.clearTargetCells=function(e){for(var t=0;t<e.length;t++)e[t].innerHTML="<br>"},e.prepareInsertNode=function(e,t,n){if("string"==typeof e)return e=H(e,n),(i=sf.base.createElement("div")).innerHTML=e.replace(/&(times|divide|ne)(;?)/g,"&amp;$1$2"),t?i:i.firstChild;var i,s=!sf.base.isNullOrUndefined(e)&&!sf.base.isNullOrUndefined(e.classList)&&e.classList.contains("pasteContent");return t&&!s?((i=sf.base.createElement("div")).appendChild(e),i):(-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&this.unwrapSpansAroundBlocks(e),e)},e.unwrapSpansAroundBlocks=function(e){var t=this;if(e.nodeType===Node.ELEMENT_NODE){var n=e;if(Array.from(n.childNodes).forEach((function(e){t.unwrapSpansAroundBlocks(e)})),"span"===n.tagName.toLowerCase()&&n.hasChildNodes()){if(null!==n.querySelector("address, article, aside, blockquote, canvas, dd, div, dl, dt, fieldset, figcaption, figure, footer, form, h1, h2, h3, h4, h5, h6, header, hr, li, main, nav, noscript, ol, p, pre, section, table, tfoot, ul, video")&&n.parentNode){for(;n.firstChild;)n.parentNode.insertBefore(n.firstChild,n);n.parentNode.removeChild(n)}}}},e.adjustSelectionRange=function(e,t,n,i){return i.startContainer===i.endContainer&&0===i.startOffset&&i.startOffset===i.endOffset?(i=this.adjustEmptyEditorSelection(e,t,n,i),i=this.adjustSelectionToFirstTextNode(e,t,n,i),i=this.adjustBrElementSelection(e,t,i)):i},e.adjustEmptyEditorSelection=function(e,t,n,i){return i.startContainer!==n||0!==n.textContent.length||"P"!==n.children[0].tagName&&"DIV"!==n.children[0].tagName&&"BR"!==n.children[0].tagName?i:(e.setSelectionText(t,i.startContainer.children[0],i.startContainer.children[0],0,0),e.getRange(t))},e.adjustSelectionToFirstTextNode=function(e,t,n,i){if(i.startContainer===n&&n.textContent.trim().length>0&&"TABLE"!==n.childNodes[0].tagName){var s=this.findFirstTextNode(i.startContainer);if(!sf.base.isNullOrUndefined(s))return e.setSelectionText(t,s,s,0,0),e.getRange(t)}return i},e.adjustBrElementSelection=function(e,t,n){if("BR"===n.startContainer.nodeName){var i=Array.prototype.slice.call(n.startContainer.parentElement.childNodes).indexOf(n.startContainer);return e.setSelectionText(t,n.startContainer.parentElement,n.startContainer.parentElement,i,i),e.getRange(t)}return n},e.handleTableInListItem=function(e,t,n,i,s,r,o){if(0===i.length){var a=s.processedTableImageCursor(e);if("TABLE"===a.startName||"TABLE"===a.endName){var l=a.start?a.startNode:a.endNode;i.push(l)}}var d=this.findClosestRelevantElement(i[i.length-1].parentNode,o);this.insertTableInList(e,t,n,i[0],r,d)},e.isCursorAtStartPoint=function(e){return 0===e.startOffset&&e.startOffset===e.endOffset&&e.startContainer===e.endContainer},e.findRelevantParentNode=function(e,t,n,i){return t?sf.base.isNullOrUndefined(e[0])||sf.base.isNullOrUndefined(e[0].parentNode)?n.startContainer:this.findClosestRelevantElement(e[0].parentNode,i):e[0]},e.shouldInsertOutsideRange=function(e,t,n,i,s){return e!==t.startContainer&&(!n&&!(i.nodeType===Node.ELEMENT_NODE&&-1!==ge.indexOf(i.tagName.toLocaleLowerCase()))||"table"===s.nodeName.toLowerCase()&&i&&-1===ge.indexOf(i.tagName.toLocaleLowerCase()))},e.handleContentInsertionOutsideRange=function(e,t,n,i,s,r,o,a,l,d,c,h){var p=s.GetSpliceNode(n,o),u=p.previousSibling,f=p.parentNode;if(1===l.length)i.setSelectionContents(e,p),n=i.getRange(e);else if(f&&"LI"!==f.nodeName){var m=s.GetSpliceNode(n,l[l.length-1].parentElement);m=sf.base.isNullOrUndefined(m)?p:m,i.setSelectionText(e,p,m,0,3===m.nodeType?m.textContent.length:m.childNodes.length),n=i.getRange(e)}this.extractOrCleanupContent(n,f),"TABLE"===d.tagName&&this.cleanupForTableInsertion(n,t),this.removeOriginalNodes(l),this.insertNodeAtLocation(e,u,f,t,a,p,d,c,n,h),this.removeEmptyElements(t),this.setSelectionAfterInsertion(a,i,e)},e.extractOrCleanupContent=function(e,t){null!==e.startContainer.parentElement.closest("ol,ul")&&null!==e.endContainer.parentElement.closest("ol,ul")?function(e,t){if(null!==e.startContainer.parentElement.closest("ol,ul")&&null!==e.endContainer.parentElement.closest("ol,ul")){e.extractContents();var n=("#text"===e.startContainer.nodeName?e.startContainer.parentElement:e.startContainer).querySelectorAll("li");n.length>0&&n.forEach((function(e){sf.base.isNullOrUndefined(e.firstChild)||"OL"!==e.firstChild.nodeName&&"UL"!==e.firstChild.nodeName||(e.style.listStyleType="none"),""===e.innerHTML.trim()&&e!==t&&e.remove();var n="LI"===t.nodeName?t:sf.base.closest(t,"li");""===e.textContent.trim()&&e!==n&&e.remove()}))}}(e,t):e.extractContents()},e.cleanupForTableInsertion=function(e,t){var n=sf.base.closest(e.startContainer,"blockquote");if(!sf.base.isNullOrUndefined(n)&&n.childNodes.length>0)for(var i=n.childNodes.length-1;i>=0;i--){var s=n.childNodes[i];sf.base.isNullOrUndefined(s)||""!==s.innerText.trim()||sf.base.detach(s)}this.removeEmptyElements(t,!1,n)},e.removeOriginalNodes=function(e){for(var t=0;t<e.length;t++)if(3!==e[t].nodeType&&null!=e[t].parentNode){if("IMG"===e[t].nodeName)continue;e[t].parentNode.removeChild(e[t])}},e.insertNodeAtLocation=function(e,t,n,i,s,r,o,a,l,d){sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(t.parentNode)?(n=this.findAppropriateParentNode(n,i),this.insertNodeBasedOnContext(n,i,s,o,a,l,r,d)):e.contains(t)?De.AppendBefore(s,t,!0):l.insertNode(s)},e.findAppropriateParentNode=function(e,t){for(var n=null;e!==t&&e.firstChild&&""===e.textContent.trim()&&"LI"!==e.nodeName;){n=e,e=e.parentNode}return null!==n?n:e},e.insertNodeBasedOnContext=function(e,t,n,i,s,r,o,a){if(e.firstChild&&(e!==t||"TABLE"===n.nodeName&&s&&e===r.startContainer&&e===r.endContainer))if(""===e.textContent.trim()&&e!==t&&"LI"===e.nodeName)e.appendChild(n);else if(""===e.textContent.trim()&&e!==t){if(!e.parentNode||e.parentNode!==t||this.isBlockElement(n)||a&&"BR"===a.toUpperCase())De.AppendBefore(n,e,!1);else{var l=a&&"DIV"===a.toUpperCase()?sf.base.createElement("div"):sf.base.createElement("p");l.appendChild(n),De.AppendBefore(l,e,!1)}sf.base.detach(e)}else De.AppendBefore(n,e.firstChild,!1);else sf.base.isNullOrUndefined(o.previousSibling)&&"TABLE"===i.tagName?e.prepend(n):e.appendChild(n)},e.setSelectionAfterInsertion=function(e,t,n){"IMG"===e.nodeName?this.imageFocus(e,t,n):3!==e.nodeType?t.setSelectionText(n,e,e,0,e.childNodes.length):t.setSelectionText(n,e,e,0,e.textContent.length)},e.handleContentInsertionInsideRange=function(e,t,n,i,s,r){var o=sf.base.isNullOrUndefined(i)?null:sf.base.closest(i,"li");this.shouldInsertInTableCell(i,o,r)?(t.extractContents(),o.appendChild(s),this.removeEmptyNextLI(o)):this.insertWithRangeHandling(e,t,s,r),this.setCursorAfterInsertion(e,s,n)},e.shouldInsertInTableCell=function(e,t,n){return!(sf.base.isNullOrUndefined(e)||"TD"!==e.nodeName&&"TH"!==e.nodeName||sf.base.isNullOrUndefined(t)||n)},e.insertWithRangeHandling=function(e,t,n,i){if(t.deleteContents(),i&&""===t.startContainer.textContent&&"BR"!==t.startContainer.nodeName&&(t.startContainer.innerHTML=""),sf.base.Browser.isIE){var s=e.createDocumentFragment();s.appendChild(n),t.insertNode(s)}else this.isHrElement(t)?this.insertAfterHrElement(t,n):this.insertBasedOnStartContainer(t,n)},e.isHrElement=function(e){return 1===e.startContainer.nodeType&&"hr"===e.startContainer.nodeName.toLowerCase()&&"hr"===e.endContainer.nodeName.toLowerCase()},e.insertAfterHrElement=function(e,t){var n=e.startContainer.nextElementSibling;n&&(n.querySelector("br")&&sf.base.detach(n.querySelector("br")),n.appendChild(t))},e.insertBasedOnStartContainer=function(e,t){"BR"===e.startContainer.nodeName?e.startContainer.parentElement.insertBefore(t,e.startContainer):e.insertNode(t)},e.setCursorAfterInsertion=function(e,t,n){3!==t.nodeType&&t.childNodes.length>0?n.setSelectionText(e,t,t,1,1):"IMG"===t.nodeName?this.imageFocus(t,n,e):3!==t.nodeType?n.setSelectionContents(e,t):n.setSelectionText(e,t,t,t.textContent.length,t.textContent.length)},e.shouldScrollToCursor=function(e,t,n){return!sf.base.isNullOrUndefined(e)&&t<e.scrollHeight&&1===n.nodeType&&("IMG"===n.nodeName||!sf.base.isNullOrUndefined(n.querySelector("img")))},e.removeEmptyNextLI=function(e){for(var t=sf.base.closest(e,"ul,ol");t&&t.parentElement&&"LI"===t.parentElement.nodeName;)t=sf.base.closest(t.parentElement,"ul,ol");if(t){var n=t.querySelectorAll("li");n.forEach((function(e){(function(e){return""===e.textContent.trim()&&!e.querySelector("audio,video,img,table,br")})(e)&&sf.base.detach(e)}))}},e.findFirstTextNode=function(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var t=0;t<e.childNodes.length;t++){var n=this.findFirstTextNode(e.childNodes[t]);if(!sf.base.isNullOrUndefined(n))return n}return null},e.pasteInsertHTML=function(e,t,n,i,s,r,o,a,l,d){var c=this.getImmediateBlockNode(e[e.length-1],l);if(c&&0===c.textContent.length){var h=c.querySelector("br:last-of-type");h&&h.classList.add("rte-temp-br")}var p=n.startOffset===n.endOffset&&n.startContainer===n.endContainer;n=this.adjustRangeForEmptyEditor(e,n,i,r,l,p);var u=this.setupRangeForPaste(e,t,n,i,s,r,o,a,l);n=u.range;var f=this.containsBlockElements(t)?this.handleBlockNodeContent(e,t,n,s,l,d,o):this.handleInlineContent(e,t,n,i,r,l,p,u.sibNode,u.lasNode,u.isSingleNode),m=this.processSpecialNodes(f,t,d);this.positionCursorAfterPaste(m,t,i,r,l,d),this.alignCheck(l),this.listCleanUp(i,r),this.removeEmptyBrFromParagraph(l)},e.removeEmptyBrFromParagraph=function(e){var t=e.querySelector("br.rte-temp-br");t&&t.remove()},e.adjustRangeForEmptyEditor=function(e,t,n,i,s,r){if(r&&t.startContainer===s&&""===s.textContent&&0===t.startOffset&&0===t.endOffset&&"TABLE"!==s.childNodes[0].tagName){var o=this.getImmediateBlockNode(e[e.length-1],s);return n.setSelectionText(i,o,o,0,0),n.getRange(i)}return t},e.setupRangeForPaste=function(e,t,n,i,s,r,o,a,l){var d,c,h,p=!1;if(l!==n.startContainer&&(!o&&(a.nodeType!==Node.ELEMENT_NODE||-1===ge.indexOf(a.tagName.toLocaleLowerCase()))||"table"===t.nodeName.toLowerCase()&&a&&-1===ge.indexOf(a.tagName.toLocaleLowerCase()))&&"HR"!==t.firstChild.nodeName&&(d=s.GetSpliceNode(n,a),!sf.base.isNullOrUndefined(d)))if(c=sf.base.isNullOrUndefined(d.previousSibling)?d.parentNode.previousSibling:d.previousSibling,1===e.length)i.setSelectionContents(r,d),n=i.getRange(r),p=!0;else{var u=e[e.length-1].textContent?e[e.length-1].textContent:"";(h=s.GetSpliceNode(n,e[e.length-1].parentElement))&&"LI"===h.nodeName&&h.nextSibling&&"LI"===h.nextSibling.nodeName&&(this.isAnotherLiFromEndLi=u!==h.textContent),h=sf.base.isNullOrUndefined(h)?d:h,i.setSelectionText(r,d,h,0,3===h.nodeType?h.textContent.length:h.childNodes.length),n=i.getRange(r),p=!1}return this.removingComments(t),{preNode:d,sibNode:c,lasNode:h,isSingleNode:p,range:n}},e.containsBlockElements=function(e){for(var t=e.childNodes,n=0;n<t.length;n++)if(fe.indexOf(t[n].nodeName.toLowerCase())>=0)return!0;return!1},e.handleInlineContent=function(e,t,n,i,s,r,o,a,l,d){var c=document.createDocumentFragment();return o?this.handleCursorInlineContent(e,t,n,i,s,r,c):this.handleRegularInlineContent(t,n,c,r,a,l,d)},e.handleRegularInlineContent=function(e,t,n,i,s,r,o){for(var a;e.firstChild;)a=e.firstChild,n.appendChild(e.firstChild);if(o)t.deleteContents(),this.removeEmptyElements(i,!0),t.insertNode(n);else{var l=i===t.startContainer?t.startContainer:t.startContainer.parentNode,d=Array.prototype.indexOf.call(l.childNodes,-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&i===t.startContainer?t.startContainer.firstChild:t.startContainer);t.deleteContents(),-1!==d&&(t.setStart(l,d),t.setEnd(l,d)),sf.base.isNullOrUndefined(r)||r===i||(sf.base.detach(r),this.removeEmptyElements(i,!0)),sf.base.isNullOrUndefined(s)?t.insertNode(n):s.parentNode===i?s.appendChild(n):s.parentNode.appendChild(n)}return a},e.handleCursorInlineContent=function(e,t,n,i,s,r,o){var a,l=this.getImmediateBlockNode(n.startContainer,r),d=sf.base.createElement("span",{className:"tempSpan"});for(this.shouldInsertInAnchor(n)?this.insertInAnchor(n,d,r):this.isMentionChip(e)?n.startContainer.parentElement.insertAdjacentElement("afterend",d):0!==n.startOffset&&0!==n.endOffset&&n.startOffset===n.endOffset&&!t.querySelector("a")&&n.endOffset===n.startContainer.textContent.length&&l.lastChild.contains(n.startContainer)?l.appendChild(d):n.insertNode(d);t.firstChild;)a=t.firstChild,o.appendChild(t.firstChild);return this.insertFragmentOrReplaceNode(d,o,n,i,document,a,r)},e.shouldInsertInAnchor=function(e){var t=sf.base.closest(e.startContainer.parentElement,"a");return 3===e.startContainer.nodeType&&!sf.base.isNullOrUndefined(t)&&!sf.base.isNullOrUndefined(sf.base.closest(t,"span"))},e.insertInAnchor=function(e,t,n){var i=this.getImmediateBlockNode(e.startContainer,n);i.querySelectorAll("br").length>0&&sf.base.detach(i.querySelector("br")),sf.base.closest(sf.base.closest(e.startContainer.parentElement,"a"),"span").appendChild(t)},e.isMentionChip=function(e){return e[0]&&"#text"===e[0].nodeName&&e[0].nodeValue.includes("​")&&!sf.base.isNullOrUndefined(e[0].parentElement)&&!sf.base.isNullOrUndefined(e[0].parentElement.previousElementSibling)&&e[0].parentElement.previousElementSibling.classList.contains("e-mention-chip")},e.insertFragmentOrReplaceNode=function(e,t,n,i,s,r,o){var a=this.getClosestMatchingElement(e.parentNode,t,o),l=t.firstChild&&t.firstChild.childNodes.length>1;return 1===t.childNodes.length&&t.firstChild&&!l&&a?this.replaceWithMatchedContent(e,a,t,n,i,s,r):(e.parentNode.replaceChild(t,e),r)},e.replaceWithMatchedContent=function(e,t,n,i,s,r,o){var a=document.createElement("div"),l=n.firstChild.textContent||"";a.innerHTML=n.firstChild.innerHTML||"";var d=a.firstChild,c=o;if(d&&(t.replaceChild(d,e),t.parentNode&&d.nodeType===Node.TEXT_NODE&&this.shouldNormalizeTextNodes(d))){t.parentNode.normalize();var h=i.startOffset+l.length;s.setCursorPoint(r,t.firstChild,h),c=null}return a.remove(),c},e.shouldNormalizeTextNodes=function(e){return e.previousSibling&&e.previousSibling.nodeType===Node.TEXT_NODE||e.nextSibling&&e.nextSibling.nodeType===Node.TEXT_NODE},e.handleBlockNodeContent=function(e,t,n,i,s,r,o){var a=this.findParentPreElement(n,s);return sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(a)||"PRE"!==a.nodeName?this.processBlockContent(e,t,n,i,s,r,o):(n.insertNode(t),t.lastChild)},e.findParentPreElement=function(e,t){for(var n=e.startContainer;!sf.base.isNullOrUndefined(n)&&"PRE"!==n.nodeName&&n!==t;)n=n.parentElement;return n},e.processInlineNodesBetweenBlocks=function(e,t){for(var n=document.createDocumentFragment(),i=!1,s=null,r=null,o=sf.base.createElement("div",{id:"pasteContent_rte"});e.firstChild;){var a=e.firstChild;if("#text"!==a.nodeName||""!==a.textContent.trim()){r=a;var l=this.isBlockElement(a);i?l?(s=null,n.appendChild(a)):(s||(s="DIV"===t?sf.base.createElement("div"):sf.base.createElement("p"),n.appendChild(s)),s.appendChild(a)):l?(i=!0,n.appendChild(a)):(o.appendChild(a),n.appendChild(o))}else sf.base.detach(a)}return{fragment:n,lastNode:r}},e.isBlockElement=function(e){if(e.nodeType!==Node.ELEMENT_NODE)return!1;for(var t=fe,n=e.nodeName.toLowerCase(),i=0;i<t.length;i++)if(t[i]===n)return!0;return!1},e.processBlockContent=function(e,t,n,i,s,r,o){var a,l=this.processInlineNodesBetweenBlocks(t,r);a=this.insertTempNode(n,l.fragment,e,i,s),this.contentsDeleted||this.cleanupBeforeBlockInsertion(n,s,o);var d=s.querySelector("#pasteContent_rte");return sf.base.isNullOrUndefined(d)||this.processFirstInlineNodeSet(d,r),a},e.cleanupBeforeBlockInsertion=function(e,t,n){n||0!==e.startContainer.parentElement.textContent.length||"BR"!==e.startContainer.nodeName||"P"!==e.startContainer.parentElement.nodeName||t.removeChild(e.startContainer.parentElement),e.deleteContents(),this.removeEmptyElements(t)},e.processFirstInlineNodeSet=function(e,t){for(var n;e.firstChild&&(n=e.firstChild,this.isInlineElement(n));)n=this.handleFirstBlockChild(e,t);return sf.base.detach(e),n},e.handleFirstBlockChild=function(e,t){var n=e.firstChild;if(sf.base.isNullOrUndefined(e.previousElementSibling)){var i="DIV"===t?sf.base.createElement("div"):sf.base.createElement("p");e.parentElement.insertBefore(i,e)}return"BR"===e.previousElementSibling.nodeName?e.parentElement.insertBefore(e.firstChild,e):e.previousElementSibling.appendChild(e.firstChild),n},e.isInlineElement=function(e){return"#text"===e.nodeName||this.inlineNode.indexOf(e.nodeName.toLowerCase())>=0},e.processSpecialNodes=function(e,t,n){return e?e instanceof Element&&"GOOGLE-SHEETS-HTML-ORIGIN"===e.nodeName?this.processGoogleSheetsTable(e):"TABLE"===e.nodeName?this.addParagraphAfterTable(e,n):e:null},e.processGoogleSheetsTable=function(e){var t=e.querySelector("table"),n=t.querySelector("colgroup");if(n)for(var i=0;i<t.rows.length;i++)for(var s=0;s<t.rows[i].cells.length;s++){var r=n.querySelectorAll("col")[s];if(r&&r.hasAttribute("width")){var o=r.getAttribute("width");t.rows[i].cells[s].style.width=o+"px"}}return e},e.addParagraphAfterTable=function(e,t){var n=sf.base.createElement("DIV"===t?"div":"p");return n.appendChild(sf.base.createElement("br")),e.parentElement.insertBefore(n,e.nextSibling),n},e.positionCursorAfterPaste=function(e,t,n,i,s,r){e&&("#text"===e.nodeName?this.placeCursorEnd(e,t,n,i,s):"HR"===e.nodeName?this.handleHRElementCursor(e,n,i,r):s.contains(e)&&sf.base.isNullOrUndefined(s.querySelector(".paste-cursor"))?this.cursorPos(e,t,n,i,s):this.handleListElementCursor(t,s,n,i))},e.handleListElementCursor=function(e,t,n,i){var s=t.querySelector(".paste-cursor");if(sf.base.isNullOrUndefined(s)){var r=t.querySelectorAll(".pasteContent_RTE");if(r.length>0){var o=r[r.length-1];this.cursorPos(o,e,n,i,t)}}else n.setCursorPoint(i,s,0),s.remove()},e.handleHRElementCursor=function(e,t,n,i){for(var s=e.nextSibling;s&&"#text"===s.nodeName&&""===s.textContent.trim();)s=s.nextSibling;var r=sf.base.createElement("DIV"===i?"div":"p");r.appendChild(sf.base.createElement("br"));var o=e.parentNode;if(!s||"HR"!==s.nodeName&&"TABLE"!==s.nodeName)if(o&&"LI"===o.nodeName){for(var a=e.nextSibling;a&&a.nodeType===Node.TEXT_NODE&&""===a.textContent.trim();)a=a.nextSibling;for(;!a&&o;){if(o&&("OL"===o.nodeName||"UL"===o.nodeName||"LI"===o.nodeName||"BLOCKQUOTE"===o.nodeName))for(a=o.nextSibling;a&&a.nodeType===Node.TEXT_NODE&&""===a.textContent.trim();)a=a.nextSibling;o=o.parentNode}sf.base.isNullOrUndefined(a)&&e.parentNode.appendChild(r),e=a||r}else if(s){var l=s.firstChild;l&&"#text"!==l.nodeName&&l.hasAttribute("class")&&l.classList.contains("rte-temp-br")&&s.firstChild.removeAttribute("class"),e=s}else o.appendChild(r),o.insertBefore(e,r),e=r;else o.insertBefore(r,s),e=r;return t.setSelectionText(n,e,e,0,0),e},e.compareParentElements=function(e,t){return!(!e||!t)&&(e.tagName===t.tagName&&this.getFilteredAttributes(e)===this.getFilteredAttributes(t))},e.getFilteredAttributes=function(e){return Array.from(e.attributes).map((function(e){if("class"===e.name){var t=e.value.split(" ").filter((function(e){return"pasteContent_RTE"!==e})).join(" ");return t?"class='"+t+"'":""}return e.name+"='"+e.value+"'"})).filter((function(e){return e.length>0})).sort().join(" ")},e.getClosestMatchingElement=function(e,t,n){for(var i=e;i&&!i.contains(n);){if(this.findMatchingChild(t,i))return i;i=i.parentElement}return null},e.findMatchingChild=function(e,t){for(var n=0,i=Array.from(e.children);n<i.length;n++){var s=i[n];if(this.compareParentElements(s,t))return s;var r=this.findMatchingChild(s,t);if(r)return r}return null},e.listCleanUp=function(e,t){var n=e.getRange(t),i=n.startContainer,s=n.startOffset,r=n.startContainer.parentElement,o=n.endContainer.parentElement;if(!sf.base.isNullOrUndefined(r)&&!sf.base.isNullOrUndefined(o)){var a=r.closest("ol, ul"),l=o.closest("ol, ul");if(!sf.base.isNullOrUndefined(a)&&!sf.base.isNullOrUndefined(l)){var d=this.cleanUpListItems(a),c=this.cleanUpListContainer(a);(d||c)&&(n.setStart(i,s),n.setEnd(i,s))}}},e.cleanUpListItems=function(e){var t,n=this,i=!1;if(sf.base.isNullOrUndefined(e.closest("ol, ul"))||(t=e.closest("ol, ul").querySelectorAll("li")),sf.base.isNullOrUndefined(t)||0===t.length)return!1;var s=null;t.forEach((function(e){var t=e.parentElement;if(!sf.base.isNullOrUndefined(t)&&"OL"!==t.nodeName&&"UL"!==t.nodeName&&(sf.base.isNullOrUndefined(s)&&(s=t.closest("li")),!sf.base.isNullOrUndefined(s))){var r=e.nextSibling;if(!sf.base.isNullOrUndefined(r)&&"LI"!==r.nodeName){for(var o=Array.prototype.indexOf.call(t.childNodes,r),a=t.cloneNode(!1),l=t.childNodes.length,d=o;d<l;d++)a.appendChild(t.childNodes[o]);if(a.childNodes.length>0){var c=document.createElement("li");c.appendChild(a),s.insertAdjacentElement("afterend",c)}else a.remove()}var h=t.closest("ol, ul");s.insertAdjacentElement("afterend",e),s=s.nextSibling,sf.base.isNullOrUndefined(h)||n.removeEmptyElements(h),i=!0}}));var r=this.cleanUpFlattenListContainer(e);return i=r||i},e.cleanUpFlattenListContainer=function(e){var t,n=!1;return sf.base.isNullOrUndefined(e.closest("ol, ul"))||(t=e.closest("ol, ul").querySelectorAll("li")),!sf.base.isNullOrUndefined(t)&&0!==t.length&&(t.forEach((function(e){sf.base.isNullOrUndefined(e.firstChild)||"OL"!==e.firstChild.nodeName&&"UL"!==e.firstChild.nodeName||(e.style.listStyleType="none");var t=Array.from(e.children).find((function(e){return"LI"===e.tagName&&e.parentElement&&"OL"!==e.parentElement.tagName&&"UL"!==e.parentElement.tagName}));sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(e.parentNode)||(e.parentNode.replaceChild(t,e),(sf.base.isNullOrUndefined(t.textContent)||""===t.textContent.trim())&&t.remove(),n=!0)})),n)},e.cleanUpListContainer=function(e){var t=!1,n=[],i=[];if(!sf.base.isNullOrUndefined(e)){for(var s=0;s<e.childNodes.length;s++){var r=e.childNodes[s],o=-1!==["UL","OL"].indexOf(r.nodeName),a=sf.base.isNullOrUndefined(r.previousSibling)||r.previousSibling&&r.previousSibling.nodeType===Node.TEXT_NODE&&""===r.previousSibling.textContent.trim(),l=r.previousElementSibling,d=l&&"LI"===l.nodeName.toUpperCase();o&&a&&d?(l.appendChild(r),this.cleanUpListContainer(r),s--):"LI"!==r.nodeName.toLocaleUpperCase()&&n.push(r),("LI"===r.nodeName.toLocaleUpperCase()||e.lastChild===r)&&n.length>0&&(i.push({elements:Ue(n)}),n=[])}i.forEach((function(n){var i=n.elements,s=document.createElement("li");i[0].parentNode.replaceChild(s,i[0]),i.forEach((function(e){return s.appendChild(e)})),s.textContent&&""===s.textContent.trim()&&!s.querySelector("img")&&e.removeChild(s),t=!0}))}return t},e.placeCursorEnd=function(e,t,n,i,s){for(;!sf.base.isNullOrUndefined(e)&&"#text"!==e.nodeName&&"IMG"!==e.nodeName&&"BR"!==e.nodeName&&"HR"!==e.nodeName;){if(!sf.base.isNullOrUndefined(e.lastChild)&&"P"===e.lastChild.nodeName&&""===e.lastChild.innerHTML){var r=sf.base.createElement("br");e.lastChild.appendChild(r)}e=e.lastChild}"IMG"===(e=sf.base.isNullOrUndefined(e)?t:e).nodeName?this.imageFocus(e,n,i):n.setSelectionText(i,e,e,e.textContent.length,e.textContent.length),this.removeEmptyElements(s)},e.getNodeCollection=function(e,t,n){var i=[];return e.startOffset===e.endOffset&&e.startContainer===e.endContainer&&"BR"!==e.startContainer.nodeName&&e.startContainer.childNodes.length>0&&("TD"===e.startContainer.nodeName||3!==e.startContainer.nodeType&&n.classList&&n.classList.contains("pasteContent"))?i.push(e.startContainer.childNodes[e.endOffset]):i=t.getInsertNodeCollection(e),i},e.insertTempNode=function(e,t,n,i,s){var r=t.lastChild;return this.shouldInsertAfterTable(e,s)?(this.insertNodeAfterTable(e.startContainer,t,e.endOffset-1),r):this.shouldInsertBeforeTable(e,s)?(this.insertNodeBeforeTable(e.startContainer,t,e.startOffset),r):this.shouldAppendAfterTableAtCursor(e,s)?(e.startContainer.appendChild(t),r):r=this.handleStandardNodeInsertion(e,t,n,i,s)},e.shouldInsertAfterTable=function(e,t){var n=e.startContainer.nodeType===Node.TEXT_NODE?e.startContainer.parentNode:e.startContainer;return(n===t||n.closest("table"))&&!sf.base.isNullOrUndefined(n.childNodes[e.endOffset-1])&&"TABLE"===n.childNodes[e.endOffset-1].nodeName},e.insertNodeAfterTable=function(e,t,n){sf.base.isNullOrUndefined(e.childNodes[n].nextSibling)?e.appendChild(t):e.insertBefore(t,e.childNodes[n].nextSibling)},e.shouldInsertBeforeTable=function(e,t){return e.startContainer===t&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])&&"TABLE"===e.startContainer.childNodes[e.startOffset].nodeName},e.insertNodeBeforeTable=function(e,t,n){n>=0&&n<e.childNodes.length?e.insertBefore(t,e.childNodes[n]):e.appendChild(t)},e.shouldAppendAfterTableAtCursor=function(e,t){return e.startContainer===t&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.endOffset])&&"TABLE"===e.startContainer.childNodes[e.endOffset].nodeName},e.handleStandardNodeInsertion=function(e,t,n,i,s){var r=this.findBlockNodeForInsertion(e,n,s);this.processListItemsInNode(r,t,s);var o=t.lastChild;return this.isTableCellNode(r)?(this.insertInTableCell(e,t,r,i),o):this.isHorizontalRuleInEmptyBlock(o,e)?(e.startContainer.parentNode.replaceChild(t,e.startContainer),o):(this.isMediaElement(r)&&(r=e.startContainer),this.handleRegularInsertion(e,t,r,i,s),o)},e.findBlockNodeForInsertion=function(e,t,n){var i=this.getImmediateBlockNode(t[t.length-1],n);return(sf.base.isNullOrUndefined(i)||sf.base.isNullOrUndefined(i.parentElement))&&3!==e.endContainer.nodeType&&(i=e.endContainer,e.setEnd(i,e.endContainer.textContent.length)),i&&("BODY"===i.nodeName||"DIV"===i.nodeName&&e.startContainer===e.endContainer&&1===e.startContainer.nodeType)&&(i=e.startContainer),i},e.processListItemsInNode=function(e,t,n){if(this.wrapUnstructedLiWithUl(t),this.shouldProcessListItems(e,t,n))for(var i,s=t;!sf.base.isNullOrUndefined(s.firstElementChild)&&s.firstElementChild.lastElementChild&&"LI"===s.firstElementChild.lastElementChild.tagName;)i=s.firstElementChild.lastElementChild,this.removeChecklistStyle(e,i),this.removeListItemMargins(i),s.firstElementChild.insertAdjacentElement("afterend",i)},e.wrapUnstructedLiWithUl=function(e){for(var t,n=Array.from(e.querySelectorAll("li")).filter((function(e){return-1===["UL","OL"].indexOf(e.parentNode.nodeName)})),i=null,s=0;s<n.length;s++){var r=n[s],o=n[s+1]&&r.nextSibling===n[s+1];!sf.base.isNullOrUndefined(i)&&t||(i=sf.base.createElement("ul"),e.insertBefore(i,r)),i.appendChild(r),t=o}},e.removeChecklistStyle=function(e,t){"LI"!==e.nodeName||!e.parentElement||"UL"!==e.parentElement.nodeName&&"OL"!==e.parentElement.nodeName||(t.style.removeProperty("list-style"),t.style.removeProperty("position"),""===t.getAttribute("style")&&t.removeAttribute("style"))},e.shouldProcessListItems=function(e,t,n){return e&&"#text"!==e.nodeName&&e.closest("LI")&&n.contains(e.closest("LI"))&&"TD"!==e.nodeName&&"TH"!==e.nodeName&&"TR"!==e.nodeName&&t&&t.firstElementChild&&("OL"===t.firstElementChild.tagName||"UL"===t.firstElementChild.tagName)},e.removeListItemMargins=function(e){e.style.removeProperty("margin-left"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),""===e.getAttribute("style")&&e.removeAttribute("style")},e.isTableCellNode=function(e){if(!e)return!1;var t=e.nodeName;return"TD"===t||"TH"===t||"TR"===t||"TABLE"===t},e.insertInTableCell=function(e,t,n,i){var s=e.startContainer;if(("TD"===s.nodeName||"TH"===s.nodeName)&&1===s.childNodes.length&&"BR"===s.firstChild.nodeName)return s.replaceChild(t,s.firstChild),void(this.contentsDeleted=!0);for(;!sf.base.isNullOrUndefined(s)&&s.parentElement!==n;)s=s.parentElement;e.deleteContents();var r=i.GetSpliceNode(e,s);r?r.parentNode.replaceChild(t,r):e.insertNode(t),this.contentsDeleted=!0},e.handleRegularInsertion=function(e,t,n,i,s){var r,o=new et(s),a=this.getNodeCollection(e,o,t),l=a[a.length-1];if(this.isEmptySpecialNode(l)){if(r=l,this.handleEmptySpecialNodeInsertion(e,t,l))return}else if(this.isTextOrBrInListItem(l,n,s)){if(r=l,this.handleTextInListItem(e,t,l,n,i,s))return}else r=this.getSplitElementForInsertion(e,i,n);r&&r.nodeType===Node.ELEMENT_NODE&&""===e.toString()&&null!==r.querySelector("img, video, audio")?r.parentNode.insertBefore(t,r):r.parentNode.replaceChild(t,r)},e.isEmptySpecialNode=function(e){return!!e&&("BR"===e.nodeName||"HR"===e.nodeName||"#text"===e.nodeName&&!sf.base.isNullOrUndefined(e.parentElement)&&"LI"===e.parentElement.nodeName)&&!sf.base.isNullOrUndefined(e.parentElement)&&0===e.parentElement.textContent.trim().length},e.handleEmptySpecialNodeInsertion=function(e,t,n){if("LI"!==n.parentElement.nodeName||sf.base.isNullOrUndefined(n.nextSibling)||"BR"!==n.nextSibling.nodeName||sf.base.detach(n.nextSibling),("LI"===n.parentElement.nodeName||n.parentElement.closest("li"))&&""===n.parentElement.textContent){this.removeListfromPaste(e),1===n.parentElement.childNodes.length&&"BR"===n.nodeName&&sf.base.detach(n);var i=Array.from(t.childNodes).filter((function(e){return!("LI"===e.nodeName||"UL"===e.nodeName||"OL"===e.nodeName)})),s=this.extractChildNodes(t);if(i.length>0&&s.length>1)this.insertBlockNodesInLI(s,e);else{var r=e.startContainer.parentElement,o=r.nextElementSibling;"DIV"===e.startContainer.nodeName&&r&&"LI"===r.nodeName&&r.parentNode?(r.parentNode.insertBefore(t,o),sf.base.detach(r)):e.insertNode(t)}return this.contentsDeleted=!0,!0}return!1},e.extractChildNodes=function(e){for(var t=[],n=0;n<e.childNodes.length;n++)t.push(e.childNodes.item(n));return t},e.insertBlockNodesInLI=function(e,t){e=this.processInsertNodes(e);for(var n=document.createDocumentFragment(),i=0,s=e;i<s.length;i++){var r=s[i],o=sf.base.createElement("li");o.appendChild(r.cloneNode(!0)),n.appendChild(o)}this.unwrapInlineWrappers(n);var a=t.startContainer.parentElement,l=a.nextElementSibling;"DIV"===t.startContainer.nodeName&&a&&"LI"===a.nodeName&&a.parentNode?(a.parentNode.insertBefore(n,l),sf.base.detach(a)):t.insertNode(n)},e.processInsertNodes=function(e){for(var t=[],n=[],i=0,s=e;i<s.length;i++){var r=s[i];r.nodeType===Node.ELEMENT_NODE&&-1!==fe.indexOf(r.nodeName.toLowerCase())?(n.length>0&&(t.push(this.wrapInlineElementsInSpan(n)),n=[]),t.push(r)):n.push(r)}return n.length>0&&t.push(this.wrapInlineElementsInSpan(n)),t},e.wrapInlineElementsInSpan=function(e){var t=sf.base.createElement("span");return t.className="inline-wrapper",e.forEach((function(e){return t.appendChild(e)})),t},e.unwrapInlineWrappers=function(e){e.querySelectorAll(".inline-wrapper").forEach((function(e){var t=e.parentNode;if(t){for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}}))},e.removeEmptyAfterStartLI=function(e,t){var n=this;this.clearIfCompletelyEmpty(e);var i=this.getRootList(e,t);i&&i.querySelectorAll("li").forEach((function(t){n.isRemovableEmptyListItem(t,e)&&sf.base.detach(t)}))},e.clearIfCompletelyEmpty=function(e){0!==e.textContent.length||e.querySelector("audio,video,img,table,br,hr")||(e.innerHTML="")},e.getRootList=function(e,t){for(var n=sf.base.closest(e,"ul,ol");n&&n.parentElement&&t.contains(n.parentElement);){var i=sf.base.closest(n.parentElement,"ul,ol");if(!t.contains(i))return n;n=i}return n||null},e.isRemovableEmptyListItem=function(e,t){return e!==t&&""===e.textContent.trim()&&!e.querySelector("audio,video,img,table,br,hr")},e.isTextOrBrInListItem=function(e,t,n){return e&&("#text"===e.nodeName||"BR"===e.nodeName||"HR"===e.nodeName)&&!sf.base.isNullOrUndefined(e.parentElement)&&("LI"===e.parentElement.nodeName||e.parentElement.closest("LI")||t===n&&e.parentElement===t)&&e.parentElement.textContent.trim().length>0},e.handleTextInListItem=function(e,t,n,i,s,r){"LI"!==n.parentElement.nodeName||sf.base.isNullOrUndefined(n.nextSibling)||"BR"!==n.nextSibling.nodeName||sf.base.detach(n.nextSibling);var o=Array.from(t.childNodes).filter((function(e){return!("LI"===e.nodeName||"UL"===e.nodeName||"OL"===e.nodeName)})),a=n.parentElement,l=null,d=e.collapsed,c=d?n.parentElement.closest("LI"):null,h=null,p=null;if(!e.collapsed){var u=e.startContainer,f=e.startOffset;l=e.cloneRange(),h=this.findLiFromContainer(l.startContainer),p=this.findLiFromContainer(l.endContainer),this.removeListfromPaste(e),h&&o.length>0&&this.removeEmptyAfterStartLI(h,r),e.setStart(u,f),e.setEnd(u,f)}var m=e.startContainer.parentElement,g=this.getImmediateBlockNode(n,t);if("HR"===t.firstChild.nodeName){i=(h?sf.base.closest(h,"li"):sf.base.closest(i,"li"))||i,this.insertBlockElementInList(e,t,i,s)}else if(d&&c&&o.length>0)this.pasteLI(t,c,a,g,e,s);else if(!d&&h&&p&&o.length>0)this.nonCollapsedInsertion(t,l,s,p);else if(d&&("UL"===t.firstChild.nodeName||"OL"===t.firstChild.nodeName)&&n.parentElement&&"DIV"===n.parentElement.nodeName)if(0===e.startOffset&&0===e.endOffset&&m)m.parentNode.insertBefore(t,m);else if(e.startOffset===e.startContainer.textContent.length&&e.endOffset===e.startContainer.textContent.length&&m&&m.parentNode){var b=m.nextSibling;m.parentNode.insertBefore(t,b)}else{var v=m.closest("li"),y=s.GetSpliceNode(e,m),C=document.createElement("li"),N=y.nextSibling;C.appendChild(N),t.appendChild(C),v.parentNode.insertBefore(t,v.nextSibling)}else if(!d&&("#text"===e.startContainer.nodeName&&"DIV"===m.nodeName||"DIV"===e.startContainer.nodeName&&"LI"===m.nodeName)){(u="#text"===e.startContainer.nodeName&&0===e.startContainer.textContent.trim().length?m:e.startContainer)&&"LI"===u.parentElement.nodeName&&m.parentNode.insertBefore(t,m.nextSibling)}else e.insertNode(t);return this.contentsDeleted=!0,!0},e.findLiFromContainer=function(e){if("LI"===e.nodeName)return e;var t=e.nodeType===Node.TEXT_NODE?e.parentNode:e;return t="LI"===t.nodeName?t:t.closest("LI")},e.nonCollapsedInsertion=function(e,t,n,i){var s=this.extractChildNodes(e);s=this.processInsertNodes(s);var r=t.startContainer,o=t.endContainer,a="UL"===o.nodeName||"OL"===o.nodeName,l=this.getClosestLi(r),d=this.getPreviousLi(l),c=this.getNextLi(l),h=l.parentNode;c&&h===o&&a&&""===i.textContent&&(c=null),r===o||(!c||l.contains(o)&&!a)&&!this.isAnotherLiFromEndLi||this.isAnotherLiFromEndLi&&h!==o&&"A"!==o.nodeName?this.handleSingleLiInsertion(l,d,c,s,r,t,n,h):this.handleMultiLiInsertion(l,s,r,o,h),this.unwrapInlineWrappers(h)},e.getClosestLi=function(e){for(var t=e.nodeType===Node.TEXT_NODE?e.parentNode:e;t&&"LI"!==t.nodeName;)t=t.parentNode;return t},e.getPreviousLi=function(e){var t=e.previousSibling;return t&&"LI"===t.nodeName?t:null},e.getNextLi=function(e){var t=e.nextSibling;return t&&"LI"===t.nodeName?t:null},e.appendListItems=function(e,t,n,i){for(var s=null,r=n;r<i;r++){var o=document.createElement("li");o.appendChild(t[r]),e.appendChild(o),s=o}return s},e.moveSiblingsToLiAndInsert=function(e,t,n,i,s){for(var r=[];e;)r.push(e),e=e.nextSibling;for(var o=0;o<r.length;o++)i.contains(r[o])&&i.removeChild(r[o]);for(o=0;o<r.length;o++)t.appendChild(r[o]);i.nextSibling?s.insertBefore(n,i.nextSibling):i.appendChild(n)},e.handleSingleLiInsertion=function(e,t,n,i,s,r,o,a){var l=document.createDocumentFragment();this.extractNestedListsIntoNewListItem(e);var d=null,c=null,h=!e.hasChildNodes()||e.lastChild.nodeType!==Node.TEXT_NODE&&""!==e.textContent?e.lastChild:e;s&&s.textContent&&s.textContent.length>0&&(h=(d=o.GetSpliceNode(r,s)).previousSibling!==t?d.previousSibling:null,c=d.nextSibling!==n?d.nextSibling:null);var p=i[0],u=1===i.length;if(u&&(c?(this.addCursorMarker(c),this.moveAllChildren(c,p),c.parentNode.removeChild(c)):this.addCursorMarker(p,!0)),h&&h!==t&&h.textContent&&h.textContent.length>0)this.moveAllChildren(p,h);else if(u&&""===e.textContent)e.appendChild(p);else{var f=sf.base.createElement("li");f.appendChild(p),l.appendChild(f)}var m=this.appendListItems(l,i,1,i.length);m&&c&&(this.addCursorMarker(c),"A"===c.nodeName?m.lastChild.appendChild(c):this.mergeLastNodeContent(c,m)),c&&("LI"===c.nodeName||!c.nextSibling)?(a.insertBefore(l,e.nextSibling),c&&c.parentNode&&0===c.textContent.length&&c.parentNode.removeChild(c)):m&&this.moveSiblingsToLiAndInsert(c,m,l,e,a),d&&d.parentNode&&""===d.textContent&&d.parentNode.removeChild(d),e&&e.parentNode&&""===e.textContent&&e.parentNode.removeChild(e)},e.handleMultiLiInsertion=function(e,t,n,i,s){var r=document.createDocumentFragment();this.extractNestedListsIntoNewListItem(e);var o=e.nextSibling;o&&this.extractNestedListsIntoNewListItem(o),n=n.nodeType===Node.TEXT_NODE?n.parentNode:n,""===i.textContent&&i.nextSibling&&(i=i.nextSibling),o.contains(i)&&"UL"!==i.nodeName&&"OL"!==i.nodeName||(i=o);var a=t[0],l=t[t.length-1];i.nodeType===Node.TEXT_NODE&&t.length>1?l.appendChild(i):t.length>1&&(this.addCursorMarker(i),this.moveAllChildren(i,l),o.insertBefore(l,o.firstChild)),1===t.length&&(this.addCursorMarker(i),this.moveAllChildren(i,a),o&&o.parentNode&&o.parentNode.removeChild(o));var d=null;if(n.textContent.length>0&&e.textContent.length>0)this.moveAllChildren(a,n),"A"===n.nodeName&&(n=n.parentNode.lastChild);else{var c=sf.base.createElement("li");c.appendChild(a),r.appendChild(c),1===t.length&&(d=c)}sf.base.isNullOrUndefined(d)&&(d=this.appendListItems(r,t,1,t.length-1)),sf.base.isNullOrUndefined(n.nextSibling)?s.insertBefore(r,e.nextSibling):d&&this.moveSiblingsToLiAndInsert(n.nextSibling,d,r,e,s),""===e.textContent&&e.parentNode&&e.parentNode.removeChild(e)},e.pasteLI=function(e,t,n,i,s,r){var o=this.extractChildNodes(e);o=this.processInsertNodes(o);var a=this.getBlockNodeLength(i),l=t.parentNode,d=!0,c=!1;if(t.contains(n)&&n.previousSibling&&0!==n.previousSibling.textContent.trim().length&&(d=!1),t.contains(n)&&(sf.base.isNullOrUndefined(n.nextSibling)||n.nextSibling&&-1!==["LI","UL","OL"].indexOf(n.nextSibling.nodeName))&&s.startOffset===n.textContent.length){for(var h=n.previousSibling,p=s.startOffset;h&&"LI"!==h.nodeName;)p+=h.textContent.length,h=h.previousSibling;c=p===a}var u=0===s.startOffset&&d,f=s.startOffset===a||c;u?this.handlePasteAtStart(o,t,n,l):f?this.handlePasteAtEnd(o,t,n,l):this.handlePasteInMiddle(o,t,n,s,l,r),this.unwrapInlineWrappers(l)},e.handlePasteAtStart=function(e,t,n,i){var s=e[e.length-1];this.addCursorMarker(n),this.moveAllChildren(n,s),t.insertBefore(s,t.firstChild);var r=this.createLiFragment(e,0,e.length-1);i.insertBefore(r,t)},e.handlePasteAtEnd=function(e,t,n,i){var s=e[0],r=this.hasNestedListInsideLi(n);if("LI"===n.nodeName&&r){var o=this.collectAndRemoveFollowingNodes(t,r);this.moveAllChildren(s,n),o.forEach((function(e){return n.appendChild(e)}))}else this.moveAllChildren(s,n);var a=this.createLiFragment(e,1,e.length),l=a.lastChild;if(sf.base.isNullOrUndefined(r)&&(sf.base.isNullOrUndefined(n.nextSibling)||"LI"===n.nodeName))i.insertBefore(a,t.nextSibling);else if(l){(o=this.collectAndRemoveFollowingNodes(t,r||n.nextSibling)).forEach((function(e){return l.appendChild(e)})),this.insertFragmentAfterLi(a,t,i)}},e.handlePasteInMiddle=function(e,t,n,i,s,r){var o=r.GetSpliceNode(i,n),a=o.previousSibling,l=o.nextSibling,d=e[0];1===e.length&&(this.addCursorMarker(l),this.moveAllChildren(l,d)),this.moveAllChildren(d,a);var c=this.createLiFragment(e,1,e.length),h=c.lastChild;h&&(this.addCursorMarker(l),"A"===l.nodeName?h.lastChild.appendChild(l):this.mergeLastNodeContent(l,h));var p=this.hasNestedListInsideLi(t);if(l&&sf.base.isNullOrUndefined(l.nextSibling)&&h&&sf.base.isNullOrUndefined(p)||"LI"===l.nodeName)s.insertBefore(c,t.nextSibling),0===l.textContent.length&&l.parentNode.removeChild(l);else if(h){this.collectAndRemoveFollowingNodes(t,p||l).forEach((function(e){return h.appendChild(e)})),this.insertFragmentAfterLi(c,t,s)}o.parentNode.removeChild(o)},e.hasNestedListInsideLi=function(e){if("LI"===e.nodeName)for(var t=0,n=Array.from(e.children);t<n.length;t++){if("UL"===(o=n[t]).tagName||"OL"===o.tagName)return o}var i=e.closest("LI");if(!i)return null;for(var s=0,r=Array.from(i.children);s<r.length;s++){var o;if("UL"===(o=r[s]).tagName||"OL"===o.tagName)return o}return null},e.getBlockNodeLength=function(e){if("LI"===e.nodeName){for(var t=0,n=0,i=Array.from(e.childNodes);n<i.length;n++){var s=i[n];if(s.nodeType===Node.ELEMENT_NODE&&-1!==["UL","OL"].indexOf(s.tagName))break;t+=s.textContent?s.textContent.length:0}return t}return e.textContent?e.textContent.length:0},e.addCursorMarker=function(e,t){var n=sf.base.createElement("span");n.className="paste-cursor",t?e.appendChild(n):e.insertBefore(n,e.firstChild)},e.extractNestedListsIntoNewListItem=function(e){for(var t=[],n=0,i=Array.from(e.childNodes);n<i.length;n++){var s=i[n];s.nodeType!==Node.ELEMENT_NODE||"UL"!==s.tagName&&"OL"!==s.tagName||t.push(s)}if(t.length>0){for(var r=sf.base.createElement("li"),o=0,a=t;o<a.length;o++){var l=a[o];r.appendChild(l)}var d=e.parentNode;if(d){var c=e.nextSibling;c?d.insertBefore(r,c):d.appendChild(r)}}},e.createLiFragment=function(e,t,n){for(var i=document.createDocumentFragment(),s=t;s<n;s++){var r=sf.base.createElement("li");r.appendChild(e[s]),i.appendChild(r)}return i},e.collectAndRemoveFollowingNodes=function(e,t){for(var n=[],i=t;i;){var s=i.nextSibling;n.push(i),e.removeChild(i),i=s}return n},e.insertFragmentAfterLi=function(e,t,n){t.nextSibling?n.insertBefore(e,t.nextSibling):t.appendChild(e)},e.moveAllChildren=function(e,t){for(var n="A"===t.nodeName,i="A"===e.nodeName;e.firstChild&&!i;){var s=e.firstChild;if("UL"===s.nodeName||"OL"===s.nodeName)return;n?(t.parentNode.insertBefore(s,t.nextSibling),t=t.nextSibling):t.appendChild(s)}i&&t.appendChild(e)},e.mergeLastNodeContent=function(e,t){for(;e&&e.firstChild;){var n=e.firstChild;if(n)fe.indexOf(n.nodeName.toLowerCase())>=0?"UL"===n.nodeName||"OL"===n.nodeName?t.appendChild(n):(this.moveAllChildren(n,t.lastChild),e.removeChild(n)):t.lastChild.appendChild(n)}},e.getSplitElementForInsertion=function(e,t,n){var i=e.collapsed,s=0===e.startOffset,r=e.startContainer.nodeType===Node.TEXT_NODE?e.startOffset===e.startContainer.textContent.length:e.startOffset===e.startContainer.childNodes.length;return n&&"P"===n.nodeName&&(s||r||!i)&&""===n.textContent.trim()?t.SplitNode(e,n,!0):t.GetSpliceNode(e,n)},e.cursorPos=function(e,t,n,i,s){e.classList.add("lastNode"),s.innerHTML=function(e){var t=document.createElement("div");t.innerHTML=e;for(var n=t.querySelectorAll("table"),i=0;i<n.length;i++)if(n[i].classList.length>0&&!n[i].classList.contains("e-rte-table")&&!n[i].classList.contains("e-rte-custom-table")){if(n[i].classList.add("e-rte-paste-table"),n[i].classList.contains("e-rte-paste-word-table")){n[i].classList.remove("e-rte-paste-word-table");continue}if(n[i].classList.contains("e-rte-paste-excel-table")){n[i].classList.remove("e-rte-paste-excel-table"),"0"===n[i].getAttribute("border")&&n[i].removeAttribute("border");for(var s=n[i].querySelectorAll("td"),r=0;r<s.length;r++)"none"===s[r].style.borderLeft&&s[r].style.removeProperty("border-left"),"none"===s[r].style.borderRight&&s[r].style.removeProperty("border-right"),"none"===s[r].style.borderBottom&&s[r].style.removeProperty("border-bottom"),"none"===s[r].style.borderTop&&s[r].style.removeProperty("border-top"),"none"===s[r].style.border&&s[r].style.removeProperty("border")}else{if(n[i].classList.contains("e-rte-paste-onenote-table")){n[i].classList.remove("e-rte-paste-onenote-table");continue}if(n[i].classList.contains("e-rte-paste-html-table")){var o=n[i];if(o.classList.remove("e-rte-paste-html-table"),!o.classList.contains("e-rte-table-border")){var a=o.querySelectorAll("td, th"),l=o.getAttribute("style"),d=l&&l.includes("border");if(!d)for(var c=0,h=Array.from(a);c<h.length;c++){var p=h[c].getAttribute("style");if(p&&p.includes("border")){d=!0;break}}d||(o.classList.add("e-rte-table"),o.classList.remove("e-rte-paste-table"))}continue}}}var u=t.querySelectorAll("img");for(i=0;i<u.length;i++)u[i].classList.contains("e-rte-image-unsupported")||(u[i].classList.contains("e-rte-image")||u[i].classList.add("e-rte-image"),u[i].classList.contains("e-imginline")||u[i].classList.contains("e-imgbreak")||u[i].classList.add("e-imginline"));return t.innerHTML}(s.innerHTML),e=s.querySelector(".lastNode"),sf.base.isNullOrUndefined(e)||(this.placeCursorEnd(e,t,n,i,s),e.classList.remove("lastNode"),0===e.classList.length&&e.removeAttribute("class"))},e.imageFocus=function(e,t,n){var i=document.createTextNode(" ");if(e.parentNode&&"A"===e.parentNode.nodeName){var s=e.parentNode,r=s.parentNode;r.insertBefore(i,s.nextSibling),r.insertBefore(e,i)}else e.parentNode.insertBefore(i,e.nextSibling);t.setSelectionText(n,e.nextSibling,e.nextSibling,0,0)},e.getImmediateBlockNode=function(e,t){for(;e&&fe.indexOf(e.nodeName.toLocaleLowerCase())<0;)e=e.parentNode;return e},e.removingComments=function(e){var t=e.innerHTML;t=t.replace(/<!--[\s\S]*?-->/g,""),e.innerHTML=t},e.findDetachEmptyElem=function(e,t){var n;if(void 0===t&&(t=!1),sf.base.isNullOrUndefined(e.parentElement))n=null;else{var i=e.parentElement.textContent.length>0&&e.parentElement.textContent.match(/\u00a0/g)&&e.parentElement.textContent.match(/\u00a0/g).length>0,s=!sf.base.isNullOrUndefined(e.parentElement.querySelector("br"));n=!i&&!s&&""===e.parentElement.textContent.trim()&&"true"!==e.parentElement.contentEditable&&sf.base.isNullOrUndefined(e.parentElement.querySelector("img"))&&"TD"!==e.parentElement.nodeName&&"TH"!==e.parentElement.nodeName&&sf.base.isNullOrUndefined(e.parentElement.querySelector("table td, table th"))?t&&-1!==fe.indexOf(e.parentElement.tagName.toLowerCase())?e:this.findDetachEmptyElem(e.parentElement,t):t&&-1!==fe.indexOf(e.tagName.toLowerCase())?null:e}return n},e.removeEmptyElements=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null);for(var i=e.querySelectorAll(":empty"),s=Array.from(i).filter((function(e){var t=e.tagName.toLowerCase();return!(e.closest("svg")||e.closest("canvas")||["td","tr","th","textarea","input","img","video","audio","br","hr","iframe"].indexOf(t)>-1)})),r=0;r<s.length;r++){var o=!0,a=s[r];if("DIV"===a.tagName&&(o="none"===a.style.borderBottom||""===a.style.borderBottom),"COL"!==a.nodeName){var l=!sf.base.isNullOrUndefined(n)&&a===n;if(be.indexOf(a.tagName.toLowerCase())<0&&o&&!l){var d=this.findDetachEmptyElem(a,t);sf.base.isNullOrUndefined(d)||d.nodeType===Node.ELEMENT_NODE&&"TEXTAREA"===d.nodeName.toUpperCase()||sf.base.detach(d)}}else if(!a.style.width){var c=a.parentElement;sf.base.detach(c)}}},e.findClosestRelevantElement=function(e,t){for(var n=e,i=0,s=["table","li"];i<s.length;i++){var r=s[i],o=sf.base.closest(n,r);if(o)return o}for(;n&&n.nodeType===Node.ELEMENT_NODE;){var a=n.parentNode;if(a===t)return n;if(!sf.base.isNullOrUndefined(a.tagName)&&(this.isTagInList(a.tagName,me)||this.isTagInList(a.tagName,ye)))return n;n=a}return null},e.isTagInList=function(e,t){return-1!==t.indexOf(e.toLowerCase())},e.insertTableInList=function(e,t,n,i,s,r){var o=sf.base.closest(n,"ul,ol"),a=o?o.querySelectorAll("li").length:0,l=s.SplitNode(e,n,!0),d=l.previousElementSibling,c=r?sf.base.closest(r,"li"):null,h=c?c.innerHTML:null;d&&sf.base.closest(d,"ol,ul")&&sf.base.closest(d,"ol,ul").querySelectorAll("li").length>a?(d.appendChild(t),e.deleteContents(),l.childNodes.length>0&&this.moveChildNodes(l,d),n!==r&&h&&h!==c.innerHTML&&this.moveChildNodes(c,d)):(e.deleteContents(),l.insertBefore(t,l.firstChild),n!==r&&this.moveChildNodes(r,n));this.removeEmptyNextLI(sf.base.closest(t,"li")),t.classList.add("ignore-table")},e.moveChildNodes=function(e,t){for(;!sf.base.isNullOrUndefined(e)&&!sf.base.isNullOrUndefined(e.firstChild);)t.appendChild(e.firstChild)},e.alignCheck=function(e){for(var t=e.querySelectorAll('span[style*="text-align"]'),n=0;n<t.length;n++){var i=t[n];if(i){var s=this.getImmediateBlockNode(i,null);if(s){for(var r="",o=0;o<t.length;o++){var a=t[o];s.contains(a)&&(r+=a.textContent)}s.textContent.trim()===r.trim()&&(s.style.textAlign=i.style.textAlign)}}}},e.removeListfromPaste=function(e){e.deleteContents();var t=e.startContainer;sf.base.isNullOrUndefined(t)||"LI"!==t.nodeName||sf.base.isNullOrUndefined(t.parentElement)||"OL"!==t.parentElement.nodeName&&"UL"!==t.parentElement.nodeName||""!==t.textContent.trim()||t.parentElement.querySelectorAll("li").forEach((function(e){""===e.textContent.trim()&&e!==t&&e.remove()}))},e.isHorizontalRuleInEmptyBlock=function(e,t){if("HR"!==e.nodeName)return!1;var n=t.startContainer;return n.nodeType===Node.ELEMENT_NODE&&("P"===n.nodeName||"DIV"===n.nodeName)&&1===n.childNodes.length&&n.firstChild&&"BR"===n.firstChild.nodeName},e.isMediaElement=function(e){return!!e&&("VIDEO"===e.nodeName||"AUDIO"===e.nodeName)},e.insertBlockElementInList=function(e,t,n,i){var s=sf.base.closest(n,"ul,ol"),r=s?s.querySelectorAll("li").length:0,o=i.SplitNode(e,n,!0),a=o.previousElementSibling;a&&s&&s.querySelectorAll("li").length>r?(a.appendChild(t.firstChild),o.childNodes.length>0&&this.moveChildNodes(o,a)):o.firstChild&&"HR"===o.firstChild.nodeName?o.insertBefore(t.firstChild,o.firstChild.nextSibling):o.insertBefore(t.firstChild,o.firstChild),""===o.textContent.trim()&&o.childNodes.length<1&&sf.base.detach(o)},e.inlineNode=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","title","u","tt","var","video","wbr"],e.contentsDeleted=!1,e.isAnotherLiFromEndLi=!1,e}(),He=function(){function e(e){this.directRangeElems=["IMG","TABLE","AUDIO","VIDEO","HR"],this.BLOCK_TAGS=["address","article","aside","audio","blockquote","canvas","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","output","p","pre","section","td","tfoot","th","video","body"],this.editableElement=e,this.currentDocument=e.ownerDocument}return e.prototype.getBlockNode=function(){var e=this,t=[],n=this.currentDocument.getSelection().getRangeAt(0);if(n.startContainer===this.editableElement&&n.startContainer===n.endContainer&&"#text"!==n.startContainer.nodeName){if(n.startOffset===n.endOffset)this.editableElement.childNodes[n.startOffset]&&this.directRangeElems.indexOf(this.editableElement.childNodes[n.startOffset].nodeName)>-1&&t.push(this.editableElement.childNodes[n.startOffset]);else n.endOffset===n.startOffset+1&&t.push(this.editableElement.childNodes[n.startOffset]);if(t.length>0)return t}else{var i=n.startContainer.nodeType===Node.TEXT_NODE?n.startContainer.parentElement:n.startContainer,s=n.endContainer.nodeType===Node.TEXT_NODE?n.endContainer.parentElement:n.endContainer,r=this.isBlockNode(s)?s:this.getParentBlockNode(s),o=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(t){return n.intersectsNode(t)?e.isBlockNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}});for(o.currentNode=i;o.currentNode;)if(this.isBlockNode(o.currentNode)?(this.addToBlockCollection(t,o,n),o.nextNode()):o.previousNode(),o.currentNode===s||o.currentNode===r){this.addToBlockCollection(t,o,n);break}}return t},e.prototype.addToBlockCollection=function(e,t,n){var i=t.currentNode;if(t.currentNode&&-1===e.indexOf(t.currentNode))if("LI"===i.nodeName)if(!i.parentNode.closest("li"))e.push(t.currentNode);else{var s=n.commonAncestorContainer,r=i.parentElement.closest("li"),o="LI"===i.nodeName&&!!r,a=!!(3===s.nodeType?s.parentElement:s).closest("ul,ol");if(!o||!a)return;e.push(t.currentNode)}else e.push(t.currentNode)},e.prototype.getTextNodes=function(e){for(var t=[],n=this.currentDocument.getSelection().getRangeAt(0),i=this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return n.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),s=i.nextNode();s;)t.push(s),s=i.nextNode();return t},e.prototype.isBlockNode=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&this.BLOCK_TAGS.indexOf(e.tagName.toLowerCase())>=0},e.prototype.getLastTextNode=function(e){for(var t=this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),n=null,i=t.nextNode();i;)n=i,i=t.nextNode();return n},e.prototype.getFirstTextNode=function(e){return this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,null).nextNode()},e.prototype.getParentBlockNode=function(e){var t=this,n=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return t.isBlockNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return n.currentNode=e,n.parentNode()},e.prototype.getTopMostNode=function(e){if(this.isBlockNode(e.parentNode))return e;for(var t=e.parentNode;t;){if(this.isBlockNode(t.parentNode)||e.textContent!==t.textContent)return t;t=t.parentNode}return t},e.prototype.findParentLiElementUntilEditable=function(e){for(var t=e;t&&t!==this.editableElement;){if(t.nodeType===Node.ELEMENT_NODE){var n=t;if("LI"===n.tagName)return n}t=t.parentNode}return null},e.prototype.getSelectedLiElements=function(){var e=this.currentDocument.getSelection().getRangeAt(0),t=this.currentDocument.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ALL,{acceptNode:function(t){return function(e,t){var n=e.cloneRange();return n.selectNodeContents(t),e.compareBoundaryPoints(Range.END_TO_START,n)<0&&e.compareBoundaryPoints(Range.START_TO_END,n)>0}(e,t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),n=new Set,i=this.findParentLiElementUntilEditable(t.currentNode);for(i&&n.add(i);t.nextNode();){var s=this.findParentLiElementUntilEditable(t.currentNode);s&&n.add(s)}return Array.from(n)},e.prototype.getLiElementsInRange=function(){for(var e=[],t=this.getSelectedLiElements(),n=function(n){var s=i.findParentLiElementUntilEditable(t[n]);if(s&&s.querySelectorAll("li").length>0){var r=i.currentDocument.getSelection().getRangeAt(0);s.querySelectorAll("li").forEach((function(t){r.intersectsNode(t)&&-1===e.indexOf(t)&&e.push(t)}))}sf.base.isNullOrUndefined(s)||-1!==e.indexOf(s)||e.push(s)},i=this,s=0;s<t.length;s++)n(s);return e},e}(),qe=function(){function e(e){this.listTabIndentation=!1,this.parent=e,this.domNode=this.parent.domNode,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("list-type",this.applyListsHandler,this),this.parent.observer.on("keyup-handler",this.onKeyUp,this),this.parent.observer.on("keydown-handler",this.keyDownHandler,this),this.parent.observer.on("actionBegin",this.spaceKeyAction,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("list-type",this.applyListsHandler),this.parent.observer.off("keyup-handler",this.onKeyUp),this.parent.observer.off("keydown-handler",this.keyDownHandler),this.parent.observer.off("actionBegin",this.spaceKeyAction),this.parent.observer.off(v,this.destroy)},e.prototype.testList=function(e){var t=[/^[\d]+[.]+$/,/^(?=[MDCLXVI])M*(C[MD]|D?C{0,3})(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})[.]$/gi,/^[a-zA-Z][.]+$/],n=sf.base.isNullOrUndefined(e)?null:e.innerText.trim().split(".")[0]+".";if(!sf.base.isNullOrUndefined(n))for(var i=0;i<t.length;i++)if(t[i].test(n))return!0;return!1},e.prototype.testCurrentList=function(e){var t=[/^[1]+[.]+$/,/^[i]+[.]+$/,/^[a]+[.]+$/];if(!sf.base.isNullOrUndefined(e.startContainer.textContent.slice(0,e.startOffset)))for(var n=e.startContainer.textContent.replace(/\u200B/g,"").slice(0,e.startOffset).trim(),i=0;i<t.length;i++)if(t[i].test(n)&&2===n.length)return!0;return!1},e.prototype.createAutoList=function(e,t){var n={BR:{BR:!0,P:!0,DIV:!0},P:{BR:!1,P:!0,DIV:!0},DIV:{BR:!1,P:!0,DIV:!0}};return!(!n[e]||void 0===n[e][t])&&n[e][t]},e.prototype.isInsideSameListType=function(e,t){if(!e)return!1;var n=e.closest("li");if(!n)return!1;var i=n.closest("ul, ol");return!!i&&("OL"===i.tagName&&t||"UL"===i.tagName&&!t)},e.prototype.spaceList=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument);var n=this.parent.domNode.getSelectedNode(t.startContainer,t.startOffset),i=(this.parent.domNode.getSelectedNode(t.endContainer,t.endOffset),n.previousElementSibling),s=n.nextElementSibling,r=sf.base.isNullOrUndefined(i)?null:i.innerText.trim().substring(0,1),o=sf.base.isNullOrUndefined(s)?null:s.innerText.trim().substring(0,1),a=this.testCurrentList(t),l=this.testList(i),d=this.testList(s),c=this.isInsideSameListType(n,a),h=t.startContainer.previousElementSibling&&"BR"===t.startContainer.previousElementSibling.tagName;if(!c&&!l&&!d&&"*"!==r&&"*"!==o&&(this.createAutoList(e.enterKey,e.shiftEnterKey)||!h)){var p=sf.base.createElement("br");a?(t.startContainer.textContent=t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length),"#text"===t.startContainer.nodeName&&0===t.startContainer.textContent.length&&this.parent.domNode.insertAfter(p,t.startContainer),this.applyListsHandler({subCommand:"OL",callBack:e.callBack,enterAction:e.enterKey}),e.event.preventDefault()):"*"!==t.startContainer.textContent.replace(/\u200B/g,"").slice(0,t.startOffset).trim()&&"-"!==t.startContainer.textContent.replace(/\u200B/g,"").slice(0,t.startOffset).trim()||(t.startContainer.textContent=t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length),"#text"===t.startContainer.nodeName&&0===t.startContainer.textContent.length&&this.parent.domNode.insertAfter(p,t.startContainer),this.applyListsHandler({subCommand:"UL",callBack:e.callBack,enterAction:e.enterKey}),e.event.preventDefault())}},e.prototype.isCtrlEnterInChecklist=function(e){var t=!1;if(e.event&&(e.event.ctrlKey||e.event.metaKey)&&"Enter"===e.event.key)for(var n=new He(this.parent.editableElement).getLiElementsInRange(),i=0;i<n.length;i++)"LI"===n[i].nodeName&&"UL"===n[i].parentElement.nodeName&&!n[i].classList.contains("e-rte-checklist-hidden")&&n[i].parentElement.classList.contains("e-rte-checklist")&&(t=!0,n[i].classList.contains("e-rte-checklist-checked")?n[i].classList.remove("e-rte-checklist-checked"):n[i].classList.add("e-rte-checklist-checked"));t&&(e.callBack&&e.callBack({requestType:this.currentAction,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes(),event:e.event}),t=!1)},e.prototype.enterList=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n="LI"===t.startContainer.nodeName?t.startContainer:t.startContainer.parentElement.closest("LI"),i="LI"===t.endContainer.nodeName?t.endContainer:t.endContainer.parentElement.closest("LI");this.isCtrlEnterInChecklist(e);var s,r,o=!1;if(!sf.base.isNullOrUndefined(n)){var a=n.querySelectorAll(".e-video-clickelem"),l=a.length>0&&"IFRAME"===a[0].childNodes[0].nodeName;o=n.querySelectorAll("IMG").length>0||n.querySelectorAll("AUDIO").length>0||n.querySelectorAll("VIDEO").length>0||l}n&&(s=n.parentElement)&&(r=s.parentElement);var d=sf.base.isNullOrUndefined(n)?null:n.querySelector("TABLE");if(!sf.base.isNullOrUndefined(n)&&!sf.base.isNullOrUndefined(i)&&n===i&&"LI"===n.tagName&&""===n.textContent.trim()&&!o&&sf.base.isNullOrUndefined(d)){if(n.innerHTML.indexOf("&nbsp;")>=0)return;if(65279===n.textContent.charCodeAt(0)&&(n.textContent=""),sf.base.isNullOrUndefined(r.closest("UL"))&&sf.base.isNullOrUndefined(r.closest("OL"))){if(!sf.base.isNullOrUndefined(n.nextElementSibling)){var c=this.parent.domNode.blockParentNode(n);this.parent.nodeCutter.GetSpliceNode(t,c)}var h=void 0;"DIV"===e.enterAction?(h=sf.base.createElement("div")).innerHTML="<br>":"P"===e.enterAction?(h=sf.base.createElement("p")).innerHTML="<br>":h=sf.base.createElement("br");var p=this.domNode.getImmediateBlockNode(t.startContainer),u=this.applyFormattingFromRange(h,t,p,e.enterAction),f=u.formattedElement,m=u.cursorTarget;h=f,sf.base.isNullOrUndefined(r)||"BLOCKQUOTE"!==r.nodeName||this.parent.observer.notify("blockquote_list_handled",{}),this.parent.domNode.insertAfter(h,s),e.event.preventDefault(),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,m,0),""===s.textContent&&0===s.querySelectorAll("audio,video,table").length?sf.base.detach(s):sf.base.detach(n)}sf.base.isNullOrUndefined(r)||sf.base.isNullOrUndefined(r.closest("UL"))&&sf.base.isNullOrUndefined(r.closest("OL"))||"LI"!==r.nodeName||"none"!==r.style.listStyleType||""!==r.textContent||""!==n.textContent||n!==s.firstElementChild||!sf.base.isNullOrUndefined(n.nextSibling)||(sf.base.detach(s),r.style.removeProperty("list-style-type"),e.event.preventDefault())}var g="#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,b=this.isNodeInListNotTable(g);if(!sf.base.isNullOrUndefined(n)&&!sf.base.isNullOrUndefined(i)&&n===i&&"LI"===n.tagName&&0!==n.textContent.length&&b&&e.event&&!e.event.shiftKey&&!e.event.ctrlKey&&!e.event.metaKey)return this.splitListAtCursor(t,n,s),void e.event.preventDefault();this.handleNestedEnterKeyForLists(e,r,n,s)},e.prototype.splitListAtCursor=function(e,t,n){var i,s=this.parent.editableElement.ownerDocument.createRange(),r=["AREA","BASE","BR","COL","EMBED","HR","IMG","INPUT","LINK","META","SOURCE","TRACK","WBR"],o=e.startContainer,a=e.startOffset;e.startContainer===e.endContainer&&e.startOffset===e.endOffset?(s.setStart(o,a),s.setEndAfter(t),this.parent.nodeSelection.setRange(this.parent.currentDocument,s),i=this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument).cloneContents(),this.cleanupListElements(i,r),s.deleteContents()):(e.deleteContents(),s.setStart(o,a),s.setEndAfter(t),this.parent.nodeSelection.setRange(this.parent.currentDocument,s),i=this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument).cloneContents(),this.cleanupListElements(i,r),s.deleteContents());if(t.querySelectorAll("*:empty").length>0)for(var l=t.querySelectorAll("*:empty"),d=0;d<l.length;d++)-1===r.indexOf(l[d].nodeName)&&sf.base.detach(l[d]);""===t.innerHTML&&(t.innerHTML="<br>"),i.normalize();var c=this.parent.nodeSelection.findFirstContentNode(i);if(t.nextElementSibling?n.insertBefore(i,t.nextElementSibling):n.appendChild(i),"BR"===c.node.nodeName){var h=this.parent.editableElement.ownerDocument.createRange();h.setStartBefore(c.node),h.setEndBefore(c.node),this.parent.nodeSelection.setRange(this.parent.currentDocument,h)}else this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,c.node,0)},e.prototype.cleanupListElements=function(e,t){for(var n=e.firstElementChild.querySelectorAll("*:empty"),i=0;i<n.length-1;i++)-1===t.indexOf(n[i].nodeName)&&sf.base.detach(n[i]);this.ensureListItemContent(e)},e.prototype.ensureListItemContent=function(e){for(var t=e.querySelectorAll("li"),n=0;n<t.length;n++){var i=t[n];if(i.childNodes.length>0&&(i.firstChild&&("UL"===i.firstChild.nodeName||"OL"===i.firstChild.nodeName)||i.firstElementChild&&("UL"===i.firstElementChild.nodeName||"OL"===i.firstElementChild.nodeName))&&!(i.firstChild&&"#text"===i.firstChild.nodeName&&i.firstChild.textContent.trim().length>0)||""===i.innerHTML){var s=document.createElement("br");i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s)}else{var r=i.querySelector("*:empty");r&&r.appendChild(document.createElement("br"))}}},e.prototype.isNodeInListNotTable=function(e){for(var t=e;t&&t!==this.parent.editableElement;){if("TABLE"===t.nodeName)return!1;if("UL"===t.nodeName||"OL"===t.nodeName)return!0;t=t.parentNode}return!1},e.prototype.applyFormattingFromRange=function(e,t,n,i){var s=e,r=[];if(n){for(var o=t.startContainer,a=["div","p","h1","h2","h3","h4","h5","h6","li","ul","ol","table","tr","td","th"];o&&o!==n;){var l=o.nodeName.toLowerCase();-1===a.indexOf(l)&&o.nodeType===Node.ELEMENT_NODE&&r.push({tag:l,element:o}),o=o.parentNode}if(r.length>0){(e="BR"===i?sf.base.createElement("DIV"):e).innerHTML="";var d=e;r.reverse().forEach((function(e){var t=sf.base.createElement(e.tag);Array.from(e.element.attributes).forEach((function(e){t.setAttribute(e.name,e.value)})),d.appendChild(t),d=t}));var c=sf.base.createElement("br");d.appendChild(c),s=d}}return{formattedElement:"BR"===i&&r.length>0?e.firstChild:e,cursorTarget:s}},e.prototype.handleNestedEnterKeyForLists=function(e,t,n,i){var s=!1;if(!sf.base.isNullOrUndefined(n)&&n.querySelectorAll("audio,video,table,img,HR").length>0&&(s=!0),!sf.base.isNullOrUndefined(t)&&(!sf.base.isNullOrUndefined(t.closest("UL"))||!sf.base.isNullOrUndefined(t.closest("OL"))||"UL"===i.nodeName||"OL"===i.nodeName)&&("LI"===t.nodeName||"LI"===n.nodeName)&&("none"===t.style.listStyleType||""===t.style.listStyleType)&&""!==t.textContent&&!sf.base.isNullOrUndefined(n.lastElementChild)&&""!==n.lastElementChild.textContent&&n.firstElementChild&&""===n.firstElementChild.textContent&&!s&&(n===i.firstElementChild||"LI"===n.nodeName)){var r=this.parent.nodeSelection.getRange(this.parent.currentDocument);this.saveSelection=this.parent.nodeSelection.save(r,this.parent.currentDocument),this.domNode.setMarker(this.saveSelection),e.event.preventDefault();var o=[];n===i.firstElementChild?o.push(i.firstElementChild):"LI"===n.nodeName&&o.push(n),this.revertList(o,e),this.revertClean(),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()}},e.prototype.backspaceList=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.domNode.getSelectedNode(t.startContainer,t.startOffset),i=this.parent.domNode.getSelectedNode(t.endContainer,t.endOffset);if(n="BR"===n.nodeName?n.parentElement:n,i="BR"===i.nodeName?i.parentElement:i,!sf.base.isNullOrUndefined(n)&&n.closest("li")){var s=this.getListCursorInfo(t),r=null===n.previousElementSibling,o=this.parent.domNode.blockNodes(),a=this.isAllListNodesSelected(n.closest("li").parentElement),l="StartNested"===s.position&&n&&n.parentElement&&n.parentElement.closest("li")&&n.parentElement.closest("li").getAttribute("style")&&-1!==n.parentElement.closest("li").getAttribute("style").indexOf("list-style-type: none;");if(r&&(["StartParent"].indexOf(s.position)>-1||l)){e.event.preventDefault();var d=this.parent.nodeSelection.save(t,this.parent.currentDocument);this.domNode.setMarker(d);for(var c=0;c<o.length;c++)o.length>0&&"LI"!==o[c].tagName&&"LI"===o[c].parentNode.tagName&&(o[c]=o[c].parentNode);return this.revertList([o[0]],e),this.revertClean(),void(d=this.domNode.saveMarker(d)).restore()}if(["SingleFull","MultipleFull"].indexOf(s.selectionState)>-1&&a){if(e.event.preventDefault(),o[0].innerHTML="",t.deleteContents(),o.length>1)for(c=0;c<o.length;c++)if(0!==c){var h=o[c];sf.base.detach(h)}return void this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,o[0],0)}}if(n===i&&!sf.base.isNullOrUndefined(sf.base.closest(n,"li"))&&(""===n.textContent.trim()&&65279===n.textContent.charCodeAt(0)||1===n.textContent.length&&8203===n.textContent.charCodeAt(0))&&(n.textContent=""),n===i&&"LI"===n.tagName&&0===n.textContent.length&&sf.base.isNullOrUndefined(n.previousElementSibling)&&n.removeAttribute("style"),n!==i||""!==n.textContent||this.hasMediaElement(n)){if(!(sf.base.isNullOrUndefined(n.firstChild)||"BR"!==n.firstChild.nodeName||sf.base.isNullOrUndefined(n.childNodes[1])||"UL"!==n.childNodes[1].nodeName&&"OL"!==n.childNodes[1].nodeName)){p=sf.base.isNullOrUndefined(n.closest("ul"))?n.closest("ol"):n.closest("ul");if(sf.base.isNullOrUndefined(p)||p.tagName!==n.childNodes[1].nodeName)sf.base.isNullOrUndefined(p)||p.parentElement.insertBefore(n.children[1],p);else{for(;n.childNodes[1].lastChild;)this.parent.domNode.insertAfter(n.children[1].lastChild,n);sf.base.detach(n.childNodes[1])}}}else if("LI"===n.parentElement.tagName&&"LI"===i.parentElement.tagName)sf.base.detach(n);else if(n.closest("ul")||n.closest("ol")){var p;if((p=sf.base.isNullOrUndefined(n.closest("ul"))?n.closest("ol"):n.closest("ul")).firstElementChild===n&&!sf.base.isNullOrUndefined(p.children[1])&&("OL"===p.children[1].tagName||"UL"===p.children[1].tagName))if(p.tagName===p.children[1].tagName){for(;p.children[1].lastChild;)this.parent.domNode.insertAfter(p.children[1].lastChild,p.children[1]);sf.base.detach(p.children[1])}else p.parentElement.insertBefore(p.children[1],p)}if(n===i&&"LI"===n.tagName&&this.isAtListStart(n,t)&&!sf.base.isNullOrUndefined(n.closest("ul, ol"))){var u=n.closest("ul, ol"),f=u.parentElement,m=n.previousElementSibling,g=n.querySelector("ol, ul");(!sf.base.isNullOrUndefined(f)&&"LI"===f.tagName&&!sf.base.isNullOrUndefined(u.previousSibling)||!sf.base.isNullOrUndefined(m)&&"LI"===m.nodeName)&&(sf.base.isNullOrUndefined(g)||!sf.base.isNullOrUndefined(m)&&sf.base.isNullOrUndefined(m)||(e.event.preventDefault(),this.handleNestedListRearrangement(n,u,f,m,g)))}this.removeList(t,e),this.firstListBackSpace(t,e)},e.prototype.hasMediaElement=function(e){if(!e)return!1;var t=e.querySelectorAll(".e-video-clickelem"),n=t.length>0&&"IFRAME"===t[0].childNodes[0].nodeName;return!!(e.querySelectorAll("audio,video,table,img,hr").length>0||-1!==["AUDIO","VIDEO","TABLE","IMG","HR"].indexOf(e.tagName)||n)},e.prototype.handleNestedListRearrangement=function(e,t,n,i,s){for(var r=this.parent.nodeSelection.findLastTextPosition(sf.base.isNullOrUndefined(i)?t.previousSibling:i),o=Array.from(e.childNodes),a=0;a<o.length;a++){var l=o[a];if(l===s&&s)for(;s.firstChild;){t.insertBefore(s.firstChild,e),e.querySelector("OL:empty,UL:empty")&&e.remove()}else sf.base.isNullOrUndefined(i)?n.insertBefore(l,t):r.node.parentElement.closest("li").appendChild(l)}this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,r.node,r.offset)},e.prototype.findPreviousElementForCursor=function(e){var t=null;return e.previousElementSibling?t=e.previousElementSibling:e.parentElement&&e.parentElement!==this.parent.editableElement&&(t=e.parentElement),t},e.prototype.handleCursorPositioningAfterListRemoval=function(e){if(e&&this.parent.userAgentData.isSafari()){var t=this.parent.nodeSelection.findLastTextPosition(e);t?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t.node,t.offset):this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,e.childNodes.length)}},e.prototype.removeList=function(e,t){var n=this,i=this.parent.domNode.getSelectedNode(e.startContainer,e.startOffset),s=!sf.base.isNullOrUndefined(e.endContainer.parentElement.closest("li"))&&e.endContainer.parentElement.closest("li").childElementCount>1&&"#text"===e.endContainer.nodeName?e.endContainer:this.parent.domNode.getSelectedNode(e.endContainer,e.endOffset),r="#text"===e.startContainer.nodeName?e.startContainer.parentElement.closest("li"):e.startContainer.closest("li"),o="#text"===e.endContainer.nodeName?e.endContainer.parentElement.closest("li"):e.endContainer.closest("li"),a="";sf.base.isNullOrUndefined(r)||sf.base.isNullOrUndefined(r.firstChild)||r.childNodes.forEach((function(e){a+=e.textContent})),i="BR"===i.nodeName?i.parentElement:i,s="BR"===s.nodeName?s.parentElement:s,i="LI"===i.nodeName||sf.base.isNullOrUndefined(i.closest("LI"))?i:i.closest("LI"),s="LI"===s.nodeName||"#text"===s.nodeName||sf.base.isNullOrUndefined(s.closest("LI"))?s:s.closest("LI");var l,d,c=!sf.base.isNullOrUndefined(o)&&sf.base.isNullOrUndefined(o.nextElementSibling);(("OL"===e.commonAncestorContainer.nodeName||"UL"===e.commonAncestorContainer.nodeName||"LI"===e.commonAncestorContainer.nodeName)&&sf.base.isNullOrUndefined(s.nextElementSibling)&&s.textContent.length===e.endOffset&&c&&sf.base.isNullOrUndefined(i.previousElementSibling)&&0===e.startOffset||-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&e.startContainer===e.endContainer&&e.startContainer===this.parent.editableElement&&0===e.startOffset&&1===e.endOffset)&&(-1!==sf.base.Browser.userAgent.indexOf("Firefox")?(l=this.findPreviousElementForCursor(e.commonAncestorContainer.childNodes[0]),sf.base.detach(e.commonAncestorContainer.childNodes[0])):"LI"===e.commonAncestorContainer.nodeName?(l=this.findPreviousElementForCursor(e.commonAncestorContainer.parentElement),sf.base.detach(e.commonAncestorContainer.parentElement)):(l=this.findPreviousElementForCursor(e.commonAncestorContainer),sf.base.detach(e.commonAncestorContainer)),t.event.preventDefault(),this.handleCursorPositioningAfterListRemoval(l),r="#text"===e.startContainer.nodeName?e.startContainer.parentElement.closest("li"):e.startContainer.closest("li"));if(!sf.base.isNullOrUndefined(o)&&e.commonAncestorContainer===this.parent.editableElement||!sf.base.isNullOrUndefined(r)&&(!e.collapsed||""===r.textContent.trim()&&sf.base.isNullOrUndefined(r.previousElementSibling)&&sf.base.isNullOrUndefined(r.nextElementSibling))&&r.textContent===a){e.deleteContents();for(var h=this.parent.editableElement.querySelectorAll("li"),p=function(e){sf.base.isNullOrUndefined(h[e].childNodes)||h[e].childNodes.forEach((function(t){"A"===t.nodeName&&""===t.textContent&&h[e].removeChild(t)})),h[e].firstChild&&(""!==h[e].textContent.trim()||u.hasMediaElement(h[e]))||h[e]!==i&&h[e]!==s&&h[e]!==o||(d=u.findPreviousElementForCursor(h[e]),h[e].parentNode.removeChild(h[e]))},u=this,f=0;f<h.length;f++)p(f);this.parent.editableElement.querySelectorAll("ol").forEach((function(e){e.firstChild&&(""!==e.textContent.trim()||n.hasMediaElement(e))||(d=n.findPreviousElementForCursor(e),e.parentNode.removeChild(e))})),this.parent.editableElement.querySelectorAll("ul").forEach((function(e){e.firstChild&&(""!==e.textContent.trim()||n.hasMediaElement(e))||(d=n.findPreviousElementForCursor(e),e.parentNode.removeChild(e))})),t.event.preventDefault(),this.handleCursorPositioningAfterListRemoval(d)}},e.prototype.onKeyUp=function(e){if(!sf.base.isNullOrUndefined(this.commonLIParent)&&!sf.base.isNullOrUndefined(this.commonLIParent.querySelector(".removeList"))){for(var t=this.commonLIParent.querySelector(".removeList");!sf.base.isNullOrUndefined(t.firstChild);)this.parent.domNode.insertAfter(t.firstChild,t);sf.base.detach(t)}if(13===e.event.keyCode)for(var n=this.parent.editableElement.querySelectorAll("UL, OL"),i=0;i<n.length;i++)sf.base.isNullOrUndefined(n[i])||sf.base.isNullOrUndefined(n[i].parentElement)||sf.base.isNullOrUndefined(n[i].previousElementSibling)||"UL"!==n[i].parentElement.nodeName&&"OL"!==n[i].parentElement.nodeName||n[i].previousElementSibling.appendChild(n[i])},e.prototype.firstListBackSpace=function(e,t){var n=this.parent.domNode.getSelectedNode(e.startContainer,e.startOffset),i=n.closest("LI");if((sf.base.isNullOrUndefined(i)||this.isAtListStart(i,e))&&(sf.base.isNullOrUndefined(n.closest("OL"))?sf.base.isNullOrUndefined(n.closest("UL"))||(this.commonLIParent=n.closest("UL")):this.commonLIParent=n.closest("OL"),!sf.base.isNullOrUndefined(i)&&0===e.startOffset&&0===e.endOffset&&sf.base.isNullOrUndefined(n.previousSibling)&&!sf.base.isNullOrUndefined(this.commonLIParent)&&sf.base.isNullOrUndefined(this.commonLIParent.previousSibling)&&sf.base.isNullOrUndefined(this.commonLIParent.parentElement.closest("OL"))&&sf.base.isNullOrUndefined(this.commonLIParent.parentElement.closest("UL"))&&sf.base.isNullOrUndefined(this.commonLIParent.parentElement.closest("LI")))){var s=sf.base.createElement("P");s.innerHTML="&#8203;",n.classList.add("removeList"),this.commonLIParent.parentElement.insertBefore(s,this.commonLIParent)}},e.prototype.isAtListStart=function(e,t){if("LI"!==e.nodeName)return!1;var n=e;return this.getFirstTextNode(n)===t.startContainer&&0===t.startOffset},e.prototype.getFirstTextNode=function(e){if(e.nodeType===Node.TEXT_NODE)return e;if("BR"===e.nodeName)return e;for(var t=0;t<e.childNodes.length;t++){var n=this.getFirstTextNode(e.childNodes[t]);if(n)return n}return null},e.prototype.keyDownHandler=function(e){if(13===e.event.which&&this.enterList(e),32===e.event.which&&this.spaceList(e),8===e.event.which&&this.backspaceList(e),46===e.event.which&&"delete"===e.event.action){var t=(o=this.parent.nodeSelection.getRange(this.parent.currentDocument)).commonAncestorContainer,n=o.startContainer,i=o.endContainer,s=3===n.nodeType?this.domNode.blockParentNode(n):n,r=3===i.nodeType?this.domNode.blockParentNode(i):i;"UL"!==t.nodeName&&"OL"!==t.nodeName||s===r||sf.base.isNullOrUndefined(sf.base.closest(s,"ul"))&&sf.base.isNullOrUndefined(sf.base.closest(s,"ol"))||sf.base.isNullOrUndefined(sf.base.closest(r,"ul"))&&sf.base.isNullOrUndefined(sf.base.closest(r,"ol"))||t.lastElementChild!==sf.base.closest(r,"li")||t.lastChild===r||o.collapsed||this.areAllListItemsSelected(t,o)&&sf.base.detach(t),this.removeList(o,e)}if(9===e.event.which){var o=this.parent.nodeSelection.getRange(this.parent.currentDocument);e.event.action&&"indent"===e.event.action||(this.saveSelection=this.parent.nodeSelection.save(o,this.parent.currentDocument)),e.enableTabKey&&this.handleListIndentation(e);var a=void 0;if((s=this.parent.domNode.getSelectedNode(o.startContainer,o.startOffset))===(r=this.parent.domNode.getSelectedNode(o.endContainer,o.endOffset))&&("BR"===s.nodeName||"#text"===s.nodeName)&&me.indexOf(s.parentNode.tagName.toLocaleLowerCase())>=0)return;e.event.action&&"indent"===e.event.action||this.listTabIndentation||this.domNode.setMarker(this.saveSelection),a=this.domNode.blockNodes();for(var l=[],d=!0,c=0;c<a.length;c++)"LI"===a[c].parentNode.tagName?l.push(a[c].parentNode):sf.base.closest(a[c],"OL")||sf.base.closest(a[c],"UL")||!sf.base.closest(a[c],"LI")?"LI"===a[c].tagName&&"P"!==a[c].childNodes[0].tagName&&"OL"!==a[c].childNodes[0].tagName&&"UL"!==a[c].childNodes[0].tagName&&l.push(a[c]):l.push(sf.base.closest(a[c],"LI"));l.length>1||1===l.length?(e.event.preventDefault(),e.event.stopPropagation(),this.currentAction=this.getAction(l[0]),e.event.shiftKey&&(!e.enableTabKey||e.enableTabKey&&!this.listTabIndentation)?(this.revertList(l,e),this.revertClean()):(!e.enableTabKey||e.enableTabKey&&!this.listTabIndentation)&&this.indentTab(e)&&(d=this.nestedList(l)),d&&(this.cleanNode(),this.parent.editableElement.focus({preventScroll:!0})),e.event.action&&"indent"===e.event.action||this.listTabIndentation||(this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore(),e.callBack&&e.callBack({requestType:this.currentAction,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes(),event:e.event}))):e.event.action&&"indent"===e.event.action||this.listTabIndentation||(e.event&&e.event.shiftKey&&"Tab"===e.event.key&&(e.event.action="tab"),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()),this.listTabIndentation=!1}else switch(e.event.action){case"ordered-list":this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault();break;case"unordered-list":this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault();break;case"checklist":this.applyListsHandler({subCommand:"Checklist",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.handleListIndentation=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.saveSelection.getParentNodeCollection(t);if(this.indentTab(e)&&("LI"===n[0].nodeName||sf.base.closest(n[0],"li"))&&!this.isCursorAtStartOfLI(t)){var i=n[n.length-1],s=n[0],r=t.startContainer;if(i&&s){if(t.deleteContents(),i!==s){for(var o=r;o.parentElement;){if(this.parent.domNode.isBlockNode(o.parentElement)){o=o.parentElement;break}o=o.parentElement}var a=void 0;this.parent.domNode.isBlockNode(i.lastChild)?(r.nodeValue+="    ",a=r.nodeValue.length):i.innerHTML+='&nbsp;&nbsp;&nbsp;&nbsp;<span class="rte-tab-space"></span>';var l=s.firstChild;if(l&&this.parent.domNode.isBlockNode(l)){for(;l.firstChild;)o.appendChild(l.firstChild);l.remove()}for(;s.firstChild;)this.parent.domNode.isBlockNode(s.firstChild)?this.parent.domNode.insertAfter(s.firstChild,o):i.appendChild(s.firstChild);s.remove();var d=i.querySelector(".rte-tab-space");d&&d.previousSibling?(this.saveSelection.setCursorPoint(this.parent.currentDocument,d.previousSibling,d.previousSibling.textContent.length),d.parentNode.removeChild(d)):this.saveSelection.setCursorPoint(this.parent.currentDocument,r,a)}else Pe.Insert(this.parent.currentDocument,"&nbsp;&nbsp;&nbsp;&nbsp;",this.parent.editableElement);this.listTabIndentation=!0}}},e.prototype.indentTab=function(e){var t="number"==typeof e.maxLength?e.maxLength:-1,n=this.parent.editableElement.textContent.replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length,i=this.parent.currentDocument.getSelection().toString().length;return-1===t||n-i+4<=t},e.prototype.isCursorAtStartOfLI=function(e){for(var t=e.startContainer;t&&"LI"!==t.nodeName;)t=t.parentNode;if(!t)return!1;var n=e.cloneRange();return n.selectNodeContents(t),n.setEnd(e.startContainer,e.startOffset),""===n.toString().trim()},e.prototype.spaceKeyAction=function(e){32===e.event.which&&this.spaceList(e)},e.prototype.getAction=function(e){return"OL"===e.parentNode.nodeName?"OL":"UL"},e.prototype.revertClean=function(){for(var e=this.parent.editableElement.querySelectorAll("ul, ol"),t=0;t<e.length;t++){var n=e[t].querySelectorAll("ul, ol");if(n.length>0)for(var i=0;i<n.length;i++){var s=n[i].previousSibling;s&&"LI"===s.tagName&&s.appendChild(n[i])}}},e.prototype.noPreviousElement=function(e){var t,n,i=e.querySelectorAll("ol, ul"),s=e.querySelectorAll("li"),r=this.domNode.contents(s[0])[0];if(s.length>0&&(i.length<=1||i[0].childNodes.length>1)&&("OL"===r.nodeName||"UL"===r.nodeName)?t=s[0]:n=i[0],t)for(var o=this.domNode.contents(e)[0];o&&!this.domNode.isList(o);null){var a=o.nextSibling;sf.base.prepend([o],t),sf.base.setStyleAttribute(e,{"list-style-type":"none"}),(d=e.parentNode&&e.parentNode.classList.contains("e-rte-checklist"))&&sf.base.addClass([e],["e-rte-checklist-hidden"]),sf.base.setStyleAttribute(t,{"list-style-type":""}),o=a}else if(n){var l=sf.base.createElement("li");sf.base.prepend([l],n);for(o=this.domNode.contents(e)[0];o&&!this.domNode.isList(o);null){a=o.nextSibling;l.appendChild(o),o=a}var d=e.parentNode&&e.parentNode.classList.contains("e-rte-checklist");sf.base.prepend([n],e.parentNode),sf.base.detach(e);var c=sf.base.createElement("li",{styles:"list-style-type: none;"});d&&sf.base.addClass([c],["e-rte-checklist-hidden"]),sf.base.prepend([c],n.parentNode),sf.base.append([n],c)}else{c=sf.base.createElement("li",{styles:"list-style-type: none;"});sf.base.prepend([c],e.parentNode);l=sf.base.createElement(e.parentNode.tagName);e.parentNode.classList.contains("e-rte-checklist")&&(sf.base.addClass([l],["e-rte-checklist"]),sf.base.addClass([c],["e-rte-checklist-hidden"])),sf.base.prepend([l],c),sf.base.append([e],l)}},e.prototype.nestedList=function(e){for(var t=!1,n=function(n){var s=i.domNode.getPreviousNode(e[n]);if(s){t=!0;var r=void 0,o=void 0,a=e[n].querySelectorAll("ol, ul"),l=e[n].querySelectorAll("li"),d=i.domNode.contents(l[0])[0];if(l.length>0&&(a.length<=1||a[0].childNodes.length>1)&&("OL"===d.nodeName||"UL"===d.nodeName)?o=l[0]:r=a[0],r){var c=sf.base.createElement("li");sf.base.prepend([c],r);for(var h=i.domNode.contents(e[n])[0];h&&!i.domNode.isList(h);null){var p=h.nextSibling;c.appendChild(h),h=p}s.parentNode&&s.parentNode.classList.contains("e-rte-checklist")&&sf.base.addClass([r],["e-rte-checklist"]),sf.base.append([r],s),sf.base.detach(e[n])}else if(o){if("LI"===s.tagName){for(h=i.domNode.contents(e[n])[0];h&&!i.domNode.isList(h);null){p=h.nextSibling;sf.base.prepend([h],o),sf.base.setStyleAttribute(e[n],{"list-style-type":"none"}),sf.base.setStyleAttribute(o,{"list-style-type":""}),h=p}sf.base.append([o.parentNode],s),sf.base.detach(e[n])}}else if("LI"===s.tagName){c=sf.base.createElement(e[n].parentNode.tagName);e[n].parentNode.classList.contains("e-rte-checklist")&&sf.base.addClass([c],["e-rte-checklist"]),c.style.listStyleType=e[n].parentNode.style.listStyleType;var u=s.getAttribute("style"),f=getComputedStyle(e[n]),m=e[n].style;if(u)u.split(";").filter(Boolean).forEach((function(t){var i=t.split(":").map((function(e){return e.trim()})),s=i[0],r=i[1];if(s&&r&&"list-style-type"!==s){var o=f.getPropertyValue(s).trim(),a=m.getPropertyValue(s).trim();o===r||a||e[n].style.setProperty(s,o)}}));sf.base.append([c],s),sf.base.append([e[n]],c)}else"OL"!==s.tagName&&"UL"!==s.tagName||sf.base.append([e[n]],s)}else{var g=e[n];t=!0,i.noPreviousElement(g)}},i=this,s=0;s<e.length;s++)n(s);return t},e.prototype.isCursorBeforeTable=function(e){return e.startOffset===e.endOffset&&e.startContainer.childNodes.length>0&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])&&"TABLE"===e.startContainer.childNodes[e.startOffset].nodeName},e.prototype.isCursorAtEndOfTable=function(e){return e.startOffset===e.endOffset&&e.startContainer.childNodes.length>0&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])&&"TABLE"===e.startContainer.childNodes[e.startOffset-1].nodeName},e.prototype.isListItemWithTableChild=function(e){return"LI"===e.nodeName&&!sf.base.isNullOrUndefined(e.firstChild)&&"TABLE"===e.firstChild.nodeName},e.prototype.handleChecklistToggle=function(e){var t=e.event.target;"LI"!==t.tagName&&sf.base.isNullOrUndefined(sf.base.closest(t,".e-rte-checklist"))||(e.event.preventDefault(),e.event.stopPropagation(),t.classList.contains("e-rte-checklist-checked")?t.classList.remove("e-rte-checklist-checked"):t.classList.add("e-rte-checklist-checked"))},e.prototype.applyListsHandler=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);if("Checklist"===e.subCommand&&e.item&&"toggleChecklist"===e.item.action)this.handleChecklistToggle(e);else{var n="HR"===t.startContainer.nodeName?t.startContainer:t.startContainer.childNodes[t.startOffset],i=n&&"HR"===n.nodeName?n.nextElementSibling:null,s=t.startContainer===t.endContainer&&t.startOffset===t.endOffset;if(-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&t.startContainer===t.endContainer&&t.startContainer===this.parent.editableElement){for(var r=t.startContainer.childNodes[t.startOffset>0?t.startOffset-1:t.startOffset]||t.startContainer,o=t.endContainer.childNodes[t.endOffset>0?t.endOffset-1:t.endOffset]||t.endContainer,a="BR"===o.lastChild.nodeName?sf.base.isNullOrUndefined(o.lastChild.previousSibling)?o:o.lastChild.previousSibling:o.lastChild;!sf.base.isNullOrUndefined(a)&&"#text"!==a.nodeName&&"IMG"!==a.nodeName&&"BR"!==a.nodeName&&"HR"!==a.nodeName;)a=a.lastChild;this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,r,a,0,a.textContent.length),t=this.parent.nodeSelection.getRange(this.parent.currentDocument)}if(t.startContainer===t.endContainer&&t.startContainer===this.parent.editableElement&&t.startOffset===t.endOffset&&0===t.startOffset&&0===this.parent.editableElement.textContent.length&&"TABLE"!==this.parent.editableElement.childNodes[0].nodeName&&"IMG"!==this.parent.editableElement.childNodes[0].nodeName){var l=t.startContainer.childNodes[0];this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,l,l,0,0),t=this.parent.nodeSelection.getRange(this.parent.currentDocument)}this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument),this.currentAction=e.subCommand,this.currentAction=e.subCommand="NumberFormatList"===this.currentAction?"OL":"BulletFormatList"===this.currentAction?"UL":this.currentAction,this.domNode.setMarker(this.saveSelection);var d=this.domNode.blockNodes(!0);"BR"===e.enterAction&&(this.isCursorBeforeTable(t)?d=[t.startContainer.childNodes[t.startOffset]]:this.isCursorAtEndOfTable(t)?d=[t.startContainer.childNodes[t.startOffset-1]]:1===d.length&&this.isListItemWithTableChild(d[0])?d[0]=d[0].firstChild:(this.setSelectionBRConfig(),this.parent.domNode.convertToBlockNodes(this.parent.domNode.blockNodes(),!0),this.setSelectionBRConfig(),d=this.parent.domNode.blockNodes()));for(var c=0;c<d.length;c++)"TABLE"!==d[c].tagName||t.collapsed||d.splice(c,1),d.length>0&&"LI"!==d[c].tagName&&"LI"===d[c].parentNode.tagName&&(d[c]=d[c].parentNode);this.applyLists(d,this.currentAction,e.selector,e.item,e,s),i&&t.startContainer===t.endContainer&&t.startOffset===t.endOffset&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0)}e.callBack&&e.callBack({requestType:this.currentAction,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},e.prototype.setSelectionBRConfig=function(){var e=this.parent.editableElement.querySelector("."+Be),t=this.parent.editableElement.querySelector("."+Me);sf.base.isNullOrUndefined(t)?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,e,t,0,0)},e.prototype.commonRevertList=function(e){for(var t,n=[],i=[],s=0;s<e.length;s++){for(var r=e[s].parentElement;this.isListTag(r.parentElement.nodeName);)r=r.parentElement;0!==s?r!==t&&(n.push(e[s]),t=r,i.push(t)):(n.push(e[s]),t=r,i.push(t))}return{commonList:n,commonListParent:i}},e.prototype.applyLists=function(e,t,n,i,s,r){if("Checklist"===t&&(t="UL"),this.isRevert(e,t,i,s.subCommand)&&sf.base.isNullOrUndefined(i)){var o=this.commonRevertList(e);this.completeRevertList(o,s.enterAction)}else{this.checkLists(e,t,i,r,s.subCommand);var a=e[0],l=[];""!==a.style.marginLeft&&l.push({"margin-left":a.style.marginLeft});for(var d=[],c=0;c<e.length;c++){if(!sf.base.isNullOrUndefined(i)&&!sf.base.isNullOrUndefined(i.listStyle)&&"Checklist"!==s.subCommand)if("listImage"===i.listStyle)d.push({"list-style-image":i.listImage});else{var h=this.formatListStyle(i.listStyle);d.push({"list-style-image":"none","list-style-type":h})}e[c].style.removeProperty("margin-left");var p="IMG"===e[c].tagName||e[c].classList.contains("e-editor-select-start")?{}:this.extractAllAttributes(e[c]);if("true"===e[c].getAttribute("contenteditable")&&1===e[c].childNodes.length&&"TABLE"===e[c].childNodes[0].nodeName){var u=document.createElement(t);u.innerHTML="<li><br/></li>",e[c].appendChild(u)}else if("LI"!==e[c].tagName&&sf.base.isNullOrUndefined(i)&&"BLOCKQUOTE"===e[c].nodeName){var f=this.parent.editableElement.ownerDocument.createElement("div"),m=this.parent.editableElement.ownerDocument.createElement(t);this.applyListStyles(m,l),this.applyListStyles(m,d);var g=e[c].innerHTML,b=this.parent.editableElement.ownerDocument.createElement("li");this.applyAllAttributes(b,p),b.innerHTML=g,m.appendChild(b),f.appendChild(m);var v=f.innerHTML;"Checklist"===s.subCommand&&(v=this.addCheckListClass(v)),e[c].innerHTML=v}else if("LI"!==e[c].tagName&&sf.base.isNullOrUndefined(i)){m=this.parent.editableElement.ownerDocument.createElement(t);this.applyListStyles(m,l),this.applyListStyles(m,d);g=void 0;g="p"===e[c].tagName.toLowerCase()||"DIV"===e[c].tagName?e[c].innerHTML:e[c].outerHTML,"HR"===e[c].tagName&&e[c].firstElementChild&&"SPAN"===e[c].firstElementChild.tagName&&e[c].firstElementChild.hasAttribute("class")&&"e-editor-select-start"===e[c].firstElementChild.className&&(g=e[c].firstElementChild.outerHTML+e[c].outerHTML);b=this.parent.editableElement.ownerDocument.createElement("li");this.applyAllAttributes(b,p),b.innerHTML=g;var y=b.outerHTML;y=this.setStyle(y),m.innerHTML=y;v=m.outerHTML;"Checklist"===s.subCommand&&(v=this.addCheckListClass(v)),this.domNode.replaceWith(e[c],v)}else if(!sf.base.isNullOrUndefined(i)&&"LI"!==e[c].tagName){f=this.parent.editableElement.ownerDocument.createElement("div"),m=this.parent.editableElement.ownerDocument.createElement(t);this.applyListStyles(m,d),f.appendChild(m);g=void 0;g="p"===e[c].tagName.toLowerCase()||"DIV"===e[c].tagName?e[c].innerHTML:e[c].outerHTML;b=this.parent.editableElement.ownerDocument.createElement("li");this.applyAllAttributes(b,p),b.innerHTML=g;y=b.outerHTML;m.innerHTML=y;v=f.innerHTML;"Checklist"===s.subCommand&&(v=this.addCheckListClass(v)),this.domNode.replaceWith(e[c],v)}}}(this.cleanNode(),"BR"===s.enterAction)&&document.querySelectorAll("span#removeSpan").forEach((function(e){for(var t=document.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e)}));this.parent.editableElement.focus({preventScroll:!0}),C()&&N(this.parent.editableElement,n),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()},e.prototype.extractAllAttributes=function(e){var t={};return e&&e.attributes&&Array.from(e.attributes).forEach((function(e){t[e.name]=e.value})),t},e.prototype.applyAllAttributes=function(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))},e.prototype.applyListStyles=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&e.style.setProperty(s,i[s])}},e.prototype.addCheckListClass=function(e){var t=sf.base.createElement("div");t.innerHTML=e;var n=t.firstElementChild;return this.applyCheckListClasses(n),t.innerHTML},e.prototype.applyCheckListClasses=function(e){sf.base.addClass([e],"e-rte-checklist")},e.prototype.setStyle=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelector("li");if(!n)return e;for(var i=["color","font-size","font-family","font-weight","font-style"],s=new Map,r=this.parent.currentDocument.createTreeWalker(n,NodeFilter.SHOW_TEXT,null),o=r.nextNode(),a=function(){for(var e=o.textContent||"",t=o.parentElement,a=new Map;t&&t!==n;)i.forEach((function(e){var n=t.style.getPropertyValue(e);n&&!a.has(e)&&a.set(e,n)})),"B"!==t.tagName&&"STRONG"!==t.tagName||a.has("font-weight")||a.set("font-weight","bold"),"I"!==t.tagName&&"EM"!==t.tagName||a.has("font-style")||a.set("font-style","italic"),t=t.parentElement;a.forEach((function(t,n){s.has(n)||s.set(n,new Map);var i=s.get(n)||new Map,r=i.get(t)||"";i.set(t,r+e)})),o=r.nextNode()};o;)a();return s.forEach((function(e,t){e.forEach((function(e,i){e===n.textContent&&n.style.setProperty(t,i)}))})),t.innerHTML},e.prototype.isRevert=function(e,t,n,i){for(var s=!0,r=0;r<e.length;r++){if("LI"!==e[r].tagName)return!1;(e[r].parentNode.tagName!==t||sf.base.isNullOrUndefined(n)&&""!==e[r].parentNode.style.listStyleType||"UL"===e[r].parentNode.tagName&&e[r].parentNode.classList.contains("e-rte-checklist")&&"Checklist"!==i)&&(s=!1),e[r].parentNode.tagName===t&&""!==e[r].parentNode.style.listStyleType&&(s=!0),"UL"!==e[r].parentNode.tagName||e[r].parentNode.classList.contains("e-rte-checklist")||"Checklist"!==i||(s=!1)}return s},e.prototype.checkLists=function(e,t,n,i,s){for(var r=[],o=0;o<e.length;o++){var a=e[o].parentNode;("LI"===e[o].tagName&&a.tagName!==t&&r.indexOf(a)<0||"LI"===e[o].tagName&&a.tagName===t&&r.indexOf(a)<0&&null!==n||"LI"===e[o].tagName&&a.tagName===t&&"Checklist"===s&&r.indexOf(a)<0||"LI"===e[o].tagName&&a.tagName===t&&"Checklist"!==s&&r.indexOf(a)<0&&a.classList.contains("e-rte-checklist"))&&r.push(a),sf.base.isNullOrUndefined(n)&&(a.tagName===t||("UL"===a.tagName||"OL"===a.tagName)&&a.hasAttribute("style"))&&a.hasAttribute("style")&&a.removeAttribute("style")}this.convertListType(e,t,r,i,n,s)},e.prototype.convertListType=function(e,t,n,i,s,r){var o=this;t="Checklist"===r?"Checklist":t;for(var a=Array.from(new Set(e.map((function(e){return e.parentNode})).filter((function(e){return"OL"===e.tagName||"UL"===e.tagName})))).reverse(),l=function(l){var c=a[l];if(i||"UL"!==c.tagName&&"OL"!==c.tagName){if(i)for(var h=n.length-1;h>=0;h--){var p=n[h],u="Checklist"===t?"ul":t,f="<"+u.toLowerCase()+" "+d.domNode.attributes(p)+">"+p.innerHTML+"</"+u.toLowerCase()+">",m=document.createElement("div");if(m.innerHTML=f,d.applyListItemStyle(m.firstChild,s),"Checklist"===r)m.innerHTML=d.addCheckListClass(m.innerHTML);else{for(var g=m.querySelectorAll("li"),b=0;b<g.length;b++)d.revertChecklistItem(g[b]);m.firstElementChild&&m.firstElementChild.classList.contains("e-rte-checklist")&&(m.firstElementChild.classList.remove("e-rte-checklist"),0===m.firstElementChild.classList.length&&m.firstElementChild.removeAttribute("class"))}d.domNode.replaceWith(n[h],m.innerHTML)}}else{var v=d.parent.currentDocument.createDocumentFragment(),y=c.tagName,C=c.classList.contains("e-rte-checklist"),N="Checklist"===t,E=d.parent.currentDocument.createElement(N?"ul":t.toLowerCase());N&&d.applyCheckListClasses(E),Array.from(c.children).filter((function(e){return"LI"===e.tagName})).forEach((function(n){if(-1!==e.indexOf(n))if(y===(N?"ul":t.toLowerCase())&&C===N){var i=n.cloneNode(!0);E.appendChild(i)}else{var r=N?"UL":t;E=o.parent.currentDocument.createElement(r.toLowerCase()),y!==t||c.classList.contains("e-rte-checklist")&&"UL"===t||o.transferAttributes(c,E),N&&o.applyCheckListClasses(E),y=N?"ul":t.toLowerCase(),C=N,v.appendChild(E);i=n.cloneNode(!0);o.applyListItemStyle(E,s),E.appendChild(i)}else y===c.tagName.toLowerCase()&&C===c.classList.contains("e-rte-checklist")||(y=c.tagName.toLowerCase(),C=c.classList.contains("e-rte-checklist"),E=o.parent.currentDocument.createElement(y),C&&o.applyCheckListClasses(E),o.transferAttributes(c,E),v.appendChild(E)),E.appendChild(n.cloneNode(!0))})),c.parentNode.replaceChild(v,c)}},d=this,c=0;c<a.length;c++)l(c)},e.prototype.applyListItemStyle=function(e,t){if(!sf.base.isNullOrUndefined(t)&&!sf.base.isNullOrUndefined(t.listStyle))if("listImage"===t.listStyle)sf.base.setStyleAttribute(e,{"list-style-image":t.listImage});else{sf.base.setStyleAttribute(e,{"list-style-image":"none"});var n=this.formatListStyle(t.listStyle);sf.base.setStyleAttribute(e,{"list-style-type":n})}},e.prototype.transferAttributes=function(e,t){for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n];t.setAttribute(i.name,i.value)}},e.prototype.cleanNode=function(){for(var e,t,n=this.parent.editableElement.querySelectorAll("ol + ol, ul + ul"),i=0;i<n.length;i++){for(var s=n[i],r=!0,o=s;o.parentElement&&(!o.parentElement||"LI"===o.parentElement.tagName||"OL"===o.parentElement.tagName||"UL"===o.parentElement.tagName);)o=o.parentElement;if(r&&("OL"===n[i].parentElement.parentElement.nodeName||"UL"===n[i].parentElement.parentElement.nodeName))r=!1,e=n[i].parentElement.parentElement.style.listStyleType,t=s.previousElementSibling;if(this.domNode.isList(s.previousElementSibling)&&this.domNode.openTagString(s)===this.domNode.openTagString(s.previousElementSibling)){for(var a=this.domNode.contents(s),l=0;l<a.length;l++)s.previousElementSibling.appendChild(a[l]);s.parentNode.removeChild(s)}else if(sf.base.isNullOrUndefined(s.getAttribute("level"))){if(this.domNode.isList(s.previousElementSibling)&&o.contains(s.previousElementSibling)&&("OL"===s.tagName||"UL"===s.tagName)&&("OL"===s.previousElementSibling.nodeName||"UL"===s.previousElementSibling.nodeName)&&s.previousElementSibling.classList.contains("e-rte-checklist")&&s.classList.contains("e-rte-checklist")&&(!s.previousElementSibling.classList.contains("e-rte-checklist")||!s.classList.contains("e-rte-checklist"))){for(a=this.domNode.contents(s),l=0;l<a.length;l++)s.previousElementSibling.appendChild(a[l]);s.parentNode.removeChild(s)}}else s.tagName===s.previousElementSibling.tagName&&s.previousElementSibling.lastChild.append(s)}if(t){t.style.listStyleType=e;var d=this.parent.nodeSelection.getRange(this.parent.currentDocument),c=[];"UL"===d.commonAncestorContainer.nodeName||"OL"===d.commonAncestorContainer.nodeName?(d.commonAncestorContainer instanceof Element&&c.push(d.commonAncestorContainer),c=c.concat(Array.from(d.commonAncestorContainer.querySelectorAll("ol, ul")))):c=Array.from(d.commonAncestorContainer.querySelectorAll("ol, ul"));for(var h=0;h<c.length;h++)for(var p=void 0,u=c[h];u;)"OL"!==u.nodeName&&"OL"!==u.nodeName||(""!==u.style.listStyleType&&"none"!==u.style.listStyleType&&"LI"!==u.nodeName?p=u.style.listStyleType:sf.base.isNullOrUndefined(p)||""!==u.style.listStyleType&&"none"!==u.style.listStyleType||"LI"===u.nodeName||"UL"!==u.nodeName&&"OL"!==u.nodeName||(u.style.listStyleType=p)),u=u.querySelector("UL,OL")}},e.prototype.findUnSelected=function(e,t){if((e=e.slice().reverse()).length>0){var n=[],i=[],s=[],r=[];s=t[t.length-1].childNodes;for(var o=0;o<s.length;o++)if("OL"===s[o].tagName||"UL"===s[o].tagName){var a=s[o].querySelectorAll("li");if(a.length>0)for(var l=0;l<a.length;l++)r.push(a[l])}for(var d=0;d<r.length;d++){for(var c=0,h=0;h<e.length;h++)r[d].contains(e[h])||(c+=1);c===e.length&&i.push(r[d])}if(i.length>0)for(var p=0;p<i.length;p++)"OL"!==this.domNode.contents(i[p])[0].nodeName&&"UL"!==this.domNode.contents(i[p])[0].nodeName&&n.push(i[p]);n.length>0&&this.nestedList(n)}},e.prototype.revertChecklistItem=function(e){e&&e.parentElement&&e.parentElement.classList.contains("e-rte-checklist")&&e.parentElement.classList.remove("e-rte-checklist")},e.prototype.isListTag=function(e){return"OL"===e||"UL"===e||"LI"===e},e.prototype.closeAncestorsBeforeSelection=function(e,t){for(var n=e.parentElement,i=e;this.isListTag(e.parentElement.nodeName)&&e.parentElement!==t;)n.insertBefore(this.closeTag(e.parentElement.nodeName),i),e=e.parentElement},e.prototype.closeAncestorsAfterSelection=function(e,t,n,i,s){var r=e;this.domNode.insertAfter(this.closeTag(t.nodeName),r),r=r.nextSibling;var o=t.parentElement,a=!1;if(n!==i)for(o!==n.parentElement&&o!==s||(a=!0);!a;)this.domNode.insertAfter(this.closeTag(o.nodeName),r),r=r.nextSibling,(o=o.parentElement)!==n.parentElement&&o!==s||(a=!0);this.reopenListStructure(t,r,s)},e.prototype.reopenListStructure=function(e,t,n){for(;this.isListTag(e.parentElement.nodeName)&&e.parentElement!==n;){this.domNode.insertAfter(this.openTag(e.parentElement.nodeName),t),e=e.parentElement;var i=(t=t.nextSibling).previousElementSibling&&["e-rte-list-close-li","e-rte-list-close-ol","e-rte-list-close-ul"].indexOf(t.previousElementSibling.classList[0])>-1,s=["e-rte-list-open-ol","e-rte-list-open-ul"].indexOf(t.classList[0])>-1;i&&s&&t.classList.add("e-rte-list-start")}},e.prototype.completeRevertList=function(e,t){void 0===t&&(t="P");for(var n=0;n<e.commonList.length;n++){var i=e.commonListParent[n],s=i.getAttribute("class"),r=i.getAttribute("style"),o=i.parentElement,a=i.querySelector(".e-editor-select-start"),l=a?a.parentElement:null;for(sf.base.isNullOrUndefined(l)&&(l=e.commonList[n]);l&&"LI"!==l.nodeName;)l=l.parentElement;l.classList.add("e-rte-select-list-start");var d=l;this.closeAncestorsBeforeSelection(l,o);var c=i.querySelector(".e-editor-select-end");sf.base.isNullOrUndefined(c)&&1===e.commonList.length&&(c=a);var h=c?c.parentElement:null;for(sf.base.isNullOrUndefined(h)&&(c=(h=i.lastElementChild).childNodes[h.childNodes.length-1]);"LI"!==h.nodeName;)h=h.parentElement;h.classList.add("e-rte-select-list-end");for(var p=h;!this.parent.domNode.isBlockNode(c)&&"LI"!==c.parentElement.tagName;)c=c.parentElement;for(;c.nextSibling&&!this.isListTag(c.nextSibling.nodeName);)c=c.nextSibling;if("TD"===c.nodeName||"TH"===c.nodeName)for(c=p.childNodes[p.childNodes.length-1];c&&this.isListTag(c.nodeName);)c=c.previousSibling;this.closeAncestorsAfterSelection(c,h,d,p,o),i.outerHTML=this.processSplitedList(this.replaceCustomSpans(i.outerHTML,s,r),t)}},e.prototype.addAllAttributes=function(e,t){Object.keys(t).forEach((function(n){var i=t[n],s=e.getAttribute(n);if(s)if("class"===n||"style"===n){var r=Array.from(new Set((s+" "+i).trim().split(/\s+/))).join(" ");e.setAttribute(n,r)}else e.setAttribute(n,i);else e.setAttribute(n,i)}));var n=!1;if(["e-rte-checklist","e-rte-select-list-start","e-rte-select-list-end","e-rte-checklist-checked"].forEach((function(t){e.classList.contains(t)&&(e.classList.remove(t),n=!0)})),n&&0===e.classList.length&&e.removeAttribute("class"),e.style){for(var i=e.style,s=0;s<i.length;s++)"list-style-image"!==i[s]&&"list-style-type"!==i[s]||(e.style.removeProperty(i[s]),s--);0===e.style.length&&e.removeAttribute("style")}},e.prototype.processSplitedList=function(e,t){var n=sf.base.createElement("div");n.innerHTML=e;var i,s=n.querySelector(".e-rte-select-list-start"),r=s;for(!s.previousElementSibling||"OL"!==s.previousElementSibling.nodeName&&"UL"!==s.previousElementSibling.nodeName||(i=this.extractAllAttributes(s.previousElementSibling)),s&&(s.classList.add("e-rte-insertAfterElement"),this.wrapperAction(s,t,n,i),r=s.nextElementSibling,sf.base.detach(s));r&&"OL"!==r.nodeName&&"UL"!==r.nodeName;)if("LI"===r.nodeName){r.classList.add("e-rte-insertAfterElement"),this.wrapperAction(r,t,n,i);var o=r.nextElementSibling;sf.base.detach(r),r=o}else r=r.nextElementSibling;var a=n.querySelector(".e-rte-insertAfterElement");a&&(a.classList.remove("e-rte-insertAfterElement"),a.getAttribute("class")||a.removeAttribute("class"));return this.addStyleForNestedList(n),this.clearEmptyList(n),n.innerHTML.trim()},e.prototype.addStyleForNestedList=function(e){if(e.lastElementChild&&("OL"===e.lastElementChild.nodeName||"UL"===e.lastElementChild.nodeName)){var t=e.lastElementChild.firstElementChild,n=sf.base.isNullOrUndefined(t)?null:this.getFirstTextNode(t);if(!sf.base.isNullOrUndefined(n)){var i=n.parentNode;if("OL"!==i.nodeName&&"UL"!==i.nodeName){for(;i&&"LI"!==i.nodeName;)i=i.parentElement;i=i.parentElement}var s=t.parentElement.getAttribute("style");i.getAttribute("style")&&i.getAttribute("style").includes(s)||sf.base.isNullOrUndefined(s)||i.setAttribute("style",s)}}},e.prototype.clearEmptyList=function(e){for(var t=e.querySelectorAll("ul, ol"),n=0;n<t.length;n++){var i=t[n],s=i.querySelector("img, video, audio, table");""===i.textContent.trim()&&!s&&sf.base.detach(i)}var r=e.querySelectorAll("li:empty");for(n=0;n<r.length;n++)sf.base.detach(r[n])},e.prototype.updateInsertAfterMarker=function(e){var t=e.nextElementSibling;e.classList.remove("e-rte-insertAfterElement"),e.getAttribute("class")||e.removeAttribute("class"),t&&t.classList.add("e-rte-insertAfterElement")},e.prototype.flushWrap=function(e,t,n){if(0===t.length)return[];if("BR"!==e.nodeName){for(var i=0;i<t.length;i++)e.appendChild(t[i]);if(""!==e.innerHTML.trim())(s=n.querySelector(".e-rte-insertAfterElement"))&&(this.domNode.insertAfter(e,s),this.updateInsertAfterMarker(s))}else{var s=n.querySelector(".e-rte-insertAfterElement"),r=!1;for(i=0;i<t.length;i++)""!==t[i].textContent.trim()&&(n.insertBefore(t[i],s),r=!0);r&&n.insertBefore(e,s)}return[]},e.prototype.createWrapElement=function(e,t,n){var i=sf.base.createElement(e);if("BR"!==i.nodeName){sf.base.isNullOrUndefined(t)||this.applyAllAttributes(i,t);var s=this.extractAllAttributes(n);this.addAllAttributes(i,s)}if(i.getAttribute("style")){["color","font-size","font-family","font-weight","font-style"].forEach((function(e){i.style.getPropertyValue(e)&&i.style.removeProperty(e)})),0===i.style.length&&i.removeAttribute("style")}return i},e.prototype.wrapperAction=function(e,t,n,i){for(var s=Array.from(e.childNodes),r=[],o=0;o<s.length;o++){var a=s[o];if(a.nodeType===Node.ELEMENT_NODE){var l=a;if(this.domNode.isBlockNode(l)&&!this.isListTag(l.nodeName)){var d=this.createWrapElement(t,i,e);r=this.flushWrap(d,r,n);var c=n.querySelector(".e-rte-insertAfterElement");if(c&&""!==l.innerHTML.trim()){sf.base.isNullOrUndefined(i)||this.addAllAttributes(l,i);for(var h=l.parentElement;h&&"LI"!==h.nodeName&&"OL"!==h.nodeName&&"UL"!==h.nodeName;)h=h.parentElement;var p=this.extractAllAttributes(h);this.addAllAttributes(l,p),this.domNode.insertAfter(l,c),this.updateInsertAfterMarker(c)}}else if(this.isListTag(l.nodeName)){var u=this.createWrapElement(t,i,e);r=this.flushWrap(u,r,n),this.wrapperAction(l,t,n,i)}else r.push(a)}else r.push(a)}var f=this.createWrapElement(t,i,e);this.flushWrap(f,r,n)},e.prototype.replaceCustomSpans=function(e,t,n){var i=!sf.base.isNullOrUndefined(n),s=!sf.base.isNullOrUndefined(t),r="<ul";s&&(r+=' class="'+t+'"'),i&&(r+=' style="'+n+'"');var o="<ol";s&&(o+=' class="'+t+'"'),i&&(o+=' style="'+n+'"');for(var a=[{pattern:/<span class="e-rte-list-close-ul"><\/span>/g,replacement:"</ul>"},{pattern:/<span class="e-rte-list-close-li"><\/span>/g,replacement:"</li>"},{pattern:/<span class="e-rte-list-close-ol"><\/span>/g,replacement:"</ol>"},{pattern:/<span class="e-rte-list-open-ul e-rte-list-start"><\/span>/g,replacement:r+=">"},{pattern:/<span class="e-rte-list-open-ol e-rte-list-start"><\/span>/g,replacement:o+=">"},{pattern:/<span class="e-rte-list-open-ul"><\/span>/g,replacement:"<ul>"},{pattern:/<span class="e-rte-list-open-li"><\/span>/g,replacement:!sf.base.isNullOrUndefined(t)&&t.indexOf("e-rte-checklist-hidden")>=0?'<li class="e-rte-checklist-hidden" style="list-style-type: none;">':'<li style="list-style-type: none;">'},{pattern:/<span class="e-rte-list-open-ol"><\/span>/g,replacement:"<ol>"}],l=e,d=0;d<a.length;d++)l=l.replace(a[d].pattern,a[d].replacement);return l},e.prototype.revertList=function(e,t){for(var n=[],i=e.length-1;i>=0;i--)for(var s=i-1;s>=0;s--)if(e[s].contains(e[i])||e[s]===e[i]){n.push(e[i]),e.splice(i,1);break}this.findUnSelected(n,e);var r=[],o=function(i){var s=e[i];3===a.domNode.contents(s)[0].nodeType&&0===a.domNode.contents(s)[0].textContent.trim().length&&sf.base.detach(a.domNode.contents(s)[0]);var o=e[i].parentNode,l=s.getAttribute("class");if(0===n.length){var d=e[i].querySelectorAll("ul, ol")[0];if(d)if(d.querySelectorAll("li")){var c=sf.base.createElement(d.tagName);sf.base.append([c],d.parentNode);var h=sf.base.createElement("li",{styles:"list-style-type: none;"});sf.base.append([h],c),sf.base.append([d],h)}}if(s.parentNode.insertBefore(a.closeTag(o.tagName),s),"LI"===o.parentNode.tagName||"OL"===o.parentNode.tagName||"UL"===o.parentNode.tagName)s.parentNode.insertBefore(a.closeTag("LI"),s);else{var p=a.getClosestListParentMargin(s);if(0===s.querySelectorAll(fe.join(", ")).length){var u=sf.base.isNullOrUndefined(l)?' class="e-rte-wrap-inner"':' class="'+l+' e-rte-wrap-inner"',f=o;e.length===f.querySelectorAll("li").length&&(sf.base.isNullOrUndefined(f.style.listStyleType)||o.style.removeProperty("list-style-type"),sf.base.isNullOrUndefined(f.style.listStyleImage)||o.style.removeProperty("list-style-image"),0===f.style.length&&o.removeAttribute("style"));var m=sf.base.isNullOrUndefined(t.enterAction)?"p":t.enterAction,g=s;if(g.getAttribute("style")){["color","font-size","font-family","font-weight","font-style"].forEach((function(e){g.style.getPropertyValue(e)&&g.style.removeProperty(e)})),0===g.style.length&&g.removeAttribute("style")}var b="<"+m+u+a.domNode.attributes(s)+"></"+m+">",v=document.createElement("div");if(v.innerHTML=b,""!==p&&(v.firstElementChild.style.marginLeft=p),"BR"!==t.enterAction)a.domNode.wrapInner(s,a.domNode.parseHTMLFragment(v.innerHTML));else if(""!==s.textContent){var y=document.createElement("br");a.domNode.wrapInner(s,a.domNode.parseHTMLFragment("<span class=e-rte-wrap-inner id=removeSpan></span>")),s.appendChild(y)}}else if(3===a.domNode.contents(s)[0].nodeType){var C=a.domNode.createTagString("p",o,a.parent.domNode.encode(a.domNode.contents(s)[0].textContent));a.domNode.replaceWith(a.domNode.contents(s)[0],C)}else if(a.domNode.contents(s)[0].classList.contains(Be)||a.domNode.contents(s)[0].classList.contains(Me)){C=a.domNode.createTagString("p",o,"<br>"+a.domNode.contents(s)[0].outerHTML);a.domNode.contents(s)[1]&&"BR"===a.domNode.contents(s)[1].tagName?(a.domNode.contents(s)[1].remove(),C=a.domNode.createTagString("p",o,"<br>"+a.domNode.contents(s)[0].outerHTML)):C=a.domNode.createTagString("p",o,a.domNode.contents(s)[0].outerHTML),a.domNode.replaceWith(a.domNode.contents(s)[0],C)}else{var N=s.firstChild;if(N){var E=s.parentElement.attributes;if(E.length>0)for(var S=0;S<E.length;S++){var T=E[S],L=function(e){return e?e.split(";").filter((function(e){return!/list-style-(image|type):/.test(e.trim())})).join(";").trim():""},O=L(N.getAttribute(T.nodeName)),k=L(s.parentElement.getAttribute(T.nodeName));O&&O!==k?N.setAttribute(T.nodeName,O?k+" "+O:k):N.setAttribute(T.nodeName,k),0===N.style.length&&N.removeAttribute("style")}}(l=N.getAttribute("class"))&&N.getAttribute("class")&&l!==N.getAttribute("class")&&sf.base.attributes(N,{class:l+" "+N.getAttribute("class")})}sf.base.append([a.openTag("LI")],s),sf.base.prepend([a.closeTag("LI")],s)}a.domNode.insertAfter(a.openTag(o.tagName),s),"LI"===o.parentNode.tagName&&(o=o.parentNode.parentNode),r.indexOf(o)<0&&r.push(o)},a=this;for(i=0;i<e.length;i++)o(i);for(i=0;i<r.length;i++){var l=r[i],d=l.innerHTML;d=(d=d.replace(/<span class="e-rte-list-close-([a-z]*)"><\/span>/g,"</$1>")).replace(/<span class="e-rte-list-open-([a-z]*)"><\/span>/g,"<$1 "+this.domNode.attributes(l)+">"),this.domNode.replaceWith(l,this.domNode.openTagString(l)+d.trim()+this.domNode.closeTagString(l))}var c=this.parent.editableElement.querySelectorAll("ul:empty, ol:empty");for(i=0;i<c.length;i++)sf.base.detach(c[i]);var h=this.parent.editableElement.querySelectorAll("li:empty");for(i=0;i<h.length;i++)sf.base.detach(h[i]);this.revertCheckListClasses()},e.prototype.revertCheckListClasses=function(){var e=this.parent.editableElement;e.querySelectorAll(".e-rte-checklist").forEach((function(e){"UL"!==e.nodeName&&e.classList.contains("e-rte-checklist")&&(sf.base.removeClass([e],["e-rte-checklist"]),""===e.getAttribute("class")&&e.removeAttribute("class"))})),e.querySelectorAll(".e-rte-checklist-checked").forEach((function(e){"LI"!==e.nodeName&&(sf.base.removeClass([e],["e-rte-checklist-checked"]),""===e.getAttribute("class")&&e.removeAttribute("class"))}))},e.prototype.getClosestListParentMargin=function(e){for(var t=e;t&&t!==this.parent.editableElement;){if("UL"===t.nodeName||"OL"===t.nodeName)return t.style.marginLeft;t=t.parentElement}return""},e.prototype.openTag=function(e){return this.domNode.parseHTMLFragment('<span class="e-rte-list-open-'+e.toLowerCase()+'"></span>')},e.prototype.closeTag=function(e){return this.domNode.parseHTMLFragment('<span class="e-rte-list-close-'+e.toLowerCase()+'"></span>')},e.prototype.destroy=function(){this.removeEventListener(),this.domNode&&(this.domNode=null)},e.prototype.areAllListItemsSelected=function(e,t){for(var n=e.querySelectorAll("li"),i=0;i<n.length;i++){var s=n[i];if(this.parent.currentDocument.createRange().selectNodeContents(s),!t.intersectsNode(s))return!1}return!0},e.prototype.getListCursorInfo=function(e){var t,n,i=new He(this.parent.editableElement),s=e.startContainer.nodeType===Node.TEXT_NODE?i.getTopMostNode(e.startContainer):e.startContainer,r=e.endContainer.nodeType===Node.TEXT_NODE?i.getTopMostNode(e.endContainer):e.endContainer,o=!e.collapsed,a=s.nodeType===Node.TEXT_NODE?s.parentElement.closest("li"):s.closest("li"),l=r.nodeType===Node.TEXT_NODE?r.parentElement.closest("li"):r.closest("li"),d=!(!a||!a.closest("ol, ul"))&&this.checkIsNestedList(a.closest("ol, ul")),c=!(!l||!l.closest("ol, ul"))&&this.checkIsNestedList(l.closest("ol, ul")),h=this.parent.domNode.blockNodes(),p=h.length,u=this.getListSelectionType(d?"Nested":"Parent",c?"Nested":"Parent");return o?(n=1===h.length?0===e.startOffset&&e.endOffset===a.textContent.length?"SingleFull":"SinglePartial":0===e.startOffset&&e.endOffset===h[p-1].textContent.length?"MultipleFull":"MultiplePartial",t="None"):(t=0===e.startOffset&&null===s.previousSibling?d?"StartNested":"StartParent":e.startOffset===a.textContent.length&&null===s.nextSibling?d?"EndNested":"EndParent":d?"MiddleNested":"MiddleParent",n="None"),{position:t,selectionState:n,itemType:u}},e.prototype.checkIsNestedList=function(e){return!(e.parentElement===this.parent.editableElement)&&!!e.closest("li")},e.prototype.getListSelectionType=function(e,t){return"Nested"===e&&"Nested"===t?"Nested":"Parent"===e&&"Parent"===t?"Parent":"Mixed"},e.prototype.isAllListNodesSelected=function(e){for(var t=this.parent.currentDocument.getSelection(),n=!1,i=e.querySelectorAll("li"),s=0;s<i.length;s++){if(!t.containsNode(i[s],!1)){n=!1;break}n=!0}return n},e.prototype.formatListStyle=function(e){var t=/^(lower|upper)(greek|alpha|roman)$/i;return t.test(e)?e.replace(t,(function(e,t,n){return t+"-"+n})).toLowerCase():e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},e}(),Fe=function(){function e(e){this.blockquotePrevent=!1,this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("format-type",this.applyFormats,this),this.parent.observer.on("keyup-handler",this.onKeyUp,this),this.parent.observer.on("keydown-handler",this.onKeyDown,this),this.parent.observer.on("blockquote_list_handled",this.blockQuotesHandled,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("format-type",this.applyFormats),this.parent.observer.off("keyup-handler",this.onKeyUp),this.parent.observer.off("keydown-handler",this.onKeyDown),this.parent.observer.off(v,this.destroy)},e.prototype.getParentNode=function(e){for(var t=e,n=["DIV","SECTION","ARTICLE","ASIDE","FOOTER","HEADER","NAV","MAIN"];e.parentNode&&e.parentNode!==this.parent.editableElement;null)e=e.parentNode;if(-1!==n.indexOf(e.nodeName.toUpperCase()))for(e=t;-1===n.indexOf(e.nodeName.toUpperCase())&&-1===n.indexOf(e.parentNode.nodeName.toUpperCase());)e=e.parentNode;return e},e.prototype.blockQuotesHandled=function(){this.blockquotePrevent=!0},e.prototype.onKeyUp=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=t.endContainer,i=n.lastChild;if(13===e.event.which&&t.startContainer===n&&3!==n.nodeType)if((r=sf.base.createElement("p")).innerHTML="<br>",!sf.base.isNullOrUndefined(i)&&i&&"BR"===i.nodeName&&i.previousSibling&&"TABLE"===i.previousSibling.nodeName)n.replaceChild(r,i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,r,0);else{var s=this.parent.nodeSelection.getSelectionNodeCollectionBr(t)[0];!sf.base.isNullOrUndefined(s)&&"BR"===s.nodeName&&s.previousSibling&&"TABLE"===s.previousSibling.nodeName&&(n.replaceChild(r,s),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,r,0))}if("BR"!==e.enterAction&&!sf.base.isNullOrUndefined(t.startContainer)&&!sf.base.isNullOrUndefined(t.startContainer.parentElement)&&t.startContainer===t.endContainer&&"#text"===t.startContainer.nodeName&&t.startContainer.parentElement.classList.contains("e-content")&&t.startContainer.parentElement.isContentEditable){var r=sf.base.createElement(e.enterAction);t.startContainer.parentElement.insertBefore(r,t.startContainer),r.appendChild(t.startContainer),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,r,1)}},e.prototype.getBlockParent=function(e,t){for(var n=e;e!==t;)n=e,e=e.parentElement;return n},e.prototype.onKeyDown=function(e){if(13===e.event.which&&!this.blockquotePrevent){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=0===t.startContainer.textContent.length||"PRE"===t.startContainer.nodeName?t.startContainer:t.startContainer.parentElement,i=0===t.endContainer.textContent.length||"PRE"===t.endContainer.nodeName?t.endContainer:t.endContainer.parentElement,s=sf.base.closest(n,"pre"),r=sf.base.closest(i,"pre"),o=sf.base.closest(n,"blockquote"),a=sf.base.closest(i,"blockquote");if(!sf.base.isNullOrUndefined(s)&&!sf.base.isNullOrUndefined(s.parentElement)&&"LI"===s.parentElement.tagName)return;if((sf.base.isNullOrUndefined(s)&&!sf.base.isNullOrUndefined(r)||!sf.base.isNullOrUndefined(s)&&sf.base.isNullOrUndefined(r))&&(e.event.preventDefault(),this.deleteContent(t),this.removeCodeContent(t),t=this.parent.nodeSelection.getRange(this.parent.currentDocument),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0)),13===e.event.which&&(!sf.base.isNullOrUndefined(o)&&!sf.base.isNullOrUndefined(a)||!sf.base.isNullOrUndefined(o)&&sf.base.isNullOrUndefined(a)))if(8203===(c=this.getBlockParent(t.startContainer,o)).textContent.charCodeAt(0)&&1===c.textContent.length||0===c.textContent.length&&0===c.querySelectorAll("img").length&&0===c.querySelectorAll("table").length)if(e.event.preventDefault(),sf.base.isNullOrUndefined(c.nextElementSibling))this.paraFocus(c.parentElement===this.parent.editableElement?c:c.parentElement);else(new Ie).SplitNode(t,c.parentElement,!1).cloneNode(!0),this.paraFocus(c.parentElement===this.parent.editableElement?c:c.parentElement);if(13===e.event.which&&!sf.base.isNullOrUndefined(s)&&!sf.base.isNullOrUndefined(r)){e.event.preventDefault(),this.deleteContent(t),this.removeCodeContent(t);var l=(t=this.parent.nodeSelection.getRange(this.parent.currentDocument)).startContainer.childNodes[t.endOffset],d=t.startContainer.childNodes[t.endOffset-1],c=t.startContainer;if(sf.base.isNullOrUndefined(l)||sf.base.isNullOrUndefined(d)||!sf.base.isNullOrUndefined(l.nextSibling)||"BR"!==l.nodeName||"BR"!==d.nodeName)if(8203===c.textContent.charCodeAt(0)&&1===c.textContent.length||0===c.textContent.length){for(;"PRE"!==c.parentElement.nodeName&&(1===c.textContent.length||0===c.textContent.length);)c=c.parentElement;!sf.base.isNullOrUndefined(c.previousSibling)&&"BR"===c.previousSibling.nodeName&&sf.base.isNullOrUndefined(c.nextSibling)?this.paraFocus(c.parentElement):this.isNotEndCursor(s,t)}else this.isNotEndCursor(s,t);else this.paraFocus(t.startContainer,e.enterAction)}}this.blockquotePrevent=!1},e.prototype.removeCodeContent=function(e){var t=new RegExp("\ufeff","g");if(!sf.base.isNullOrUndefined(e.endContainer.textContent.match(t))){var n=65279===e.endContainer.textContent.charCodeAt(e.endOffset-1)?e.endOffset-2:e.endOffset;e.endContainer.textContent=e.endContainer.textContent.replace(t,""),""===e.endContainer.textContent?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e.endContainer.parentElement,0):this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e.endContainer,n)}},e.prototype.deleteContent=function(e){e.startContainer===e.endContainer&&e.startOffset===e.endOffset||e.deleteContents()},e.prototype.paraFocus=function(e,t){var n;"DIV"===t?(n=sf.base.createElement("div")).innerHTML="<br>":"BR"===t?n=sf.base.createElement("br"):(n=sf.base.createElement("p")).innerHTML="<br>",this.parent.domNode.insertAfter(n,e),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0),sf.base.detach(e.lastChild)},e.prototype.isNotEndCursor=function(e,t){var n,i=new Ie;if(n=t.startContainer.nodeType===Node.TEXT_NODE&&"​"===t.startContainer.textContent&&3===e.lastChild.nodeType&&""===e.lastChild.textContent?t.startContainer.previousElementSibling.textContent===e.lastChild.previousElementSibling.textContent:t.startOffset===e.lastChild.textContent.length&&e.lastChild.textContent===t.startContainer.textContent,0===e.textContent.indexOf(t.startContainer.textContent)&&(0===t.startOffset&&0===t.endOffset||"PRE"===t.startContainer.nodeName)){this.insertMarker(e,t);var s=sf.base.createElement("br");e.childNodes[t.endOffset].parentElement.insertBefore(s,e.childNodes[t.endOffset])}else{var r=i.SplitNode(t,e,!0);this.insertMarker(e,t);var o=e.previousElementSibling;"PRE"===o.tagName&&(o.insertAdjacentHTML("beforeend","<br>"+r.innerHTML),sf.base.detach(e))}this.setCursorPosition(n,e)},e.prototype.setCursorPosition=function(e,t){var n=!1,i=this.parent.editableElement.querySelector(".tempSpan"),s=i.parentElement;if(""===i.parentNode.textContent?n=!0:this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e)if(n)s===t?(this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),sf.base.detach(i)):this.focusSelectionParent(i,s);else{var r=sf.base.createElement("br");this.parent.domNode.insertAfter(r,i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),sf.base.detach(i)}else n?this.focusSelectionParent(i,s):sf.base.detach(i)},e.prototype.focusSelectionParent=function(e,t){sf.base.detach(e),t.innerHTML="​",this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,0)},e.prototype.insertMarker=function(e,t){var n=sf.base.createElement("span",{className:"tempSpan"});"PRE"===t.startContainer.nodeName?e.childNodes[t.endOffset].parentElement.insertBefore(n,e.childNodes[t.endOffset]):t.startContainer.parentElement.insertBefore(n,t.startContainer)},e.prototype.applyFormats=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection.processedTableImageCursor(t);if(!n.start&&!n.end||"blockquote"===e.subCommand.toLowerCase()||"TABLE"!==n.startName&&"TABLE"!==n.endName){var i=!1;this.parent.editableElement!==t.endContainer||sf.base.isNullOrUndefined(this.parent.editableElement.children[t.endOffset-1])||"TABLE"!==this.parent.editableElement.children[t.endOffset-1].tagName||t.collapsed||(i=!0);var s=this.parent.nodeSelection.save(t,this.parent.currentDocument);this.parent.domNode.setMarker(s);var r=this.parent.domNode.blockNodes(!0);if("BR"===e.enterAction){this.setSelectionBRConfig();var o=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),a=this.parent.nodeSelection.getSelectionNodes(o),l=[];0===a.length&&a.push(r[0]);for(var d=0;d<a.length;d++){for(var c=a[d],h=void 0;!this.parent.domNode.isBlockNode(c)&&c!==this.parent.editableElement;)h=c,c=c.parentElement;this.parent.domNode.isBlockNode(c)&&c===this.parent.editableElement&&l.push(h)}for(d=0;d<l.length;d++)if(!this.parent.domNode.isBlockNode(l[d])){for(var p=c=l[d];c===this.parent.editableElement;)p=c,c=c.parentElement;var u=void 0;this.parent.domNode.isBlockNode(p.parentElement)&&p.parentElement===this.parent.editableElement?(u=sf.base.createElement("div"),p.parentElement.insertBefore(u,p),u.appendChild(p),0===p.textContent.length&&p.appendChild(sf.base.createElement("br"))):u=p;for(var f=u.previousSibling;!sf.base.isNullOrUndefined(f)&&"BR"!==f.nodeName&&!this.parent.domNode.isBlockNode(f);)u.firstChild.parentElement.insertBefore(f,u.firstChild),f=u.previousSibling;sf.base.isNullOrUndefined(f)||"BR"!==f.nodeName||sf.base.detach(f);for(var m=u.nextSibling;!sf.base.isNullOrUndefined(m)&&"BR"!==m.nodeName&&!this.parent.domNode.isBlockNode(m);)u.appendChild(m),m=u.nextSibling;sf.base.isNullOrUndefined(m)||"BR"!==m.nodeName||sf.base.detach(m)}this.setSelectionBRConfig(),r=this.parent.domNode.blockNodes()}var g=!1,b=!1;for(d=0;d<r.length;d++)(sf.base.isNullOrUndefined(sf.base.closest(r[0],"blockquote"))||sf.base.isNullOrUndefined(sf.base.closest(r[r.length-1],"blockquote")))&&(b=!0);var v=!1;for(d=0;d<r.length;d++){var y=void 0,E=void 0;if("HR"!==r[d].nodeName){if("blockquote"===e.subCommand.toLowerCase())y=this.getParentNode(r[d]),E="BR"===e.enterAction?y.innerHTML:!sf.base.isNullOrUndefined(sf.base.closest(r[d],"table"))&&this.parent.editableElement.contains(sf.base.closest(r[d],"table"))?sf.base.isNullOrUndefined(sf.base.closest(r[d],"blockquote"))?r[d].outerHTML:sf.base.closest(r[d],"blockquote").outerHTML:y.outerHTML;else{var S=r[d];E=S&&"PRE"===S.tagName&&S.firstChild&&"CODE"===S.firstChild.nodeName&&S.hasAttribute("data-language")?(y=S).querySelector("code").innerHTML:(y=S).innerHTML}var T="PRE"===y.tagName&&y.firstChild&&"CODE"===y.firstChild.nodeName&&y.hasAttribute("data-language");if((T||!("blockquote"===e.subCommand.toLowerCase()&&e.subCommand.toLowerCase()===y.tagName.toLowerCase()&&b||e.subCommand.toLowerCase()===y.tagName.toLowerCase()&&("pre"!==e.subCommand.toLowerCase()&&"blockquote"!==e.subCommand.toLowerCase()||!sf.base.isNullOrUndefined(e.exeValue)&&"dropDownSelect"===e.exeValue.name)||sf.base.isNullOrUndefined(y.parentNode)||"TABLE"===y.tagName&&"pre"===e.subCommand.toLowerCase()))&&("TABLE"!==r[d].nodeName||"blockquote"===e.subCommand.toLowerCase())){this.cleanFormats(y,e.subCommand);var L="pre"!==e.subCommand.toLowerCase()||"pre"!==y.tagName.toLowerCase()||T?e.subCommand:"p",O=e.subCommand.toLowerCase()===y.tagName.toLowerCase()&&"blockquote"===e.subCommand.toLowerCase()&&!sf.base.isNullOrUndefined(sf.base.closest(r[d],"li")),k="TABLE"===y.tagName?sf.base.isNullOrUndefined(sf.base.closest(r[d],"blockquote"))?y:sf.base.closest(r[d],"blockquote"):y;v=e.subCommand.toLowerCase()===k.tagName.toLowerCase()&&"blockquote"===e.subCommand.toLowerCase();var x=void 0,w=this.getNode(r[d]),A=this.getNode(r[r.length-1]);if((sf.base.isNullOrUndefined(sf.base.closest(r[d],"table"))||sf.base.isNullOrUndefined(sf.base.closest(r[d],"td"))&&sf.base.isNullOrUndefined(sf.base.closest(r[d],"th"))?v&&y.firstChild===w&&y.lastChild===A:this.hasOnlyBlockquotes(sf.base.closest(r[d],"td")||sf.base.closest(r[d],"th")))?x=E.replace(/<blockquote[^>]*>|<\/blockquote>/g,""):O?(g=!0,0===d&&this.createBlockquoteSpan("e-rte-blockquote-close",w,"before"),d===r.length-1&&this.createBlockquoteSpan("e-rte-blockquote-open",A,"after")):v&&sf.base.closest(r[0],"blockquote")&&sf.base.closest(r[r.length-1],"blockquote")?(g=!0,0===d&&this.createBlockquoteSpan("e-rte-blockquote-close",r[d],"before"),d===r.length-1&&this.createBlockquoteSpan("e-rte-blockquote-open",r[d],"after")):x=y&&"PRE"===y.tagName&&y.firstChild&&"CODE"===y.firstChild.nodeName&&y.hasAttribute("data-language")?this.parent.domNode.createTagString(L,null,E.replace(/>\s+</g,"><")):this.parent.domNode.createTagString(L,"blockquote"===e.subCommand.toLowerCase()?null:y,E.replace(/>\s+</g,"><")),"LI"===y.tagName){for(var B=y.firstChild,M=[],R=!1,D=0,I=Array.from(y.childNodes);D<I.length;D++){var U=(F=I[D]).nodeName.toLowerCase();"ul"===U||"ol"===U?R=!0:M.push(F)}if(R){for(var P=document.createElement("div"),H=0,q=M;H<q.length;H++){var F=q[H];P.appendChild(F.cloneNode(!0)),B!==F&&y.removeChild(F)}r[d+1]&&r[d+1].textContent===P.textContent&&(P=r[d+1]),x=this.parent.domNode.createTagString(L,"blockquote"===e.subCommand.toLowerCase()?null:P,P.innerHTML.replace(/>\s+</g,"><"));var z=document.createElement("div");z.innerHTML=x,y.replaceChild(z.firstChild,B)}else y.innerHTML="",y.insertAdjacentHTML("beforeend",x)}else if(!g){var V=!sf.base.isNullOrUndefined(sf.base.closest(r[d],"table"))&&this.parent.editableElement.contains(sf.base.closest(r[d],"table"))?sf.base.isNullOrUndefined(sf.base.closest(r[d],"blockquote"))?r[d]:sf.base.closest(r[d],"blockquote"):y;this.parent.domNode.replaceWith(V,x)}}}}if(g){var j=this.parent.editableElement.querySelectorAll(".e-rte-blockquote-open, .e-rte-blockquote-close");for(d=0;d<j.length;d++){var W=j[d].parentElement,_=W.innerHTML;if(_=(_=_.replace(/<span class="e-rte-blockquote-open"><\/span>/g,"<blockquote>")).replace(/<span class="e-rte-blockquote-close"><\/span>/g,"</blockquote>"),j[0].parentElement===j[1].parentElement){this.parent.domNode.replaceWith(W,this.parent.domNode.openTagString(W)+_.trim()+this.parent.domNode.closeTagString(W));break}d!==j.length-1||sf.base.isNullOrUndefined(j[d])||sf.base.isNullOrUndefined(j[d-1])||j[d].parentElement===j[d-1].parentElement?this.parent.domNode.replaceWith(W,this.parent.domNode.openTagString(W)+_.trim()+this.parent.domNode.closeTagString(W)):this.parent.domNode.replaceWith(W,_.trim())}}this.preFormatMerge(),this.blockquotesFormatMerge(e.enterAction);var Q=this.parent.editableElement.querySelector("."+Be),K=this.parent.editableElement.querySelector("."+Me);if(sf.base.isNullOrUndefined(Q)||sf.base.isNullOrUndefined(K)||(Q=Q.lastChild,K=K.lastChild),s=this.parent.domNode.saveMarker(s),C()&&N(this.parent.editableElement,e.selector),i)this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,Q,K,0,K.textContent.length);else if(n.start&&"blockquote"===e.subCommand.toLowerCase()){var X=s.range.startContainer.childNodes[v?s.range.startOffset-1:s.range.startOffset];if(v){var G=X.parentElement,Y=Array.prototype.indexOf.call(G.childNodes,X);this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,G,G,Y,Y)}else this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,X,X,0,0)}else s.restore();e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})}else{var $=n.start?n.startNode:n.endNode;this.applyTableSidesFormat(e,n.start,$)}},e.prototype.hasOnlyBlockquotes=function(e){for(var t=!1,n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===Node.TEXT_NODE){if(""!==i.textContent.replace(/[\u200B\u200C\u200D]/g,"").trim())return!1}else if(i.nodeType===Node.ELEMENT_NODE){if("BLOCKQUOTE"!==i.tagName)return!1;t=!0}}return t},e.prototype.getNode=function(e){if("BLOCKQUOTE"===e.nodeName)return e=e.firstChild;for(;e.parentNode&&"BLOCKQUOTE"!==e.parentNode.nodeName;null)e=e.parentNode;return e},e.prototype.createBlockquoteSpan=function(e,t,n){var i=sf.base.createElement("span");return i.classList.add(e),"before"===n?t.parentNode.insertBefore(i,t):this.parent.domNode.insertAfter(i,t),i},e.prototype.setSelectionBRConfig=function(){var e=this.parent.editableElement.querySelector("."+Be),t=this.parent.editableElement.querySelector("."+Me);sf.base.isNullOrUndefined(t)?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,e,t,0,0)},e.prototype.preFormatMerge=function(){var e=this.parent.editableElement.querySelectorAll("PRE:not([data-language])");if(!sf.base.isNullOrUndefined(e))for(var t=0;t<e.length;t++){var n=e[t].previousElementSibling;sf.base.isNullOrUndefined(n)||"PRE"!==n.tagName||(n.insertAdjacentHTML("beforeend","<br>"+e[t].innerHTML),sf.base.detach(e[t]))}},e.prototype.blockquotesFormatMerge=function(e){var t=this.parent.editableElement.querySelectorAll("BLOCKQUOTE");if(!sf.base.isNullOrUndefined(t))for(var n=0;n<t.length;n++){""===t[n].innerHTML.trim()&&sf.base.detach(t[n]);var i=t[n].previousElementSibling;sf.base.isNullOrUndefined(i)||"BLOCKQUOTE"!==i.tagName||(i.insertAdjacentHTML("beforeend",("BR"===e?"<br>":"")+t[n].innerHTML),sf.base.detach(t[n]))}},e.prototype.cleanFormats=function(e,t){var n=["display","font-size","margin-top","margin-bottom","margin-left","margin-right","font-weight"];t=t.toLowerCase();for(var i=0;i<n.length&&"p"!==t&&"blockquote"!==t&&"pre"!==t;i++)e.style.removeProperty(n[i])},e.prototype.applyTableSidesFormat=function(e,t,n){var i=sf.base.createElement(e.subCommand);"BR"!==e.enterAction&&i.appendChild(sf.base.createElement("br")),n.insertAdjacentElement(t?"beforebegin":"afterend",i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},e.prototype.destroy=function(){this.removeEventListener()},e}(),ze=function(){function e(e){this.alignments={JustifyLeft:"left",JustifyCenter:"center",JustifyRight:"right",JustifyFull:"justify"},this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("alignment-type",this.applyAlignment,this),this.parent.observer.on("keydown-handler",this.onKeyDown,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("alignment-type",this.applyAlignment),this.parent.observer.off("keydown-handler",this.onKeyDown),this.parent.observer.off(v,this.destroy)},e.prototype.onKeyDown=function(e){switch(e.event.action){case"justify-center":this.applyAlignment({subCommand:"JustifyCenter",callBack:e.callBack}),e.event.preventDefault();break;case"justify-full":this.applyAlignment({subCommand:"JustifyFull",callBack:e.callBack}),e.event.preventDefault();break;case"justify-left":this.applyAlignment({subCommand:"JustifyLeft",callBack:e.callBack}),e.event.preventDefault();break;case"justify-right":this.applyAlignment({subCommand:"JustifyRight",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.getTableNode=function(e){var t=e.startContainer.nodeType===Node.ELEMENT_NODE?e.startContainer:e.startContainer.parentNode;return[sf.base.closest(t,"td,th")]},e.prototype.applyAlignment=function(e){var t="Table"===e.value,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=this.parent.nodeSelection.save(n,this.parent.currentDocument);if(t){var s=this.parent.editableElement.querySelectorAll(".e-cell-select");if(s.length>0)for(o=0;o<s.length;o++)sf.base.setStyleAttribute(s[o],{"text-align":this.alignments[e.subCommand]});else sf.base.setStyleAttribute(this.getTableNode(n)[0],{"text-align":this.alignments[e.subCommand]})}else{this.parent.domNode.setMarker(i);var r=this.parent.domNode.blockNodes();"BR"===e.enterAction&&(r=this.parent.domNode.convertToBlockNodes(r,!1));for(var o=0;o<r.length;o++){var a=r[o];sf.base.setStyleAttribute(a,{"text-align":this.alignments[e.subCommand]})}for(var l=this.parent.domNode.getImageTagInSelection(),o=0;o<l.length;o++){var d=[];d.push(l[o]),this.parent.imgObj.imageCommand({item:{selectNode:d},subCommand:e.subCommand,value:e.subCommand,callBack:e.callBack,selector:e.selector})}this.parent.editableElement.focus({preventScroll:!0}),i=this.parent.domNode.saveMarker(i),C()&&N(this.parent.editableElement,e.selector),i.restore()}e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:t?this.getTableNode(n):this.parent.domNode.blockNodes()})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Ve=function(){function e(e){this.indentValue=20,this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("indent-type",this.applyIndents,this),this.parent.observer.on("keydown-handler",this.onKeyDown,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("indent-type",this.applyIndents),this.parent.observer.off("keydown-handler",this.onKeyDown),this.parent.observer.off(v,this.destroy)},e.prototype.onKeyDown=function(e){switch(e.event.action){case"indents":this.applyIndents({subCommand:"Indent",callBack:e.callBack}),e.event.preventDefault();break;case"outdents":this.applyIndents({subCommand:"Outdent",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.applyIndents=function(e){var t=this.parent.editableElement,n=t.classList.contains("e-rtl"),i=this.parent.nodeSelection.getRange(this.parent.currentDocument);if(!sf.base.isNullOrUndefined(this.parent.codeBlockObj)&&this.parent.codeBlockObj.isSelectionWithinCodeBlock(i,i.startContainer,i.endContainer))return void this.parent.observer.notify("codeblock_indentation",{e:e,event:e.event,subCommand:e.subCommand,callBack:e.callBack});var s=this.parent.nodeSelection.save(i,this.parent.currentDocument);this.parent.domNode.setMarker(s);var r=this.parent.domNode.blockNodes();"BR"===e.enterAction&&(r=this.parent.domNode.convertToBlockNodes(r,!1));for(var o=r.slice(),a=[],l=0;l<o.length;l++)"LI"!==o[l].tagName&&"LI"===o[l].parentNode.tagName?(r.splice(r.indexOf(o[l]),1),a.push(o[l].parentNode)):"LI"===o[l].tagName&&(r.splice(r.indexOf(o[l]),1),a.push(o[l]));a.length>0&&this.parent.observer.notify("keydown-handler",{event:{preventDefault:function(){},stopPropagation:function(){},shiftKey:"Indent"!==e.subCommand,which:9,action:"indent"}});for(l=0;l<r.length;l++){var d=r[l],c=n?d.style.marginRight:d.style.marginLeft,h=void 0;"HR"!==d.tagName&&("Indent"===e.subCommand?(h=""===c?this.indentValue+"px":parseInt(c,null)+this.indentValue+"px",n?d.style.marginRight=h:d.style.marginLeft=h):(h=""===c||"0px"===c||"0in"===c?"":parseInt(c,null)-this.indentValue<0?"0px":parseInt(c,null)-this.indentValue+"px",n?d.style.marginRight=h:d.style.marginLeft=h))}t.focus({preventScroll:!0}),C()&&N(t,e.selector),(0===r.length||r[0]&&"TABLE"!==r[0].nodeName)&&(s=this.parent.domNode.saveMarker(s)).restore(),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},e.prototype.destroy=function(){this.removeEventListener()},e}(),je=function(){function e(e,t){this.userAgent=e,this.isTesting=t}return e.prototype.getPlatform=function(){return!this.isTesting&&window.navigator.userAgentData?window.navigator.userAgentData.platform:/windows/i.test(this.userAgent)?"Windows":/macintosh|mac os/i.test(this.userAgent)&&!/iphone|ipad|ipod/i.test(this.userAgent)?"macOS":/linux/i.test(this.userAgent)&&!/android/i.test(this.userAgent)?"Linux":/iphone|ipad|ipod/i.test(this.userAgent)?"iOS":/android/i.test(this.userAgent)?"Android":"Unknown"},e.prototype.getBrowser=function(){if(!this.isTesting&&window.navigator.userAgentData)for(var e=0,t=window.navigator.userAgentData.brands;e<t.length;e++){var n=t[e];if("Google Chrome"===n.brand)return"Chrome";if("Microsoft Edge"===n.brand)return"Edge"}return/chrome|chromium|crios/i.test(this.userAgent)&&!/edg/i.test(this.userAgent)?"Chrome":/firefox|fxios/i.test(this.userAgent)&&!/edg/i.test(this.userAgent)?"Firefox":/safari/i.test(this.userAgent)&&!/chrome|chromium|crios/i.test(this.userAgent)?"Safari":/edg/i.test(this.userAgent)?"Edge":"Unknown"},e.prototype.isMobileDevice=function(){return!this.isTesting&&window.navigator.userAgentData?window.navigator.userAgentData.mobile:/(iphone|ipod|ipad|android|blackberry|bb|playbook|windows phone|webos|opera mini|mobile)/i.test(this.userAgent)},e.prototype.isSafari=function(){var e=this.getPlatform();return"Safari"===this.getBrowser()&&("macOS"===e||"iOS"===e)},e}(),We=function(){function e(){}return e.applyFormat=function(t,n,i,s,r,o,a,l){this.enterAction=s;if(["bold","italic","underline","strikethrough","superscript","subscript","uppercase","lowercase","fontcolor","fontname","fontsize","backgroundcolor","inlinecode"].indexOf(n)>-1||"formatPainter"===o){"backgroundcolor"===n&&""===o&&(o="transparent");var d=new et(i),c=new Re(i,t),h=new Ie,p=new y,u=d.getRange(t);if(u.collapsed&&u.startContainer===u.endContainer&&u.startContainer===d.editableElement&&!sf.base.isNullOrUndefined(u.startContainer.firstChild)){var f=t.createRange();u.setStart(u.startContainer.firstChild,0),u.collapse(!0),d.setRange(t,f)}var m=0,g=u.startContainer.parentElement;if(u.collapsed&&!sf.base.isNullOrUndefined(g)&&"A"===g.tagName&&(u.startOffset===g.textContent.length||0===u.startOffset)){var b=document.createTextNode("");0===u.startOffset?g.parentNode.insertBefore(b,g):sf.base.isNullOrUndefined(g.nextSibling)?g.parentNode.appendChild(b):g.parentElement.insertBefore(b,g.nextSibling);var v=t.createRange();u.setStart(b,0),u.setEnd(b,0),u.collapse(!0),d.setRange(t,v)}if(-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&u.startContainer===u.endContainer&&!sf.base.isNullOrUndefined(i)&&u.startContainer===i){for(var E=u.startContainer.childNodes[u.startOffset>0?u.startOffset-1:u.startOffset]||u.startContainer,S=u.endContainer.childNodes[u.endOffset>0?u.endOffset-1:u.endOffset]||u.endContainer,T="BR"===S.lastChild.nodeName?sf.base.isNullOrUndefined(S.lastChild.previousSibling)?S:S.lastChild.previousSibling:S.firstChild;!sf.base.isNullOrUndefined(T)&&"#text"!==T.nodeName&&"IMG"!==T.nodeName&&"BR"!==T.nodeName&&"HR"!==T.nodeName;)T=T.lastChild;d.setSelectionText(t,E,T,0,0),u=d.getRange(t)}var L=d.save(u,t),O=void 0,k=!1;i&&r&&"#text"!==i.nodeName&&(O=r.getTextNodes()),O&&O.length>0?k=!0:O=u.collapsed?d.getSelectionNodeCollection(u):d.getSelectionNodeCollectionBr(u);var x,w=!1,A=!1,B=!1,M=["fontcolor","fontname","fontsize","backgroundcolor"].indexOf(n)>-1,R=!1;if(e.userAgentData.isSafari()&&O.length>0&&(R="None"!==e.isMentionStartOrEnd(i,O[0],O[O.length-1])),!k&&u.collapsed){var D=p.getFormattedNode(u.startContainer,n,i),I=sf.base.isNullOrUndefined(D)?null:null===D.getAttribute("style")?D.nodeName:D.nodeName+"[style='"+D.getAttribute("style")+"']";if(O.length>0)w=!0,u=h.GetCursorRange(t,u,O[0]);else if(3===u.startContainer.nodeType&&(u.startContainer.parentElement.childElementCount>0&&u.startOffset>0&&"br"!==u.startContainer.parentElement.firstElementChild.tagName.toLowerCase()||!sf.base.isNullOrUndefined(D)&&D===u.startContainer.parentElement.closest(I)&&0!==u.startContainer.parentElement.closest(I).textContent.replace(new RegExp("​","g"),"").trim().length))w=!0,u=h.GetCursorRange(t,u,u.startContainer),O.push(u.startContainer);else{var U=this.insertCursorNode(t,d,u,p,h,n,o,i);d.endContainer=d.startContainer=d.getNodeArray(U,!0);var P="BR"===U.nodeName&&U.parentNode.childNodes;sf.base.isNullOrUndefined(P)||1!==P.length||"BR"!==P[0].nodeName||0!==O.length?d.endOffset=d.startOffset=1:(d.setSelectionText(t,u.startContainer,u.endContainer,0,0),B=!0),"BR"===U.nodeName&&0===U.parentNode.textContent.length&&(B=!0)}}x=!k&&u.collapsed;for(var H=!1,q=0;q<O.length;q++){var F=p.getFormattedNode(O[q],n,i);null===F&&("subscript"===n?H=null!==(F=p.getFormattedNode(O[q],"superscript",i)):"superscript"===n&&(H=null!==(F=p.getFormattedNode(O[q],"subscript",i)))),0===q&&null===F&&(A=!0),null===F||A&&!M||(O[q]=this.removeFormat(O,q,F,x,k,A,M,u,h,n,o,d,i,c)),null===F&&(O[q]=this.insertFormat(t,O,q,F,x,k,A,M,u,h,n,o,l,c,i),m++),O.length===m&&(this.isWrapped=!0),k||R||(d=this.applySelection(O,d,h,q,w))}C()&&N(i,a),B||k||L.restore(),H&&this.applyFormat(t,n,i,s,r)}},e.insertCursorNode=function(e,t,n,i,s,r,o,a){var l=t.getNodeCollection(n),d=new Re(a,e),c=l.length>0?l.length>1&&n.startContainer===n.endContainer?this.getCursorFormat(i,l,r,a):""===o&&"fontsize"===r&&null==i.getFormattedNode(l[0],r,a)&&"SPAN"===l[0].parentElement.nodeName?l[0].parentElement:i.getFormattedNode(l[0],r,a):null,h=null;if(c){if(h=l[0],8203===c.firstChild.textContent.charCodeAt(0)&&3===c.firstChild.nodeType){var p=new RegExp("​","g"),u=void 0;if("#text"!==h.nodeName)for(var f=0;f<l.length;f++)l[f].nodeType===Node.TEXT_NODE&&(h=l[f]);c.firstChild===h?(h.textContent=c.parentElement&&(d.isBlockNode(c.parentElement)&&c.parentElement.textContent.length<=1?c.parentElement.childElementCount>1:0===c.childElementCount)&&(c.parentElement.textContent.length>1||c.parentElement.firstChild&&1===c.parentElement.firstChild.nodeType)?h.textContent:h.textContent.replace(p,""),u=h):(c.firstChild.textContent=c.firstChild.textContent.replace(p,""),u=c.firstChild);var m=void 0;if(0===u.textContent.length)if(sf.base.isNullOrUndefined(u.previousSibling)){if(!sf.base.isNullOrUndefined(u.parentElement)&&0===u.parentElement.textContent.length){var g=document.createElement("BR");u.parentElement.appendChild(g),sf.base.detach(u),h=g,t.setCursorPoint(e,h.parentElement,0)}}else h=u.previousSibling,m=u.textContent.length-1,t.setCursorPoint(e,u,m)}["fontcolor","fontname","fontsize","backgroundcolor"].indexOf(r)>-1?("fontcolor"===r?c.style.color=o:"fontname"===r?c.style.fontFamily=o:"fontsize"===r?c.style.fontSize=o:c.style.backgroundColor=o,h=c):(De.unwrap(c),t.setCursorPoint(e,h,0))}else{if(l.length>1&&n.startOffset>0&&l[0].firstElementChild&&"br"===l[0].firstElementChild.tagName.toLowerCase()&&(l[0].innerHTML=""),1!==l.length||0!==n.startOffset||"BR"!==l[0].nodeName&&(sf.base.isNullOrUndefined(l[0].nextSibling)||"BR"!==l[0].nextSibling.nodeName)||sf.base.detach("#text"===l[0].nodeName?l[0].nextSibling:l[0]),!sf.base.isNullOrUndefined(l[0]&&l[0].parentElement)&&-1!==y.inlineTags.indexOf(l[0].parentElement.tagName.toLowerCase())&&l[0].textContent.includes("​")){var b=this.GetFormatNode(r,o),v=l[0];if("fontsize"===r)for(var C=l[0];C;){var N=C.parentElement.textContent.trim()===l[0].textContent.trim(),E=C.parentElement;if(d.isBlockNode(E)||!N||"SPAN"===E.nodeName&&E.classList.contains("e-img-inner"))break;C=E,l[0]=C}return this.applyStyles(l,0,b),v}h=this.getInsertNode(e,n,r,o).firstChild}return h},e.getCursorFormat=function(e,t,n,i){for(var s,r=0;r<t.length;r++)s=t[r].lastElementChild?t[r].lastElementChild:t[r];return"fontsize"===n&&null==e.getFormattedNode(s,n,i)&&"SPAN"===s.parentElement.nodeName?s.parentElement:e.getFormattedNode(s,n,i)},e.removeFormat=function(t,n,i,s,r,o,a,l,d,c,h,p,u,f){var m,g,b=null,v="#text"===l.startContainer.nodeName?l.startContainer.textContent.substring(l.startOffset,l.startContainer.textContent.length):l.startContainer.textContent,C=t[n].textContent,N=t[0].parentElement.nodeName===t[0].parentElement.parentElement.nodeName;if(l.startContainer!==l.endContainer||0!==l.startOffset||l.endOffset!==l.startContainer.length||l.startContainer.textContent!==i.textContent&&!N){var E=[],S=t[n],T=S;do{E.push(p.getIndex(S)),S=S.parentNode}while(S&&S!==i);if("BR"!==t[n].nodeName&&("#text"===T.nodeName&&T.textContent.includes("​")&&T.remove(),r||(S=b=s&&i.textContent.length-1===l.startOffset?d.SplitNode(l,i,!0):d.GetSpliceNode(l,i))),s){for(var L=b;null!==L.firstChild&&3!==L.firstChild.nodeType;null)L=L.firstChild;L.innerHTML="&#8203;",t[n]=L.firstChild}else{for(;S&&S.childNodes.length>0&&E.length-1>=0&&S.childNodes.length>E[E.length-1];){if(S.childNodes.length>1&&E.length>1){S=S.childNodes[E[E.length-2]];break}S=S.childNodes[E[E.length-1]],E.pop()}if("BR"!==t[n].nodeName){for(;1===S.nodeType&&S.childNodes.length>0;)S=S.childNodes[0];if(3!==S.nodeType||s&&""===S.nodeValue){var O=document.createElement("div");O.innerHTML="&#8203;",3!==S.nodeType?(S.insertBefore(O.firstChild,S.firstChild),t[n]=S.firstChild):(S.parentNode.insertBefore(O.firstChild,S),t[n]=S.previousSibling,S.parentNode.removeChild(S))}else t[n]=S}}}else if(a&&!t[n].contains(i)&&3===t[n].nodeType&&t[n].textContent!==i.textContent){for(var k=t[n].textContent===t[n].wholeText,x=t[n],w=this.GetFormatNode(c,h);x&&x.textContent===x.parentElement.textContent;)x=x.parentElement;if(k&&i.textContent!==x.textContent){var A=[],B=this.getPriorityFormatNode(x,u);return B&&B.textContent===x.textContent&&(x=B),A.push(x),this.applyStyles(A,0,w),t[n]}}if("backgroundcolor"===c&&(m=i.style.fontSize),"fontsize"===c){var M=sf.base.closest(t[n].parentElement,"span[style*=background-color]");sf.base.isNullOrUndefined(M)||(g=M.style.backgroundColor)}var R,D=i.getAttribute("style"),I=i.tagName;if("A"===I&&"underline"===c)i.style.textDecoration="none",R=[i];else if(-1!==y.inlineTags.indexOf(I.toLowerCase())&&a&&"span"!==I.toLocaleLowerCase()){var U=i.style;U.color&&"fontcolor"===c?"A"===i.nodeName?U.color=h:U.color="":U.backgroundColor&&"backgroundcolor"===c?U.backgroundColor="":U.fontSize&&"fontsize"===c?U.fontSize="":U.fontFamily&&"fontname"===c&&(U.fontFamily=""),""===i.getAttribute("style")&&i.removeAttribute("style"),R=[i]}else{R=De.unwrap(i),0===n&&(this.isUnwrapped=!0);var P=t[n].parentElement;sf.base.isNullOrUndefined(P)||"li"===P.tagName.toLowerCase()||(P=sf.base.closest(P,"li")),sf.base.isNullOrUndefined(P)||"li"!==P.tagName.toLowerCase()||P.textContent.trim()!==t[n].textContent.trim()&&(P.innerText.split("\n").length!==t.length||P.innerText.split("\n")[0]!==t[n].textContent.trim())?sf.base.isNullOrUndefined(P)||"li"!==P.tagName.toLowerCase()||P.textContent.trim()===t[n].textContent.trim()||("bold"===c?P.style.fontWeight="":"italic"===c&&(P.style.fontStyle=""),e.conCatenateTextNode(P,c,"","normal",h)):"bold"===c?P.style.fontWeight="":"italic"===c?P.style.fontStyle="":"fontsize"===c&&(P.style.fontSize="")}if(R[0]&&!a)for(var H=x=R[n]?R[n]:R[0];x&&x.parentElement&&x.parentElement!==u;x=x){var q=void 0;if(q="SPAN"===i.nodeName?x.parentElement.tagName.toLocaleLowerCase()===i.tagName.toLocaleLowerCase()&&x.parentElement.getAttribute("style")===D:x.parentElement.tagName.toLocaleLowerCase()===i.tagName.toLocaleLowerCase(),x.parentElement&&q&&x.parentElement.childElementCount>0){if(H.parentElement&&H.parentElement.tagName.toLocaleLowerCase()===i.tagName.toLocaleLowerCase()&&l.startContainer===l.endContainer&&1!==H.nodeType&&!sf.base.isNullOrUndefined(H.textContent)&&H.parentElement.childElementCount>1&&(l.setStart(H,0),l.setEnd(H,H.textContent.length),d.SplitNode(l,H.parentElement,!1)),"span"===x.parentElement.tagName.toLocaleLowerCase()&&"underline"===i.style.textDecoration&&"underline"!==x.parentElement.style.textDecoration){x=x.parentElement;continue}De.unwrap(x.parentElement),x=sf.base.isNullOrUndefined(x.parentElement)||f.isBlockNode(x.parentElement)?x.parentElement:H}else x=x.parentElement}if(R.length>0&&a){for(var F=0;F<R.length;F++)if(3!==R[F].nodeType||R[F].textContent&&(R[F].textContent.trim().length>0||R[F].textContent.includes(" "))){(""!==h||"fontcolor"===c&&""===h)&&(R[F]=De.Wrap(R[F],this.GetFormatNode(c,h,I,D)));P=t[n].parentElement;sf.base.isNullOrUndefined(P)||"li"===P.tagName.toLowerCase()||(P=sf.base.closest(P,"li")),sf.base.isNullOrUndefined(P)||"li"!==P.tagName.toLowerCase()||P.textContent.trim()!==t[n].textContent.trim()||"fontname"===c&&(P.style.fontFamily=h),sf.base.isNullOrUndefined(P)||"li"!==P.tagName.toLowerCase()||P.textContent.trim()===t[n].textContent.trim()||"fontname"!==c||P.style.removeProperty("font-family"),R[F].textContent===v&&("#text"===l.startContainer.nodeName||"#text"!==l.startContainer.nodeName&&l.startContainer.classList&&!l.startContainer.classList.contains("e-multi-cells-select"))&&(0===F?l.setStartBefore(R[F]):F===R.length-1&&l.setEndAfter(R[F]))}var z=t[n].parentElement;if(sf.base.isNullOrUndefined(m)||""===m||(z.style.fontSize=m),sf.base.isNullOrUndefined(g)||""===g||(z.style.backgroundColor=g),"fontsize"===c||"fontcolor"===c||"fontname"===c){P=t[n].parentElement;for(var V=t[n].parentElement;!sf.base.isNullOrUndefined(V)&&"li"!==V.tagName.toLowerCase();)P=V=V.parentElement;F=n;for(var j="";F>=0&&!sf.base.isNullOrUndefined(P)&&"li"===P.tagName.toLowerCase()&&P.contains(t[F])&&P.textContent.replace("/​/g","").trim().includes(t[F].textContent.trim());)j=t[F].textContent+j,F--;var W=!1,_=0,Q=!1;if(!sf.base.isNullOrUndefined(P)&&P.childNodes)for(var K=0;K<P.childNodes.length;K++)"OL"!==P.childNodes[K].nodeName&&"UL"!==P.childNodes[K].nodeName||(_++,W=!0);if(sf.base.isNullOrUndefined(P)||"li"!==P.tagName.toLowerCase()||P.textContent.split("​").join("").trim()!==j.split("​").join("").trim()){if(!sf.base.isNullOrUndefined(P)&&"li"===P.tagName.toLowerCase()&&W){if(W&&_>0)for(var X=0;X<P.childNodes.length;X++)t[n].textContent===P.childNodes[X].textContent&&t[n].textContent===C&&P.textContent.replace("/​/g","").trim().includes(j.split("​").join("").trim())&&(Q=!0);if(Q){for(var G=0;G<P.childNodes.length;G++)"OL"!==P.childNodes[G].nodeName&&"UL"!==P.childNodes[G].nodeName||P.childNodes[G].removeAttribute("style");"fontsize"===c?P.style.fontSize=h:"fontname"===c?P.removeAttribute("style"):(P.style.color=h,P.style.textDecoration="inherit")}}}else"fontsize"===c?P.style.fontSize=h:"fontname"===c?P.removeAttribute("style"):(P.style.color=h,P.style.textDecoration="inherit")}}return t[n]},e.insertFormat=function(t,n,i,s,r,o,a,l,d,c,h,p,u,f,m){if(r)if("uppercase"!==h&&"lowercase"!==h){g=this.getInsertNode(t,d,h,p);n[i]=g.firstChild,c.position=1}else c.position=d.startOffset;else if(null===s&&a||l){if(o||"BR"===n[i].nodeName||(n[i]=c.GetSpliceNode(d,n[i]),n[i].textContent=c.TrimLineBreak(n[i].textContent)),"uppercase"===h||"lowercase"===h)n[i].textContent="uppercase"===h?n[i].textContent.toLocaleUpperCase():n[i].textContent.toLocaleLowerCase();else if(!0!==l||""!==p){var g=this.GetFormatNode(h,p);if("formatPainter"===p||l){for(var b=n[i].parentElement,v=n[i].parentElement;!sf.base.isNullOrUndefined(v)&&"li"!==v.tagName.toLowerCase();)b=v=v.parentElement;if("fontcolor"===h||"fontname"===h||"fontsize"===h){var y=v&&"LI"===v.tagName?v:n[i].parentElement;if(!sf.base.isNullOrUndefined(y)&&y.childNodes)for(var C=0;C<y.childNodes.length;C++){if(this.concatenateTextExcludingList(n,i)===n[i].textContent){var N=void 0;if("LI"===y.tagName?N=y:y.closest("li")&&(N=y.closest("li")),!sf.base.isNullOrUndefined(N))switch(h){case"fontcolor":N.style.color=p;break;case"fontname":N.style.fontFamily=p;break;case"fontsize":N.style.fontSize=p}}var E=y.childNodes[C];if("OL"===E.tagName||"UL"===E.tagName)switch(h){case"fontcolor":E.style.color="initial";break;case"fontname":E.style.fontFamily="initial";break;case"fontsize":E.style.fontSize="initial"}}}if(sf.base.isNullOrUndefined(b)||"li"!==b.tagName.toLowerCase()||b.textContent.trim()!==n[i].textContent.trim()||("fontsize"===h?b.style.fontSize=p:"fontcolor"===h?(b.style.color=p,b.style.textDecoration="inherit"):"fontname"===h&&(b.style.fontFamily=p)),"formatPainter"===p)return this.insertFormatPainterElem(n,i,d,c,u,f);var S=n[i],T=this.getPriorityFormatNode(S,m);if(!sf.base.isNullOrUndefined(T)||l){var L=sf.base.isNullOrUndefined(T)?S:T;if(L=sf.base.isNullOrUndefined(T)||""===T.style.fontSize?L:L.firstChild,sf.base.isNullOrUndefined(T)||"fontsize"===h)for(;L;){var O=L.parentElement.textContent.trim()===n[i].textContent.trim(),k=L.parentElement;if(f.isBlockNode(k)||!O||"SPAN"===k.nodeName&&k.classList.contains("e-img-inner"))break;L=k}var x=[];if(l){var w=sf.base.closest(n[i].parentElement,"A");sf.base.isNullOrUndefined(w)||w.firstChild.textContent.trim()!==n[i].textContent.trim()||(L=n[i])}n[i].textContent.trim()!==L.textContent.trim()&&(L=n[i]),x[0]=L,this.applyStyles(x,0,g),sf.base.isNullOrUndefined(b)||"li"!==b.tagName.toLowerCase()||b.textContent.trim()===n[i].textContent.trim()||e.conCatenateTextNode(b,h,b.textContent,h,p)}else n[i]=this.applyStyles(n,i,g)}else{b=n[i].parentElement;n[i]=this.applyStyles(n,i,g),sf.base.isNullOrUndefined(b)||"li"===b.tagName.toLowerCase()||(b=sf.base.closest(b,"li"));var A=b&&b.parentElement?sf.base.closest(b.parentElement,"li"):null;sf.base.isNullOrUndefined(b)||"li"!==b.tagName.toLowerCase()||b.textContent.trim()!==n[i].textContent.trim()&&(b.innerText.split("\n").length!==n.length||b.innerText.split("\n")[0]!==n[i].textContent.trim())?sf.base.isNullOrUndefined(b)||"li"!==b.tagName.toLowerCase()||b.textContent.trim()===n[i].textContent.trim()||(e.conCatenateTextNode(b,h,b.textContent,h),!sf.base.isNullOrUndefined(b.nextSibling)&&"LI"===b.nextSibling.nodeName||sf.base.isNullOrUndefined(A)||e.conCatenateTextNode(A,h,A.textContent,h)):("bold"===h?b.style.fontWeight="bold":"italic"===h&&(b.style.fontStyle="italic"),!sf.base.isNullOrUndefined(b.nextSibling)&&"LI"===b.nextSibling.nodeName||sf.base.isNullOrUndefined(A)||e.conCatenateTextNode(A,h,A.textContent,h))}}}else!o&&n[i].isConnected&&(n[i]=c.GetSpliceNode(d,n[i]));return n[i]},e.applyStyles=function(e,t,n){return"BR"===e[t].nodeName&&"BR"===this.enterAction||(e[t]=t===e.length-1||"BR"===e[t].nodeName?De.Wrap(e[t],n):De.WrapBefore(e[t],n,!0),e[t]=this.getChildNode(e[t],n)),e[t]},e.getPriorityFormatNode=function(e,t){var n,i,s,r=new y,o=r.getFormattedNode(e,"fontsize",t);return sf.base.isNullOrUndefined(o)?(i=r.getFormattedNode(e,"backgroundcolor",t),sf.base.isNullOrUndefined(i)?(s=r.getFormattedNode(e,"fontname",t),sf.base.isNullOrUndefined(s)?(n=r.getFormattedNode(e,"fontcolor",t),sf.base.isNullOrUndefined(n)?null:n):s):i):o},e.getInsertNode=function(e,t,n,i){var s=this.GetFormatNode(n,i);if(s.innerHTML="&#8203;",sf.base.Browser.isIE){var r=e.createDocumentFragment();r.appendChild(s),t.insertNode(r)}else t.insertNode(s);return s},e.getChildNode=function(e,t){return null==e&&(t.innerHTML="&#8203;",e=t.firstChild),e},e.applySelection=function(e,t,n,i,s){return 1!==e.length||s?1===e.length&&s?(t.startContainer=t.getNodeArray(e[i],!0),t.endContainer=t.startContainer,t.startOffset=n.position,t.endOffset=n.position):0===i?(t.startContainer=t.getNodeArray(e[i],!0),t.startOffset=0):i===e.length-1&&(t.endContainer=t.getNodeArray(e[i],!1),t.endOffset=e[i].textContent.length):(t.startContainer=t.getNodeArray(e[i],!0),t.endContainer=t.startContainer,t.startOffset=0,t.endOffset=e[i].textContent.length),t},e.GetFormatNode=function(e,t,n,i){var s;switch(e){case"bold":return document.createElement("strong");case"italic":return document.createElement("em");case"underline":return s=document.createElement("span"),this.updateStyles(s,n,i),s.style.textDecoration="underline",s;case"strikethrough":return s=document.createElement("span"),this.updateStyles(s,n,i),s.style.textDecoration="line-through",s;case"superscript":return document.createElement("sup");case"subscript":return document.createElement("sub");case"fontcolor":return s=document.createElement("span"),this.updateStyles(s,n,i),s.style.color=t,s.style.textDecoration="inherit",s;case"fontname":return s=document.createElement("span"),this.updateStyles(s,n,i),s.style.fontFamily=t,s;case"fontsize":return s=document.createElement("span"),this.updateStyles(s,n,i),s.style.fontSize=t,s;case"inlinecode":return document.createElement("code");default:return s=document.createElement("span"),this.updateStyles(s,n,i),s.style.backgroundColor=t,s}},e.updateStyles=function(e,t,n){null!==n&&"SPAN"===t&&(e.style.cssText=n)},e.insertFormatPainterElem=function(e,t,n,i,s,r){var o=r.isBlockNode(e[t].parentElement)?e[t]:e[t].parentElement;if(!r.isBlockNode(o))for(;o.textContent.trim()===o.parentElement.textContent.trim()&&!r.isBlockNode(o.parentElement);)o=o.parentElement;sf.base.isNullOrUndefined(o)||1!==o.nodeType||o.classList.contains("e-rte-img-caption")||o.classList.contains("e-img-inner")||this.formatPainterCleanup(t,e,o,n,i,r);var a=s.element;if(!sf.base.isNullOrUndefined(a)){var l=a.cloneNode(!0),d=l.querySelectorAll(s.lastChild.nodeName),c=void 0;d.length>0?c=d[d.length-1]:sf.base.isNullOrUndefined(l)||l.nodeName!==s.lastChild.nodeName||(c=l),c.textContent=e[t].textContent;var h=c.childNodes[0];e[t]=De.Wrap(e[t],l),e[t].textContent="",e[t]=h}return e[t]},e.formatPainterCleanup=function(e,t,n,i,s,r){var o=["A","AUDIO","IMG","VIDEO","IFRAME"];if(0===e&&n.textContent.trim()!==t[e].textContent.trim()){s.SplitNode(i,n,!0);for(var a=t[e].parentElement.childNodes,l=0;l<a.length;l++)if(a[l].textContent.trim()===t[l].textContent.trim()){n.parentNode.insertBefore(a[l],n);break}for(var d=n.parentElement.childNodes,c=0;c<d.length;c++)""!==d[c].textContent.trim()&&0!==d[c].textContent.length||160===d[c].textContent.charCodeAt(0)||sf.base.detach(d[c])}else if(n.textContent.trim()!==t[e].textContent.trim())n.parentElement.insertBefore(t[e],n);else for(;!sf.base.isNullOrUndefined(n)&&3!==n.nodeType&&!r.isBlockNode(n);){var h=void 0;for(l=0;l<n.childNodes.length;l++){var p=n.childNodes[l];0!==p.textContent.trim().length&&3!==p.nodeType&&(h=n.childNodes[l])}-1===o.indexOf(n.tagName)&&De.unwrap(n),n=h}},e.concatenateTextExcludingList=function(e,t){var n="",i="#text"===e[t].nodeName?sf.base.closest(e[t].parentElement,"li"):sf.base.closest(e[t],"li");if(!sf.base.isNullOrUndefined(i))for(var s=0;s<i.childNodes.length;s++){var r=i.childNodes[s];(3===r.nodeType||1===r.nodeType&&"OL"!==r.tagName&&"UL"!==r.tagName)&&(n+=r.textContent)}return n},e.conCatenateTextNode=function(t,n,i,s,r){var o="",a="";switch(n){case"bold":t.querySelectorAll("strong, b").forEach((function(e){o+=e.textContent})),o===i&&(t.style.fontWeight=s);break;case"italic":t.querySelectorAll("em, i").forEach((function(e){o+=e.textContent})),o===i&&(t.style.fontStyle=s);break;case"fontcolor":t.querySelectorAll("span").forEach((function(t){a=t.style.color,e.hasColorsEqual(a,r)&&(o+=t.textContent)})),sf.base.isNullOrUndefined(o)||sf.base.isNullOrUndefined(i)||""===o||""===i||o.replace(/\s+/g,"")!==i.replace(/\s+/g,"")||(t.style.color=r,t.style.textDecoration="inherit");break;case"fontsize":t.querySelectorAll("span").forEach((function(e){e.style.getPropertyValue("font-size")===r&&(o+=e.textContent)})),sf.base.isNullOrUndefined(o)||sf.base.isNullOrUndefined(i)||""===o||""===i||o.replace(/\s+/g,"")!==i.replace(/\s+/g,"")||(t.style.fontSize=r);break;case"fontname":t.querySelectorAll("span").forEach((function(e){e.style.getPropertyValue("font-family").replace(/ /g,"")===r&&(o+=e.textContent)})),sf.base.isNullOrUndefined(o)||sf.base.isNullOrUndefined(i)||""===o||""===i||o.replace(/\s+/g,"")!==i.replace(/\s+/g,"")||(t.style.fontFamily=r)}},e.hasColorsEqual=function(e,t){return sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(t)||""===e.trim()||""===t.trim()?e===t:(e.startsWith("rgb(")&&(e=e.replace("rgb(","rgba(").slice(0,-1)+",1)"),t.startsWith("rgb(")&&(t=t.replace("rgb(","rgba(").slice(0,-1)+",1)"),e.replace(/\s+/g,"")===t.replace(/\s+/g,""))},e.isMentionStartOrEnd=function(e,t,n){var i="None",s=new He(e),r=s.getTopMostNode(t),o=s.getTopMostNode(n);return r.nodeType!==Node.ELEMENT_NODE||r.isContentEditable||o.nodeType!==Node.ELEMENT_NODE||o.isContentEditable||(i="Both"),r.nodeType!==Node.ELEMENT_NODE||r.isContentEditable||(i="Start"),o.nodeType!==Node.ELEMENT_NODE||o.isContentEditable||(i="End"),i},e.enterAction="P",e.isUnwrapped=!1,e.isWrapped=!1,e.userAgentData=new je(sf.base.Browser.userAgent,!1),e}(),_e=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("selection-type",this.applySelection,this),this.parent.observer.on("keydown-handler",this.keyDownHandler,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("selection-type",this.applySelection),this.parent.observer.off("keydown-handler",this.keyDownHandler),this.parent.observer.off(v,this.destroy)},e.prototype.keyDownHandler=function(e){(e.event.ctrlKey||e.event.metaKey)&&["bold","italic","underline","strikethrough","superscript","subscript","uppercase","lowercase","inlinecode"].indexOf(e.event.action)>-1&&(e.event.preventDefault(),We.applyFormat(this.parent.currentDocument,e.event.action,this.parent.editableElement,e.enterAction,this.parent.tableCellSelection),this.callBack(e,e.event.action))},e.prototype.applySelection=function(e){We.applyFormat(this.parent.currentDocument,e.subCommand.toLocaleLowerCase(),this.parent.editableElement,e.enterAction,this.parent.tableCellSelection,e.value,e.selector),this.callBack(e,e.subCommand)},e.prototype.callBack=function(e,t){e.callBack&&e.callBack({requestType:t,event:e.event,editorMode:"HTML",isKeyboardEvent:"keydown-handler"===e.name,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Qe=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("inserthtml-type",this.applyHtml,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("inserthtml-type",this.applyHtml),this.parent.observer.off(v,this.destroy)},e.prototype.applyHtml=function(e){var t=this.getSelectionRange(),n=e.value.firstChild;if(n&&"A"===n.nodeName&&t.startOffset!==t.endOffset){var i="#text"===t.startContainer.nodeName,s=i?ue:de,r=i?"CreateLink":"InsertLink";this.parent.observer.notify(s,{value:r,item:this.extractHyperlinkDetails(e),callBack:e.callBack})}else Pe.Insert(this.parent.currentDocument,e.value,this.parent.editableElement,!0,e.enterAction,this.parent);if("pasteCleanup"===e.subCommand){var o=this.parent.editableElement.querySelectorAll(".pasteContent_RTE"),a=[].slice.call(o),l=this.parent.editableElement.querySelectorAll(".pasteContent_Img"),d=[].slice.call(l);e.callBack({requestType:e.subCommand,editorMode:"HTML",elements:a,imgElem:d})}else e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.extractHyperlinkDetails=function(e){var t,n=this.getSelectionRange(),i=this.parent.nodeSelection.getParentNodeCollection(n),s=e.value.querySelector("a"),r=this.findAnchorElement(i);if(r&&"A"===r.nodeName){var o=n.toString(),a=r.innerText;t=o.length<a.length?a:o}else t=n.toString();return{url:s.href||"",text:t,title:s.title||"",target:s.target||"",ariaLabel:s.ariaLabel||"",selection:this.parent.nodeSelection,selectNode:Array.from(this.getSelectionRange().startContainer.childNodes),selectParent:i}},e.prototype.getSelectionRange=function(){return this.parent.nodeSelection.getRange(this.parent.currentDocument)},e.prototype.findAnchorElement=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],s=sf.base.closest(i,"a");if(s)return s}return e[0]},e.prototype.destroy=function(){this.removeEventListener()},e}(),Ke=function(){function e(){}return e.clear=function(e,t,n,i,s){this.domNode=new Re(t,e),this.defaultTag="P"===n?"p":"div";var r=new et(t),o=new Ie,a=r.getRange(e),l=a.collapsed?r.getSelectionNodeCollection(a):r.getSelectionNodeCollectionBr(a),d=r.save(a,e),c=!1;if(a.collapsed&&"ClearFormat"!==s&&(c=!0,a=o.GetCursorRange(e,a,l[0])),!a.collapsed){var h=void 0;if(h=l.length>0&&"BR"===l[0].nodeName&&sf.base.closest(l[0],"table")?o.GetSpliceNode(a,sf.base.closest(l[0],"table")):o.GetSpliceNode(a,l[l.length>1&&"IMG"===l[0].nodeName?1:0]),1===l.length)r.setSelectionContents(e,h),a=r.getRange(e);else if(l.length>1){for(var p=1,u=l[l.length-p];l.length<=p&&"BR"===l[l.length-p].nodeName;)p++,u=l[l.length-p];var f=o.GetSpliceNode(a,u);f&&r.setSelectionText(e,h,f,0,3===f.nodeType?f.textContent.length:f.childNodes.length),a=r.getRange(e)}var m=r.getNodeCollection(a),g=m.slice();this.clearInlines(r.getSelectionNodesBr(g),g,r.getRange(e),o,t),this.reSelection(e,d,m),a=r.getRange(e);var b=(m=r.getNodeCollection(a)).slice();this.clearBlocks(e,b,t,o,r),C()&&N(t,i),this.reSelection(e,d,m)}c&&r.setCursorPoint(e,a.endContainer,a.endOffset)},e.reSelection=function(e,t,n){var i=t.getInsertNodes(n);t.startContainer=t.getNodeArray(i[0],!0,e),t.startOffset=0,t.endContainer=t.getNodeArray(i[i.length-1],!1,e);var s=i[i.length-1];t.endOffset=3===s.nodeType?s.textContent.length:s.childNodes.length,t.restore()},e.clearBlocks=function(e,t,n,i,s){for(var r=[],o=0;o<t.length;o++)this.BLOCK_TAGS.indexOf(t[o].nodeName.toLocaleLowerCase())>-1&&-1===r.indexOf(t[o])?r.push(t[o]):this.BLOCK_TAGS.indexOf(t[o].parentNode.nodeName.toLocaleLowerCase())>-1&&-1===r.indexOf(t[o].parentNode)&&n!==t[o].parentNode&&r.push(t[o].parentNode);r=this.spliceParent(r,t)[0],r=this.removeParent(r),this.unWrap(e,r,i,s)},e.spliceParent=function(e,t){for(var n=0;n<e.length;n++)for(var i=e[n].childNodes.length,s=0;s<i;s++)if(t.indexOf(e[n].childNodes[s])>0&&e[n].childNodes[s].childNodes.length>0&&(t=this.spliceParent([e[n].childNodes[s]],t)[1]),t.indexOf(e[n].childNodes[s])<=-1&&""!==e[n].childNodes[s].textContent.trim()){for(var r=0;r<i;r++)t.indexOf(e[n].childNodes[r])>-1&&t.splice(t.indexOf(e[n].childNodes[r]),1);s=e[n].childNodes.length;var o=e.indexOf(e[n].parentNode),a=t.indexOf(e[n].parentNode);o>-1&&e.splice(o,1),a>-1&&t.splice(a,1);var l=t.indexOf(e[n]);l>-1&&t.splice(l,1),e.splice(n,1),n--}return[e,t]},e.removeChild=function(e,t){var n=t.childNodes.length;if(n>0)for(var i=0;i<n;i++)e.indexOf(t.childNodes[i])>-1&&(e=this.removeChild(e,t.childNodes[i])).splice(e.indexOf(t.childNodes[i]),1);return e},e.removeParent=function(e){for(var t=0;t<e.length;t++)e.indexOf(e[t].parentNode)>-1&&((e=this.removeChild(e,e[t])).splice(t,1),t--);return e},e.unWrap=function(e,t,n,i){for(var s=function(s){t[s]=sf.base.closest(t[s],"li")&&"UL"!==t[s].nodeName&&"OL"!==t[s].nodeName?sf.base.closest(t[s],"li"):t[s],r.NONVALID_TAGS.indexOf(t[s].nodeName.toLowerCase())>-1&&t[s].parentNode&&r.NONVALID_PARENT_TAGS.indexOf(t[s].parentNode.nodeName.toLowerCase())>-1&&(i.setSelectionText(e,t[s],t[s],0,t[s].childNodes.length),De.unwrap(n.GetSpliceNode(i.getRange(e),t[s].parentNode)));var o=sf.base.closest(t[s],"blockquote");if("blockquote"!==t[s].nodeName.toLocaleLowerCase()&&!sf.base.isNullOrUndefined(o)&&o.textContent===t[s].textContent){var a=r.removeParent([o]);r.unWrap(e,a,n,i)}if("p"!==t[s].nodeName.toLocaleLowerCase()){if(r.NONVALID_PARENT_TAGS.indexOf(t[s].nodeName.toLowerCase())<0&&("blockquote"!==t[s].nodeName.toLocaleLowerCase()&&"li"!==t[s].nodeName.toLocaleLowerCase()||!(r.IGNORE_PARENT_TAGS.indexOf(t[s].childNodes[0].nodeName.toLocaleLowerCase())>-1))&&(1!==t[s].childNodes.length||"p"!==t[s].childNodes[0].nodeName.toLocaleLowerCase())){var l=t[s];if(-1!==["TABLE","TD","TH"].indexOf(l.nodeName)){if(l.hasAttribute("style")&&l.removeAttribute("style"),l.hasAttribute("class")){var d=new Set(["e-rte-table","e-rte-paste-table","e-rte-custom-table"]),c=l.className.split(/\s+/).filter((function(e){return d.has(e)}));c.length>0?l.className=c.join(" "):l.removeAttribute("class")}}else De.Wrap(t[s],e.createElement(r.defaultTag))}var h=[];1===(h="TABLE"===t[s].nodeName||"TD"===t[s].nodeName||"TH"===t[s].nodeName?Array.from(t[s].childNodes):De.unwrap(t[s])).length&&"p"===h[0].parentNode.nodeName.toLocaleLowerCase()&&(De.Wrap(t[s],e.createElement(r.defaultTag)),De.unwrap(t[s]));for(var p=0;p<h.length;p++)if(r.NONVALID_TAGS.indexOf(h[p].nodeName.toLowerCase())>-1)r.unWrap(e,[h[p]],n,i);else if(r.BLOCK_TAGS.indexOf(h[p].nodeName.toLocaleLowerCase())>-1&&"p"!==h[p].nodeName.toLocaleLowerCase()){a=r.removeParent([h[p]]);r.unWrap(e,a,n,i)}else r.BLOCK_TAGS.indexOf(h[p].nodeName.toLocaleLowerCase())>-1&&"p"===h[p].nodeName.toLocaleLowerCase()?("p"===h[p].parentNode.nodeName.toLocaleLowerCase()&&De.unwrap(h[p].parentNode),De.Wrap(h[p],e.createElement(r.defaultTag)),De.unwrap(h[p])):r.BLOCK_TAGS.indexOf(h[p].nodeName.toLocaleLowerCase())>-1&&h[p].parentNode.nodeName.toLocaleLowerCase()===h[p].nodeName.toLocaleLowerCase()&&De.unwrap(h[p])}else De.Wrap(t[s],e.createElement(r.defaultTag)),De.unwrap(t[s])},r=this,o=0;o<t.length;o++)s(o)},e.clearInlines=function(e,t,n,i,s){for(var r=0;r<e.length;r++){for(var o=e[r],a=void 0;!this.domNode.isBlockNode(o)&&o.parentElement&&!o.parentElement.classList.contains("e-img-inner");)a=o,o=o.parentElement;a&&y.inlineTags.indexOf(a.nodeName.toLocaleLowerCase())>-1&&(i.GetSpliceNode(n,a),this.removeInlineParent(a))}},e.removeInlineParent=function(e){for(var t=De.unwrap(e),n=0;n<t.length;n++)1===t[n].parentNode.childNodes.length&&!t[n].parentNode.classList.contains("e-img-inner")&&y.inlineTags.indexOf(t[n].parentNode.nodeName.toLocaleLowerCase())>-1?this.removeInlineParent(t[n].parentNode):y.inlineTags.indexOf(t[n].nodeName.toLocaleLowerCase())>-1&&this.removeInlineParent(t[n])},e.BLOCK_TAGS=["address","article","aside","blockquote","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","li","main","nav","noscript","ol","p","pre","section","ul","table","td","th"],e.NONVALID_PARENT_TAGS=["thead","tbody","ul","ol","tfoot","tr"],e.IGNORE_PARENT_TAGS=["ul","ol","table"],e.NONVALID_TAGS=["thead","figcaption","tr","tfoot","figcaption","li"],e.defaultTag="p",e}(),Xe=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("clear-type",this.applyClear,this),this.parent.observer.on("keydown-handler",this.onKeyDown,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("clear-type",this.applyClear),this.parent.observer.off("keydown-handler",this.onKeyDown),this.parent.observer.off(v,this.destroy)},e.prototype.onKeyDown=function(e){switch(e.event.action){case"clear-format":this.applyClear({subCommand:"ClearFormat",callBack:e.callBack,enterAction:e.enterAction}),e.event.preventDefault()}},e.prototype.applyClear=function(e){"ClearFormat"===e.subCommand&&(Ke.clear(this.parent.currentDocument,this.parent.editableElement,e.enterAction,e.selector,e.subCommand),e.callBack&&e.callBack({requestType:e.subCommand,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)}))},e.prototype.destroy=function(){this.removeEventListener()},e}(),Ge=function(){function e(e,t){this.undoRedoStack=[],this.parent=e,this.undoRedoSteps=sf.base.isNullOrUndefined(t)?30:t.undoRedoSteps,this.undoRedoTimer=sf.base.isNullOrUndefined(t)?300:t.undoRedoTimer,this.addEventListener()}return e.prototype.addEventListener=function(){this.debounceListener=sf.base.debounce(this.keyUp,this.undoRedoTimer),this.parent.observer.on("keyup-handler",this.debounceListener,this),this.parent.observer.on("keydown-handler",this.keyDown,this),this.parent.observer.on("action",this.onAction,this),this.parent.observer.on("model_changed_plugin",this.onPropertyChanged,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++){switch(n[t]){case"undoRedoSteps":this.undoRedoSteps=e.newProp.undoRedoSteps;break;case"undoRedoTimer":this.undoRedoTimer=e.newProp.undoRedoTimer}}},e.prototype.removeEventListener=function(){this.parent.observer.off("keyup-handler",this.keyUp),this.parent.observer.off("keydown-handler",this.keyDown),this.parent.observer.off("action",this.onAction),this.parent.observer.off("model_changed_plugin",this.onPropertyChanged),this.parent.observer.off(v,this.destroy),this.debounceListener=null},e.prototype.onAction=function(e){"Undo"===e.subCommand?this.undo(e):this.redo(e)},e.prototype.destroy=function(){this.removeEventListener(),this.element=null,this.steps=null,this.undoRedoStack=[],this.undoRedoSteps=null,this.undoRedoTimer=null},e.prototype.keyDown=function(e){var t=e.event;switch(t.action){case"undo":t.preventDefault(),this.undo(e);break;case"redo":t.preventDefault(),this.redo(e)}},e.prototype.keyUp=function(e){17===e.event.keyCode||e.event.ctrlKey||this.saveData(e)},e.prototype.getTextContentFromFragment=function(e){for(var t="",n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];i.nodeType===Node.TEXT_NODE?t+=i.textContent:i.nodeType===Node.ELEMENT_NODE&&(t+=this.getTextContentFromFragment(i))}return t},e.prototype.isElementStructureEqual=function(e,t){if(e.childNodes.length!==t.childNodes.length)return!1;for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n],s=t.childNodes[n];if(!i||!s)return!1;if(i.nodeType!==s.nodeType)return!1;if(i.outerHTML!==s.outerHTML)return!1}return!0},e.prototype.saveData=function(e){if(this.parent.currentDocument){for(var t=new et(this.parent.editableElement).getRange(this.parent.currentDocument),n=this.parent.editableElement===t.startContainer.parentElement?t.startContainer.parentElement:t.startContainer,i=n.childNodes.length-1;i>=0;i--)!sf.base.isNullOrUndefined(n.childNodes[i])&&"#text"===n.childNodes[i].nodeName&&0===n.childNodes[i].textContent.length&&"IMG"!==n.childNodes[i].nodeName&&"BR"!==n.childNodes[i].nodeName&&n.childNodes[i].nodeName&&sf.base.detach(n.childNodes[i]);t=new et(this.parent.editableElement).getRange(this.parent.currentDocument);for(var s=new et(this.parent.editableElement).save(t,this.parent.currentDocument),r=this.removeResizeElement(this.parent.editableElement.cloneNode(!0)),o=document.createDocumentFragment();r.firstChild;)o.appendChild(r.firstChild);var a={text:o,range:s};this.undoRedoStack.length>=this.steps&&(this.undoRedoStack=this.undoRedoStack.slice(0,this.steps+1)),this.undoRedoStack.length>1&&this.undoRedoStack[this.undoRedoStack.length-1].range.range.collapsed===t.collapsed&&this.undoRedoStack[this.undoRedoStack.length-1].range.startOffset===s.range.startOffset&&this.undoRedoStack[this.undoRedoStack.length-1].range.endOffset===s.range.endOffset&&this.undoRedoStack[this.undoRedoStack.length-1].range.range.startContainer===s.range.startContainer&&this.getTextContentFromFragment(this.undoRedoStack[this.undoRedoStack.length-1].text).trim()===this.getTextContentFromFragment(a.text).trim()&&this.isElementStructureEqual(this.undoRedoStack[this.undoRedoStack.length-1].text,a.text)||(this.undoRedoStack.push(a),this.steps=this.undoRedoStack.length-1,this.steps>this.undoRedoSteps&&(this.undoRedoStack.shift(),this.steps--),e&&e.callBack&&e.callBack())}},e.prototype.removeResizeElement=function(e){var t=e.querySelector(".e-vid-resize");t&&sf.base.detach(t);var n=e.querySelector(".e-video-focus");n&&sf.base.removeClass([n],["e-video-focus","e-resize"]);var i=e.querySelector(".e-img-resize");i&&sf.base.detach(i);for(var s=e.querySelectorAll("img"),r=0;r<s.length;r++){var o=s[r];sf.base.removeClass([o],["e-img-focus","e-resize"])}var a=e.querySelector(".e-audio-focus");a&&sf.base.removeClass([a],["e-audio-focus"]);var l=e.querySelectorAll("img, audio, video");for(r=0;r<l.length;r++){l[r].style.outline=""}return e},e.prototype.undo=function(e){if(this.steps>0){var t=this.undoRedoStack[this.steps-1].range,n=this.undoRedoStack[this.steps-1].text;this.parent.editableElement.innerHTML="",this.parent.editableElement.appendChild(n.cloneNode(!0)),this.parent.editableElement.focus(),E(this.parent.currentDocument,this.parent.editableElement),C()&&N(this.parent.editableElement,e.selector),t.restore(),this.steps--,e.callBack&&e.callBack({requestType:"Undo",editorMode:"HTML",range:t,elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),event:e.event})}},e.prototype.redo=function(e){if(null!=this.undoRedoStack[this.steps+1]){var t=this.undoRedoStack[this.steps+1].range,n=this.undoRedoStack[this.steps+1].text;this.parent.editableElement.innerHTML="",this.parent.editableElement.appendChild(n.cloneNode(!0)),this.parent.editableElement.focus(),E(this.parent.currentDocument,this.parent.editableElement),C()&&N(this.parent.editableElement,e.selector),t.restore(),this.steps++,e.callBack&&e.callBack({requestType:"Redo",editorMode:"HTML",range:t,elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),event:e.event})}},e.prototype.getUndoStatus=function(){var e={undo:!1,redo:!1};return this.steps>0&&(e.undo=!0),null!=this.undoRedoStack[this.steps+1]&&(e.redo=!0),e},e.prototype.getCurrentStackIndex=function(){return this.steps},e.prototype.clear=function(){this.undoRedoStack=[],this.steps=null},e}(),Ye=function(){function e(e){this.olData=["decimal","decimal-leading-zero","lower-alpha","lower-roman","upper-alpha","upper-roman","lower-greek"],this.ulData=["disc","square","circle","disc","square","circle"],this.ignorableNodes=["A","APPLET","B","BLOCKQUOTE","BR","BUTTON","CENTER","CODE","COL","COLGROUP","DD","DEL","DFN","DIR","DIV","DL","DT","EM","FIELDSET","FONT","FORM","FRAME","FRAMESET","H1","H2","H3","H4","H5","H6","HR","I","IMG","IFRAME","INPUT","INS","LABEL","LI","OL","OPTION","P","PARAM","PRE","Q","S","SELECT","SPAN","STRIKE","STRONG","SUB","SUP","TABLE","TBODY","TD","TEXTAREA","TFOOT","TH","THEAD","TITLE","TR","TT","U","UL"],this.blockNode=["div","p","h1","h2","h3","h4","h5","h6","address","blockquote","button","center","dd","dir","dl","dt","fieldset","frameset","hr","iframe","isindex","li","map","menu","noframes","noscript","object","ol","pre","table","tbody","td","tfoot","th","thead","tr","ul","header","article","nav","footer","section","aside","main","figure","figcaption"],this.borderStyle=["border-top","border-right","border-bottom","border-left"],this.upperRomanNumber=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"],this.lowerRomanNumber=["i","ii","iii","iv","v","vi","vii","viii","ix","x","xi","xii","xiii","xiv","xv","xvi","xvii","xviii","xix","xx"],this.lowerGreekNumber=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],this.removableElements=["o:p","style","w:sdt"],this.listContents=[],this.cropImageDimensions=[],this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("ms_word_cleanup_plugin",this.wordCleanup,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("ms_word_cleanup_plugin",this.wordCleanup),this.parent.observer.off(v,this.destroy)},e.prototype.wordCleanup=function(e){var t=sf.base.isNullOrUndefined(e.allowedStylePropertiesArray)?[]:e.allowedStylePropertiesArray,n=[],i=e.args.clipboardData.getData("text/HTML"),s=e.args.clipboardData.getData("text/rtf"),r=sf.base.createElement("p");r.setAttribute("id","MSWord-Content"),r.innerHTML=i,this.addDoubleBr(r);var o=/style='mso-width-source:/i,a=this.findSource(r);/class='?Mso|style='[^ ]*\bmso-/i.test(i)||/class="?Mso|style="[^ ]*\bmso-/i.test(i)||/(class="?Mso|class='?Mso|class="?Xl|class='?Xl|class=Xl|style="[^"]*\bmso-|style='[^']*\bmso-|w:WordDocument)/gi.test(i)||o.test(i)?(i=i.replace(/<img[^>]+>/i,""),this.addListClass(r),n=this.listCleanUp(r,n),sf.base.isNullOrUndefined(n[0])||"UL"===n[0].parentElement.tagName||"OL"===n[0].parentElement.tagName||this.listConverter(n),this.imageConversion(r,s),this.cleanList(r,"UL"),this.cleanList(r,"OL"),this.styleCorrection(r,t),this.removingComments(r),this.removeUnwantedElements(r),this.removeEmptyElements(r),this.removeEmptyAnchorTag(r),this.breakLineAddition(r),this.processMargin(r),this.removeClassName(r),o.test(i)&&this.addTableBorderClass(r),e.callBack(r.innerHTML,this.cropImageDimensions,a)):(a===ve[2]&&this.handleOneNoteContent(r),this.removeEmptyMetaTags(r),e.callBack(r.innerHTML,null,a))},e.prototype.addDoubleBr=function(e){var t=e.querySelector(".Apple-interchange-newline");if(!sf.base.isNullOrUndefined(t)&&-1!==sf.base.Browser.userAgent.indexOf("Chrome")&&"P"===t.parentElement.nodeName&&e!==t.parentElement)for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===Node.COMMENT_NODE&&-1!==i.nodeValue.indexOf("StartFragment")){var s=sf.base.createElement("p");s.innerHTML="<br>";var r=t.parentElement.style.cssText,o=(s.getAttribute("style")||"")+r;s.style.cssText=o,e.insertBefore(s,i.nextSibling),sf.base.detach(t);break}}},e.prototype.cleanList=function(e,t){for(var n=e.querySelectorAll(t+" div"),i=n.length-1;i>=0;i--){for(var s=n[i],r=s.parentNode;s.firstChild;)r.insertBefore(s.firstChild,s);var o=this.findClosestListElem(s);o&&this.insertAfter(s,o)}},e.prototype.insertAfter=function(e,t){t.parentNode&&t.parentNode.insertBefore(e,t.nextSibling)},e.prototype.findClosestListElem=function(e){for(var t;!sf.base.isNullOrUndefined(e);){var n=!sf.base.isNullOrUndefined(e.closest("ul"))&&"UL"!==e.tagName,i="OL"!==e.tagName&&!sf.base.isNullOrUndefined(e.closest("ol"));e=n?e.closest("ul"):i?e.closest("ol"):null,t=sf.base.isNullOrUndefined(e)?t:e}return t},e.prototype.addListClass=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++){var i=t[n],s=i.getAttribute("style");if(!sf.base.isNullOrUndefined(s)){var r=s.replace(/ /g,"").replace("\n","").indexOf("mso-list:l")>=0,o=-1===i.className.toLowerCase().indexOf("msolistparagraph"),a="H"!==i.tagName.charAt(0),l="LI"!==i.tagName&&"OL"!==i.tagName&&"UL"!==i.tagName;r&&o&&a&&l&&i.classList.add("msolistparagraph")}}},e.prototype.addTableBorderClass=function(e){for(var t=e.querySelectorAll("table"),n=!1,i=0;i<t.length;i++){for(var s=0;s<this.borderStyle.length;s++)if(t[i].innerHTML.indexOf(this.borderStyle[s])>=0){n=!0;break}n&&(t[i].classList.add("e-rte-table-border"),n=!1)}},e.prototype.imageConversion=function(e,t){this.checkVShape(e);var n=e.querySelectorAll("img");if(this.markUnsupportedImages(n),0!==(n=e.querySelectorAll("img")).length){var i=[],s=[],r=[];this.extractImageInfo(n,i,r);var o=this.hexConversion(t);this.processHexValues(o,s),this.updateImageSources(e,i,s,r),this.cleanUnsupportedImages(e)}},e.prototype.markUnsupportedImages=function(e){for(var t=0;t<e.length;t++){var n=e[t],i=n.getAttribute("v:shapes");if(!sf.base.isNullOrUndefined(i))this.isUnsupportedImageShape(i)&&n.classList.add("e-rte-image-unsupported"),n.removeAttribute("v:shapes")}},e.prototype.isUnsupportedImageShape=function(e){for(var t=["Picture","Chart","圖片","Grafik","image","Graphic","_x0000_s","_x0000_i","img1","Immagine"],n=0;n<t.length;n++){var i=t[n];if("image"===i){if(e.toLowerCase().indexOf(i)>=0)return!1}else if(e.indexOf(i)>=0)return!1}return!0},e.prototype.extractImageInfo=function(e,t,n){for(var i=0;i<e.length;i++){var s=e[i];if(!s.classList.contains("e-rte-image-unsupported")){var r=s.getAttribute("src");t.push(r);var o=r.split("/"),a=o[o.length-1].split(".")[0]+i;n.push(a)}}},e.prototype.processHexValues=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];t.push({base64Data:sf.base.isNullOrUndefined(i.hex)?null:this.convertToBase64(i),isCroppedImage:i.isCroppedImage}),i.isCroppedImage&&this.cropImageDimensions.push({goalWidth:i.goalWidth,goalHeight:i.goalHeight,cropLength:i.cropLength,cropTop:i.cropTop,cropR:i.cropR,cropB:i.cropB})}},e.prototype.updateImageSources=function(e,t,n,i){for(var s=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.)|(blob\:))|(data:image\/[a-zA-Z]+;base64,[\w+/=]+)(\S+))/gi),r=e.querySelectorAll("img:not(.e-rte-image-unsupported)"),o=0;o<r.length;o++){var a=r[o],l=t[o];if(l.match(s))a.setAttribute("src",l);else{var d=n[o];sf.base.isNullOrUndefined(d)||sf.base.isNullOrUndefined(d.base64Data)?(a.removeAttribute("src"),a.classList.add("e-rte-image-unsupported")):a.setAttribute("src",d.base64Data),!sf.base.isNullOrUndefined(d)&&d.isCroppedImage&&a.classList.add("e-img-cropped")}a.setAttribute("id","msWordImg-"+i[o])}},e.prototype.cleanUnsupportedImages=function(e){for(var t=e.querySelectorAll(".e-rte-image-unsupported"),n=0;n<t.length;n++)t[n].removeAttribute("src")},e.prototype.checkVShape=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++){var i=t[n];switch(i.nodeName){case"V:SHAPETYPE":sf.base.detach(i);break;case"V:SHAPE":this.processVShapeElement(i)}}},e.prototype.processVShapeElement=function(e){var t=e.firstElementChild;if(t&&"V:IMAGEDATA"===t.nodeName){var n=t.getAttribute("src"),i=sf.base.createElement("img");i.setAttribute("src",n),e.parentElement.insertBefore(i,e),sf.base.detach(e)}},e.prototype.convertToBase64=function(e){var t=this.conHexStringToBytes(e.hex),n=this.conBytesToBase64(t),i=e.type;return i?"data:"+i+";base64,"+n:null},e.prototype.conBytesToBase64=function(e){for(var t="",n=e.length,i=0;i<n;i+=3){var s=e.slice(i,i+3),r=s.length,o=[];if(r<3)for(var a=r;a<3;a++)s[a]=0;o[0]=(252&s[0])>>2,o[1]=(3&s[0])<<4|s[1]>>4,o[2]=(15&s[1])<<2|(192&s[2])>>6,o[3]=63&s[2];for(a=0;a<4;a++)t+=a<=r?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o[a]):"="}return t},e.prototype.conHexStringToBytes=function(e){for(var t=[],n=e.length/2,i=0;i<n;i++){var s=e.substr(2*i,2),r=parseInt(s,16);t.push(r)}return t},e.prototype.hexConversion=function(e){var t=RegExp,n=new t("\\{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?(\\{\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s\\}]*?"),i=new t("(?:("+n.source+"))([\\da-fA-F\\s]+)\\}","g"),s=e.match(i),r=[];if(sf.base.isNullOrUndefined(s))return r;for(var o=0;o<s.length;o++){var a=s[o];if((-1===a.indexOf("fIsBullet")||-1!==a.indexOf("wzName"))&&n.test(a)){var l=this.extractImageData(a,n);l&&r.push(l)}}return r},e.prototype.extractImageData=function(e,t){var n=null;if(-1!==e.indexOf("\\pngblip"))n="image/png";else if(-1!==e.indexOf("\\jpegblip"))n="image/jpeg";else{if(-1===e.indexOf("\\emfblip"))return null;n=null}var i=this.isImageCropped(e),s={goalWidth:0,goalHeight:0,cropLength:0,cropTop:0,cropR:0,cropB:0};return i&&(s.goalWidth=this.extractCropValue("wgoal",e),s.goalHeight=this.extractCropValue("hgoal",e),s.cropLength=this.extractCropValue("cropl",e),s.cropTop=this.extractCropValue("cropt",e),s.cropR=this.extractCropValue("cropr",e),s.cropB=this.extractCropValue("cropb",e)),{hex:n?e.replace(t,"").replace(/[^\da-fA-F]/g,""):null,type:n,isCroppedImage:i,goalWidth:s.goalWidth,goalHeight:s.goalHeight,cropLength:s.cropLength,cropTop:s.cropTop,cropR:s.cropR,cropB:s.cropB}},e.prototype.isImageCropped=function(e){var t=this.extractCropValue("cropl",e)>0&&this.extractCropValue("cropt",e)>0,n=this.extractCropValue("cropr",e)>0,i=this.extractCropValue("cropb",e)>0;return t||n||i},e.prototype.extractCropValue=function(e,t){var n=t.replace(/\r\n\\/g,"\\").replace(/\n/g,"\\"),i=new RegExp("\\\\pic"+e+"(\\-?\\d+)\\\\").exec(n);return!i||i.length<2?0:parseInt(i[1],10)},e.prototype.removeClassName=function(e){for(var t=e.querySelectorAll("*[class]:not(.e-img-cropped):not(.e-rte-image-unsupported)"),n=0;n<t.length;n++)t[n].removeAttribute("class")},e.prototype.breakLineAddition=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++){var i=t[n];if(this.isReplacableWithBreak(i)){var s=this.findDetachElem(i),r=sf.base.createElement("br");this.hasNonBreakingSpace(s)||sf.base.isNullOrUndefined(s.parentElement)||(s.parentElement.insertBefore(r,s),sf.base.detach(s))}}},e.prototype.isReplacableWithBreak=function(e){var t=0===e.children.length,n="&nbsp;"===e.innerHTML,i=!e.closest("li"),s=!e.closest("td"),r="SPAN"!==e.nodeName,o="SPAN"===e.nodeName&&sf.base.isNullOrUndefined(e.previousElementSibling)&&sf.base.isNullOrUndefined(e.nextElementSibling);return t&&n&&i&&s&&(r||o)},e.prototype.hasNonBreakingSpace=function(e){var t=e.textContent.length>0,n=e.textContent.match(/\u00a0/g),i=null!==n&&n.length>0;return t&&i},e.prototype.findDetachElem=function(e){var t=e.parentElement;if(sf.base.isNullOrUndefined(t))return e;var n=""===t.textContent.trim(),i="TD"!==t.tagName&&"TH"!==t.tagName,s=sf.base.isNullOrUndefined(t.querySelector("img"));return n&&i&&s?this.findDetachElem(t):e},e.prototype.removeUnwantedElements=function(e){this.removeStyleElements(e),this.removeElementsByTagName(e)},e.prototype.removeStyleElements=function(e){var t=e.querySelector("style");sf.base.isNullOrUndefined(t)||sf.base.detach(t)},e.prototype.removeElementsByTagName=function(e){for(var t=e.innerHTML,n=RegExp,i=0;i<this.removableElements.length;i++){var s=this.removableElements[i],r=new n("<"+s+"\\s*[^>]*>","g"),o=new n("</"+s+">","g");t=(t=t.replace(r,"")).replace(o,"")}e.innerHTML=t,e.querySelectorAll(":empty")},e.prototype.findDetachEmptyElem=function(e){if(sf.base.isNullOrUndefined(e.parentElement))return null;var t=e.parentElement,n=!this.hasNonBreakingSpace(t)&&""===t.textContent.trim(),i="MSWord-Content"!==t.getAttribute("id"),s=!this.hasParentWithClass(e,"MsoListParagraph"),r=sf.base.isNullOrUndefined(t.querySelector("img"));return n&&i&&s&&r?this.findDetachEmptyElem(t):e},e.prototype.hasParentWithClass=function(e,t){for(var n=e.parentElement;!sf.base.isNullOrUndefined(n);){if(n.classList.contains(t))return!0;n=n.parentElement}return!1},e.prototype.removeEmptyElements=function(e){for(var t=e.querySelectorAll(":empty"),n=0;n<t.length;n++){var i=t[n];this.isEmptyCellWithMsoNormal(i)&&(i.innerHTML="-");var s=this.isDivWithoutBorder(i);if(this.shouldRemoveEmptyElement(i,s)){var r=this.findDetachEmptyElem(i);sf.base.isNullOrUndefined(r)||sf.base.detach(r)}}},e.prototype.isEmptyCellWithMsoNormal=function(e){var t=e.closest("td");return!sf.base.isNullOrUndefined(t)&&!sf.base.isNullOrUndefined(t.querySelector(".MsoNormal"))},e.prototype.isDivWithoutBorder=function(e){if("DIV"!==e.tagName)return!0;var t=e.style.borderBottom;return"none"===t||""===t},e.prototype.shouldRemoveEmptyElement=function(e,t){return-1===["IMG","BR","IFRAME","TD","TH","HR"].indexOf(e.tagName)&&t},e.prototype.removeEmptyMetaTags=function(e){for(var t=e.querySelectorAll("meta:empty"),n=t.length-1;n>=0;n--){var i=t[n];""===i.textContent&&sf.base.detach(i)}},e.prototype.styleCorrection=function(e,t){var n=e.querySelectorAll("style"),i=[];if(0!==n.length){var s=/[\S ]+\s+{[\s\S]+?}/gi;sf.base.isNullOrUndefined(n[0].innerHTML.match(s))?n.length>1&&(i=n[1].innerHTML.match(s)):i=n[0].innerHTML.match(s);var r=sf.base.isNullOrUndefined(i)?null:this.findStyleObject(i);if(!sf.base.isNullOrUndefined(r)){var o=this.sortSelectors(Object.keys(r)),a=o.map((function(e){return r[""+e]}));a=this.removeUnwantedStyle(a,t),this.filterStyles(e,t),this.applyStylesToElements(e,o,a),this.processListStyles(e,o,a)}}},e.prototype.sortSelectors=function(e){return e.sort((function(e,t){return(e.trim().startsWith(".")?0:1)-(t.trim().startsWith(".")?0:1)}))},e.prototype.filterStyles=function(e,t){for(var n=e.querySelectorAll("*[style]"),i=0;i<n.length;i++){for(var s=n[i],r=s.getAttribute("style").split(";"),o="",a=0;a<r.length;a++){var l=r[a],d=l.split(":")[0].trim();t.indexOf(d)>=0&&(o+=l+";")}s.style.cssText=o}},e.prototype.applyStylesToElements=function(e,t,n){for(var i,s=!1,r=/^(p|div|li)\.(1|10|11)$/,o=0;o<t.length;o++){var a=t[o],l=a.split("."),d=l[0];if(""===d){var c=l[1];i=e.getElementsByClassName(c),s=!0}else{if(1===l.length&&d.indexOf("@")>=0||r.test(a))continue;i=1===l.length&&d.indexOf("@")<0?e.getElementsByTagName(d):e.querySelectorAll(a)}this.applyStyleToElementCollection(i,a,n[o],s),s=!1}},e.prototype.applyStyleToElementCollection=function(e,t,n,i){for(var s=0;s<e.length;s++){var r=e[s];if(!r.closest("li")||"p"!==t){var o=r.getAttribute("style");if(!sf.base.isNullOrUndefined(o)&&""!==o.trim()){var a=n.split(";");this.removeBorderNoneStyles(a),i||this.removeOverlappingStyles(a,o);var l=a.join(";")+";"+o;r.style.cssText=l}else n=n.replace(/text-indent:-.*?;?/g,"").replace(/border:\s*none;?/g,"").trim(),r.style.cssText=n}}},e.prototype.removeBorderNoneStyles=function(e){for(var t=0;t<e.length;t++){var n=e[t].split(":");"border"===n[0]&&"none"===n[1]&&(e.splice(t,1),t--)}},e.prototype.removeOverlappingStyles=function(e,t){for(var n=0;n<e.length;n++){var i=e[n].split(":")[0];t.indexOf(i+":")>=0&&(e.splice(n,1),n--)}},e.prototype.processListStyles=function(e,t,n){for(var i=["MsoListParagraphCxSpFirst","MsoListParagraphCxSpMiddle","MsoListParagraphCxSpLast"],s=0;s<i.length;s++){var r=i[s],o="li."+r,a=t.indexOf(o);if(a>-1){var l=e.querySelectorAll("ol."+r+", ul."+r);this.adjustListMargins(l,n[a])}}},e.prototype.adjustListMargins=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],s=i.getAttribute("style");if(!sf.base.isNullOrUndefined(s)&&""!==s.trim()&&""!==i.style.marginLeft)for(var r=t.split(";"),o=0;o<r.length;o++){var a=r[o],l=a.split(":")[0];"margin-left".indexOf(l)>=0&&this.adjustMarginLeftValue(i,a)}}},e.prototype.adjustMarginLeftValue=function(e,t){var n=t.split(":")[1],i=e.style.marginLeft;if(!sf.base.isNullOrUndefined(n)&&n.indexOf("in")>=0&&i.indexOf("in")>=0){var s=parseFloat(n.split("in")[0]),r=parseFloat(i.split("in")[0]);e.style.marginLeft=r-s+"in"}},e.prototype.removeUnwantedStyle=function(e,t){for(var n=[],i=0;i<e.length;i++){for(var s=e[i].split(";"),r="",o=0;o<s.length;o++){var a=s[o],l=a.split(":")[0];t.indexOf(l)>=0&&(r+=a+";")}n[i]=r}return n},e.prototype.findStyleObject=function(e){for(var t={},n=0;n<e.length;n++){var i=e[n],s=i.replace(/([\S ]+\s+){[\s\S]+?}/gi,"$1"),r=i.replace(/[\S ]+\s+{([\s\S]+?)}/gi,"$1");s=this.cleanupStyleText(s),r=this.cleanupStyleText(r);for(var o=s.split(", "),a=0;a<o.length;a++)t[o[a]]=r}return t},e.prototype.cleanupStyleText=function(e){var t=e;return t=(t=t.replace(/^[\s]|[\s]$/gm,"")).replace(/\n|\r|\n\r/g,"")},e.prototype.removingComments=function(e){var t=e.innerHTML.replace(/<!--[\s\S]*?-->/g,"");e.innerHTML=t},e.prototype.listCleanUp=function(e,t){for(var n=!1,i=e.querySelectorAll("*"),s=0;s<i.length;s++){var r=i[s];this.shouldIgnoreElement(r)||(this.isMsoListParagraph(r)&&(this.isFirstListItem(r)&&t.length>0&&null!==t[t.length-1]&&t.push(null),t.push(r)),this.shouldAddListSeparator(n,r)&&t.push(null),this.isBlockElement(r)&&(n=this.isMsoListParagraph(r)))}return t.length>0&&null!==t[t.length-1]&&t.push(null),t},e.prototype.shouldIgnoreElement=function(e){var t=-1===this.ignorableNodes.indexOf(e.nodeName),n=3===e.nodeType&&""===e.textContent.trim();return t||n},e.prototype.isMsoListParagraph=function(e){var t=e.className,n=t&&-1!==t.toLowerCase().indexOf("msolistparagraph"),i=e.getAttribute("style"),s=!sf.base.isNullOrUndefined(i)&&i.indexOf("mso-list:")>=0;return n&&s},e.prototype.isFirstListItem=function(e){return e.className.indexOf("MsoListParagraphCxSpFirst")>=0},e.prototype.shouldAddListSeparator=function(e,t){return e&&this.isBlockElement(t)&&!this.isMsoListParagraph(t)},e.prototype.isBlockElement=function(e){return-1!==this.blockNode.indexOf(e.nodeName.toLowerCase())},e.prototype.listConverter=function(e){var t=[];this.processListNodes(e,t,[],""),this.replaceNodesWithLists(e,t)},e.prototype.processListNodes=function(e,t,n,i){for(var s,r=0;r<e.length;r++){var o=e[r];if(null!==o){this.fixOutlineLevel(o);var a=o.getAttribute("style")||"",l=this.extractNestingLevel(a);if(s=this.extractListFormatOverride(a,s),this.listContents=[],this.getListContent(o),!sf.base.isNullOrUndefined(this.listContents[0])){for(var d=this.determineListProperties(this.listContents[0],r,e,o),c=[],h=1;h<this.listContents.length;h++)c.push(this.listContents[h]);var p=sf.base.isNullOrUndefined(o.className)?"":o.className;i=this.updateNodeStyle(o,a),n.push({listType:d.type,content:c,nestedLevel:l,listFormatOverride:s,class:p,listStyle:i,listStyleTypeName:d.styleType,start:d.startAttr,styleMarginLeft:d.marginLeft})}}else t.push({content:this.makeConversion(n),node:e[r-1]}),n=[]}},e.prototype.fixOutlineLevel=function(e){var t=e.getAttribute("style");t&&-1!==t.indexOf("mso-outline-level")&&(e.style.cssText=t.replace("mso-outline-level","mso-outline"))},e.prototype.extractNestingLevel=function(e){return e&&-1!==e.indexOf("level")?parseInt(e.charAt(e.indexOf("level")+5),null):1},e.prototype.extractListFormatOverride=function(e,t){if(e&&-1!==e.indexOf("mso-list:")){if(e.match(/mso-list:[^;]+;?/)){var n=e.replace(new RegExp("\\n","g"),"").split(" ").join("").match(/mso-list:[^;]+;?/)[0].split(":l");return sf.base.isNullOrUndefined(n)?null:parseInt(n[1].split("level")[0],10)}return null}return t},e.prototype.determineListProperties=function(e,t,n,i){var s={type:e.trim().length>1?"ol":"ul",styleType:""};return s.styleType=this.getlistStyleType(e,s.type),"ol"!==s.type||0!==t&&null!==n[t-1]||(s.startAttr=this.determineStartAttribute(e,s.styleType)),""!==i.style.marginLeft&&(s.marginLeft=i.style.marginLeft),s},e.prototype.determineStartAttribute=function(e,t){var n=e.split(".")[0];if(-1===["A","a","I","i","α","1","01","1-"].indexOf(n))switch(t){case"decimal":case"decimal-leading-zero":if(!isNaN(parseInt(n,10)))return parseInt(n,10);break;case"upper-alpha":return n.split(".")[0].charCodeAt(0)-64;case"lower-alpha":return n.split(".")[0].charCodeAt(0)-96;case"upper-roman":return this.upperRomanNumber.indexOf(n.split(".")[0])+1;case"lower-roman":return this.lowerRomanNumber.indexOf(n.split(".")[0])+1;case"lower-greek":return this.lowerGreekNumber.indexOf(n.split(".")[0])+1;default:return}},e.prototype.updateNodeStyle=function(e,t){return sf.base.isNullOrUndefined(e.getAttribute("style"))?"":(e.style.cssText=t.replace("text-align:start;",""),e.style.textIndent="",e.getAttribute("style"))},e.prototype.replaceNodesWithLists=function(e,t){for(var n=e.shift();n;){for(var i=[],s=0;s<t.length;s++)if(t[s].node===n){for(var r=t[s].content,o=0;o<r.childNodes.length;o++)i.push(r.childNodes[o]);for(o=0;o<i.length;o++)n.parentElement.insertBefore(i[o],n);break}n.remove(),(n=e.shift())||(n=e.shift())}},e.prototype.getlistStyleType=function(e,t){var n=e.split(".")[0];return"ol"===t?this.getOrderedListStyleType(n):this.getUnorderedListStyleType(n)},e.prototype.getOrderedListStyleType=function(e){var t=e.charCodeAt(0);return this.upperRomanNumber.indexOf(e)>-1?"upper-roman":this.lowerRomanNumber.indexOf(e)>-1?"lower-roman":this.lowerGreekNumber.indexOf(e)>-1?"lower-greek":t>64&&t<91?"upper-alpha":t>96&&t<123?"lower-alpha":e.length>1&&"0"===e[0]&&!isNaN(Number(e))?"decimal-leading-zero":"decimal"},e.prototype.getUnorderedListStyleType=function(e){switch(e){case"o":return"circle";case"§":return"square";default:return"disc"}},e.prototype.makeConversion=function(e){var t,n=sf.base.createElement("div");if(0===e.length)return n;for(var i,s=1,r=0,o=e[0].listFormatOverride,a=0;a<e.length;a++){var l=e[a],d=this.isStandardListType(l.class);i&&i.classList.remove("e-current-list-item"),this.shouldResetListItem(i,a,e,d)&&(i=null);var c=this.createParagraphWithContent(l);this.isNewRootList(l,r,o)?i=(t=this.createRootList(n,l,c)).querySelector(".e-current-list-item"):this.isSameLevelList(l,s,o)?i=(t=this.addToSameLevelList(l,t,c,i,n)).querySelector(".e-current-list-item"):this.isDeeperNestedList(l,s)?i=(t=this.createNestedList(l,i,c,d,n,s)).querySelector(".e-current-list-item"):this.isTopLevelList(l)?i=(t=this.handleTopLevelList(l,n,c)).querySelector(".e-current-list-item"):(this.handleOtherNestingScenarios(l,i,c,o),i=n.querySelector(".e-current-list-item")),this.applyListItemStyles(i,l),s=l.nestedLevel,o=l.listFormatOverride,r++,this.setStartAttributeIfNeeded(t,l)}var h=n.querySelectorAll(".e-current-list-item");for(a=0;a<h.length;a++)h[a].classList.remove("e-current-list-item"),""===h[a].className&&h[a].removeAttribute("class");return n},e.prototype.isStandardListType=function(e){for(var t=["MsoListParagraphCxSpFirst","MsoListParagraphCxSpMiddle","MsoListParagraphCxSpLast"],n=0;n<t.length;n++)if(!sf.base.isNullOrUndefined(e)&&t[n].indexOf(e)>=0)return!0;return!1},e.prototype.shouldResetListItem=function(e,t,n,i){return!sf.base.isNullOrUndefined(e)&&0!==t&&n[t-1].listType!==n[t].listType&&!i},e.prototype.createParagraphWithContent=function(e){var t=sf.base.createElement("p",{className:"MsoNoSpacing"});return t.innerHTML=e.content.join(" "),t},e.prototype.isNewRootList=function(e,t,n){return 1===e.nestedLevel&&(0===t||n!==e.listFormatOverride)&&e.content.length>0},e.prototype.createRootList=function(e,t,n){var i=sf.base.createElement(t.listType,{className:t.class}),s=sf.base.createElement("li");return s.appendChild(n),i.appendChild(s),e.appendChild(i),i.setAttribute("level",t.nestedLevel.toString()),"msolistparagraph"!==t.class?i.style.marginLeft=t.styleMarginLeft:sf.base.addClass([i],"marginLeftIgnore"),i.style.listStyleType=t.listStyleTypeName,s.classList.add("e-current-list-item"),i},e.prototype.isSameLevelList=function(e,t,n){return e.nestedLevel===t&&n===e.listFormatOverride},e.prototype.addToSameLevelList=function(e,t,n,i,s){var r,o;return sf.base.isNullOrUndefined(i)||sf.base.isNullOrUndefined(i.parentElement)||i.parentElement.tagName.toLowerCase()!==e.listType?sf.base.isNullOrUndefined(i)?((r=sf.base.createElement(e.listType)).style.listStyleType=e.listStyleTypeName,(o=sf.base.createElement("li")).classList.add("e-current-list-item"),o.appendChild(n),r.appendChild(o),r.setAttribute("level",e.nestedLevel.toString()),s.appendChild(r),r):((r=sf.base.createElement(e.listType)).style.listStyleType=e.listStyleTypeName,(o=sf.base.createElement("li")).classList.add("e-current-list-item"),o.appendChild(n),r.appendChild(o),r.setAttribute("level",e.nestedLevel.toString()),i.parentElement.parentElement.appendChild(r),r):((o=sf.base.createElement("li")).classList.add("e-current-list-item"),o.appendChild(n),i.parentElement.appendChild(o),i.parentElement)},e.prototype.isDeeperNestedList=function(e,t){return e.nestedLevel>t},e.prototype.createNestedList=function(e,t,n,i,s,r){var o;if(sf.base.isNullOrUndefined(t))return i?this.createStandardNestedList(e,n,s):this.createRootList(s,e,n);for(var a=e.nestedLevel-r,l=0;l<a;l++)o=sf.base.createElement(e.listType),t.appendChild(o),t=sf.base.createElement("li"),l!==a-1&&a>1&&(t.style.listStyleType="none"),o.appendChild(t);return t.classList.add("e-current-list-item"),t.appendChild(n),o.setAttribute("level",e.nestedLevel.toString()),o.style.listStyleType=e.listStyleTypeName,o},e.prototype.createStandardNestedList=function(e,t,n){var i,s=sf.base.createElement(e.listType),r=sf.base.createElement("li");s.appendChild(r),s.style.listStyleType="none";for(var o=0;o<e.nestedLevel-1;o++)i=sf.base.createElement(e.listType),r.appendChild(i),r=sf.base.createElement("li"),i.appendChild(r),i.style.listStyleType="none";return r.classList.add("e-current-list-item"),r.appendChild(t),n.appendChild(s),i.setAttribute("level",e.nestedLevel.toString()),i.style.listStyleType=e.listStyleTypeName,i},e.prototype.getLastListItem=function(e){return e.querySelector("li:last-child")},e.prototype.isTopLevelList=function(e){return 1===e.nestedLevel},e.prototype.handleTopLevelList=function(e,t,n){var i,s=t.lastChild;s&&s.tagName.toLowerCase()===e.listType?i=s:((i=sf.base.createElement(e.listType)).style.listStyleType=e.listStyleTypeName,t.appendChild(i));var r=sf.base.createElement("li");return r.appendChild(n),i.appendChild(r),i.setAttribute("level",e.nestedLevel.toString()),r.classList.add("e-current-list-item"),i},e.prototype.handleOtherNestingScenarios=function(e,t,n,i){for(var s,r=t;r.parentElement;){var o=(r=r.parentElement).attributes.getNamedItem("level");if(o){var a=parseInt(o.textContent,10);if(a===e.nestedLevel&&i===e.listFormatOverride){(l=sf.base.createElement("li")).appendChild(n),r.appendChild(l),l.classList.add("e-current-list-item");break}if(a===e.nestedLevel&&i!==e.listFormatOverride){this.createDifferentFormatList(e,r,n);break}if(e.nestedLevel>a){var l;s=sf.base.createElement(e.listType),(l=sf.base.createElement("li")).appendChild(n),s.appendChild(l),r.appendChild(s),s.setAttribute("level",e.nestedLevel.toString()),s.style.listStyleType=e.listStyleTypeName,l.classList.add("e-current-list-item");break}}}},e.prototype.createDifferentFormatList=function(e,t,n){var i=sf.base.createElement(e.listType),s=sf.base.createElement("li");if(i.appendChild(s),e.nestedLevel>1)for(var r=0;r<e.nestedLevel-1;r++)s.appendChild(i=sf.base.createElement(e.listType)),s=sf.base.createElement("li"),i.appendChild(s),i.style.listStyleType="none";s.appendChild(n),s.classList.add("e-current-list-item"),t.appendChild(i),i.setAttribute("level",e.nestedLevel.toString()),i.style.listStyleType=e.listStyleTypeName},e.prototype.applyListItemStyles=function(e,t){sf.base.isNullOrUndefined(e)||(e.setAttribute("class",t.class),e.style.cssText=sf.base.isNullOrUndefined(t.listStyle)?"":t.listStyle)},e.prototype.setStartAttributeIfNeeded=function(e,t){!sf.base.isNullOrUndefined(t.start)&&1!==t.start&&"ol"===t.listType&&e.setAttribute("start",t.start.toString())},e.prototype.getListContent=function(e){var t=e.firstElementChild;this.isImageList(t)?this.handleImageList(e):t.childNodes.length>0&&this.handleTextList(e,t),this.listContents.push(e.innerHTML)},e.prototype.isImageList=function(e){return""===e.textContent.trim()&&!sf.base.isNullOrUndefined(e.firstElementChild)&&"IMG"===e.firstElementChild.nodeName},e.prototype.handleImageList=function(e){var t=e.innerHTML.trim();this.listContents.push(""),this.listContents.push(t)},e.prototype.handleTextList=function(e,t){this.cleanupListIgnoreTags(t);var n=this.cleanupListOrder(t);this.processListOrderElement(e,t,n)},e.prototype.cleanupListIgnoreTags=function(e){for(var t=e.querySelectorAll('[style*="mso-list"]'),n=0;n<t.length;n++){var i=t[n],s=i.getAttribute("style").replace(/\n/g,"");i.setAttribute("style",s)}},e.prototype.cleanupListOrder=function(e){var t=e.querySelector('span[style*="mso-list"]');if(t){var n=t.getAttribute("style");n&&(n=n.replace(/\s*:\s*/g,":"),t.setAttribute("style",n))}return e.querySelector('span[style="mso-list:Ignore"]')},e.prototype.processListOrderElement=function(e,t,n){var i=sf.base.isNullOrUndefined(n);if(n=i?t:n,!sf.base.isNullOrUndefined(n)){var s=n.textContent.trim();i&&(s=this.extractBulletMarker(n,s)),this.listContents.push(s),i||sf.base.detach(n),this.removingComments(e),this.removeUnwantedElements(e)}},e.prototype.extractBulletMarker=function(e,t){var n=t.match(/^(\d{1,2}|[a-zA-Z]|[*#~•○■])(\.|\)|-)\s*/);if(!sf.base.isNullOrUndefined(n)){var i=n[0].trim();return e.textContent=e.textContent.trim().substring(i.length).trim(),i}return t},e.prototype.processMargin=function(e){this.processListItemMargins(e),this.processTableMargins(e),this.processIgnoredNodeMargins(e)},e.prototype.processListItemMargins=function(e){for(var t=e.querySelectorAll("li"),n=0;n<t.length;n++){var i=t[n];sf.base.isNullOrUndefined(i.style.marginLeft)||i.parentElement.classList.contains("marginLeftIgnore")||(i.style.marginLeft="")}},e.prototype.processTableMargins=function(e){for(var t=e.querySelectorAll("table"),n=0;n<t.length;n++){var i=t[n],s=i.style.marginLeft;!sf.base.isNullOrUndefined(s)&&s.indexOf("-")>=0&&(i.style.marginLeft="")}},e.prototype.processIgnoredNodeMargins=function(e){for(var t=e.querySelectorAll(".marginLeftIgnore li"),n=0;n<t.length;n++){var i=t[n],s=i.style.marginLeft;if(!sf.base.isNullOrUndefined(s)&&""!==s){var r=parseFloat(s.split("in")[0])-.5;i.style.marginLeft=r.toString()+"in"}}},e.prototype.removeEmptyAnchorTag1=function(e){for(var t=e.querySelectorAll("a:not([href])"),n=t.length-1;n>=0;n--){for(var i=t[n].parentNode;t[n].firstChild;)i.insertBefore(t[n].firstChild,t[n]);i.removeChild(t[n])}},e.prototype.removeEmptyAnchorTag=function(e){for(var t=e.querySelectorAll("a:not([href])"),n=t.length-1;n>=0;n--){for(var i=t[n],s=i.parentNode;i.firstChild;)s.insertBefore(i.firstChild,i);s.removeChild(i)}},e.prototype.findSource=function(e){for(var t=e.querySelectorAll("meta"),n=0;n<t.length;n++){var i=t[n],s=i.getAttribute("content"),r=i.getAttribute("name");if(r&&r.toLowerCase().indexOf("generator")>=0&&s&&s.toLowerCase().indexOf("microsoft")>=0)for(var o=0;o<ve.length;o++){var a=ve[o];if(s.toLowerCase().indexOf(a)>=0)return a}}return"html"},e.prototype.handleOneNoteContent=function(e){for(var t=e.querySelectorAll("ul, ol"),n=0;n<t.length;n++){var i=t[n],s=0===i.querySelectorAll("li").length,r=i.childNodes.length>0;s&&r&&De.unwrap(i)}},e.prototype.destroy=function(){this.removeEventListener()},e}(),$e=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("insert-text-type",this.insertText,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("insert-text-type",this.insertText),this.parent.observer.off(v,this.destroy)},e.prototype.insertText=function(e){var t=document.createTextNode(e.value);Pe.Insert(this.parent.currentDocument,t,this.parent.editableElement),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Je=function(){function e(e){this.clickCount=0,this.lastClickTime=0,this.currentDocument=e.document,this.editableElement=e.editableElement,this.nodeSelection=new et(this.editableElement),this.nodeCutter=new Ie,this.domNode=new Re(this.editableElement,this.currentDocument),this.domTree=new He(this.editableElement),this.observer=new sf.base.Observer(this),this.listObj=new qe(this),this.formatObj=new Fe(this),this.alignmentObj=new ze(this),this.indentsObj=new Ve(this),this.selectionObj=new _e(this),this.inserthtmlObj=new Qe(this),this.insertTextObj=new $e(this),this.clearObj=new Xe(this),this.undoRedoManager=new Ge(this,e.options),this.msWordPaste=new Ye(this),this.tableCellSelection=new Ae(this.editableElement,this.currentDocument),this.userAgentData=new je(sf.base.Browser.userAgent,!1),this.wireEvents(),this.isDestroyed=!1}return e.prototype.wireEvents=function(){this.observer.on("keydown",this.editorKeyDown,this),this.observer.on("keyup",this.editorKeyUp,this),this.observer.on("keyup",this.editorKeyUp,this),this.observer.on("model_changed",this.onPropertyChanged,this),this.observer.on("ms_word_cleanup",this.onWordPaste,this),this.observer.on("onBegin",this.onBegin,this),this.observer.on("mouseDown",this.editorMouseDown,this),this.observer.on("destroy",this.destroy,this)},e.prototype.unwireEvents=function(){this.observer.off("keydown",this.editorKeyDown),this.observer.off("keyup",this.editorKeyUp),this.observer.off("keyup",this.editorKeyUp),this.observer.off("model_changed",this.onPropertyChanged),this.observer.off("ms_word_cleanup",this.onWordPaste),this.observer.off("onBegin",this.onBegin),this.observer.off("mouseDown",this.editorMouseDown),this.observer.off("destroy",this.destroy)},e.prototype.onWordPaste=function(e){this.observer.notify("ms_word_cleanup_plugin",e)},e.prototype.onPropertyChanged=function(e){this.observer.notify("model_changed_plugin",e)},e.prototype.editorKeyDown=function(e){this.observer.notify("keydown-handler",e)},e.prototype.editorKeyUp=function(e){this.observer.notify("keyup-handler",e)},e.prototype.onBegin=function(e){this.observer.notify("actionBegin",e)},e.prototype.execCommand=function(e,t,n,i,s,r,o,a){switch(e.toLowerCase()){case"lists":case"checklist":this.observer.notify("list-type",{subCommand:t,event:n,callBack:i,selector:o,item:r,enterAction:a});break;case"codeblock":this.observer.notify("code-block",{subCommand:t,event:n,callBack:i,selector:o,item:r,enterAction:a});break;case"formats":this.observer.notify("format-type",{subCommand:t,event:n,callBack:i,selector:o,exeValue:r,enterAction:a});break;case"alignments":this.observer.notify("alignment-type",{subCommand:t,event:n,callBack:i,selector:o,value:r,enterAction:a});break;case"indents":this.observer.notify("indent-type",{subCommand:t,event:n,callBack:i,selector:o,enterAction:a});break;case"links":this.observer.notify(ue,{command:e,value:t,item:r,event:n,callBack:i,enterAction:a});break;case"files":this.observer.notify(de,{command:e,value:"Image",item:r,event:n,callBack:i,selector:o});break;case"images":this.observer.notify(de,{command:e,value:t,item:r,event:n,callBack:i,selector:o});break;case"audios":this.observer.notify(ce,{command:e,value:t,item:r,event:n,callBack:i,selector:o});break;case"videos":this.observer.notify(he,{command:e,value:t,item:r,event:n,callBack:i,selector:o});break;case"table":switch(t.toString().toLocaleLowerCase()){case"createtable":this.observer.notify(pe,{item:r,event:n,callBack:i,enterAction:a});break;case"insertrowbefore":case"insertrowafter":this.observer.notify("INSERT-ROW",{item:r,event:n,callBack:i});break;case"insertcolumnleft":case"insertcolumnright":this.observer.notify("INSERT-COLUMN",{item:r,event:n,callBack:i});break;case"deleterow":this.observer.notify("DELETE-ROW",{item:r,event:n,callBack:i});break;case"deletecolumn":this.observer.notify("DELETE-COLUMN",{item:r,event:n,callBack:i});break;case"tableremove":this.observer.notify("REMOVE-TABLE",{item:r,event:n,callBack:i});break;case"tableheader":this.observer.notify("TABLE-HEADER",{item:r,event:n,callBack:i});break;case"aligntop":case"alignmiddle":case"alignbottom":this.observer.notify("TABLE_VERTICAL_ALIGN",{item:r,event:n,callBack:i});break;case"merge":this.observer.notify("TABLE_MERGE",{item:r,event:n,callBack:i});break;case"horizontalsplit":this.observer.notify("TABLE_HORIZONTAL_SPLIT",{item:r,event:n,callBack:i});break;case"verticalsplit":this.observer.notify("TABLE_VERTICAL_SPLIT",{item:r,event:n,callBack:i});break;case"dashed":case"alternate":case"custom":this.observer.notify("TABLE_STYLES",{item:r,event:n,callBack:i});break;case"backgroundcolor":this.observer.notify("TABLE_BACKGROUND_COLOR",{subCommand:t,value:r,event:n,callBack:i})}break;case"font":case"style":case"effects":case"casing":this.observer.notify("selection-type",{subCommand:t,event:n,callBack:i,value:s,selector:o,enterAction:a});break;case"inserthtml":this.observer.notify("inserthtml-type",{subCommand:t,callBack:i,value:s,enterAction:a});break;case"inserttext":this.observer.notify("insert-text-type",{subCommand:t,callBack:i,value:s});break;case"clear":this.observer.notify("clear-type",{subCommand:t,event:n,callBack:i,selector:o,enterAction:a});break;case"actions":this.observer.notify("action",{subCommand:t,event:n,callBack:i,selector:o});break;case"formatpainter":this.observer.notify("format_painter_actions",{item:r,subCommand:t,event:n,callBack:i});break;case"emojipicker":this.observer.notify("emoji_picker_actions",{item:r,subCommand:t,value:s,event:n,callBack:i})}},e.prototype.editorMouseDown=function(e){if(3===e.args.detail&&this.tripleClickSelection(e.args),-1!==sf.base.Browser.userAgent.indexOf("Safari")){var t=(new Date).getTime();t-this.lastClickTime>500&&(this.clickCount=0),this.clickCount++,this.lastClickTime=t,3===this.clickCount&&(this.tripleClickSelection(e.args),this.clickCount=0)}},e.prototype.tripleClickSelection=function(e){var t=this.nodeSelection.getRange(this.currentDocument),n=this.nodeSelection.get(this.currentDocument),i=new He(this.editableElement);if(n.rangeCount>0&&""!==n.toString()){var s=this.getParentBlockNode(t.startContainer),r=this.getParentBlockNode(t.endContainer);if(s&&r&&s===r){var o=this.currentDocument.createRange(),a=i.getFirstTextNode(s),l=i.getLastTextNode(r);a&&l&&(o.setStart(a,0),o.setEnd(l,l.textContent.length),this.nodeSelection.setRange(this.currentDocument,o),e.preventDefault())}}},e.prototype.getParentBlockNode=function(e){var t=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return window.getComputedStyle(e).display.indexOf("inline")<0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t.currentNode=e,t.parentNode()},e.prototype.destroy=function(){this.isDestroyed||(this.unwireEvents(),this.observer.notify(v),this.editableElement&&(this.editableElement=null),this.currentDocument=null,this.nodeCutter&&(this.nodeCutter=null),this.domNode&&(this.domNode=null),this.listObj&&(this.listObj=null),this.formatObj&&(this.formatObj=null),this.alignmentObj&&(this.alignmentObj=null),this.indentsObj&&(this.indentsObj=null),this.linkObj&&(this.linkObj=null),this.imgObj&&(this.imgObj=null),this.audioObj&&(this.audioObj=null),this.videoObj&&(this.videoObj=null),this.selectionObj&&(this.selectionObj=null),this.inserthtmlObj&&(this.inserthtmlObj=null),this.insertTextObj&&(this.insertTextObj=null),this.clearObj&&(this.clearObj=null),this.tableObj&&(this.tableObj=null),this.codeBlockObj&&(this.codeBlockObj=null),this.msWordPaste&&(this.msWordPaste=null),this.formatPainterEditor&&(this.formatPainterEditor=null),this.emojiPickerObj&&(this.emojiPickerObj=null),this.tableCellSelection&&(this.tableCellSelection=null),this.domTree&&(this.domTree=null),this.userAgentData=null,this.isDestroyed=!0)},e.prototype.beforeSlashMenuApplyFormat=function(){for(var e=this.nodeSelection.getRange(this.currentDocument),t=this.nodeSelection.getNodeCollection(e)[0],n=e.startOffset;-1===this.nodeSelection.getRange(this.currentDocument).toString().indexOf("/");)this.nodeSelection.setSelectionText(this.currentDocument,t,t,n,e.endOffset),n--;var i=this.nodeSelection.getRange(this.currentDocument),s=this.nodeCutter.GetSpliceNode(i,t),r=s.previousSibling;!s.parentElement||1!==s.parentElement.innerHTML.length&&1!==s.parentNode.childNodes.length||s.parentElement.appendChild(document.createElement("br")),s.parentNode.removeChild(s),r&&this.nodeSelection.setCursorPoint(document,r,r.textContent.length)},e}(),Ze="e-img-caption",et=function(){function e(e){this.startNodeName=[],this.endNodeName=[],this.editableElement=e}return e.prototype.saveInstance=function(e,t){return this.range=e.cloneRange(),this.rootNode=this.documentFromRange(e),this.body=t,this.startContainer=this.getNodeArray(e.startContainer,!0),this.endContainer=this.getNodeArray(e.endContainer,!1),this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.html=this.body.innerHTML,this},e.prototype.documentFromRange=function(e){return 9===e.startContainer.nodeType?e.startContainer:e.startContainer.ownerDocument},e.prototype.getRange=function(e){var t=this.get(e),n=t&&t.rangeCount>0?t.getRangeAt(t.rangeCount-1):e.createRange();return n.startContainer!==e||n.endContainer!==e||n.startOffset||n.endOffset||(n.setStart(e.body,0),n.collapse(!0)),n},e.prototype.get=function(e){return e.defaultView.getSelection()},e.prototype.save=function(e,t){return e=e?e.cloneRange():this.getRange(t),this.saveInstance(e,t.body)},e.prototype.getIndex=function(e){var t=0;if(e=e.previousSibling||"BR"!==e.tagName?e.previousSibling:e)for(e.nodeType;e;null)t++,e.nodeType,e=e.previousSibling;return t},e.prototype.isChildNode=function(e,t){for(var n=0;n<t.childNodes.length;n++)if(e.indexOf(t.childNodes[n])>-1)return!0;return!1},e.prototype.getNode=function(e,t,n){return(!this.editableElement||this.editableElement.contains(e)&&this.editableElement!==e)&&(t!==e||3!==e.nodeType&&e.firstChild&&-1===n.indexOf(e.firstChild)&&!this.isChildNode(n,e))?3===e.nodeType&&e.previousSibling===t&&"IMG"===t.nodeName?null:-1===n.indexOf(e.firstChild)&&e.firstChild&&!this.isChildNode(n,e)?e.firstChild:e.nextSibling?e.nextSibling:e.parentNode?e.parentNode:null:null},e.prototype.getNodeCollection=function(e){var t=e.startContainer.childNodes[e.startOffset]||e.startContainer,n=e.endContainer.childNodes[e.endOffset>0?e.endOffset-1:e.endOffset]||e.endContainer,i=this.processedTableImageCursor(e);if((i.start||i.end)&&("TABLE"===i.startName||"TABLE"===i.endName))return[i.start?i.startNode:i.endNode];if((t===n||"BR"===t.nodeName&&t===e.endContainer.childNodes[e.endOffset])&&0===t.childNodes.length)return[t];if(e.startOffset===e.endOffset&&0!==e.startOffset&&"PRE"===e.startContainer.nodeName)return["BR"===t.nodeName||"#text"===t.nodeName?t:t.childNodes[0]];var s=[];do{-1===s.indexOf(t)&&s.push(t),t=this.getNode(t,n,s)}while(t);return s},e.prototype.getParentNodeCollection=function(e){return this.getParentNodes(this.getNodeCollection(e),e)},e.prototype.getParentNodes=function(e,t){e=e.reverse();for(var n=0;n<e.length;n++)-1!==e.indexOf(e[n].parentNode)||3===e[n].nodeType&&t.startContainer!==t.endContainer&&t.startContainer.parentNode!==t.endContainer.parentNode&&t.startContainer.parentNode.tagName&&t.endContainer.parentNode.tagName&&-1!==fe.indexOf(t.startContainer.parentNode.tagName.toLowerCase())&&-1!==fe.indexOf(t.endContainer.parentNode.tagName.toLowerCase())?(e.splice(n,1),n--):3===e[n].nodeType&&(e[n]=e[n].parentNode);return e},e.prototype.getSelectionNodeCollection=function(e){return this.getSelectionNodes(this.getNodeCollection(e))},e.prototype.getSelectionNodeCollectionBr=function(e){return this.getSelectionNodesBr(this.getNodeCollection(e))},e.prototype.getSelectionNodes=function(e){e=e.reverse();for(var t=new RegExp("​","g"),n=0;n<e.length;n++)(3!==e[n].nodeType||""===e[n].textContent.trim()||1===e[n].textContent.length&&e[n].textContent.match(t))&&(e.splice(n,1),n--);return e.reverse()},e.prototype.getSelectionNodesBr=function(e){e=e.reverse();for(var t=0;t<e.length;t++)"BR"===e[t].nodeName||3===e[t].nodeType&&(""!==e[t].textContent.trim()||e[t].textContent.includes(" "))||(e.splice(t,1),t--);return e.reverse()},e.prototype.getInsertNodeCollection=function(e){return this.getInsertNodes(this.getNodeCollection(e))},e.prototype.getInsertNodes=function(e){e=e.reverse();for(var t=0;t<e.length;t++)(0!==e[t].childNodes.length&&3!==e[t].nodeType||3===e[t].nodeType&&""===e[t].textContent)&&(e.splice(t,1),t--);return e.reverse()},e.prototype.getNodeArray=function(e,t,n){var i=[];for(t?this.startNodeName=[]:this.endNodeName=[];e!==(n||this.rootNode)&&!sf.base.isNullOrUndefined(e);null)t?this.startNodeName.push(e.nodeName.toLowerCase()):this.endNodeName.push(e.nodeName.toLowerCase()),i.push(this.getIndex(e)),e=e.parentNode;return i},e.prototype.setRangePoint=function(e,t,n,i){for(var s=this.rootNode,r=n.length,o=i;r--;null)s=s&&s.childNodes[n[r]];return s&&o>=0&&"html"!==s.nodeName&&(3===s.nodeType&&"&nbsp;"===s.nodeValue.replace(/\u00a0/g,"&nbsp;")?o=s.textContent.length:3!==s.nodeType&&(o=Math.min(o,s.childNodes.length)),e[t?"setStart":"setEnd"](s,o)),e},e.prototype.restore=function(){var e=this.range.cloneRange();return e=this.setRangePoint(e,!0,this.startContainer,this.startOffset),e=this.setRangePoint(e,!1,this.endContainer,this.endOffset),this.selectRange(this.rootNode,e),e},e.prototype.selectRange=function(e,t){this.setRange(e,t),this.save(t,e)},e.prototype.setRange=function(e,t){var n=this.get(e);n.removeAllRanges(),n.addRange(t)},e.prototype.setSelectionText=function(e,t,n,i,s){var r=e.createRange();r.setStart(t,i),r.setEnd(n,s),this.setRange(e,r)},e.prototype.setSelectionContents=function(e,t){var n=e.createRange();n.selectNode(t),this.setRange(e,n)},e.prototype.setSelectionNode=function(e,t){var n=e.createRange();n.selectNodeContents(t),this.setRange(e,n)},e.prototype.getSelectedNodes=function(e){return this.getNodeCollection(this.getRange(e))},e.prototype.Clear=function(e){this.get(e).removeAllRanges()},e.prototype.insertParentNode=function(e,t,n){n.surroundContents(t),this.selectRange(e,n)},e.prototype.setCursorPoint=function(e,t,n){var i=e.createRange(),s=e.defaultView.getSelection();i.setStart(t,n),i.collapse(!0),s.removeAllRanges(),s.addRange(i)},e.prototype.isTableOrImageStart=function(e){var t=e.startContainer,n=e.startOffset,i=t.childNodes[n],s=e.collapsed&&1===t.nodeType&&t.isContentEditable&&i&&["TABLE"].indexOf(i.nodeName)>-1;return s?{start:s,startNodeName:i.nodeName,startNode:i}:{start:!1,startNodeName:"",startNode:void 0}},e.prototype.isTableOrImageEnd=function(e){var t=e.startContainer,n=e.startOffset,i=t.childNodes[n-1],s=e.collapsed&&1===t.nodeType&&t.isContentEditable&&i&&["TABLE"].indexOf(i.nodeName)>-1;return s?{end:s,endNodeName:i.nodeName,endNode:i}:{end:!1,endNodeName:"",endNode:void 0}},e.prototype.processedTableImageCursor=function(e){var t=this.isTableOrImageStart(e),n=t.start,i=t.startNodeName,s=t.startNode,r=this.isTableOrImageEnd(e);return{start:n,startName:i,end:r.end,endName:r.endNodeName,startNode:s,endNode:r.endNode}},e.prototype.findLastTextPosition=function(e){if(e.nodeType===Node.TEXT_NODE)return{node:e,offset:e.textContent?e.textContent.length:0};if("BR"===e.nodeName)return{node:e,offset:0};for(var t=e.childNodes.length-1;t>=0;t--){var n=this.findLastTextPosition(e.childNodes[t]);if(n)return n}return null},e.prototype.findFirstTextNode=function(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var t=0;t<e.childNodes.length;t++){var n=this.findFirstTextNode(e.childNodes[t]);if(!sf.base.isNullOrUndefined(n))return n}return null},e.prototype.findFirstContentNode=function(e){if(e.nodeType===Node.TEXT_NODE)return{node:e,position:0};if("BR"===e.nodeName)return{node:e,position:0};for(var t=0;t<e.childNodes.length;t++){var n=this.findFirstContentNode(e.childNodes[t]);if(null!==n.node)return n}return{node:e,position:0}},e}(),tt=function(){function e(e){this.parent=e,this.drop=this.dragDrop.bind(this),this.enter=this.dragEnter.bind(this),this.start=this.dragStart.bind(this),this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(ue,this.linkCommand,this),this.parent.observer.on(v,this.destroy,this);var e=this.parent.editableElement;e&&(sf.base.EventHandler.add(e,"drop",this.drop),sf.base.EventHandler.add(e,"dragenter",this.enter),sf.base.EventHandler.add(e,"dragover",this.start))},e.prototype.removeEventListener=function(){this.parent.observer.off(ue,this.linkCommand),this.parent.observer.off(v,this.destroy);var e=this.parent.editableElement;e&&(sf.base.EventHandler.remove(e,"drop",this.drop),sf.base.EventHandler.remove(e,"dragenter",this.enter),sf.base.EventHandler.remove(e,"dragover",this.start)),this.drop=null,this.enter=null,this.start=null},e.prototype.linkCommand=function(e){switch(e.value.toString().toLocaleLowerCase()){case"createlink":case"editlink":this.createLink(e);break;case"openlink":this.openLink(e);break;case"removelink":this.removeLink(e)}},e.prototype.dragStart=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);if(t){var n,i=t.startContainer,s=t.endContainer,r=null,o=null;if(i.nodeType===Node.ELEMENT_NODE)r=i.closest("a");else(n=i.parentElement)&&(r=n.closest("a"));if(s.nodeType===Node.ELEMENT_NODE)o=s.closest("a");else(n=s.parentElement)&&(o=n.closest("a"));("A"===e.target.nodeName||r||o)&&(this.dragSelectionRange=t.cloneRange())}},e.prototype.dragEnter=function(e){e.dataTransfer.dropEffect="copy",e.preventDefault()},e.prototype.dragDrop=function(e){var t=e.dataTransfer.getData("text/html");if((!t||!/^<img[\s\S]*?>$/i.test(t.trim()))&&this.dragSelectionRange){e.preventDefault();var n=void 0;if(this.parent.currentDocument.caretRangeFromPoint?n=this.parent.currentDocument.caretRangeFromPoint(e.clientX,e.clientY):e.rangeParent&&(n=this.parent.currentDocument.createRange()).setStart(e.rangeParent,e.rangeOffset),t){var i=null;if(n.startContainer&&n.startContainer.nodeType===Node.TEXT_NODE?i=n.startContainer.parentNode:n.startContainer instanceof HTMLAnchorElement&&(i=n.startContainer),i)i&&"A"!==i.nodeName&&(i=i.closest("a"));else if(n.collapsed){var s=n.startContainer;if(s){var r=s.closest("a");r&&(i=r)}}if(i){var o=sf.base.createElement("div",{innerHTML:t});o.querySelectorAll("a").forEach((function(e){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.remove()})),t=o.innerHTML}n.deleteContents();var a=n.createContextualFragment(t);a.querySelectorAll("a").forEach((function(e){e.style.textDecoration=""})),this.dragSelectionRange&&(this.dragSelectionRange.deleteContents(),this.normalizeEmptyLinks(),this.dragSelectionRange=null),this.parent.nodeSelection.setRange(this.parent.currentDocument,n),Pe.Insert(this.parent.currentDocument,a,this.parent.editableElement,!0),i&&i.normalize()}}},e.prototype.normalizeEmptyLinks=function(){if(this.dragSelectionRange){var e=this.dragSelectionRange.commonAncestorContainer,t=e.nodeType===Node.TEXT_NODE?e.parentElement:e;if(t&&-1===fe.indexOf(t.nodeName.toLocaleLowerCase())&&(t=this.parent.domNode.getImmediateBlockNode(t)),t)t.querySelectorAll("a:empty").forEach((function(e){""!==e.textContent.trim()||e.querySelector("img")||e.querySelector("video")||e.parentNode&&e.parentNode.removeChild(e)}))}},e.prototype.createLink=function(e){var t=!sf.base.isNullOrUndefined(e.item.selectParent)&&1===e.item.selectParent.length&&sf.base.closest(e.item.selectParent[0],"a");if(t=sf.base.isNullOrUndefined(t)?sf.base.isNullOrUndefined(e.item.selectParent)||1!==e.item.selectParent.length?null:e.item.selectParent[0]:t,sf.base.isNullOrUndefined(t)||"A"!==t.tagName){var n=new et(this.parent.editableElement),i=n.getRange(this.parent.currentDocument);"#text"!==i.endContainer.nodeName||i.startContainer.textContent.length!==i.endOffset+1||" "!==i.endContainer.textContent.charAt(i.endOffset)||sf.base.isNullOrUndefined(i.endContainer.nextSibling)||"A"!==i.endContainer.nextSibling.nodeName||(n.setSelectionText(this.parent.currentDocument,i.startContainer,i.endContainer,i.startOffset,i.endOffset+1),i=n.getRange(this.parent.currentDocument));var s=!!sf.base.isNullOrUndefined(e.item.text)||e.item.text.replace(/ /g,"").localeCompare(i.toString().replace(/\n/g," ").replace(/ /g,""))<0;if(e.event&&"keydown"===e.event.type&&(32===e.event.keyCode||13===e.event.keyCode)||"Paste"===e.item.action||i.collapsed||s){var r=this.createAchorNode(e);r.innerText=""===e.item.text?e.item.url:e.item.text;var o=r.innerText.replace(/  +/g,(function(e){return" ".repeat(e.length)}));r.innerText=o,e.item.selection.restore(),Pe.Insert(this.parent.currentDocument,r,this.parent.editableElement),sf.base.isNullOrUndefined(r.parentElement)||"LI"!==r.parentElement.nodeName||sf.base.isNullOrUndefined(r.parentNode.childNodes)||""!==r.parentNode.childNodes[0].textContent||r.parentNode.removeChild(r.parentNode.childNodes[0]);if(e.event&&"keydown"===e.event.type&&(32===e.event.keyCode||13===e.event.keyCode||/[^\w\s\\/\\.\\:]/g.test(e.event.key))){var a=e.item.selection.range.startContainer;a.textContent=this.removeText(a.textContent,e.item.text)}else{h="Paste"===e.item.action?r.childNodes[0].textContent.length:0;e.item.selection.setSelectionText(this.parent.currentDocument,r.childNodes[0],r.childNodes[0],h,r.childNodes[0].textContent.length)}}else this.handleLinkFormat(e)}else{var l=t,d="";if(sf.base.isNullOrUndefined(e.item.url)||l.setAttribute("href",e.item.url),sf.base.isNullOrUndefined(e.item.title)||l.setAttribute("title",e.item.title),!sf.base.isNullOrUndefined(e.item.text)&&""!==e.item.text){d=l.innerText;var c=document.createTreeWalker(l,NodeFilter.SHOW_TEXT,null).nextNode();c&&(c.textContent=e.item.text)}if(sf.base.isNullOrUndefined(e.item.target)?(l.removeAttribute("target"),l.removeAttribute("aria-label")):(l.setAttribute("target",e.item.target),l.setAttribute("aria-label",e.item.ariaLabel)),d===e.item.text)e.item.selection.setSelectionText(this.parent.currentDocument,l,l,1,1),e.item.selection.restore();else{var h="Paste"===e.item.action?l.childNodes[0].textContent.length:0,p="#text"===l.firstChild.nodeName?l.childNodes[0].textContent.length:l.childNodes.length;e.item.selection.setSelectionText(this.parent.currentDocument,l.childNodes[0],l.childNodes[0],h,p)}}e.callBack&&e.callBack({requestType:"Links",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.createAchorNode=function(e){var t=sf.base.createElement("a",{className:"e-rte-anchor",attrs:{href:e.item.url,title:sf.base.isNullOrUndefined(e.item.title)||""===e.item.title?e.item.url:e.item.title}});return sf.base.isNullOrUndefined(e.item.target)||t.setAttribute("target",e.item.target),sf.base.isNullOrUndefined(e.item.ariaLabel)||t.setAttribute("aria-label",e.item.ariaLabel),t},e.prototype.removeText=function(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)n[i]===t&&(n.splice(i,1),i--);return n.join(" ")+" "},e.prototype.openLink=function(e){document.defaultView.open(e.item.url,e.item.target),this.callBack(e)},e.prototype.removeLink=function(e){var t=this.parent.domNode.blockNodes();if(t.length<2){this.parent.domNode.setMarker(e.item.selection);for(var n=sf.base.closest(e.item.selectParent[0],"a"),i=n||e.item.selectParent[0],s=i.parentNode,r=[];i.firstChild&&s;null)r.push(s.insertBefore(i.firstChild,i));s.removeChild(i),r&&1===r.length&&(e.item.selection.startContainer=e.item.selection.getNodeArray(r[r.length-1],!0),e.item.selection.endContainer=e.item.selection.startContainer,e.item.selection.startOffset=0,e.item.selection.endOffset=r[r.length-1].textContent.length),e.item.selection=this.parent.domNode.saveMarker(e.item.selection)}else for(var o=0;o<t.length;o++)for(var a=t[o].querySelectorAll("a"),l=0;l<a.length;l++)this.parent.currentDocument.getSelection().containsNode(a[l],!0)&&(a[l].outerHTML=a[l].innerHTML);e.item.selection.restore(),this.callBack(e)},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.handleLinkFormat=function(e){var t=this.parent.editableElement,n=this.parent.nodeSelection.getRange(t.ownerDocument),i=this.parent.currentDocument.getSelection();if(i&&0!==i.rangeCount){var s,r,o,a=new He(t),l="BR"===e.enterAction?[this.parent.editableElement]:a.getBlockNode(),d=[],c=["IMG","AUDIO","VIDEO"];if(1===n.startContainer.nodeType)s=(o=n.startContainer.childNodes[n.startOffset])&&c.indexOf(o.nodeName)>-1?o:null;if(1===n.endContainer.nodeType)r=(o=n.endContainer.childNodes[n.endContainer.childNodes.length>1?n.endOffset-1:n.endOffset])&&c.indexOf(o.nodeName)>-1?o:null;for(var h={startContainer:n.startContainer,endContainer:n.endContainer,endOffset:n.endOffset,startOffset:n.startOffset,collapsed:n.collapsed},p=0;p<l.length;p++){var u=l[p];if(this.unwrapLink(u),u.normalize(),this.applyLinkToBlockNode(u,e,d),l.length<=1&&d.length<=1){var f=d[d.length-1].textContent.trim(),m=e.item.text.trim();f!==m&&(d[d.length-1].textContent=m)}}if(0!==d.length)if(s||r){var g=s?s.parentElement:h.startContainer,b=r?r.parentElement:h.endContainer,v=s?0:h.startOffset,y=h.endOffset;this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,g,b,v,y)}else 1===d.length?this.parent.nodeSelection.setSelectionContents(this.parent.currentDocument,d[0]):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,d[0],d[d.length-1],0,d[d.length-1].textContent.length)}},e.prototype.applyLinkToBlockNode=function(e,t,n){for(var i=new He(this.parent.editableElement),s=i.getTextNodes(e),r=e.querySelectorAll("*"),o=this.parent.nodeSelection.getRange(this.parent.currentDocument),a=[],l=0===r.length,d=0;d<s.length;d++){var c=void 0,h=s[d],p=(new y).getFormattedNode(h,"fontcolor",e);if(l)c=this.getSplitNode(h,o),n.push(De.Wrap(c,this.createAchorNode(t)));else if(p)a.length>0&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction),c=this.getSplitNode(p,o),o.intersectsNode(p)&&(De.Wrap(p.firstChild,this.createAchorNode(t)),n.push(h));else{var u="#text"===o.startContainer.nodeName&&o.startContainer===h&&0!==o.startOffset,f="#text"===o.endContainer.nodeName&&o.endContainer===h&&o.endOffset!==o.startContainer.textContent.length;if(d>0)("BR"===t.enterAction?this.parent.editableElement:i.getParentBlockNode(h))!==e&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction);if(u||f){var m=i.getTopMostNode(h);c=this.getSplitNode(m,o),n.push(h),a.push(h)}else n.push(h),a.push(h);d===s.length-1&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction)}}},e.prototype.unwrapLink=function(e){var t=e.querySelectorAll("a");if(0!==t.length){var n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=n.startContainer,s=n.endContainer,r=n.startOffset,o=n.endOffset;this.parent.nodeSelection.save(n,this.parent.currentDocument);for(var a=this.parent.nodeSelection.get(this.parent.currentDocument),l=0;l<t.length;l++)if(n.intersectsNode(t[l]))if(a.containsNode(t[l],!1))De.unwrap(t[l]);else{var d=t[l]&&t[l].textContent;d&&n.startContainer.textContent&&-1!==d.indexOf(n.startContainer.textContent)&&(r=0);var c=this.getSplitNode(t[l],n);De.unwrap(c)}n.setStart(i,r),n.setEnd(s,o)}},e.prototype.replaceElementsWithAnchor=function(e,t,n){for(var i=new He(this.parent.editableElement),s=[],r=0;r<e.length;r++){var o=e[r];s.push(i.getTopMostNode(o))}e.length=0;var a,l=s[0],d=t.cloneNode(!0);l.parentElement.insertBefore(t,l);for(var c=0;c<s.length;c++){var h=s[c];if("BR"===n)if(0===c)t.appendChild(h);else if(sf.base.isNullOrUndefined(a)){var p=d.cloneNode(!0);h.parentElement.insertBefore(p,h),p.appendChild(h),a=p}else{var u=h.nextSibling&&"BR"===h.nextSibling.nodeName||i.isBlockNode(h.nextSibling),f=h.previousSibling&&"BR"===h.previousSibling.nodeName||i.isBlockNode(h.previousSibling),m=this.parent.editableElement.lastChild===h,g=i.isBlockNode(h.parentElement);if(u&&f){p=d.cloneNode(!0);h.parentElement.insertBefore(p,h),p.appendChild(h),a=p}else if(m){p=d.cloneNode(!0);h.parentElement.insertBefore(p,h),p.appendChild(h)}else if(g){p=d.cloneNode(!0);h.parentElement.insertBefore(p,h),p.appendChild(h),a=p}else a.appendChild(h)}else t.appendChild(h)}},e.prototype.getSplitNode=function(e,t){var n=new Ie;return t.collapsed?n.SplitNode(t,e,!0):n.GetSpliceNode(t,e)},e}(),nt=function(){return(nt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},it=function(){function e(e){this.parent=e,this.rteId=this.parent.element.id,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on("unLink",this.removeLink,this),this.parent.observer.on("insertLink",this.linkDialog,this),this.parent.observer.on("link-toolbar-action",this.onToolbarAction,this),this.parent.observer.on("iframe-click",this.onIframeMouseDown,this),this.parent.observer.on(c,this.editAreaClickHandler,this),this.parent.observer.on("insertCompleted",this.showLinkQuickToolbar,this),this.parent.observer.on(s,this.bindOnEnd,this),this.parent.observer.on("selectionChangeMouseUp",this.editAreaClickHandler,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(i,this.destroy),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off("unLink",this.removeLink),this.parent.observer.off("insertLink",this.linkDialog),this.parent.observer.off("link-toolbar-action",this.onToolbarAction),this.parent.observer.off("iframe-click",this.onIframeMouseDown),this.parent.observer.off(c,this.editAreaClickHandler),this.parent.observer.off("insertCompleted",this.showLinkQuickToolbar),this.parent.observer.off(s,this.bindOnEnd),this.parent.observer.off("selectionChangeMouseUp",this.editAreaClickHandler),sf.base.EventHandler.remove(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick)},e.prototype.bindOnEnd=function(){this.parent.formatter.editorManager.linkObj||(this.parent.formatter.editorManager.linkObj=new tt(this.parent.formatter.editorManager))},e.prototype.linkDialog=function(e,t){var n="HTML"===this.parent.editorMode?e.selection.getRange(this.parent.getDocument()).toString():e.text;if(!sf.base.isNullOrUndefined(t)&&(!sf.base.isNullOrUndefined(e.selectParent)&&e.selectParent.length>1||!sf.base.isNullOrUndefined(e.selectNode)&&e.selectNode.length>1)&&(t.text=n),"HTML"===this.parent.editorMode&&(this.hasAnchorNodePresent(e.selectParent)||this.hasAnchorNodePresent(e.selectNode))&&sf.base.isNullOrUndefined(t))this.editLink(e);else{this.selectionObj={selection:e.selection,selectParent:e.selectParent,args:e.args};var i={url:"",text:"",title:"",target:!0};sf.base.isNullOrUndefined(t)||(i={url:t.url,text:t.text,title:t.title,target:""!==t.target}),("HTML"===this.parent.editorMode&&sf.base.isNullOrUndefined(t)&&(!sf.base.isNullOrUndefined(n)&&""!==n&&0===e.selection.range.startOffset||e.selection.range.startOffset!==e.selection.range.endOffset)||"Markdown"===e.module)&&(i.text=n),sf.base.EventHandler.add(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick,this),sf.base.isNullOrUndefined(sf.base.select(".e-rte-link-dialog",this.parent.element))?this.parent.dotNetRef.invokeMethodAsync("ShowLinkDialog",i,sf.base.isNullOrUndefined(t)?null:"Edit"):this.parent.dotNetRef.invokeMethodAsync("CloseLinkDialog",null),this.quickToolObj&&(this.hideLinkQuickToolbar(),this.quickToolObj.hideInlineQTBar(),sf.base.isNullOrUndefined(this.quickToolObj.textQTBar)||sf.base.isNullOrUndefined(this.quickToolObj.textQTBar.element)||!this.quickToolObj.textQTBar.element.classList.contains("e-popup-open")||this.quickToolObj.hideTextQTBar())}},e.prototype.hasAnchorNodePresent=function(e){return!sf.base.isNullOrUndefined(e)&&e.length>0&&e.some((function(e){return e&&null!==sf.base.closest(e,"a")}))},e.prototype.insertLink=function(e){var t,n=this,i=e.url.trim(),s=e.text;"HTML"===this.parent.editorMode&&(t=e.title);var r=e.target?"_blank":null,o=e.target?this.parent.localeData.linkAriaLabel:null;if("Markdown"===this.parent.editorMode&&""===i&&(i="https://"),""!==i){if(s="Markdown"===this.parent.editorMode?""!==s.trim()?s:"":""===s.trim()?i:s,this.isUrl(i)?this.checkUrl(!1):i=this.parent.enableAutoUrl||i.indexOf("https")>-1?i:"https://"+i,"HTML"===this.parent.editorMode&&sf.base.isNullOrUndefined(sf.base.closest(this.selectionObj.selection.range.startContainer.parentNode,"#"+this.parent.getPanel().id))){this.parent.getEditPanel().focus(),sf.base.Browser.isIE&&this.parent.iframeSettings.enable&&this.selectionObj.selection.restore();var a=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());this.selectionObj.selection=this.parent.formatter.editorManager.nodeSelection.save(a,this.parent.getDocument()),this.selectionObj.selectParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(a)}var l={url:i,text:s,title:t,target:r,ariaLabel:o,selection:this.selectionObj.selection,selectParent:this.selectionObj.selectParent};this.parent.dotNetRef.invokeMethodAsync("CloseLinkDialog",null).then((function(){var e=n.parent.element.ownerDocument.querySelector("#"+n.rteId+"_rtelink");if(sf.base.isNullOrUndefined(e)){C()&&n.parent.iframeSettings.enable&&sf.base.select("iframe",n.parent.element).contentWindow.focus(),"HTML"===n.parent.editorMode&&n.selectionObj.selection.restore(),0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData();var t=void 0;if(sf.base.isNullOrUndefined(n.selectionObj.args)||"KeyK"!==n.selectionObj.args.code)t=n.selectionObj.args;else{var i=n.selectionObj.args,s={item:{command:"Links",subCommand:"CreateLink"},originalEvent:i=nt(nt({},i),{target:null})};sf.base.extend(n.selectionObj.args,s,!0),t=s}n.parent.formatter.process(n.parent,t,!sf.base.isNullOrUndefined(n.selectionObj.args)&&n.selectionObj.args.originalEvent,l),n.parent.getEditPanel().focus()}}))}else this.checkUrl(!0)},e.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},e.prototype.checkUrl=function(e){var t=sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-link-dialog .e-rte-linkurl"))?document.querySelector(".e-rte-elements.e-rte-link-dialog .e-rte-linkurl"):this.parent.element.querySelector(".e-rte-link-dialog .e-rte-linkurl");e?(sf.base.addClass([t],"e-error"),t.setSelectionRange(0,t.value.length),t.focus()):sf.base.removeClass([t],"e-error")},e.prototype.cancelDialog=function(){C()?this.selectionObj.selection.restore():this.parent.getEditPanel().focus()},e.prototype.linkDialogClosed=function(){"HTML"===this.parent.editorMode?this.selectionObj.selection.restore():this.parent.formatter.editorManager.markdownSelection.restore(this.parent.getEditPanel())},e.prototype.getAnchorNode=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],s=sf.base.closest(i,"a");if(s)return s}return e[0]},e.prototype.openLink=function(e){var t=this.getAnchorNode(e.selectParent);if(t.classList.contains("e-rte-anchor")||"A"===t.tagName){var n=this.parent.htmlEditorModule.sanitizeHelper(t.outerHTML),i=document.createElement("div");i.innerHTML=n,this.parent.formatter.process(this.parent,e.args,e.args,{url:i.firstChild.href,text:t.innerText,target:""===t.target?"_self":"_blank",selectNode:e.selectNode,subCommand:e.args.item.subCommand}),i.remove()}},e.prototype.editLink=function(e){var t=this.getAnchorNode(e.selectNode),n=this.getAnchorNode(e.selectParent);if((n="A"===t.nodeName?t:n).classList.contains("e-rte-anchor")||"A"===n.tagName){var i={url:n.getAttribute("href"),text:n.innerText,title:n.title,target:n.target};this.linkDialog(e,i)}},e.prototype.removeLink=function(e){0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData();var t=this.getAnchorNode(e.selectParent);this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,selectParent:e.selectParent,selection:e.selection,text:t.innerText,subCommand:e.args.item.subCommand}),C()&&this.parent.iframeSettings.enable?sf.base.select("iframe",this.parent.element).contentWindow.focus():this.parent.getEditPanel().focus(),this.hideLinkQuickToolbar()},e.prototype.onToolbarAction=function(e){switch(e.args.item.subCommand){case"OpenLink":this.openLink(e);break;case"EditLink":this.editLink(e);break;case"RemoveLink":this.removeLink(e)}},e.prototype.editAreaClickHandler=function(e){if(this.parent.readonly)this.hideLinkQuickToolbar();else{var t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick;if(!(2===t.which||n&&1===t.which||!n&&3===t.which)&&"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule){var i=t.target,s=i&&("HTML"===i.nodeName||"#document"===i.nodeName),r=!(i&&"#text"!==i.nodeName&&"#document"!==i.nodeName&&"HTML"!==i.nodeName&&i.closest(".e-rte-elements"));if(s||!this.parent.inputElement.contains(i)&&r)i=(a=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument())).commonAncestorContainer.parentElement;if("A"===(i=this.getAnchorNode([i])).nodeName&&i.childNodes.length>0&&"IMG"!==i.childNodes[0].nodeName&&"IMG"!==e.args.target.nodeName)if(!1===e.args.ctrlKey)this.showLinkQuickToolbar({args:t,isNotify:!1,type:"Links",elements:[t.target]});else{var o=this.parent.formatter.editorManager.nodeSelection,a=o.getRange(this.parent.getDocument()),l={args:{item:{subCommand:"OpenLink",command:"Links",name:""},originalEvent:e.args},selectNode:o.getNodeCollection(a),selectParent:o.getParentNodeCollection(a),selection:o.save(a,this.parent.getDocument())};this.openLink(l)}else this.hideLinkQuickToolbar()}}},e.prototype.showLinkQuickToolbar=function(e){var t=this;if("enter"!==e.args.action&&"space"!==e.args.action){if("Links"!==e.type||sf.base.isNullOrUndefined(this.parent.quickToolbarModule))return;this.quickToolObj=this.parent.quickToolbarModule;var n,i=this.parent.element.getBoundingClientRect().top,s=this.parent.element.getBoundingClientRect().left,r=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),o=this.parent.getToolbarElement(),a=o?o.offsetHeight+this.parent.toolbarModule.getExpandTBarPopHeight():0;if([].forEach.call(e.elements,(function(e,t){0===t&&(n="#text"===e.nodeName?e.parentNode:e)})),e.isNotify){var l=n.getBoundingClientRect(),d=l.top,c=l.left,h=d-i;this.parent.iframeSettings.enable?s+c:c,window.scrollY+(this.parent.iframeSettings.enable?i+a+d:i+h),this.linkQTPopupTime=setTimeout((function(){t.quickToolObj.showLinkQTBar(r.endContainer,e.args)}),400)}else{var p=void 0;p=e.args.touches?e.args.changedTouches[0]:p=e.args,this.parent.iframeSettings.enable?window.scrollX+s+p.clientX:p.pageX,this.parent.iframeSettings.enable?window.scrollY+i+a+p.clientY:p.pageY,this.quickToolObj.showLinkQTBar(r.endContainer,e.args)}}},e.prototype.hideLinkQuickToolbar=function(){this.quickToolObj&&this.quickToolObj.hideLinkQTBar()},e.prototype.showDialog=function(e,t){if(e&&this.parent.getEditPanel().focus(),"HTML"===this.parent.editorMode){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n),o={args:e?{item:{command:"Links",subCommand:"CreateLink"},originalEvent:void 0}:t.args,selectNode:s,selection:i,selectParent:r};this.linkDialog(o)}else{var a=this.parent.getEditPanel();this.parent.formatter.editorManager.markdownSelection.save(a.selectionStart,a.selectionEnd),this.linkDialog({args:{item:{command:"Links",subCommand:"Link"},originalEvent:e?void 0:t.args},member:"link",text:this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.getEditPanel()),module:"Markdown",name:"insertLink"})}},e.prototype.onKeyDown=function(e){var t=e.args;switch(t.action){case"escape":this.parent.dotNetRef.invokeMethodAsync("CloseLinkDialog",null);break;case"insert-link":this.showDialog(!1,e),t.preventDefault()}},e.prototype.onDocumentClick=function(e){var t=e.target,n="#"+this.rteId+"_rtelink",i=this.parent.getToolbarElement(),s="#"+this.rteId+"_toolbar_CreateLink",r=this.parent.element.querySelector(n),o=!sf.base.isNullOrUndefined(document.querySelector(".e-rte-link-dialog"))&&document.querySelector(".e-rte-link-dialog").classList.contains("e-rte-elements");sf.base.isNullOrUndefined(r)&&!o||!(!sf.base.closest(t,n)&&this.parent.toolbarSettings.enable&&i&&!i.contains(e.target)||(i&&i.contains(e.target)||this.parent.inlineMode.enable&&!sf.base.closest(t,n))&&!sf.base.closest(t,s)&&!t.querySelector(s))||(this.parent.dotNetRef.invokeMethodAsync("CloseLinkDialog","Outside Click"),sf.base.EventHandler.remove(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick),this.parent.isBlur=!0,sf.base.Browser.isIE&&ee(this.parent.element,"focusout"))},e.prototype.onIframeMouseDown=function(){this.parent.dotNetRef.invokeMethodAsync("CloseLinkDialog",null)},e.prototype.destroy=function(){sf.base.isNullOrUndefined(this.linkQTPopupTime)||(clearTimeout(this.linkQTPopupTime),this.linkQTPopupTime=null),this.removeEventListener()},e}(),st=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(de,this.imageCommand,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(de,this.imageCommand),this.parent.observer.off(v,this.destroy)},e.prototype.imageCommand=function(e){switch(e.value.toString().toLowerCase()){case"image":case"replace":this.createImage(e);break;case"insertlink":this.insertImageLink(e);break;case"openimagelink":this.openImageLink(e);break;case"editimagelink":this.editImageLink(e);break;case"removeimagelink":this.removeImageLink(e);break;case"remove":this.removeImage(e);break;case"alttext":this.insertAltTextImage(e);break;case"dimension":this.imageDimension(e);break;case"caption":this.imageCaption(e);break;case"justifyleft":this.imageJustifyLeft(e);break;case"justifycenter":this.imageJustifyCenter(e);break;case"justifyright":this.imageJustifyRight(e);break;case"inline":this.imageInline(e);break;case"break":this.imageBreak(e)}},e.prototype.createImage=function(e){var t=this,n=!1;if(e.item.url=sf.base.isNullOrUndefined(e.item.url)||"undefined"===e.item.url?e.item.src:e.item.url,sf.base.isNullOrUndefined(e.item.selectParent)||"IMG"!==e.item.selectParent[0].tagName){var i=sf.base.createElement("img");this.setStyle(i,e),sf.base.isNullOrUndefined(e.item.selection)||e.item.selection.restore(),sf.base.isNullOrUndefined(e.selector)||"pasteCleanupModule"!==e.selector?Pe.Insert(this.parent.currentDocument,i,this.parent.editableElement):sf.base.isNullOrUndefined(this.parent.currentDocument)||e.callBack({requestType:"Images",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:[i]})}else{var s=e.item.selectParent[0];n=!0,this.setStyle(s,e,n)}if(e.callBack&&(sf.base.isNullOrUndefined(e.selector)||!sf.base.isNullOrUndefined(e.selector)&&"pasteCleanupModule"!==e.selector)){var r=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],o="Replace"===e.value||n?e.item.selectParent[0]:sf.base.Browser.isIE?r.previousSibling:r.previousElementSibling,a=function(){if(!sf.base.isNullOrUndefined(t.parent.currentDocument)){t.parent.userAgentData.isSafari()&&E(t.parent.currentDocument,t.parent.editableElement);var n=o.getAttribute("width"),i=o.getAttribute("height");(sf.base.isNullOrUndefined(n)||"auto"===n)&&o.setAttribute("width",o.offsetWidth.toString()),(sf.base.isNullOrUndefined(i)||"auto"===i)&&o.setAttribute("height",o.offsetHeight.toString()),e.callBack({requestType:"Replace"===e.value?(e.item.subCommand="Replace","Replace"):"Images",editorMode:"HTML",event:e.event,range:t.parent.nodeSelection.getRange(t.parent.currentDocument),elements:[o]})}o.removeEventListener("load",a)};o.addEventListener("load",a)}},e.prototype.setStyle=function(e,t,n){var i;if(sf.base.isNullOrUndefined(t.item.url)||e.setAttribute("src",t.item.url),n)for(var s={"e-imgcenter":"e-imgcenter","e-imgright":"e-imgright","e-imgleft":"e-imgleft"},r=e.classList,o=0;o<r.length;o++)sf.base.isNullOrUndefined(s[r[o]])||(i=s[r[o]]);e.setAttribute("class","e-rte-image"+(sf.base.isNullOrUndefined(t.item.cssClass)?"":" "+t.item.cssClass)+(sf.base.isNullOrUndefined(i)?"":" "+i)),sf.base.isNullOrUndefined(t.item.altText)||e.setAttribute("alt",t.item.altText.replace(/\.[a-zA-Z0-9]+$/,"")),sf.base.isNullOrUndefined(t.item.width)||sf.base.isNullOrUndefined(t.item.width.width)||e.setAttribute("width",this.calculateStyleValue(t.item.width.width)),sf.base.isNullOrUndefined(t.item.height)||sf.base.isNullOrUndefined(t.item.height.height)||e.setAttribute("height",this.calculateStyleValue(t.item.height.height)),sf.base.isNullOrUndefined(t.item.width)||sf.base.isNullOrUndefined(t.item.width.minWidth)||(e.style.minWidth=this.calculateStyleValue(t.item.width.minWidth)),sf.base.isNullOrUndefined(t.item.width)||sf.base.isNullOrUndefined(t.item.width.maxWidth)||(e.style.maxWidth=this.calculateStyleValue(t.item.width.maxWidth)),sf.base.isNullOrUndefined(t.item.height)||sf.base.isNullOrUndefined(t.item.height.minHeight)||(e.style.minHeight=this.calculateStyleValue(t.item.height.minHeight)),sf.base.isNullOrUndefined(t.item.height)||sf.base.isNullOrUndefined(t.item.height.maxHeight)||(e.style.maxHeight=this.calculateStyleValue(t.item.height.maxHeight))},e.prototype.calculateStyleValue=function(e){return"string"==typeof e&&(-1!==e.indexOf("px")||-1!==e.indexOf("%")||-1!==e.indexOf("auto"))?e:e+"px"},e.prototype.insertImageLink=function(e){var t=sf.base.createElement("a",{attrs:{href:e.item.url}});e.item.selectNode[0].parentElement.classList.contains("e-img-wrap")&&(e.item.selection.restore(),t.setAttribute("contenteditable","true")),t.appendChild(e.item.selectNode[0]),sf.base.isNullOrUndefined(e.item.target)||t.setAttribute("target",e.item.target),sf.base.isNullOrUndefined(e.item.ariaLabel)||t.setAttribute("aria-label",e.item.ariaLabel),Pe.Insert(this.parent.currentDocument,t,this.parent.editableElement),this.callBack(e)},e.prototype.openImageLink=function(e){document.defaultView.open(e.item.url,e.item.target),this.callBack(e)},e.prototype.removeImageLink=function(e){var t=e.item.selectParent[0];if(t.classList.contains("e-img-caption")){var n=sf.base.select(".e-img-wrap",t),i=sf.base.select(".e-img-inner",t),s=i.cloneNode(!0);sf.base.detach(sf.base.select("a",t)),sf.base.detach(i),n.appendChild(e.item.insertElement),n.appendChild(s)}else sf.base.detach(t),sf.base.Browser.isIE&&e.item.selection&&e.item.selection.restore(),Pe.Insert(this.parent.currentDocument,e.item.insertElement,this.parent.editableElement);this.callBack(e)},e.prototype.editImageLink=function(e){e.item.selectNode[0].parentElement.href=e.item.url,sf.base.isNullOrUndefined(e.item.target)?(e.item.selectNode[0].parentElement.removeAttribute("target"),e.item.selectNode[0].parentElement.removeAttribute("aria-label")):(e.item.selectNode[0].parentElement.target=e.item.target,e.item.selectNode[0].parentElement.setAttribute("aria-label",e.item.ariaLabel)),this.callBack(e)},e.prototype.removeImage=function(e){if(sf.base.closest(e.item.selectNode[0],"a"))"A"!==e.item.selectNode[0].parentElement.nodeName||sf.base.isNullOrUndefined(e.item.selectNode[0].parentElement.innerText)?sf.base.detach(sf.base.closest(e.item.selectNode[0],"a")):sf.base.isNullOrUndefined(sf.base.closest(e.item.selectNode[0],"."+Ze))?sf.base.detach(e.item.selectNode[0]):sf.base.detach(sf.base.closest(e.item.selectNode[0],"."+Ze));else if(sf.base.isNullOrUndefined(sf.base.closest(e.item.selectNode[0],"."+Ze))){var t=e.item.selectNode[0].parentElement;sf.base.detach(e.item.selectNode[0]),0===t.childNodes.length&&t.appendChild(document.createElement("br"))}else sf.base.detach(sf.base.closest(e.item.selectNode[0],"."+Ze));this.callBack(e)},e.prototype.insertAltTextImage=function(e){e.item.selectNode[0].setAttribute("alt",e.item.altText),this.callBack(e)},e.prototype.imageDimension=function(e){var t=e.item.selectNode[0];t.style.height="",t.style.width="","auto"!==e.item.width?t.style.width=sf.base.formatUnit(e.item.width):t.removeAttribute("width"),"auto"!==e.item.height?t.style.height=sf.base.formatUnit(e.item.height):t.removeAttribute("height"),this.callBack(e)},e.prototype.imageCaption=function(e){Pe.Insert(this.parent.currentDocument,e.item.insertElement,this.parent.editableElement),this.callBack(e)},e.prototype.imageJustifyLeft=function(e){var t=e.item.selectNode[0];sf.base.isNullOrUndefined(t)||(t.removeAttribute("class"),sf.base.addClass([t],"e-rte-image"),sf.base.isNullOrUndefined(sf.base.closest(t,"."+Ze))||(sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgright"),sf.base.addClass([sf.base.closest(t,"."+Ze)],"e-imgleft")),"A"===t.parentElement.nodeName?(sf.base.removeClass([t.parentElement],"e-imgright"),sf.base.addClass([t.parentElement],"e-imgleft"),sf.base.addClass([t],"e-imgleft")):null!=t.parentElement.nextElementSibling?(sf.base.addClass([t],"e-imgleft"),t.parentElement.nextElementSibling.style.clear="left"):sf.base.addClass([t],"e-imgleft"),this.callBack(e))},e.prototype.imageJustifyCenter=function(e){var t=e.item.selectNode[0];sf.base.isNullOrUndefined(t)||(t.removeAttribute("class"),sf.base.addClass([t],"e-rte-image"),sf.base.isNullOrUndefined(sf.base.closest(t,"."+Ze))||(sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgleft"),sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgright"),sf.base.addClass([sf.base.closest(t,"."+Ze)],"e-imgcenter")),"A"===t.parentElement.nodeName?(sf.base.removeClass([t.parentElement],"e-imgleft"),sf.base.removeClass([t.parentElement],"e-imgright"),sf.base.addClass([t.parentElement],"e-imgcenter"),sf.base.addClass([t],"e-imgcenter")):sf.base.addClass([t],"e-imgcenter"),this.callBack(e))},e.prototype.imageJustifyRight=function(e){var t=e.item.selectNode[0];sf.base.isNullOrUndefined(t)||(t.removeAttribute("class"),sf.base.addClass([t],"e-rte-image"),sf.base.isNullOrUndefined(sf.base.closest(t,"."+Ze))||(sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgleft"),sf.base.addClass([sf.base.closest(t,"."+Ze)],"e-imgright")),"A"===t.parentElement.nodeName?(sf.base.removeClass([t.parentElement],"e-imgleft"),sf.base.addClass([t.parentElement],"e-imgright"),sf.base.addClass([t],"e-imgright")):null!=t.parentElement.nextElementSibling?(sf.base.addClass([t],"e-imgright"),t.parentElement.nextElementSibling.style.clear="right"):sf.base.addClass([t],"e-imgright"),this.callBack(e))},e.prototype.imageInline=function(e){var t=e.item.selectNode[0];t.removeAttribute("class"),sf.base.addClass([t],"e-rte-image"),sf.base.addClass([t],"e-imginline"),sf.base.isNullOrUndefined(sf.base.closest(t,"."+Ze))||(sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgbreak"),sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgcenter"),sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgleft"),sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgright"),sf.base.addClass([sf.base.closest(t,"."+Ze)],"e-caption-inline")),this.callBack(e)},e.prototype.imageBreak=function(e){var t=e.item.selectNode[0];t.removeAttribute("class"),sf.base.addClass([t],"e-imgbreak"),sf.base.addClass([t],"e-rte-image"),sf.base.isNullOrUndefined(sf.base.closest(t,"."+Ze))||(sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-caption-inline"),sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgcenter"),sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgleft"),sf.base.removeClass([sf.base.closest(t,"."+Ze)],"e-imgright"),sf.base.addClass([sf.base.closest(t,"."+Ze)],"e-imgbreak")),this.callBack(e)},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),rt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(ce,this.audioCommand,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(ce,this.audioCommand),this.parent.observer.off(v,this.destroy)},e.prototype.audioCommand=function(e){var t,n,i=e.value.toString().toLowerCase();switch("inline"!==i&&"break"!==i&&"audioremove"!==i||(n=(t=e.item.selectNode[0]).closest(".e-audio-wrap")),i){case"audio":case"audioreplace":this.createAudio(e);break;case"inline":t.removeAttribute("class"),n.style.display="inline-block",sf.base.addClass([t],["e-rte-audio","e-audio-inline","e-audio-focus"]),this.callBack(e);break;case"break":t.removeAttribute("class"),n.style.display="block",sf.base.addClass([t],["e-audio-break","e-rte-audio","e-audio-focus"]),this.callBack(e);break;case"audioremove":n?sf.base.detach(n):sf.base.detach(t),this.callBack(e)}},e.prototype.createAudio=function(e){var t,n=this,i=!1;if(!sf.base.isNullOrUndefined(e.item.selectParent)&&e.item.selectParent[0].classList&&(e.item.selectParent[0].classList.contains("e-clickelem")||e.item.selectParent[0].classList.contains("e-audio-wrap")||"AUDIO"===e.item.selectParent[0].tagName)){var s=e.item.selectParent[0].querySelector("source");this.setStyle(s,e,s),i=!0}else{t=sf.base.createElement("span",{className:"e-audio-wrap",attrs:{contentEditable:"false",title:sf.base.isNullOrUndefined(e.item.title)?sf.base.isNullOrUndefined(e.item.fileName)?"":e.item.fileName:e.item.title}});var r=sf.base.createElement("audio",{className:"e-rte-audio e-audio-inline",attrs:{controls:""}}),o=sf.base.createElement("source"),a=sf.base.createElement("span",{className:"e-clickelem"});if(this.setStyle(o,e,r),r.appendChild(o),a.appendChild(r),t.appendChild(a),sf.base.isNullOrUndefined(e.item.cssClass)||"e-audio-break"===e.item.cssClass&&(t.style.display="block"),sf.base.isNullOrUndefined(e.item.selection)||e.item.selection.restore(),Pe.Insert(this.parent.currentDocument,t,this.parent.editableElement),!sf.base.isNullOrUndefined(e.item.selection)){var l=e.item.selection.getRange(this.parent.currentDocument),d=document.createTextNode(" "),c=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0];t.parentNode.insertBefore(d,c.nextSibling),e.item.selection.save(l,this.parent.currentDocument)}}if(e.callBack&&(sf.base.isNullOrUndefined(e.selector)||!sf.base.isNullOrUndefined(e.selector)&&"pasteCleanupModule"!==e.selector)){var h=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],p="AudioReplace"===e.value||i?"audio"===e.item.selectParent[0].tagName.toLowerCase()?e.item.selectParent[0]:e.item.selectParent[0].querySelector("audio"):sf.base.Browser.isIE?h:h.querySelector("audio");p.addEventListener("loadeddata",(function(){"AudioReplace"===e.value&&i||sf.base.isNullOrUndefined(n.parent.currentDocument)||(n.parent.userAgentData.isSafari()&&E(n.parent.currentDocument,n.parent.editableElement),e.callBack({requestType:"Audios",editorMode:"HTML",event:e.event,range:n.parent.nodeSelection.getRange(n.parent.currentDocument),elements:[p]}))})),i&&p.load()}},e.prototype.setStyle=function(e,t,n){sf.base.isNullOrUndefined(t.item.url)||e.setAttribute("src",t.item.url);var i=t.item.fileName?t.item.fileName.split(".").pop().toLowerCase():t.item.url?t.item.url.split(".").pop().toLowerCase():"";e.type="opus"===i?"audio/ogg":"m4a"===i?"audio/mp4":t.item.fileName&&t.item.fileName.split(".").length>0?"audio/"+t.item.fileName.split(".")[t.item.fileName.split(".").length-1]:t.item.url&&t.item.url.split(".").length>0?"audio/"+t.item.url.split(".")[t.item.url.split(".").length-1]:"",sf.base.isNullOrUndefined(t.item.cssClass)||"AUDIO"!==n.nodeName||("e-audio-break"===t.item.cssClass?(sf.base.addClass([n],["e-audio-break"]),sf.base.removeClass([n],["e-audio-inline"])):(sf.base.addClass([n],["e-audio-inline"]),sf.base.removeClass([n],["e-audio-break"])))},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),ot=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(he,this.videoCommand,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(he,this.videoCommand),this.parent.observer.off(v,this.destroy)},e.prototype.videoCommand=function(e){var t,n,i,s="",r=e.value.toString().toLowerCase();switch("video"!==r&&"videoreplace"!==r&&(n=(t=e.item.selectNode[0]).closest(".e-embed-video-wrap"),i=t.closest(".e-video-clickelem")),t&&(s=t.classList.contains("e-rte-embed-url")?"e-rte-embed-url":""),r){case"video":case"videoreplace":this.createVideo(e);break;case"videodimension":this.videoDimension(e);break;case"inline":t.removeAttribute("class"),n&&(n.style.display="inline-block"),i&&(t.parentElement.style.cssFloat=""),sf.base.addClass([t],["e-rte-video","e-video-inline","e-video-focus"]),this.callBack(e);break;case"break":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat=""),sf.base.addClass([t],["e-video-break","e-rte-video","e-video-focus"]),this.callBack(e);break;case"justifyleft":t.removeAttribute("class"),n&&(n.style.display="block"),i?t.parentElement.style.cssFloat="left":null!=t.parentElement.nextElementSibling?(sf.base.addClass([t],""===s?["e-rte-video","e-video-left"]:["e-rte-video","e-video-left",s]),t.parentElement.nextElementSibling.style.clear="left"):sf.base.addClass([t],""===s?["e-rte-video","e-video-left"]:["e-rte-video","e-video-left",s]),this.callBack(e);break;case"justifycenter":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat=""),sf.base.addClass([t],""===s?["e-rte-video","e-video-center"]:["e-rte-video","e-video-center",s]),this.callBack(e);break;case"justifyright":t.removeAttribute("class"),n&&(n.style.display="block"),i?t.parentElement.style.cssFloat="right":null!=t.parentElement.nextElementSibling?(sf.base.addClass([t],""===s?["e-rte-video","e-video-right"]:["e-rte-video","e-video-left",s]),t.parentElement.nextElementSibling.style.clear="right"):sf.base.addClass([t],""===s?["e-rte-video","e-video-right"]:["e-rte-video","e-video-right",s]),this.callBack(e);break;case"videoremove":sf.base.detach(t.parentElement),this.callBack(e)}},e.prototype.wrapVideo=function(e){var t,n;if(e.item.isEmbedUrl){t=sf.base.createElement("span",{className:"e-embed-video-wrap",attrs:{contentEditable:"false"}});var i=sf.base.createElement("span",{className:"e-video-clickelem"}),s=sf.base.createElement("template");s.innerHTML=e.item.fileName,i.appendChild(s.content),this.vidElement=n=i.firstElementChild,this.setStyle(n,e,this.vidElement),t.style.display="e-video-inline"===e.item.cssClass?"inline-block":"block",t.appendChild(i)}else t=sf.base.createElement("span",{className:"e-video-wrap",attrs:{contentEditable:"false",title:sf.base.isNullOrUndefined(e.item.title)?sf.base.isNullOrUndefined(e.item.fileName)?"":e.item.fileName:e.item.title}}),this.vidElement=sf.base.createElement("video",{className:"e-rte-video e-video-inline",attrs:{controls:""}}),n=sf.base.createElement("source"),this.setStyle(n,e,this.vidElement),this.vidElement.appendChild(n),t.appendChild(this.vidElement);return t},e.prototype.createVideo=function(e){var t,n=this,i=!1;if("VideoReplace"!==e.value||sf.base.isNullOrUndefined(e.item.selectParent)||"VIDEO"!==e.item.selectParent[0].tagName)if("VideoReplace"===e.value&&!sf.base.isNullOrUndefined(e.item.selectParent)&&sf.base.isNullOrUndefined(e.item.selectParent[0].querySelector("iframe"))&&e.item.selectParent[0].classList&&e.item.selectParent[0].classList.contains("e-video-clickelem"))e.item.selectParent[0].innerHTML=e.item.fileName,this.setStyle(e.item.selectParent[0].firstElementChild,e,e.item.selectParent[0].firstElementChild);else if("VideoReplace"!==e.value||sf.base.isNullOrUndefined(e.item.selectParent)||sf.base.isNullOrUndefined(e.item.selectParent[0].querySelector("iframe"))||e.item.isEmbedUrl){if(e.item.isEmbedUrl)t=this.wrapVideo(e);else{if("VideoReplace"===e.value){var s=e.item.selection.range.startContainer.closest(".e-embed-video-wrap");sf.base.isNullOrUndefined(s)||s.remove()}t=this.wrapVideo(e)}if(sf.base.isNullOrUndefined(e.item.selection)||e.item.selection.restore(),Pe.Insert(this.parent.currentDocument,t,this.parent.editableElement),!sf.base.isNullOrUndefined(e.item.selection)){var r=e.item.selection.getRange(this.parent.currentDocument),o=document.createTextNode(" "),a=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0];t.parentNode.insertBefore(o,a.nextSibling),e.item.selection.save(r,this.parent.currentDocument)}}else{t=this.wrapVideo(e),(l=e.item.selection.range.startContainer).parentNode.replaceChild(t,l)}else if(e.item.isEmbedUrl){var l;t=this.wrapVideo(e),(l=e.item.selection.range.startContainer).parentNode.replaceChild(t,l)}else{var d=e.item.selectParent[0].querySelector("source");this.setStyle(d,e,d),i=!0}if(e.callBack&&(sf.base.isNullOrUndefined(e.selector)||!sf.base.isNullOrUndefined(e.selector)&&"pasteCleanupModule"!==e.selector)){var c,h=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0];"VideoReplace"===e.value||i?e.item.isEmbedUrl?e.item.isEmbedUrl?sf.base.isNullOrUndefined(t)||(c=t.querySelector("iframe")):c=e.item.selectParent[0].querySelector("iframe"):c=e.item.selectParent[0]:c=e.item.isEmbedUrl?h.querySelector("iframe"):"VIDEO"===h.tagName?h:h.lastElementChild,c.addEventListener("IFRAME"!==c.tagName?"loadeddata":"load",(function(){"VideoReplace"===e.value&&i||(e.item.isEmbedUrl&&c&&c.classList.add("e-rte-embed-url"),sf.base.isNullOrUndefined(n.parent.currentDocument)||(n.parent.userAgentData.isSafari()&&E(n.parent.currentDocument,n.parent.editableElement),e.callBack({requestType:"Videos",editorMode:"HTML",event:e.event,range:n.parent.nodeSelection.getRange(n.parent.currentDocument),elements:[c]})))})),i&&c.load(),-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&(this.vidElement.addEventListener("play",(function(){n.editAreaVideoClick(e)})),this.vidElement.addEventListener("pause",(function(){n.editAreaVideoClick(e)})))}},e.prototype.editAreaVideoClick=function(e){e.callBack({requestType:"VideosPlayPause",editorMode:"HTML",event:e.event})},e.prototype.setStyle=function(e,t,n){(""===t.item.url||sf.base.isNullOrUndefined(t.item.url)||!sf.base.isNullOrUndefined(e))&&(e&&e.nodeName&&"iframe"!==e.nodeName.toLowerCase())&&e.setAttribute("src",t.item.url),t.item.isEmbedUrl||(e.type=t.item.fileName&&t.item.fileName.split(".").length>0?"video/"+t.item.fileName.split(".")[t.item.fileName.split(".").length-1]:t.item.url&&t.item.url.split(".").length>0?"video/"+t.item.url.split(".")[t.item.url.split(".").length-1]:""),sf.base.isNullOrUndefined(t.item.width)||sf.base.isNullOrUndefined(t.item.width.width)||n.setAttribute("width",sf.base.formatUnit(t.item.width.width)),sf.base.isNullOrUndefined(t.item.height)||sf.base.isNullOrUndefined(t.item.height.height)||n.setAttribute("height",sf.base.formatUnit(t.item.height.height)),sf.base.isNullOrUndefined(t.item.width)||sf.base.isNullOrUndefined(t.item.width.minWidth)||(n.style.minWidth=sf.base.formatUnit(t.item.width.minWidth)),sf.base.isNullOrUndefined(t.item.width)||sf.base.isNullOrUndefined(t.item.width.maxWidth)||(n.style.maxWidth=sf.base.formatUnit(t.item.width.maxWidth)),sf.base.isNullOrUndefined(t.item.height)||sf.base.isNullOrUndefined(t.item.height.minHeight)||(n.style.minHeight=sf.base.formatUnit(t.item.height.minHeight)),sf.base.isNullOrUndefined(t.item.height)||sf.base.isNullOrUndefined(t.item.height.maxHeight)||(n.style.maxHeight=sf.base.formatUnit(t.item.height.maxHeight)),sf.base.isNullOrUndefined(t.item.cssClass)||("e-video-break"===t.item.cssClass?(sf.base.addClass([n],["e-video-break"]),sf.base.removeClass([n],["e-video-inline"])):(sf.base.addClass([n],["e-video-inline"]),sf.base.removeClass([n],["e-video-break"])))},e.prototype.videoDimension=function(e){var t=e.item.selectNode[0].classList.contains("e-video-clickelem")?e.item.selectNode[0].querySelector("iframe"):e.item.selectNode[0];t.style.height="",t.style.width="","auto"!==e.item.width&&(t.style.width=sf.base.formatUnit(e.item.width)),"auto"!==e.item.height&&(t.style.height=sf.base.formatUnit(e.item.height)),this.callBack(e)},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),at=function(){function e(){this.allCells=[],this.hasCellsUpdated=!1,this.preventOverflowCells=!1}return e.prototype.handleTablePaste=function(e,t){if(e&&t&&!(t.length<1)){this.hasCellsUpdated=!1;var n=t[0];this.preventOverflowCells=t.length>1;var i=this.getClosestTable(n);if(i){var s=this.getTableRows(e),r=this.getRowIndex(n);this.allCells=L(i);var o=this.getCellIndex(n,r),a=L(e);this.pasteMultipleRows(i,s,r,o,a),this.hasCellsUpdated&&x(i,!0)}}},e.prototype.getClosestTable=function(e){return sf.base.closest(e,"table")},e.prototype.getTableRows=function(e){for(var t=[],n=e.rows.length,i=0;i<n;i++){var s=e.rows.item(i);null!==s&&t.push(s)}return t},e.prototype.getRowIndex=function(e){var t=e.parentElement;return null!==t?t.rowIndex:0},e.prototype.getCellIndex=function(e,t){void 0===t&&(t=0);for(var n=t;n<this.allCells.length;n++)for(var i=this.allCells[n],s=0;s<i.length;s++)if(this.allCells[n][s]===e)return s;return e.cellIndex>=0?e.cellIndex:0},e.prototype.pasteMultipleRows=function(e,t,n,i,s){for(var r=0;r<t.length;r++){var o=t[r];this.pasteRowContent(e,o,i,n,s)}},e.prototype.ensureCellCount=function(e,t,n){if(n<t)for(this.hasCellsUpdated=!0;n<t;){e.insertCell().innerHTML="<br>",n++}},e.prototype.getOrCreateRow=function(e,t){if(t<e.rows.length)return e.rows.item(t);if(!this.preventOverflowCells){var n=e.insertRow();return this.fillRowWithEmptyCells(n,this.getMaxColumnCount(e.rows[0].cells)),this.allCells=L(e),n}return null},e.prototype.fillRowWithEmptyCells=function(e,t){for(var n=0;n<t;n++){e.insertCell().innerHTML="<br>"}},e.prototype.getMaxColumnCount=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n].colSpan;return t},e.prototype.pasteRowContent=function(e,t,n,i,s){var r=this.getRowCells(t);this.allCells=L(e),this.preventOverflowCells||this.ensureTargetTableCapacity(e,n,s);for(var o=0;o<r.length;o++){var a=r[o];this.allCells=L(e);var l=k(a,s),d=i+l[0],c=n+l[1];this.preventOverflowCells&&this.adjustCellSpans(a,d,c,e);var h=this.getOrCreateRow(e,d);if(h){var p=this.allCells[d][c];p&&!this.shouldSkipCell(p)&&this.copyCellAttributes(p,a,d,c,e,h)}}},e.prototype.adjustCellSpans=function(e,t,n,i){var s=parseInt(e.getAttribute("rowspan")||"1",10),r=parseInt(e.getAttribute("colspan")||"1",10);if(s>1){var o=this.calculateAdjustedRowSpan(e,t,n,s,i);e.setAttribute("rowspan",o.toString())}if(r>1){var a=this.calculateAdjustedColSpan(t,n,r);e.setAttribute("colspan",a.toString())}},e.prototype.calculateAdjustedRowSpan=function(e,t,n,i,s){for(var r=i,o=1;o<i;o++){var a=t+o;if(this.getOrCreateRow(s,a)){var l=this.allCells[a][n];l&&!this.shouldSkipCell(l)||--r}else--r}var d=i-r;return d>0&&this.adjustCellHeights(e,null,r,d),r},e.prototype.calculateAdjustedColSpan=function(e,t,n){for(var i=n,s=0;s<n;s++){var r=t+s,o=this.allCells[e][r];o&&!this.shouldSkipCell(o)||--i}return i},e.prototype.ensureTargetTableCapacity=function(e,t,n){if(n[0])for(var i=0;i<e.rows.length;i++){var s=e.rows[i],r=this.allCells[i].length,o=t+n[0].length;this.ensureCellCount(s,o,r)}},e.prototype.shouldSkipCell=function(e){return this.preventOverflowCells&&!(e.classList.contains("e-cell-select")&&e.classList.contains("e-multi-cells-select"))},e.prototype.getRowCells=function(e){for(var t=[],n=e.cells.length,i=0;i<n;i++){var s=e.cells.item(i);null!==s&&t.push(s)}return t},e.prototype.copyCellAttributes=function(e,t,n,i,s,r){if(t){e=this.handleCellInsertLocation(e,r,n,i),e=this.handleInsertRowMismatch(e,r,n,i,s);var o=this.getCellSpanAttributes(e,t);e=this.handleColspanChanges(e,o.oldColSpan,o.newColSpan,n,i,r,s),(e=this.handleRowspanChanges(e,o.oldRowSpan,o.newRowSpan,n,i,s,o.newColSpan)).innerHTML=t.innerHTML,e.style.cssText=t.style.cssText}},e.prototype.getCellSpanAttributes=function(e,t){return{oldRowSpan:parseInt(e.getAttribute("rowspan")||"1",10),oldColSpan:parseInt(e.getAttribute("colspan")||"1",10),newRowSpan:parseInt(t.getAttribute("rowspan")||"1",10),newColSpan:parseInt(t.getAttribute("colspan")||"1",10)}},e.prototype.handleCellInsertLocation=function(e,t,n,i){var s=this.getInsertionColIndex(i,t,n);if(s<i){var r=parseInt(e.getAttribute("colspan")||"1",10),o=r-(i-s);if(o>0){var a=s+1,l=t.insertCell(a);return l.innerHTML="<br>",l.style.cssText=e.style.cssText,l.className=e.className,e.setAttribute("colspan",(r-o).toString()),this.allCells[n][i]=l,l.setAttribute("colspan",o.toString()),e.hasAttribute("rowspan")&&l.setAttribute("rowspan",e.getAttribute("rowspan")),l}}return e},e.prototype.handleInsertRowMismatch=function(e,t,n,i,s){if(e.parentElement!==t){var r=parseInt(e.getAttribute("rowspan")||"1",10),o=r-(n-this.getRowIndex(e)),a=r-o;if(r>1){this.removeRowspanAttributes(s,n,i);var l=this.allCells[n][i];return l.innerHTML=e.innerHTML,l.style.cssText=e.style.cssText,l.className=e.className,e.hasAttribute("colspan")&&l.setAttribute("colspan",e.getAttribute("colspan")),1===o?l.removeAttribute("rowspan"):l.setAttribute("rowspan",o.toString()),a>1?e.setAttribute("rowspan",a.toString()):e.removeAttribute("rowspan"),this.adjustCellHeights(e,l,a,o),l}}return e},e.prototype.adjustCellHeights=function(e,t,n,i){if(e.style.height){var s=e.style.height,r=parseFloat(s);if(!isNaN(r)&&r>0){var o=r/(n+i);e.style.height=n*o+"px",t&&(t.style.height=i*o+"px")}}},e.prototype.handleRowspanChanges=function(e,t,n,i,s,r,o){if(t>1&&n<=1){var a=t-n,l=i+1;this.removeRowspanAttributes(r,l,s),(c=this.allCells[l][s]).innerHTML=e.innerHTML,c.style.cssText=e.style.cssText,c.className=e.className,e.hasAttribute("colspan")&&c.setAttribute("colspan",e.getAttribute("colspan")),1===a?c.removeAttribute("rowspan"):c.setAttribute("rowspan",a.toString()),e.removeAttribute("rowspan"),this.adjustCellHeights(e,c,n,a)}else if(t>1&&n>1){var d=n-t;if(d>0)this.applyRowspanAttributes(r,i,s,n,o),e.setAttribute("rowspan",n.toString());else if(d<0){var c;l=i+n;this.removeRowspanAttributes(r,l,s),(c=this.allCells[l][s]).innerHTML=e.innerHTML,c.style.cssText=e.style.cssText,c.className=e.className,e.hasAttribute("colspan")&&c.setAttribute("colspan",e.getAttribute("colspan")),1==-d?c.removeAttribute("rowspan"):c.setAttribute("rowspan",(-d).toString()),e.setAttribute("rowspan",n.toString()),this.adjustCellHeights(e,c,n,-d)}}else n>1&&t<=1&&(this.applyRowspanAttributes(r,i,s,n,o),e.setAttribute("rowspan",n.toString()));return e},e.prototype.handleColspanChanges=function(e,t,n,i,s,r,o){if(t>1&&n<=1){var a=t-n;this.insertFollowingSiblings(r,s,i,n),1===a?e.removeAttribute("colspan"):e.setAttribute("colspan",a.toString()),e.innerHTML="",(c=this.allCells[i][s]).className=e.className,e=c}else if(n>1&&t<=1){var l=n-t;l>0&&(this.removeFollowingSiblings(this.allCells[i],s+t,l,o,r,i),e.setAttribute("colspan",n.toString()))}else if(n>1&&t>1){var d=n-t;if(d>0)this.removeFollowingSiblings(this.allCells[i],s+t,d,o,r,i),e.setAttribute("colspan",n.toString());else if(d<0){var c;this.insertFollowingSiblings(r,s,i,1),e.setAttribute("colspan",(-d).toString()),e.innerHTML="",(c=this.allCells[i][s]).className=e.className,(e=c).setAttribute("colspan",n.toString())}}return e},e.prototype.applyRowspanAttributes=function(e,t,n,i,s){for(var r=1;r<i;r++)for(var o=t+r,a=0;a<s;a++){var l=n+a;this.processRowspanCell(e,o,l)}},e.prototype.processRowspanCell=function(e,t,n){var i=this.getOrCreateRow(e,t),s=this.allCells[t][n],r=Array.prototype.indexOf.call(i.cells,s);if(s&&s.parentElement&&-1!==r){var o=parseInt(s.getAttribute("colspan")||"1",10),a=parseInt(s.getAttribute("rowspan")||"1",10);o<=1&&a<=1||this.handleComplexCellRemoval(e,i,s,t,n,o,a),i.removeChild(s),this.allCells[t][n]=null}},e.prototype.handleComplexCellRemoval=function(e,t,n,i,s,r,o){r>1&&this.handleColspanCellRemoval(t,n,i,s,r),o>1&&this.handleRowspanCellRemoval(e,n,i,s,o)},e.prototype.handleColspanCellRemoval=function(e,t,n,i,s){this.insertFollowingSiblings(e,i,n,1);var r=s-1,o=this.allCells[n][i];o.innerHTML="<br>",o.style.cssText=t.style.cssText,o.className=t.className,1===r?o.removeAttribute("colspan"):o.setAttribute("colspan",r.toString())},e.prototype.handleRowspanCellRemoval=function(e,t,n,i,s){this.removeRowspanAttributes(e,n+1,i);var r=this.allCells[n+1][i],o=s-1;r.innerHTML=t.innerHTML,r.style.cssText=t.style.cssText,r.className=t.className,1===o?r.removeAttribute("rowspan"):r.setAttribute("rowspan",o.toString()),this.adjustCellHeights(t,r,s,o)},e.prototype.removeRowspanAttributes=function(e,t,n){var i=this.getOrCreateRow(e,t),s=this.getInsertionColIndex(n,i,t),r=i.insertCell(s);this.allCells[t][n]=r},e.prototype.getInsertionColIndex=function(e,t,n){if(!t||0===t.cells.length)return 0;var i=e,s=this.allCells[n]||[];i=this.findMatchingCellIndex(s,t,i,!0);var r=s.indexOf(t.cells[0]);((s.length<=i||t.cells.length<=e&&-1!==r&&r<i)&&(i=e,i=this.findMatchingCellIndex(s,t,i,!1)),s[i])?(i=s[i].cellIndex,t.cells.length<=e&&-1!==r&&e>r&&i++):i=e;return i},e.prototype.findMatchingCellIndex=function(e,t,n,i){for(var s=n;e&&s>=0&&e[s]&&t&&-1===Array.prototype.indexOf.call(t.cells,e[s]);)s=i?s+1:s-1;return s},e.prototype.removeFollowingSiblings=function(e,t,n,i,s,r){for(var o=0;o<n;o++){var a=e[t];if(a&&a.parentElement){var l=parseInt(a.getAttribute("colspan")||"1",10),d=parseInt(a.getAttribute("rowspan")||"1",10);l<=1&&d<=1||this.handleComplexCellRemoval(i,s,a,r,t,l,d),a.parentElement.removeChild(a),e[t]=null}}},e.prototype.insertFollowingSiblings=function(e,t,n,i){for(var s=this.getInsertionColIndex(t,e,n),r=0;r<i;r++){var o=e.insertCell(s);o.innerHTML="<br>",this.allCells[n][t]=o}},e.prototype.getValidTableFromPaste=function(e){if("table"===e.nodeName.toLowerCase())return e;var t=e.querySelector("table");return t?this.getWrapperNodeForTable(e,t):null},e.prototype.getWrapperNodeForTable=function(e,t){for(var n=e;n!==t;){var i=Array.from(n.childNodes).filter((function(e){return e.nodeType!==Node.COMMENT_NODE&&!(e.nodeType===Node.TEXT_NODE&&""===e.textContent.trim())}));if(1!==i.length)return null;n=i[0]}return n},e}(),lt=function(){function e(e,t,n){this.isTableMoveActive=!1,this.pageX=null,this.pageY=null,this.isResizeBind=!0,this.currentColumnResize="",this.resizeEndTime=0,this.ensureInsideTableList=!0,this.parent=e,this.tablePastingObj=new at,this.tableModel=t,this.iframeSettings=n,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(pe,this.createTable,this),this.parent.observer.on("INSERT-ROW",this.insertRow,this),this.parent.observer.on("INSERT-COLUMN",this.insertColumn,this),this.parent.observer.on("DELETE-ROW",this.deleteRow,this),this.parent.observer.on("DELETE-COLUMN",this.deleteColumn,this),this.parent.observer.on("REMOVE-TABLE",this.removeTable,this),this.parent.observer.on("TABLE-HEADER",this.tableHeader,this),this.parent.observer.on("TABLE_VERTICAL_ALIGN",this.tableVerticalAlign,this),this.parent.observer.on("TABLE_MERGE",this.cellMerge,this),this.parent.observer.on("TABLE_HORIZONTAL_SPLIT",this.horizontalSplit,this),this.parent.observer.on("TABLE_VERTICAL_SPLIT",this.verticalSplit,this),this.parent.observer.on("TABLE_STYLES",this.tableStyles,this),this.parent.observer.on("TABLE_BACKGROUND_COLOR",this.setBGColor,this),this.parent.observer.on("TABLE_MOVE",this.tableMove,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(pe,this.createTable),this.parent.observer.off("INSERT-ROW",this.insertRow),this.parent.observer.off("INSERT-COLUMN",this.insertColumn),this.parent.observer.off("DELETE-ROW",this.deleteRow),this.parent.observer.off("DELETE-COLUMN",this.deleteColumn),this.parent.observer.off("REMOVE-TABLE",this.removeTable),this.parent.observer.off("TABLE-HEADER",this.tableHeader),this.parent.observer.off("TABLE_VERTICAL_ALIGN",this.tableVerticalAlign),this.parent.observer.off("TABLE_MERGE",this.cellMerge),this.parent.observer.off("TABLE_HORIZONTAL_SPLIT",this.horizontalSplit),this.parent.observer.off("TABLE_VERTICAL_SPLIT",this.verticalSplit),this.parent.observer.off("TABLE_STYLES",this.tableStyles),this.parent.observer.off("TABLE_BACKGROUND_COLOR",this.setBGColor),this.parent.observer.off("TABLE_MOVE",this.tableMove),this.parent.observer.off(v,this.destroy),!sf.base.Browser.isDevice&&this.tableModel.tableSettings.resize&&(sf.base.EventHandler.remove(this.tableModel.getEditPanel(),"mouseover",this.resizeHelper),sf.base.EventHandler.remove(this.tableModel.getEditPanel(),sf.base.Browser.touchStartEvent,this.resizeStart)),this.curTable&&sf.base.EventHandler.remove(this.curTable,"mouseleave",this.tableMouseLeave),sf.base.EventHandler.remove(this.tableModel.getDocument(),"selectionchange",this.tableCellsKeyboardSelection)},e.prototype.copy=function(e){var t=this.extractSelectedTable(this.curTable,e);if(t){var n=D(t.outerHTML,this.tableModel.editorMode);try{var i=new Blob([n],{type:"text/html"}),s=new window.ClipboardItem({"text/html":i});navigator.clipboard.write([s])}catch(e){console.error("Clipboard API not supported in this browser")}}},e.prototype.updateTableModel=function(e){this.tableModel=e},e.prototype.extractSelectedTable=function(e,t){var n=e.querySelectorAll(".e-cell-select.e-multi-cells-select");if(!n||0===n.length)return null;var i=e.cloneNode(!0),s=this.buildSelectionMap(e,n,t);return this.cleanTableToSelection(i,s),this.removeColGroup(i),i},e.prototype.buildSelectionMap=function(e,t,n){for(var i=new Map,s=0;s<t.length;s++){for(var r=t[s],o=r.parentElement,a=Array.prototype.indexOf.call(e.rows,o),l=Array.prototype.indexOf.call(o.cells,r),d=parseInt(r.getAttribute("rowspan")||"1",10),c=0;c<d;c++){var h=c+a;i.has(h)||i.set(h,new Set),0===c&&i.get(h).add(l)}if(n)e.rows[a].cells[l].innerHTML="<br>"}return i},e.prototype.cleanTableToSelection=function(e,t){for(var n=e.rows.length-1;n>=0;n--){var i=e.rows[n];if(t.has(n))for(var s=t.get(n),r=i.cells.length-1;r>=0;r--)s.has(r)||i.deleteCell(r);else sf.base.detach(i)}},e.prototype.removeColGroup=function(e){var t=w(e);t&&sf.base.detach(t)},e.prototype.createTable=function(e){var t=this.createTableStructure(e);return this.insertTableInDocument(t,e),this.handlePostTableInsertion(t,e),t},e.prototype.createTableStructure=function(e){var t=sf.base.createElement("table",{className:"e-rte-table"});this.applyTableDimensions(t,e.item.width);var n=this.calculateCellWidth(e.item.width.width,e.item.columns),i=this.createInitialColgroup(e.item.columns,n);t.appendChild(i);var s=sf.base.createElement("tbody");return this.createRowsAndCells(s,e.item.rows,e.item.columns),t.appendChild(s),t},e.prototype.createInitialColgroup=function(e,t){for(var n=sf.base.createElement("colgroup"),i=0;i<e;i++){var s=sf.base.createElement("col");s.appendChild(sf.base.createElement("br")),s.style.width=t+"%",n.appendChild(s)}return n},e.prototype.applyTableDimensions=function(e,t){sf.base.isNullOrUndefined(t.width)||(e.style.width=this.calculateStyleValue(t.width)),sf.base.isNullOrUndefined(t.minWidth)||(e.style.minWidth=this.calculateStyleValue(t.minWidth)),sf.base.isNullOrUndefined(t.maxWidth)||(e.style.maxWidth=this.calculateStyleValue(t.maxWidth))},e.prototype.calculateCellWidth=function(e,t){return parseInt(e,10)>100?100/t:parseInt(e,10)/t},e.prototype.createRowsAndCells=function(e,t,n){for(var i=0;i<t;i++){for(var s=sf.base.createElement("tr"),r=0;r<n;r++){var o=sf.base.createElement("td");o.appendChild(sf.base.createElement("br")),s.appendChild(o)}e.appendChild(s)}},e.prototype.insertTableInDocument=function(e,t){t.item.selection.restore(),Pe.Insert(this.tableModel.getDocument(),e,this.tableModel.getEditPanel()),t.item.selection.setSelectionText(this.tableModel.getDocument(),e.querySelector("td"),e.querySelector("td"),0,0)},e.prototype.handlePostTableInsertion=function(e,t){this.insertElementAfterTableIfNeeded(e,t.enterAction),e.classList.contains("ignore-table")&&T([e],["ignore-table"]);var n=this.getOffsetParent(e,this.tableModel.getDocument());if(n){var i=n&&("TD"===n.nodeName||"TH"===n.nodeName),s=!(!n.classList||!n.classList.contains("e-multi-cells-select"));i&&!s&&T([n],["e-cell-select"])}e.querySelector("td").classList.add("e-cell-select"),t.callBack&&t.callBack({requestType:"Table",editorMode:"HTML",event:t.event,range:this.parent.nodeSelection.getRange(this.tableModel.getDocument()),elements:[e]})},e.prototype.insertElementAfterTableIfNeeded=function(e,t){if(null===e.nextElementSibling&&!e.classList.contains("ignore-table")){var n=void 0;"DIV"===t?(n=sf.base.createElement("div")).appendChild(sf.base.createElement("br")):"BR"===t?n=sf.base.createElement("br"):(n=sf.base.createElement("p")).appendChild(sf.base.createElement("br")),this.insertAfter(n,e)}},e.prototype.calculateStyleValue=function(e){return"string"==typeof e&&(e.indexOf("px")>=0||e.indexOf("%")>=0||e.indexOf("auto")>=0)?e:e+"px"},e.prototype.insertAfter=function(e,t){t.parentNode&&t.parentNode.insertBefore(e,t.nextSibling)},e.prototype.getSelectedCellMinMaxIndex=function(e){for(var t=this.curTable.querySelectorAll(".e-cell-select"),n=e.length,i=0,s=e[0].length,r=0,o=0;o<t.length;o++){var a=k(t[o],e),l=this.FindIndex(a[0],a[1],e);n=Math.min(a[0],n),i=Math.max(l[0],i),s=Math.min(a[1],s),r=Math.max(l[1],r)}return{startRow:n,endRow:i,startColumn:s,endColumn:r}},e.prototype.insertRow=function(e){var t="InsertRowBefore"!==e.item.subCommand;this.curTable=sf.base.closest(this.parent.nodeSelection.range.startContainer.parentElement,"table");var n=null;n=0===this.curTable.querySelectorAll(".e-cell-select").length?this.addRowWithoutCellSelection():this.addRowWithCellSelection(e,t),this.updateSelectionAfterRowInsertion(n,e),this.executeCallback(e)},e.prototype.addRowWithoutCellSelection=function(){var e=this.curTable.rows[this.curTable.rows.length-1],t=e.cloneNode(!0);t.removeAttribute("rowspan"),this.insertAfter(t,e);var n=t.cells;return n&&n.length>0?n[0]:null},e.prototype.addRowWithCellSelection=function(e,t){var n=L(this.curTable),i=this.getSelectedCellMinMaxIndex(n),s=t?i.endRow:i.startRow,r=sf.base.createElement("tr"),o=this.curTable.querySelectorAll("th.e-cell-select").length>0;this.createCellsForNewRow(n,s,t,o,r),this.insertNewRowAtPosition(e,t,o,s,r);var a=r.cells;return a&&a.length>0&&i.endColumn<a.length?a[i.endColumn]:null},e.prototype.createCellsForNewRow=function(e,t,n,i,s){for(var r=0;r<e[t].length;r++)this.isCellAffectedByRowspan(e,t,r,n)?this.isFirstCellInSpan(e,t,r)&&this.incrementRowspan(e[t][r]):this.createNewCellForRow(e,t,r,i,n,s)},e.prototype.isCellAffectedByRowspan=function(e,t,n,i){return i&&t<e.length-1&&e[t][n]===e[t+1][n]||!i&&0<t&&e[t][n]===e[t-1][n]},e.prototype.isFirstCellInSpan=function(e,t,n){return 0===n||0<n&&e[t][n]!==e[t][n-1]},e.prototype.incrementRowspan=function(e){var t=parseInt(e.getAttribute("rowspan"),10)||1;e.setAttribute("rowspan",(t+1).toString())},e.prototype.createNewCellForRow=function(e,t,n,i,s,r){var o=sf.base.createElement("td");o.appendChild(sf.base.createElement("br")),r.appendChild(o);var a=e[this.getReferenceRowIndex(e,t,i,s)][n].getAttribute("style");if(a){var l=this.cellStyleCleanup(a);o.style.cssText=l}},e.prototype.getReferenceRowIndex=function(e,t,n,i){return n&&i&&t+1<e.length?t+1:t},e.prototype.insertNewRowAtPosition=function(e,t,n,i,s){var r;r=n&&t?this.curTable.querySelector("tbody").childNodes[0]:this.curTable.rows[i],"InsertRowBefore"===e.item.subCommand||n?r.parentElement.insertBefore(s,r):this.insertAfter(s,r)},e.prototype.updateSelectionAfterRowInsertion=function(e,t){e&&(this.clearTableSelections(),sf.base.addClass([e],"e-cell-select"),t.item.selection.setSelectionText(this.tableModel.getDocument(),e,e,0,0))},e.prototype.clearTableSelections=function(){T(this.tableModel.getEditPanel().querySelectorAll(".e-cell-select"),"e-cell-select"),this.removeTableSelection()},e.prototype.executeCallback=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.tableModel.getDocument()),elements:this.parent.nodeSelection.getSelectedNodes(this.tableModel.getDocument())})},e.prototype.insertColumn=function(e){var t=e.item.selection.range.startContainer;"TH"!==t.nodeName&&"TD"!==t.nodeName&&(t=sf.base.closest(t.parentElement,"td,th"));var n=sf.base.closest(t,"tr"),i=sf.base.closest(n,"table").rows,s=Array.prototype.slice.call(n.querySelectorAll(":scope > td, :scope > th")).indexOf(t),r=sf.base.closest(n,"table");this.prepareTableForColumnInsertion(e,r),this.insertCellsInAllRows(e,i,s,r);var o="InsertColumnRight"===e.item.subCommand?s+1:s,a=n.cells[o];this.clearTableSelections(),sf.base.addClass([a],"e-cell-select"),this.finalizeColumnInsertion(e,a)},e.prototype.prepareTableForColumnInsertion=function(e,t){for(var n=t.querySelectorAll("th,td"),i=0;i<n.length;i++)n[i].dataset.oldWidth=n[i].offsetWidth/t.offsetWidth*100+"%";(sf.base.isNullOrUndefined(t.style.width)||""===t.style.width)&&(t.style.width=t.offsetWidth+"px")},e.prototype.insertCellsInAllRows=function(e,t,n,i){for(var s=i.querySelectorAll("th,td"),r=t[0].querySelectorAll(":scope > td, :scope > th").length,o=parseInt(e.item.width,10)/(r+1),a=parseInt(e.item.width,10)/r,l=this.updateColumnGroup(i,n,e.item.subCommand,o),d=0;d<t.length;d++){var c=t[d].querySelectorAll(":scope > td, :scope > th")[n],h=this.createColumnCell(c);"InsertColumnLeft"===e.item.subCommand?c.parentElement.insertBefore(h,c):this.insertAfter(h,c),delete h.dataset.oldWidth}this.redistributeCellWidths(s,a,o,l)},e.prototype.updateColumnGroup=function(e,t,n,i){x(e);var s=w(e),r=sf.base.createElement("col");r.appendChild(sf.base.createElement("br")),r.style.width=i.toFixed(4)+"%";var o=s.querySelectorAll("col");if(o.length>0&&t<o.length){var a=o[t];"InsertColumnLeft"===n?s.insertBefore(r,a):this.insertAfter(r,a)}else s.appendChild(r);return s.querySelectorAll("col")},e.prototype.createColumnCell=function(e){var t=e.cloneNode(!0),n=t.getAttribute("style");if(n){var i=this.cellStyleCleanup(n);t.style.cssText=i}return t.innerHTML="",t.appendChild(sf.base.createElement("br")),t.removeAttribute("class"),t.removeAttribute("colspan"),t.removeAttribute("rowspan"),t},e.prototype.redistributeCellWidths=function(e,t,n,i){for(var s=0;s<e.length;s++)if(e[s].dataset.oldWidth){var r=Number(e[s].dataset.oldWidth.split("%")[0]);i[Array.prototype.slice.call(e[s].parentElement.querySelectorAll(":scope > td, :scope > th")).indexOf(e[s])].style.width=(r*n/t).toFixed(4)+"%",delete e[s].dataset.oldWidth}},e.prototype.finalizeColumnInsertion=function(e,t){e.item.selection.setSelectionText(this.tableModel.getDocument(),t,t,0,0),this.executeCallback(e)},e.prototype.setBGColor=function(e){var t=this.parent.nodeSelection.getRange(this.tableModel.getDocument()),n=3===t.startContainer.nodeType?t.startContainer.parentNode:t.startContainer;this.curTable=n.closest("table");for(var i=this.curTable.querySelectorAll(".e-cell-select"),s=0;s<i.length;s++)i[s].style.backgroundColor=e.value.toString();this.parent.undoRedoManager.saveData(),this.parent.observer.notify("hideTableQuickToolbar",{}),this.executeBgColorCallback(e)},e.prototype.executeBgColorCallback=function(e){e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.tableModel.getDocument()),elements:this.parent.nodeSelection.getSelectedNodes(this.tableModel.getDocument())})},e.prototype.tableStyles=function(e){var t=e.event,n=e.item.subCommand,i=sf.base.closest(t.selectParent[0],"table");this.applyTableStyleCommand(n,i),this.applyCustomCssClasses(t,i),this.parent.undoRedoManager.saveData(),this.parent.observer.notify("hideTableQuickToolbar",{}),this.parent.nodeSelection.restore(),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:t.args,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.applyTableStyleCommand=function(e,t){if("Dashed"===e)this.parent.editableElement.classList.contains("e-dashed-border")?T([this.parent.editableElement],"e-dashed-border"):this.parent.editableElement.classList.add("e-dashed-border"),t.classList.contains("e-dashed-border")?T([t],"e-dashed-border"):t.classList.add("e-dashed-border");else if("Alternate"===e){this.parent.editableElement.classList.contains("e-alternate-border")?T([this.parent.editableElement],"e-alternate-border"):this.parent.editableElement.classList.add("e-alternate-border"),t.classList.contains("e-alternate-border")?T([t],"e-alternate-border"):t.classList.add("e-alternate-border")}},e.prototype.applyCustomCssClasses=function(e,t){var n=e.args;if(n&&n.item.cssClass)for(var i=n.item.cssClass.split(" "),s=0;s<i.length;s++){var r=i[s];t.classList.contains(r)?T([t],r):t.classList.add(r)}},e.prototype.deleteColumn=function(e){var t=e.item.selection.range.startContainer;if(3===t.nodeType&&(t=sf.base.closest(t.parentElement,"td,th")),this.curTable=sf.base.closest(t,"table"),1===sf.base.closest(t,"tr").querySelectorAll("th,td").length)this.removeEntireTable(e);else{x(this.curTable);var n=this.removeSelectedColumns(e);this.updateColgroupAfterColumnDeletion(this.curTable,n.startColumn,n.endColumn)}this.executeDeleteColumnCallback(e)},e.prototype.updateColgroupAfterColumnDeletion=function(e,t,n){for(var i=w(e),s=i.querySelectorAll("col"),r=n-t+1,o=0;o<r;o++)t<s.length&&(i.removeChild(s[t]),s=i.querySelectorAll("col"));var a=s.length,l=e.offsetWidth,d=new Array(a);for(o=0;o<a;o++)d[o]=s[o].offsetWidth;for(o=0;o<a;o++)s[o].style.width=M(d[o],l).toFixed(4)+"%"},e.prototype.removeEntireTable=function(e){var t=e.item.selection.range.startContainer;sf.base.detach(sf.base.closest(t.parentElement,"table")),e.item.selection.restore()},e.prototype.removeSelectedColumns=function(e){for(var t=-1,n=L(this.curTable),i=this.getSelectedCellMinMaxIndex(n),s=i.startColumn,r=i.endColumn,o=0;o<n.length;o++)for(var a=n[o],l=0;l<a.length;l++){var d=a[l];if("true"!==d.dataset.processed){var c=k(d,n),h=parseInt(d.getAttribute("colspan"),10)||1;this.isCellAffectedByDeletedColumns(c[1],h,s,r)&&(d.dataset.processed="true",h>1?this.adjustColspan(d,h):(sf.base.detach(d),t=l,this.handleIESpecificSelection(e,sf.base.Browser.isIE)))}}return this.cleanupProcessedCells(),this.updateSelectionAfterColumnDelete(e,i.startRow,t),i},e.prototype.cleanupProcessedCells=function(){var e=this.curTable.querySelectorAll("td, th");Array.from(e).forEach((function(e){delete e.dataset.processed}))},e.prototype.isCellAffectedByDeletedColumns=function(e,t,n,i){return e+(t-1)>=n&&e<=i},e.prototype.adjustColspan=function(e,t){e.setAttribute("colspan",(t-1).toString())},e.prototype.handleIESpecificSelection=function(e,t){if(t){var n=this.curTable.querySelector("td");e.item.selection.setSelectionText(this.tableModel.getDocument(),n,n,0,0),n.classList.add("e-cell-select")}},e.prototype.updateSelectionAfterColumnDelete=function(e,t,n){if(n>-1){var i=n<=(this.curTable&&this.curTable.rows[t]&&this.curTable.rows[t].cells.length-1)?n:n-1,s=this.curTable.rows[t].cells[i];s&&(e.item.selection.setSelectionText(this.tableModel.getDocument(),s,s,0,0),s.classList.add("e-cell-select"))}},e.prototype.executeDeleteColumnCallback=function(e){if(e.callBack){var t=this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startContainer;if("TD"!==t.nodeName){var n=this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startOffset,i=t.children[n];i&&this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(),i,0)}this.executeCallback(e)}},e.prototype.deleteRow=function(e){var t=e.item.selection.range.startContainer;3===t.nodeType&&(t=sf.base.closest(t.parentElement,"td,th"));var n=Array.prototype.indexOf.call(t.parentNode.childNodes,t);this.curTable=sf.base.closest(t,"table");var i=L(this.curTable),s=this.getSelectedCellMinMaxIndex(i);1===this.curTable.rows.length?this.removeEntireTable(e):this.deleteSelectedRows(e,s,i,n),this.executeCallback(e)},e.prototype.deleteSelectedRows=function(e,t,n,i){for(var s=t.endRow;s>=t.startRow;s--){var r=this.curTable.rows[s];this.adjustRowSpans(s,n),this.repositionSpannedCells(s,n);var o=r.rowIndex;this.curTable.deleteRow(o),this.restoreFocusAfterRowDeletion(e,o,i)}},e.prototype.adjustRowSpans=function(e,t){for(var n=0;n<t[e].length;n++)if(0===n||t[e][n]!==t[e][n-1]){var i=t[e][n],s=i.getAttribute("rowspan");if(s&&parseInt(s,10)>1){var r=parseInt(s,10)-1;1===r?(i.removeAttribute("rowspan"),this.createReplacementCellIfNeeded(n)):i.setAttribute("rowspan",r.toString())}}},e.prototype.createReplacementCellIfNeeded=function(e){var t=this.getMergedRow(L(this.curTable));if(t&&e<t.length){var n=t[e];if(n){var i=n.cloneNode(!0);i.innerHTML="<br>",n.parentElement&&n.parentElement.insertBefore(i,n)}}},e.prototype.repositionSpannedCells=function(e,t){for(var n=0;n<t[e].length;n++){var i=t[e][n],s=e<t.length-1&&i===t[e+1][n],r=0===e||i!==t[e-1][n];if(s&&r)for(var o=n;o>0&&i===t[e][o-1];){if(0===o)this.curTable.rows[e+1].prepend(i);else t[e+1][o-1].insertAdjacentElement("afterend",i);o--}}},e.prototype.restoreFocusAfterRowDeletion=function(e,t,n){var i=sf.base.isNullOrUndefined(this.curTable.rows[t])?this.curTable.rows[t-1]:this.curTable.rows[t],s=i&&i.querySelectorAll("td")[n];if(s)e.item.selection.setSelectionText(this.tableModel.getDocument(),s,s,0,0),s.classList.add("e-cell-select");else{var r=this.curTable.querySelector("td");e.item.selection.setSelectionText(this.tableModel.getDocument(),r,r,0,0),r.classList.add("e-cell-select")}},e.prototype.getMergedRow=function(e){for(var t,n=this.curTable.rows[0].childNodes.length,i=0;i<e.length;i++)if(e[i].length!==n){t=e[i];break}return t},e.prototype.removeTable=function(e){var t=e.item.selection.range.startContainer;t=3===t.nodeType?t.parentNode:t;var n=sf.base.closest(t.parentElement,"table");if(n){var i=n.nextSibling;sf.base.detach(n),e.item.selection.restore(),this.focusAfterTableDeletion(i)}this.executeCallback(e)},e.prototype.focusAfterTableDeletion=function(e){if(e){var t=this.parent.nodeSelection.findFirstContentNode(e);if(t&&t.node)if("BR"===t.node.nodeName){var n=this.parent.editableElement.ownerDocument.createRange();n.setStartBefore(t.node),n.setEndBefore(t.node),this.parent.nodeSelection.setRange(this.parent.currentDocument,n)}else this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t.node,0)}},e.prototype.tableHeader=function(e){var t=this.getTableFromSelection(e),n=this.checkIfTableHasHeader(t);t&&!n?this.createTableHeader(t):t.deleteTHead(),this.executeCallback(e)},e.prototype.getTableFromSelection=function(e){var t=e.item.selection.range.startContainer;return"TABLE"===t.nodeName?t:(3===t.nodeType&&(t=t.parentNode),sf.base.closest(t.parentElement,"table"))},e.prototype.checkIfTableHasHeader=function(e){var t=!1;return Array.prototype.slice.call(e.childNodes).forEach((function(e){"THEAD"===e.nodeName&&(t=!0)})),t},e.prototype.createTableHeader=function(e){for(var t=e.querySelector("tr"),n=t.childElementCount,i=0,s=0;s<n;s++){i+=parseInt(t.children[s].getAttribute("colspan"),10)||1}var r=e.createTHead().insertRow(0);this.createHeaderCells(r,i)},e.prototype.createHeaderCells=function(e,t){for(var n=0;n<t;n++){var i=sf.base.createElement("th");i.appendChild(sf.base.createElement("br")),e.appendChild(i)}},e.prototype.tableVerticalAlign=function(e){var t=this.getVerticalAlignmentValue(e.item.subCommand);this.applyVerticalAlignment(e.item.tableCell,t),this.executeCallback(e)},e.prototype.getVerticalAlignmentValue=function(e){switch(e){case"AlignTop":return"top";case"AlignMiddle":return"middle";case"AlignBottom":return"bottom";default:return""}},e.prototype.applyVerticalAlignment=function(e,t){var n=this.curTable&&this.curTable.querySelectorAll(".e-cell-select");if(n&&n.length>0)for(var i=0;i<n.length;i++)n[i].style.verticalAlign=t;else e.style.verticalAlign=t;t&&""!==t&&e.getAttribute("valign")&&e.removeAttribute("valign")},e.prototype.cellMerge=function(e){this.curTable=sf.base.closest(this.parent.nodeSelection.range.startContainer.parentElement,"table");var t=this.curTable.querySelectorAll(".e-cell-select");if(!(t.length<2)){x(this.curTable);var n=A(this.curTable);this.mergeCellContent();var i=this.getSelectedMinMaxIndexes(L(this.curTable));this.configureFirstCellForMerge(t,i),this.cleanupAfterMerge(t),this.updateTableStructureAfterMerge(i),this.updateColgroupAfterMerge(i.startColumn,i.endColumn,n),this.updateSelectionAfterMerge(e,t[0]),this.executeCallback(e)}},e.prototype.configureFirstCellForMerge=function(e,t){var n=e[0],i=n.parentElement.querySelectorAll(".e-cell-select");t.startColumn<t.endColumn&&n.setAttribute("colspan",(t.endColumn-t.startColumn+1).toString()),t.startRow<t.endRow&&n.setAttribute("rowspan",(t.endRow-t.startRow+1).toString());var s=this.calculateMaxCellHeight(i);n.style.height=s+"px"},e.prototype.updateColgroupAfterMerge=function(e,t,n){var i=w(this.curTable),s=this.isEntireColumnsMerged(n);if(e<t&&s>0){var r=i.querySelectorAll("col"),o=parseFloat(r[e].style.width)||0;if(e<r.length)for(var a=0;a<s;a++){var l=e+1;l<r.length&&(o+=parseFloat(r[l].style.width),i.removeChild(r[l]),r=i.querySelectorAll("col"))}r[e].style.width=o+"%"}},e.prototype.isEntireColumnsMerged=function(e){return e-A(this.curTable)},e.prototype.calculateMaxCellHeight=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n].offsetHeight;i>t&&(t=i)}return t},e.prototype.cleanupAfterMerge=function(e){for(var t=[],n=1;n<e.length;n++)t.push(e[n]);t.forEach((function(e){return sf.base.detach(e)}));var i=[];for(n=0;n<this.curTable.rows.length;n++)""===this.curTable.rows[n].innerHTML.trim()&&i.push(this.curTable.rows[n]);i.forEach((function(e){return sf.base.detach(e)})),T(this.curTable.querySelectorAll("table td, table th"),"e-multi-cells-select"),T(this.curTable.querySelectorAll("table td, table th"),"e-cell-select-end")},e.prototype.updateTableStructureAfterMerge=function(e){this.updateRowSpanStyle(e.startRow,e.endRow,L(this.curTable)),this.updateColSpanStyle(e.startColumn,e.endColumn,L(this.curTable))},e.prototype.updateSelectionAfterMerge=function(e,t){e.item.selection.setSelectionText(this.tableModel.getDocument(),e.item.selection.range.startContainer,e.item.selection.range.startContainer,0,0),this.parent.nodeSelection&&t&&this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(),t,0)},e.prototype.updateColSpanStyle=function(e,t,n){var i,s=0,r=0,o=n;if(e<(t=Math.min(t,o[0].length-1))){for(i=e;i<=t&&(s=this.getEffectiveColspan(o[0][i],t-e+1),!this.isValidColspanStart(o[0],e,i,s)||(r=this.processRowsForColspan(o,i,s)));i++);r&&this.updateCellAttribute(o,r,"colspan",0,o.length-1,e,t)}},e.prototype.getEffectiveColspan=function(e,t){var n=e.getAttribute("colspan"),i=n?parseInt(n,10):1;return Math.min(i,t)},e.prototype.isValidColspanStart=function(e,t,n,i){var s=t<n&&e[n]===e[n-1],r=i>1&&e[n]===e[n+1];return!s&&r},e.prototype.processRowsForColspan=function(e,t,n){for(var i=n-1,s=1;s<e.length&&(e[s][t]===e[s-1][t]||(i=this.processRowCells(e,s,t,n,i)));s++);return i},e.prototype.processRowCells=function(e,t,n,i,s){for(var r=s,o=n;o<n+i;o++){var a=parseInt(e[t][o].getAttribute("colspan"),10)||1;if(a>1&&e[t][o]===e[t][o+1])o+=r=Math.min(r,a-1);else if(0===(r=Math.max(0,r-1)))break}return r},e.prototype.updateRowSpanStyle=function(e,t,n){var i=n,s=0;if(e<(t=Math.min(t,i.length-1))){for(var r=e;r<=t;r++)if(this.isValidRowspanStart(i,e,r,t)){var o=this.getEffectiveRowspan(i[r][0],t-e+1);if(!(s=this.processColumnsForRowspan(i,r,o)))break}s&&this.updateCellAttribute(i,s,"rowspan",e,t,0,i[0].length-1)}},e.prototype.isValidRowspanStart=function(e,t,n,i){var s=!(t<n&&e[n][0]===e[n-1][0]),r=!!e[n][0],o=0;if(r){var a=e[n][0].getAttribute("rowspan");o=a?parseInt(a,10):1,o=Math.min(o,i-t+1)}var l=o>1&&n+1<=i&&e[n][0]===e[n+1][0];return s&&r&&o>1&&l},e.prototype.getEffectiveRowspan=function(e,t){var n=e.getAttribute("rowspan"),i=n?parseInt(n,10):1;return Math.min(i,t)},e.prototype.processColumnsForRowspan=function(e,t,n){for(var i=n-1,s=1;s<e[0].length&&(e[t][s]===e[t][s-1]||(i=this.processColumnCells(e,t,s,n,i)));s++);return i},e.prototype.processColumnCells=function(e,t,n,i,s){for(var r=s,o=t;o<t+i;o++){var a=parseInt(e[o][n].getAttribute("rowspan"),10)||1;if(a>1&&o+1<e.length&&e[o][n]===e[o+1][n])o+=r=Math.min(r,a-1);else if(0===(r=Math.max(0,r-1)))break}return r},e.prototype.updateCellAttribute=function(e,t,n,i,s,r,o){for(var a=i;a<=s;a++)for(var l=r;l<=o;l++)if(e[a][l]){if("true"===e[a][l].dataset.processed)continue;var d=parseInt(e[a][l].getAttribute(n),10)||1;if(this.shouldUpdateCellAttribute(e,a,l,i,r,d)){var c=d-t;this.updateSpanAttribute(e[a][l],n,c),e[a][l].dataset.processed="true"}}this.cleanupProcessedCells()},e.prototype.shouldUpdateCellAttribute=function(e,t,n,i,s,r){var o=i<t&&e[t][n]===e[t-1][n],a=s<n&&e[t][n]===e[t][n-1];return o||a||r>1},e.prototype.updateSpanAttribute=function(e,t,n){n>1?e.setAttribute(t,n.toString()):e.removeAttribute(t)},e.prototype.mergeCellContent=function(){for(var e=this.curTable.querySelectorAll(".e-cell-select"),t=this.isCellEmpty(e[0])?"":e[0].innerHTML,n=1;n<e.length;n++){var i=e[n];this.isCellEmpty(i)||(t=this.appendCellContent(t,i.innerHTML))}e[0].innerHTML=t},e.prototype.isCellEmpty=function(e){return"<br>"===e.innerHTML||""===e.innerHTML},e.prototype.appendCellContent=function(e,t){return e?e+"<br>"+t:t},e.prototype.getSelectedMinMaxIndexes=function(e){var t=this.curTable.querySelectorAll(".e-cell-select");if(t.length>0){for(var n=this.initializeMinMaxData(e),i=0;i<t.length;i++)n=this.updateMinMaxWithCell(n,t[i],e);return n}return null},e.prototype.initializeMinMaxData=function(e){return{startRow:e.length,endRow:0,startColumn:e[0].length,endColumn:0}},e.prototype.updateMinMaxWithCell=function(e,t,n){var i=k(t,n),s=this.FindIndex(i[0],i[1],n);return{startRow:Math.min(i[0],e.startRow),endRow:Math.max(s[0],e.endRow),startColumn:Math.min(i[1],e.startColumn),endColumn:Math.max(s[1],e.endColumn)}},e.prototype.horizontalSplit=function(e){var t=e.item.selection.range.startContainer;if(this.curTable=sf.base.closest(t.parentElement,"table"),!(this.curTable.querySelectorAll(".e-cell-select").length>1)){this.activeCell=this.curTable.querySelector(".e-cell-select");var n=this.prepareNewCellForSplit(),i=k(this.activeCell,L(this.curTable)),s=L(this.curTable),r=this.getRowSpanValue(this.activeCell);r>1?this.splitCellWithRowspan(r,i,s,n):this.splitCellWithoutRowspan(i,s,n),this.executeCallback(e)}},e.prototype.prepareNewCellForSplit=function(){var e=this.activeCell.cloneNode(!0);return e.removeAttribute("class"),e.innerHTML="<br>",e},e.prototype.getRowSpanValue=function(e){return e.getAttribute("rowspan")?parseInt(e.getAttribute("rowspan"),10):1},e.prototype.splitCellWithRowspan=function(e,t,n,i){var s=Math.ceil(e/2),r=e-s;if(this.activeCell.style&&this.activeCell.style.height){var o=this.activeCell.offsetHeight/e;this.activeCell.style.height=o*s+"px",i.style.height=o*r+"px"}this.updateRowspanAttributes(this.activeCell,i,s,r);var a=t[0]+s,l=this.findInsertionColumnIndex(n,a,t[1]);this.insertNewCellIntoRow(n,a,l,i)},e.prototype.updateRowspanAttributes=function(e,t,n,i){n>1?e.setAttribute("rowspan",n.toString()):e.removeAttribute("rowspan"),i>1?t.setAttribute("rowspan",i.toString()):t.removeAttribute("rowspan")},e.prototype.findInsertionColumnIndex=function(e,t,n){for(var i=0===n?n:n-1;i>=0;){var s=e[t][i]===e[t][i-1],r=t>0&&e[t][i]===e[t-1][i];if(!s&&!r)break;i--}return i},e.prototype.insertNewCellIntoRow=function(e,t,n,i){if(-1===n){var s=this.curTable.rows[t];s.firstChild?s.prepend(i):this.curTable.appendChild(i)}else e[t][n].insertAdjacentElement("afterend",i)},e.prototype.splitCellWithoutRowspan=function(e,t,n){if(this.activeCell.style&&this.activeCell.style.height){var i=this.activeCell.offsetHeight/2;this.activeCell.style.height=i+"px",n.style.height=i+"px"}var s=sf.base.createElement("tr");s.appendChild(n);var r=t[e[0]];if(this.adjustRowspansInRow(r),this.activeCell.parentNode.style&&this.activeCell.parentNode.style.height){var o=parseFloat(this.activeCell.parentNode.style.height)/2;s.style.height=o+"%",this.activeCell.parentNode.style.height=o+"%"}this.activeCell.parentNode.insertAdjacentElement("afterend",s)},e.prototype.adjustRowspansInRow=function(e){for(var t=0;t<=e.length-1;t++)if(e[t]!==e[t-1]&&e[t]!==this.activeCell){var n=parseInt(e[t].getAttribute("rowspan"),10)||1;e[t].setAttribute("rowspan",(n+1).toString())}},e.prototype.verticalSplit=function(e){var t=e.item.selection.range.startContainer;if(this.curTable=sf.base.closest(t.parentElement,"table"),!(this.curTable.querySelectorAll(".e-cell-select").length>1)){x(this.curTable);var n=A(this.curTable);this.activeCell=this.curTable.querySelector(".e-cell-select");var i=this.prepareNewCellForVerticalSplit(),s=k(this.activeCell,L(this.curTable)),r=L(this.curTable),o=this.getColSpanValue(this.activeCell),a={leftCellWidth:0,rightCellWidth:0};a=o>1?this.splitCellWithColspan(o,s,i):this.splitCellWithoutColspan(s,r),this.activeCell.parentNode.insertBefore(i,this.activeCell.nextSibling),this.updateColgroupAfterVerticalSplit(this.curTable,s[1],a,n),this.executeCallback(e)}},e.prototype.updateColgroupAfterVerticalSplit=function(e,t,n,i){var s=w(e),r=A(e),o=s.querySelectorAll("col");if(t<o.length&&i<r){o[t].style.width=n.leftCellWidth+"%";var a=sf.base.createElement("col");a.appendChild(sf.base.createElement("br")),a.style.width=n.rightCellWidth+"%",o[t].parentNode.insertBefore(a,o[t].nextSibling)}},e.prototype.prepareNewCellForVerticalSplit=function(){var e=this.activeCell.cloneNode(!0);return e.removeAttribute("class"),e.innerHTML="<br>",e},e.prototype.getColSpanValue=function(e){return parseInt(e.getAttribute("colspan"),10)||1},e.prototype.splitCellWithColspan=function(e,t,n){var i=Math.ceil(e/2),s=e-i,r=this.getColSizes(this.curTable),o=this.calculateLeftCellWidth(t[1],i,r),a=this.calculateRightCellWidth(t[1],i,e,r,o);return this.updateColspanAttributes(this.activeCell,n,i,s),{leftCellWidth:o,rightCellWidth:a}},e.prototype.calculateLeftCellWidth=function(e,t,n){return this.getSplitColWidth(e,e+t-1,n)},e.prototype.calculateRightCellWidth=function(e,t,n,i,s){var r=this.getSplitColWidth(e+t,e+n-1,i),o=M(this.activeCell.offsetWidth,this.curTable.offsetWidth);return o-s<r?o-s:r},e.prototype.updateColspanAttributes=function(e,t,n,i){n>1?e.setAttribute("colspan",n.toString()):e.removeAttribute("colspan"),i>1?t.setAttribute("colspan",i.toString()):t.removeAttribute("colspan")},e.prototype.splitCellWithoutColspan=function(e,t){var n=M(this.activeCell.offsetWidth,this.curTable.offsetWidth)/2;return this.adjustColspansInColumn(t,e),{leftCellWidth:n,rightCellWidth:n}},e.prototype.adjustColspansInColumn=function(e,t){for(var n=this.curTable.rows,i=0;i<=n.length-1;i++)if(this.shouldAdjustColspanForCell(i,e,t)){var s=e[i][t[1]];this.incrementColspan(s)}},e.prototype.shouldAdjustColspanForCell=function(e,t,n){return(0===e||t[e][n[1]]!==t[e-1][n[1]])&&t[e][n[1]]!==this.activeCell},e.prototype.incrementColspan=function(e){var t=parseInt(e.getAttribute("colspan"),10)||1;e.setAttribute("colspan",(t+1).toString())},e.prototype.getSplitColWidth=function(e,t,n){for(var i=0,s=e;s<=t;s++)i+=n[s];return M(i,this.curTable.offsetWidth)},e.prototype.getColSizes=function(e){for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;for(var s=new Array(n),r=new Map,o=0;o<e.rows.length;o++)for(var a=0,l=0;l<e.rows[o].cells.length;l++){this.mapRowspanCells(e,r,o,l,a);var d=B(r,o,l);d>a&&(a=d),this.storeCellWidth(e,s,a,o,l),a+=1+e.rows[o].cells[l].colSpan-1}return s},e.prototype.mapRowspanCells=function(e,t,n,i,s){for(var r=1;r<e.rows[n].cells[i].rowSpan;r++){var o=""+(n+r)+s;t.set(o,e.rows[n].cells[i])}},e.prototype.storeCellWidth=function(e,t,n,i,s){var r=e.rows[i].cells[s].offsetWidth;(!t[n]||r<t[n])&&(t[n]=r)},e.prototype.FindIndex=function(e,t,n){for(var i=e+1,s=t+1;i<n.length;){if(n[i][t]!==n[e][t]){i--;break}i++}for(i===n.length&&i--;s<n[e].length;){if(n[e][s]!==n[e][t]){s--;break}s++}return s===n[e].length&&s--,[i,s]},e.prototype.isMergedCell=function(e){return parseInt(e.getAttribute("rowspan")||"1",10)>1||parseInt(e.getAttribute("colspan")||"1",10)>1},e.prototype.adjustBoundary=function(e,t,n,i,s,r,o){var a=k(n[e][t],n),l=this.FindIndex(a[0],a[1],n);return l&&(i=Math.min(a[0],i),s=Math.max(l[0],s),r=Math.min(a[1],r),o=Math.max(l[1],o)),[i,s,r,o]},e.prototype.highlightCells=function(e,t,n,i,s){for(var r,o,a,l,d=e,c=t,h=n,p=i,u=d;u<=c;u++){this.isMergedCell(s[u][h])&&(d=(r=this.adjustBoundary(u,h,s,d,c,h,p))[0],c=r[1],h=r[2],p=r[3]),this.isMergedCell(s[u][p])&&(d=(o=this.adjustBoundary(u,p,s,d,c,h,p))[0],c=o[1],h=o[2],p=o[3]);for(var f=h;f<=p;f++)this.isMergedCell(s[d][f])&&(d=(a=this.adjustBoundary(d,f,s,d,c,h,p))[0],c=a[1],h=a[2],p=a[3]),this.isMergedCell(s[c][f])&&(d=(l=this.adjustBoundary(c,f,s,d,c,h,p))[0],c=l[1],h=l[2],p=l[3])}return d===e&&c===t&&h===n&&p===i?{startRow:e,endRow:t,startColumn:n,endColumn:i}:this.highlightCells(d,c,h,p,s)},e.prototype.restoreRange=function(e){if(this.parent.userAgentData.isSafari())this.parent.nodeSelection.Clear(this.tableModel.getDocument());else{var t="TD"===e.nodeName||"TH"===e.nodeName;this.tableModel.getDocument().getSelection().rangeCount>0&&t&&this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(),e,0)}},e.prototype.tableStyle=function(e){this.executeCallback(e)},e.prototype.tableMove=function(e){if(this.activeCell=e.selectNode[0],this.activeCell){var t=e.event.target;if(!this.isValidCellTarget(t)){var n=null;if((n=t.nodeType!==Node.ELEMENT_NODE?t.parentElement:t)&&"TD"!==n.tagName&&"TH"!==n.tagName&&(n=sf.base.closest(n,"TD")||sf.base.closest(n,"TH")),!n)return;t=n}this.curTable=sf.base.closest(t,"table");var i=sf.base.closest(this.activeCell,"table");if(i.contains(this.curTable)){var s=this.findContainingCell(i,this.curTable);s&&(this.curTable=i,t=s)}if(this.areCellsInSameTable(this.curTable,i)){var r=L(this.curTable),o=k(this.activeCell,r),a=k(t,r),l=this.clearPreviousSelection();this.isSameCellSelected(o,a,l)||(this.selectCellRange(o,a,r),t.classList.add("e-cell-select-end"),e.event.type&&e.event.preventDefault(),this.restoreRange(t))}}},e.prototype.findContainingCell=function(e,t){for(var n=e.rows,i=0;i<n.length;i++)for(var s=n[i].cells,r=0;r<s.length;r++){var o=s[r];if(o.contains(t))return o}return null},e.prototype.isValidCellTarget=function(e){if(!this.activeCell||!e)return!1;var t=this.activeCell.tagName,n=e.tagName;return"TD"===e.tagName||"TH"===e.tagName||t===n},e.prototype.areCellsInSameTable=function(e,t){return!sf.base.isNullOrUndefined(e)&&!sf.base.isNullOrUndefined(t)&&e===t},e.prototype.clearPreviousSelection=function(){for(var e=this.curTable.querySelectorAll(".e-cell-select, .e-multi-cells-select, .e-cell-select-end"),t=e.length-1;t>=0;t--){var n=t;this.activeCell!==e[n]&&T([e[n]],["e-cell-select"]),T([e[n]],["e-multi-cells-select"]),T([e[n]],["e-cell-select-end"])}return e},e.prototype.isSameCellSelected=function(e,t,n){return!(e[0]!==t[0]||e[1]!==t[1])&&(n.length>1&&this.restoreRange(this.activeCell),!0)},e.prototype.selectCellRange=function(e,t,n){for(var i=this.highlightCells(Math.min(e[0],t[0]),Math.max(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[1],t[1]),n),s=i.startRow;s<=i.endRow;s++)for(var r=s,o=i.startColumn;o<=i.endColumn;o++){var a=o;n[r][a].classList.add("e-cell-select"),n[r][a].classList.add("e-multi-cells-select")}},e.prototype.destroy=function(){this.removeEventListener(),this.resizeIconPositionTime&&(clearTimeout(this.resizeIconPositionTime),this.resizeIconPositionTime=null)},e.prototype.cellStyleCleanup=function(e){for(var t=e.split(";"),n=[],i=["background-color","vertical-align","text-align"],s=0;s<t.length;s++){for(var r=t[s],o=!0,a=0;a<i.length;a++){var l=i[a];if(r.indexOf(l)>-1){o=!1;break}}o&&n.push(r)}return n.join(";")},e.prototype.calMaxCol=function(e){if(!(e&&e.rows&&0!==e.rows.length&&e.rows[0]&&e.rows[0].cells))return[];for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;for(var s=new Array(n),r=new Map,o=0;o<e.rows.length;o++)for(var a=0,l=0;l<e.rows[o].cells.length;l++){for(var d=1;d<e.rows[o].cells[l].rowSpan;d++){var c=""+(o+d)+a;r.set(c,e.rows[o].cells[l])}var h=B(r,o,l);h>a&&(a=h);var p=e.rows[o].cells[l].offsetWidth;(!s[a]||p<s[a].offsetWidth)&&(s[a]=e.rows[o].cells[l]),a+=1+e.rows[o].cells[l].colSpan-1}return s},e.prototype.resizeBtnInit=function(){return this.resizeBtnStat={column:!1,row:!1,tableBox:!1}},e.prototype.calcPos=function(e){var t={top:0,left:0};if(!e)return t;var n=e.getBoundingClientRect(),i=e.ownerDocument,s=this.getOffsetParent(e,i),r=!1;if(s&&"TD"===s.nodeName&&"TABLE"===e.nodeName&&(s=sf.base.closest(s,".e-rte-content"),r=!0),s&&s!==e&&1===s.nodeType&&(t=s.getBoundingClientRect()),r){r=!1;var o=this.iframeSettings.enable?i.documentElement:this.tableModel.getEditPanel(),a=o&&o.scrollTop||0,l=o&&o.scrollLeft||0;return{top:a>0?a+n.top-t.top:n.top-t.top,left:l>0?l+n.left-t.left:n.left-t.left}}if(s!==this.tableModel.getEditPanel()&&"TABLE"===e.nodeName){for(var d=e;d&&d.parentElement!==this.tableModel.getEditPanel();)d=d.parentElement;var c=d.getBoundingClientRect();return{top:this.iframeSettings.enable?n.top:d.offsetTop+n.top-c.top,left:n.left-c.left+1}}return{top:e.offsetTop,left:e.offsetLeft}},e.prototype.getOffsetParent=function(e,t){for(var n=e.offsetParent||t.documentElement;n&&(n===t.body||n===t.documentElement)&&"static"===n.style.position;)n=n.parentNode;return n},e.prototype.getPointX=function(e){var t=e,n=e;return t.touches&&t.touches.length>0?t.touches[0].pageX:n.pageX},e.prototype.getPointY=function(e){var t=e,n=e;return t.touches&&t.touches.length>0?t.touches[0].pageY:n.pageY},e.prototype.getCurrentColWidth=function(e,t){var n=0;if(e&&e.style&&""!==e.style.width){var i=e.style.width;n=-1!==i.indexOf("%")?parseFloat(i.split("%")[0]):M(e.offsetWidth,t)}else e&&t>0&&(n=M(e.offsetWidth,t));return n},e.prototype.resetResizeHelper=function(e){var t=this.tableModel.rteElement.querySelectorAll(".e-table-rhelper.e-column-helper");Array.from(t).forEach((function(e){e.parentNode&&e.parentNode.removeChild(e)}));var n=this.tableModel.rteElement.querySelectorAll(".e-table-rhelper.e-row-helper");Array.from(n).forEach((function(e){e.parentNode&&e.parentNode.removeChild(e)})),0===parseInt(e.style.width,10)&&(e.style.width=e.offsetWidth+"px")},e.prototype.resizeStart=function(e){if(this.parent&&this.tableModel&&!this.tableModel.readonly){sf.base.Browser.isDevice&&this.resizeHelper(e);var t=e.target;if(t&&(t.classList.contains("e-column-resize")||t.classList.contains("e-row-resize")||t.classList.contains("e-table-box"))){if(this.resetResizeHelper(this.curTable),e.preventDefault(),this.tableModel.preventDefaultResize(e),!t.classList.contains("e-table-box")){var n=this.tableModel.getEditPanel().querySelector(".e-table-box");sf.base.isNullOrUndefined(n)||parseInt(t.getAttribute("data-col"),10)===this.calMaxCol(this.curTable).length||n.classList.add("e-hide")}if(T(this.curTable.querySelectorAll("td,th"),"e-cell-select"),this.removeTableSelection(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),this.resizeBtnStat=this.resizeBtnInit(),this.tableModel.hideTableQuickToolbar(),t.classList.contains("e-column-resize")?this.handleColumnResize(t):t.classList.contains("e-row-resize")?this.handleRowResize(t):t.classList.contains("e-table-box")&&(this.resizeBtnStat.tableBox=!0),sf.base.Browser.isDevice&&this.helper&&!this.helper.classList.contains("e-reicon"))this.helper.classList.add("e-reicon"),sf.base.EventHandler.add(document,sf.base.Browser.touchStartEvent,this.removeHelper,this),sf.base.EventHandler.add(this.helper,sf.base.Browser.touchStartEvent,this.resizeStart,this);else{var i={event:e,requestType:"Table"};this.tableModel.resizeStart(i)}this.isResizeBind&&(sf.base.EventHandler.add(this.tableModel.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing,this),sf.base.EventHandler.add(this.tableModel.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd,this),this.isResizeBind=!1)}}},e.prototype.handleColumnResize=function(e){this.resizeBtnStat.column=!0,x(this.curTable);var t=e.getAttribute("data-col")||"0",n=parseInt(t,10);n===this.calMaxCol(this.curTable).length?(this.currentColumnResize="last",this.colIndex=n-1,this.columnEle=this.calMaxCol(this.curTable)[this.colIndex]):(this.currentColumnResize=0===n?"first":"middle",this.colIndex=n,this.columnEle=this.calMaxCol(this.curTable)[this.colIndex]),this.appendHelper(e)},e.prototype.appendHelper=function(e){var t="e-table-rhelper"+this.tableModel.getCssClass(!0);this.helper=sf.base.createElement("div",{className:t}),sf.base.Browser.isDevice&&this.helper.classList.add("e-reicon"),this.tableModel.getEditPanel().appendChild(this.helper),this.setHelperHeight(e),this.hideRowColumnAddIcons(e)},e.prototype.setHelperHeight=function(e){if(this.resizeBtnStat&&this.resizeBtnStat.column){this.helper.classList.add("e-column-helper");var t=e.style.height,n=parseFloat(e.style.left)+.5,i=e.style.top;this.helper.style.cssText="height: "+t+"; top: "+i+"; left: "+n+"px;"}else{this.helper.classList.add("e-row-helper");var s=e.style.width,r=parseFloat(e.style.top)-.5,o=e.style.left;this.helper.style.cssText="width: "+s+"; top: "+r+"px; left: "+o+";"}},e.prototype.updateHelper=function(){if(this.helper){var e=this.calcPos(this.curTable);if(e=this.adjustPositionForScrollbar(e,this.curTable),this.resizeBtnStat&&this.resizeBtnStat.column){var t=e.left+this.calcPos(this.columnEle).left+(this.tableModel.enableRtl?this.columnEle.getBoundingClientRect().width:0)+("last"!==this.currentColumnResize||this.tableModel.enableRtl?0:this.columnEle.offsetWidth)-1;this.helper.style.left=t+"px",this.helper.style.height=this.curTable.offsetHeight+"px"}else{var n=this.calcPos(this.rowEle).top+e.top+this.rowEle.offsetHeight-1;this.helper.style.top=n+"px",this.helper.style.width=this.curTable.offsetWidth+"px"}}},e.prototype.handleRowResize=function(e){var t=e.getAttribute("data-row")||"0",n=parseInt(t,10);this.rowEle=this.curTable.rows[n],this.resizeBtnStat.row=!0,this.appendHelper(e)},e.prototype.addResizeEventHandlers=function(){this.tableModel.tableSettings.resize&&sf.base.EventHandler.add(this.tableModel.getEditPanel(),sf.base.Browser.touchStartEvent,this.resizeStart,this),sf.base.Browser.isDevice||sf.base.EventHandler.add(this.tableModel.getEditPanel(),"mouseover",this.resizeHelper,this)},e.prototype.removeResizeEventHandlers=function(){sf.base.EventHandler.remove(this.tableModel.getEditPanel(),sf.base.Browser.touchStartEvent,this.resizeStart),this.cancelResizeAction()},e.prototype.resizeHelper=function(e){if(this.parent&&this.tableModel&&!this.tableModel.readonly&&!(this.isTableMoveActive||e&&e.buttons&&e.buttons>0)){var t=null;if(e&&e.targetTouches&&e.targetTouches.length>0?t=e.targetTouches[0].target:e&&e.target&&(t=e.target),t){var n=sf.base.closest(t,"table.e-rte-table, table.e-rte-paste-table, table.e-rte-custom-table"),i=this.tableModel.getEditPanel(),s=i.querySelectorAll(".e-table-box.e-rbox-select, .e-table-rhelper.e-column-helper, .e-table-rhelper.e-row-helper").length>0;if(s||sf.base.isNullOrUndefined(this.curTable)||sf.base.isNullOrUndefined(n)||n===this.curTable||!i.contains(n)||(this.removeResizeElement(),this.removeHelper(e),this.cancelResizeAction()),!this.isTableNode(t)){var r=sf.base.closest(t,"td, th");r&&(t=r)}!s&&this.isTableNode(t)?(n&&i.contains(n)&&("TD"===t.nodeName||"TH"===t.nodeName)?this.curTable=n:this.curTable=t,this.removeResizeElement(),this.tableResizeEleCreation(this.curTable,e),this.handleRowColumnAddIcon(t,this.curTable)):this.hideRowColumnAddIcons(t)}}},e.prototype.isTableNode=function(e){return"TABLE"===e.nodeName||"TD"===e.nodeName||"TH"===e.nodeName},e.prototype.handleRowColumnAddIcon=function(e,t){if(e&&"TABLE"!==e.nodeName){var n=this.getAttributeValue(e,"rowspan",1),i=this.getAttributeValue(e,"colspan",1),s=k(e,L(t));if(!(s.length<2)){var r=s[0]+(n-1),o=s[1];0!==r&&0!==o||(this.updateRowInsertIcons(r,n),this.updateColumnInsertIcons(o,i))}}},e.prototype.getAttributeValue=function(e,t,n){if(!e.hasAttribute(t))return n;var i=e.getAttribute(t);return i?parseInt(i,10):n},e.prototype.createIcon=function(e){return sf.base.createElement("span",{attrs:{unselectable:"on",contenteditable:"false"},className:"e-icons "+e})},e.prototype.updateRowInsertIcons=function(e,t){for(var n=this.tableModel.getEditPanel(),i=0;i<=t;i++){var s='.e-rte-table-resize.e-tb-row-insert[data-row="'+(e-i)+'"]',r=n.querySelector(s);this.updateInsertIcon(r)}},e.prototype.updateColumnInsertIcons=function(e,t){for(var n=this.tableModel.getEditPanel(),i=0;i<=t;i++){var s='.e-rte-table-resize.e-tb-col-insert[data-col="'+(e+i)+'"]',r=n.querySelector(s);this.updateInsertIcon(r)}},e.prototype.updateInsertIcon=function(e){if(e){var t=this.tableModel.enableRtl?"e-circle e-insert-cell-rtl":"e-circle",n=this.createIcon(t);e.appendChild(n),e.style.opacity="1"}},e.prototype.hideRowColumnAddIcons=function(e){if(e&&e.classList&&!e.classList.contains("e-circle-add")&&(!e.classList.contains("e-rte-table-resize")||this.tableModel.getEditPanel().contains(this.helper))){var t=this.tableModel.getEditPanel();if(t.querySelectorAll(".e-rte-table-resize .e-icons.e-circle-add").length>0)this.removeResizeElement();else t.querySelectorAll(".e-rte-table-resize .e-icons.e-circle").forEach((function(e){var t=e.parentElement;t&&(t.style.opacity="0",sf.base.detach(e))}))}},e.prototype.resizeEnd=function(e){if(this.parent){if(this.resizeBtnInit(),this.isResizeBind=!0,sf.base.EventHandler.remove(this.tableModel.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing),sf.base.EventHandler.remove(this.tableModel.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd),this.tableModel.getEditPanel().querySelector(".e-table-box")&&this.tableModel.getEditPanel().contains(this.tableModel.getEditPanel().querySelector(".e-table-box"))){var t=this.tableModel.getEditPanel().querySelector(".e-table-box");sf.base.isNullOrUndefined(t)||t.classList.remove("e-hide"),sf.base.Browser.isDevice||(sf.base.EventHandler.remove(this.tableModel.getEditPanel(),"mouseover",this.resizeHelper),sf.base.EventHandler.add(this.tableModel.getEditPanel(),"mouseover",this.resizeHelper,this)),this.removeResizeElement()}this.helper&&this.tableModel.getEditPanel().contains(this.helper)&&(sf.base.detach(this.helper),this.helper=null),this.resetResizeHelper(this.curTable),this.pageX=null,this.pageY=null;for(var n=this.curTable.querySelectorAll("tr"),i=[],s=0;s<n.length;s++){var r=parseFloat(n[s].clientHeight.toString())/parseFloat(this.curTable.clientHeight.toString())*100;i[s]=r}for(s=0;s<n.length;s++)n[s].style.height&&("THEAD"===n[s].parentElement.nodeName?(n[s].parentElement.style.height=i[s]+"%",n[s].style.height=i[s]+"%"):n[s].style.height=i[s]+"%");var o={event:e,requestType:"table"};this.tableModel.resizeEnd(o),this.resizeEndTime=(new Date).getTime()}},e.prototype.cancelResizeAction=function(){this.isResizeBind=!0,sf.base.EventHandler.remove(this.tableModel.getEditPanel(),sf.base.Browser.touchMoveEvent,this.resizing),sf.base.EventHandler.remove(this.tableModel.getEditPanel(),sf.base.Browser.touchEndEvent,this.resizeEnd),this.removeResizeElement()},e.prototype.removeResizeElement=function(){var e=this.tableModel.getEditPanel().querySelectorAll(".e-column-resize, .e-row-resize, .e-table-box, .e-table-rhelper, .e-tb-col-insert, .e-tb-row-insert");if(e&&e.length>0)for(var t=0;t<e.length;t++){var n=e[t];if(n){if(n.classList&&(n.classList.contains("e-tb-col-insert")||n.classList.contains("e-tb-row-insert"))){var i=n.querySelector(".e-circle-add");i&&sf.base.EventHandler.remove(i,"mousedown",this.handleIconMouseDown),this.removeInsertIconEvents(n)}sf.base.detach(e[t])}}var s=this.parent.editableElement?this.parent.editableElement.lastChild:null;s&&"P"===s.nodeName&&(sf.base.removeClass([s],["e-rte-last-paragraph"]),0===s.classList.length&&s.removeAttribute("class"))},e.prototype.removeHelper=function(e){var t=e?e.target:null,n=t?t.classList:null;n&&!n.contains("e-reicon")&&this.helper&&(sf.base.EventHandler.remove(document,sf.base.Browser.touchStartEvent,this.removeHelper),sf.base.EventHandler.remove(this.helper,sf.base.Browser.touchStartEvent,this.resizeStart),this.tableModel.getEditPanel().contains(this.helper)&&sf.base.detach(this.helper),this.pageX=null,this.helper=null)},e.prototype.tableResizeEleCreation=function(e,t){if(e&&t){this.tableModel.preventDefaultResize(t);var n=this.calMaxCol(this.curTable),i=this.getTableRowsWithoutRowspan(e),s=parseFloat(getComputedStyle(e).height)||0,r=parseFloat(getComputedStyle(e).width)||0,o=this.parent.editableElement?this.parent.editableElement.lastChild:null;o&&"P"===o.nodeName&&sf.base.addClass([o],["e-rte-last-paragraph"]);var a=this.calcPos(e);a=this.adjustPositionForScrollbar(a,e);var l=L(e);this.createColumnResizers(n,s,a,l),this.createRowResizers(i,e,r,a,l),this.tableModel.tableSettings.resize&&this.createResizeBox(n.length,a,r,s)}},e.prototype.adjustPositionForScrollbar=function(e,t){if(!this.tableModel.enableRtl)return e;if(this.iframeSettings.enable){var n=this.tableModel.getDocument();if(!(n&&n.defaultView&&n.body&&n.body.id))return e;var i=this.getOffsetParent(t,n);if(!(i&&"TD"===i.nodeName&&"TABLE"===t.nodeName))return e;var s=n.defaultView.parent&&n.defaultView.parent.window,r=s&&s.document,o=n.body.id.replace("-edit","");if(r&&o){var a=r.querySelector("#"+o);if(a)(l=a.clientWidth-n.body.clientWidth)>0&&(e.left-=l)}}else{var l,d=this.tableModel.getEditPanel();if(d)(l=d.offsetWidth-d.clientWidth)>0&&this.tableModel.enableRtl&&(e.left-=l)}return e},e.prototype.resizing=function(e){if(this.parent&&this.tableModel){var t={event:e,requestType:"table"};this.tableModel.resizing(t)}},e.prototype.perfomResizing=function(e){var t,n=this.getPointX(e),i=this.getPointY(e),s=this.tableModel.enableRtl?-(n-this.pageX):n-this.pageX,r=this.tableModel.enableRtl?-(i-this.pageY):i-this.pageY;this.pageX=n,this.pageY=i;var o,a=this.curTable.closest("td"),l=this.tableModel.getEditPanel().querySelector(".e-table-box"),d=parseInt(getComputedStyle(this.curTable).width,10),c=isNaN(parseInt(this.curTable.style.height,10))?parseInt(getComputedStyle(this.curTable).height,10):parseInt(this.curTable.style.height,10),h=+getComputedStyle(this.tableModel.getEditPanel()).paddingRight.match(/\d/g).join(""),p=this.tableModel.getEditPanel().offsetWidth-(this.tableModel.getEditPanel().offsetWidth-this.tableModel.getEditPanel().clientWidth)-2*h,u=this.curTable&&this.curTable.parentElement;if(sf.base.isNullOrUndefined(this.curTable.parentElement.closest("table"))||sf.base.isNullOrUndefined(this.curTable.closest("td"))||!this.tableModel.getEditPanel().contains(this.curTable.closest("td")))o=u&&u!==this.tableModel.getEditPanel()&&u.clientWidth!==p?u.clientWidth-2*+getComputedStyle(u).paddingRight.match(/\d/g).join(""):p;else{var f=this.curTable.closest("td"),m=+getComputedStyle(f).paddingRight.match(/\d/g).join("");o=f.offsetWidth-(f.offsetWidth-f.clientWidth)-2*m}if(this.resizeBtnStat.column){this.curTable.closest("li")&&(o=this.curTable.closest("li").offsetWidth);var g=this.curTable.querySelectorAll("colgroup > col"),b=void 0;b=""!==this.curTable.style.width&&this.curTable.style.width.includes("%")?parseFloat(this.curTable.style.width.split("%")[0]):this.getCurrentTableWidth(this.curTable.offsetWidth,this.tableModel.getEditPanel().offsetWidth);var v=g[this.colIndex],y=this.getCurrentColWidth(v,d);if("first"===this.currentColumnResize){if(s-=.75,this.removeResizeElement(),a&&(t=this.curTable.getBoundingClientRect().right-this.calcPos(a).left,this.curTable.style.maxWidth=t+"px"),(0!==s&&5<y||s<0)&&b<=100&&M(d-s,o)<=100){var C=g[this.colIndex];this.curTable.style.width=M(d-s,o)>100?"100%":M(d-s,o)+"%";var N=b-M(d-s,o),E=0;if(!(U=this.curTable.style.width.indexOf("%")>-1)&&this.curTable.offsetWidth>this.tableModel.getEditPanel().offsetWidth)return void(this.curTable.style.width=p+"px");if(U&&parseFloat(this.curTable.style.width.split("%")[0])>100)return void(this.curTable.style.width="100%");if(!sf.base.isNullOrUndefined(this.curTable.style.marginLeft)&&""!==this.curTable.style.marginLeft){var S=this.curTable.style.marginLeft.match(/[-+]?\d*\.\d+|\d+/);sf.base.isNullOrUndefined(S)||(E=parseFloat(S[0]))}var T=E+N;if(T&&T>100)T=100-parseFloat(this.curTable.style.width);if(!this.curTable.classList.contains("e-rte-paste-table")&&T&&T<1)return this.curTable.style.marginLeft=null,void(this.curTable.style.width="100%");this.curTable.style.marginLeft="calc("+("100%"===this.curTable.style.width?0:T)+"%)";var L=this.getCurrentColWidth(C,d);C.style.width=L-N+"%"}}else if("last"===this.currentColumnResize){if(s+=.75,this.removeResizeElement(),a&&(t=a.getBoundingClientRect().right-this.curTable.getBoundingClientRect().left,this.curTable.style.maxWidth=t+"px"),(0!==s&&5<y||s>0)&&b<=100&&M(d+s,o)<=100){var O=g[this.colIndex];this.curTable.style.width=M(d+s,o)>100?"100%":M(d+s,o)+"%";N=b-M(d+s,o),L=this.getCurrentColWidth(O,d);O.style.width=L-N+"%"}}else{var k=g[this.colIndex].offsetWidth-s,x=g[this.colIndex].offsetWidth+g[this.colIndex-1].offsetWidth;if(x-k>20&&k>20){var w=x-k,A=k;g[this.colIndex-1].style.width=M(w,d)+"%",g[this.colIndex].style.width=M(A,d)+"%"}}this.updateHelper()}else if(this.resizeBtnStat.row){this.tableModel.preventDefaultResize(e);for(var B=[],R=this.curTable.querySelectorAll("tr"),D=0;D<R.length;D++)this.rowEle!==R[D]&&(B[D]=parseFloat(R[D].clientHeight.toString()));this.curTable.style.height=parseFloat(this.curTable.clientHeight.toString())+(r>0?0:r)+"px";for(D=0;D<R.length;D++)this.rowEle===R[D]?R[D].style.height=parseFloat(R[D].clientHeight.toString())+r+"px":R[D].style.height=B[D]+"px";sf.base.isNullOrUndefined(l)||(l.style.cssText="top: "+(this.calcPos(this.curTable).top+c-4)+"px; left:"+(this.calcPos(this.curTable).left+(this.tableModel.enableRtl?0:d)-4)+"px;"),this.updateHelper()}else if(this.resizeBtnStat.tableBox){if(a){var I=this.curTable.getBoundingClientRect().left-a.getBoundingClientRect().left;t=Math.abs(I-a.getBoundingClientRect().width)-5,this.curTable.style.maxWidth=t+"px"}var U;if(this.curTable.style.height=c+r+"px",sf.base.isNullOrUndefined(l)||(l.classList.add("e-rbox-select"),l.style.cssText="top: "+(this.calcPos(this.curTable).top+parseInt(getComputedStyle(this.curTable).height,10)-4)+"px; left:"+(this.calcPos(this.curTable).left+(this.tableModel.enableRtl?0:d)-4)+"px;"),this.curTable.closest("li")&&(o=this.curTable.closest("li").offsetWidth),(U=this.curTable.style.width.indexOf("%")>-1)&&parseFloat(this.curTable.style.width.split("%")[0])>100)return void(this.curTable.style.width="100%");if(!U&&this.curTable.offsetWidth>this.tableModel.getEditPanel().offsetWidth)return void(this.curTable.style.width=p+"px");this.curTable.style.width=U?M(d+s,o)+"%":d+s+"px"}},e.prototype.getCurrentTableWidth=function(e,t){return 0===t?0:e/t*100},e.prototype.getTableRowsWithoutRowspan=function(e){for(var t=[],n=0;n<e.rows.length;n++)for(var i=0;i<e.rows[n].cells.length;i++)if(!e.rows[n].cells[i].hasAttribute("rowspan")){t.push(e.rows[n].cells[i]);break}return t},e.prototype.createColumnResizers=function(e,t,n,i){var s=e.filter((function(e){return null!=e})),r=this.tableModel.enableRtl,o=n.left;if(r)for(var a=0;a<s.length;a++)o+=s[a].getBoundingClientRect().width;for(a=0;a<=s.length;a++){if(0!==a){var l=s[a-1];o+=r?-l.getBoundingClientRect().width:l.getBoundingClientRect().width}if(this.tableModel.tableSettings.resize){var d=sf.base.createElement("span",{attrs:{"data-col":a.toString(),unselectable:"on",contenteditable:"false"}});d.classList.add("e-rte-table-resize","e-column-resize"),d.style.cssText="height:"+t+"px;width:4px;top:"+n.top+"px;left:"+(o-1.5)+"px;",this.tableModel.getEditPanel().appendChild(d)}0===a||a!==s.length&&i[0][a]===i[0][a-1]||this.createTableInsertIcon({index:a,top:n.top,left:o,cellType:"column",allCells:i,isRTL:r})}},e.prototype.createTableInsertIcon=function(e){var t,n="column"===e.cellType,i=n?"data-col":"data-row",s=n?"e-tb-col-insert":"e-tb-row-insert",r=n?"e-column-resize":"e-row-resize",o=n?"e-column-helper":"e-row-helper",a=sf.base.createElement("span",{attrs:(t={},t[i]=e.index.toString(),t.unselectable="on",t.contenteditable="false",t)});a.classList.add("e-rte-table-resize",s),e.isRTL&&a.classList.add("e-insert-cell-rtl");var l="left:"+(n?e.left-12.5:e.left-14.3)+"px;top:"+(n?e.top-14.3:e.top-11.5)+"px;";a.style.cssText=a.style.cssText+l,this.attachInsertIconEvents(a,i,r,o,e.allCells,e.isRTL)},e.prototype.attachInsertIconEvents=function(e,t,n,i,s,r){sf.base.EventHandler.add(e,"mouseover",this.handleIconMouseOver.bind(this,e,t,n,i,r,s),this),sf.base.EventHandler.add(e,"mouseout",this.handleIconMouseOut.bind(this,e),this);var o=this.tableModel.getEditPanel();o&&o.appendChild(e)},e.prototype.handleIconMouseOver=function(e,t,n,i,s,r){var o=e.querySelector(".e-circle");o&&o.classList&&o.classList.contains("e-circle")&&(sf.base.detach(o),e.style.cursor=this.isResizeBind?"pointer":"",this.isResizeBind&&this.handleInsertIconHover(e,t,n,i,s,r))},e.prototype.handleIconMouseOut=function(e,t){var n=t.relatedTarget;n&&!e.contains(n)&&"1"===e.style.opacity&&this.removeResizeElement()},e.prototype.handleIconMouseDown=function(e,t,n,i){if(i&&this.parent&&this.parent.undoRedoManager){i.preventDefault(),i.stopPropagation(),this.removeResizeElement(),this.parent.undoRedoManager.saveData();var s="data-col"===t,r=e.getAttribute(t),o=r?parseInt(r,10):-1;if(!(o<0)&&n){var a=s?"column":"row";this.insertTableElement(a,o,n)}}},e.prototype.removeInsertIconEvents=function(e){e&&(sf.base.EventHandler.remove(e,"mouseover",this.handleIconMouseOver),sf.base.EventHandler.remove(e,"mouseout",this.handleIconMouseOut))},e.prototype.handleInsertIconHover=function(e,t,n,i,s,r){var o=s?"e-circle-add e-insert-cell-rtl":"e-circle-add",a=this.createIcon(o);sf.base.EventHandler.add(a,"mousedown",this.handleIconMouseDown.bind(this,e,t,r),this),e.appendChild(a),e.style.opacity="1";var l="span["+t+'="'+e.getAttribute(t)+'"].'+("e-rte-table-resize."+n),d=this.tableModel.getEditPanel().querySelector(l);d&&(d.classList.add("e-table-rhelper",i),d.classList.remove("e-rte-table-resize",n),d.style.backgroundColor="","data-row"===t?this.applyRowResizeStyles(d,s):this.applyColumnResizeStyles(d))},e.prototype.applyRowResizeStyles=function(e,t){if(e.style.height="2px",!t){var n=this.parseNumericStyle(e.style.width);e.style.width=n-.5+"px";var i=this.parseNumericStyle(e.style.left);e.style.left=i+.5+"px"}var s=this.parseNumericStyle(e.style.top);e.style.top=s+1+"px"},e.prototype.applyColumnResizeStyles=function(e){e.style.width="2px";var t=this.parseNumericStyle(e.style.height);e.style.height=t-.5+"px";var n=this.parseNumericStyle(e.style.top);e.style.top=n+.5+"px";var i=this.parseNumericStyle(e.style.left);e.style.left=i+1+"px"},e.prototype.parseNumericStyle=function(e){if(!e)return 0;var t=parseFloat(e);return isNaN(t)?0:t},e.prototype.insertTableElement=function(e,t,n){if(this.curTable&&!(t<0)){var i;"column"===e?(i="InsertColumnLeft",t===n[0].length&&(i="InsertColumnRight",t-=1)):i="InsertRowAfter";var s=this.tableModel.getDocument(),r="column"===e?n[0][t]:n[t][0];this.parent.nodeSelection.setCursorPoint(s,r,0),"row"===e&&(this.clearTableSelections(),sf.base.addClass([r],"e-cell-select"));var o=this.parent.nodeSelection.getRange(s),a={item:{selection:this.parent.nodeSelection.save(o,s),subCommand:i,width:this.tableModel.tableSettings.width},callBack:null,subCommand:"",value:"",selector:""};"column"===e?this.insertColumn(a):this.insertRow(a),this.parent.undoRedoManager.saveData(),this.tableModel.enableUndo()}},e.prototype.createRowResizers=function(e,t,n,i,s){for(var r=0;r<e.length;r++){var o=e[r],a=!sf.base.isNullOrUndefined(t.getAttribute("cellspacing"))||""!==t.getAttribute("cellspacing")?0:this.calcPos(o).left,l=!(!o.classList||!o.classList.contains("e-multi-cells-select")),d=this.calcPos(o).top+(l?0:i.top)+o.getBoundingClientRect().height-1.5;if(this.tableModel.tableSettings.resize){var c=sf.base.createElement("span",{attrs:{"data-row":r.toString(),unselectable:"on",contenteditable:"false"}});c.classList.add("e-rte-table-resize","e-row-resize"),c.style.cssText="width:"+n+"px;height:4px;top:"+d+"px;left:"+(a+i.left)+"px; z-index: 2",c.style.cssText="width:"+n+"px;height:4px;top:"+d+"px;left:"+(a+i.left)+"px;",this.tableModel.getEditPanel().appendChild(c)}r+1!==e.length&&s[r][0]===s[r+1][0]||this.createTableInsertIcon({index:r,top:d,left:this.tableModel.enableRtl?n+a+i.left:a+i.left,cellType:"row",allCells:s,isRTL:this.tableModel.enableRtl})}},e.prototype.createResizeBox=function(e,t,n,i){var s=sf.base.createElement("span",{className:"e-table-box"+this.tableModel.getCssClass(!0),attrs:{"data-col":e.toString(),unselectable:"on",contenteditable:"false"}});n=this.tableModel.enableRtl?0:n,s.style.cssText="top:"+(t.top+i-4)+"px;left:"+(t.left+n-4)+"px;",sf.base.Browser.isDevice&&s.classList.add("e-rmob"),this.tableModel.getEditPanel().appendChild(s)},e.prototype.removeTableSelection=function(){var e=this.tableModel.getEditPanel().querySelector("table.e-cell-select");e&&T([e],"e-cell-select"),this.removeAllFakeSelectionEles()},e.prototype.removeAllFakeSelectionEles=function(){var e=this.tableModel.getEditPanel().querySelectorAll(".e-table-fake-selection");e&&e.length>0&&e.forEach((function(e){sf.base.detach(e)}))},e.prototype.tableArrowNavigation=function(e,t,n){if(this.previousTableElement=n,!this.shouldSkipArrowNavigation(e,t)){e.preventDefault(),this.clearSelectionState(n);var i=this.getTargetCellForArrowNavigation(e,n);i&&t.setSelectionText(this.tableModel.getDocument(),i,i,0,0)}},e.prototype.shouldSkipArrowNavigation=function(e,t){var n=t.range.startContainer;return!(40!==e.keyCode||3!==n.nodeType||!(n.nextSibling&&"BR"===n.nextSibling.nodeName||n.parentNode&&!n.parentNode.closest("td")))||!(38!==e.keyCode||3!==n.nodeType||!(n.previousSibling&&"BR"===n.previousSibling.nodeName||n.parentNode&&!n.parentNode.closest("td")))},e.prototype.clearSelectionState=function(e){T([e],"e-cell-select"),this.removeCellSelectClasses(),this.removeTableSelection()},e.prototype.getTargetCellForArrowNavigation=function(e,t){return 40===e.keyCode?this.getNextRowCell(t):this.getPreviousRowCell(t)},e.prototype.getNextRowCell=function(e){var t=sf.base.closest(e,"tr"),n=sf.base.closest(e,"table");if(t&&t.nextElementSibling){var i=e.cellIndex;return t.nextElementSibling.children[i]}return n.tHead&&"TH"===e.nodeName&&n.rows.length>1?n.rows[1].cells[e.cellIndex]:n.nextSibling?n.nextSibling:e},e.prototype.getPreviousRowCell=function(e){var t=sf.base.closest(e,"tr"),n=sf.base.closest(e,"table");if(t&&t.previousElementSibling){var i=e.cellIndex;return t.previousElementSibling.children[i]}return n.tHead&&"TH"!==e.nodeName?n.tHead.rows[0].cells[e.cellIndex]:n.previousSibling?n.previousSibling:e},e.prototype.tabSelection=function(e,t,n){this.cleanTableRows(n),this.previousTableElement=n;var i=this.insideList(t.range);i||this.clearSelectionState(n),this.shouldSkipTabNavigation(e)||i||(e.preventDefault(),e.shiftKey||37===e.keyCode?this.handleBackwardTabNavigation(n,t,e):this.handleForwardTabNavigation(n,t,e))},e.prototype.cleanTableRows=function(e){var t=e.closest("table");if(t)for(var n=t.querySelectorAll("thead, tbody, tr"),i=0;i<n.length;i++)this.removeEmptyTextNodes(n[i])},e.prototype.removeEmptyTextNodes=function(e){for(var t=e.childNodes,n=t.length-1;n>=0;n--){var i=t[n];i.nodeType===Node.TEXT_NODE&&""===i.nodeValue.trim()&&e.removeChild(i)}},e.prototype.shouldSkipTabNavigation=function(e){return 37===e.keyCode||39===e.keyCode},e.prototype.insideList=function(e){var t=this.getBlockNodesInSelection(e),n=this.getListNodesFromBlocks(t);return n.length>1||n.length&&0===e.startOffset&&0===e.endOffset?(this.ensureInsideTableList=!0,!0):(this.ensureInsideTableList=!1,!1)},e.prototype.getListNodesFromBlocks=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],s=i.parentNode;"LI"===s.tagName?t.push(s):"LI"===i.tagName&&this.isSimpleListItem(i)&&t.push(i)}return t},e.prototype.isSimpleListItem=function(e){if(!e.childNodes.length)return!1;var t=e.childNodes[0];return"P"!==t.tagName&&"OL"!==t.tagName&&"UL"!==t.tagName},e.prototype.getBlockNodesInSelection=function(e){var t=["DIV","SECTION","HEADER","FOOTER","ARTICLE","NAV","P","H1","H2","H3","BLOCKQUOTE","LI","PRE","TD","TH","FORM","FIELDSET","LEGEND","LABEL","TEXTAREA"],n=new Set;return e.collapsed?this.handleCollapsedRangeBlockNodes(e,t,n):this.handleExpandedRangeBlockNodes(e,t,n),Array.from(n)},e.prototype.handleCollapsedRangeBlockNodes=function(e,t,n){var i=this.getImmediateBlockNode(e.startContainer,t);i&&n.add(i)},e.prototype.handleExpandedRangeBlockNodes=function(e,t,n){for(var i=this.tableModel.getDocument().createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});i.nextNode();){var s=this.getImmediateBlockNode(i.currentNode,t);s&&n.add(s)}},e.prototype.getImmediateBlockNode=function(e,t){for(var n=e.nodeType===Node.TEXT_NODE?e.parentNode:e;n&&n.nodeType===Node.ELEMENT_NODE;){var i=n;if(t.indexOf(i.tagName)>-1)return i;n=n.parentNode}return null},e.prototype.handleForwardTabNavigation=function(e,t,n){var i=this.findNextElementForward(e);e===i&&"TH"===e.nodeName&&(i=sf.base.closest(e,"table").rows[1].cells[0]),39===n.keyCode&&e===i&&(i=sf.base.closest(e,"table").nextSibling),i&&this.setSelectionForElement(i,t),e===i&&39!==n.keyCode&&i&&this.addNewRowAndNavigate(e,i,t,n)},e.prototype.findNextElementForward=function(e){if(!sf.base.isNullOrUndefined(e.nextSibling))return e.nextSibling;var t=sf.base.closest(e,"tr").nextSibling;if(!sf.base.isNullOrUndefined(t))return t.childNodes[0];var n=sf.base.closest(e,"table").nextSibling;return sf.base.isNullOrUndefined(n)?e:"td"===n.nodeName.toLowerCase()?n:e},e.prototype.addNewRowAndNavigate=function(e,t,n,i){e.classList.add("e-cell-select"),this.tableModel.addRow(n,i,!0),this.clearSelectionState(e);var s=t.parentElement;t=s.nextSibling?s.nextSibling.firstChild:s.firstChild,this.setSelectionForElement(t,n)},e.prototype.removeCellSelectClasses=function(){T(this.tableModel.getEditPanel().querySelectorAll("table td, table th"),"e-cell-select-end"),T(this.tableModel.getEditPanel().querySelectorAll("table td, table th"),"e-multi-cells-select"),T(this.tableModel.getEditPanel().querySelectorAll("table td, table th"),"e-cell-select")},e.prototype.handleBackwardTabNavigation=function(e,t,n){var i=this.findPreviousElementBackward(e);if(this.shouldNavigateToTableHeader(e,i)){var s=sf.base.closest(e,"table");i=s.rows[0].cells[s.rows[0].cells.length-1]}e===i&&37===n.keyCode&&(i=sf.base.closest(e,"table").previousSibling),(i=this.handleNestedTableNavigation(i))&&this.setSelectionForElement(i,t)},e.prototype.findPreviousElementBackward=function(e){if(!sf.base.isNullOrUndefined(e.previousSibling))return e.previousSibling;var t=sf.base.closest(e,"tr").previousSibling;if(!sf.base.isNullOrUndefined(t))return t.childNodes[t.childNodes.length-1];var n=sf.base.closest(e,"table").previousSibling;return sf.base.isNullOrUndefined(n)?e:"td"===n.nodeName.toLowerCase()?n:e},e.prototype.shouldNavigateToTableHeader=function(e,t){return e===t&&0===e.cellIndex&&sf.base.closest(e,"table").tHead&&"TH"!==e.nodeName},e.prototype.handleNestedTableNavigation=function(e){if(!sf.base.isNullOrUndefined(e)&&e.firstChild&&"TABLE"===e.firstChild.nodeName){for(var t=e;!sf.base.isNullOrUndefined(t.firstChild)&&"TABLE"===t.firstChild.nodeName&&t.firstChild.rows.length>0&&t.firstChild.rows[0].cells.length>0;)t=t.firstChild.rows[0].cells[0];return t}return e},e.prototype.setSelectionForElement=function(e,t){""!==e.textContent.trim()&&sf.base.closest(e,"td")?t.setSelectionNode(this.tableModel.getDocument(),e):t.setSelectionText(this.tableModel.getDocument(),e,e,0,0)},e.prototype.resetTableSelection=function(){var e=this.tableModel.getEditPanel().querySelectorAll(".e-cell-select-end");!sf.base.isNullOrUndefined(e)&&e.length>0&&this.parent.nodeSelection.setSelectionNode(this.tableModel.getDocument(),this.curTable),this.removeCellSelectClasses(),this.removeTableSelection()},e.prototype.handleShiftKeyTableSelection=function(e){var t=39===e.keyCode||37===e.keyCode||38===e.keyCode||40===e.keyCode;e.shiftKey&&t&&(this.keyDownEventInstance=e,sf.base.EventHandler.add(this.tableModel.getDocument(),"selectionchange",this.tableCellsKeyboardSelection,this))},e.prototype.tableCellsKeyboardSelection=function(e){sf.base.EventHandler.remove(this.tableModel.getDocument(),"selectionchange",this.tableCellsKeyboardSelection),this.setupSelectionState();var t=this.tableModel.getEditPanel().querySelectorAll(".e-cell-select-end");if(this.isTableMultiSelectActive()||!sf.base.isNullOrUndefined(t)&&t.length>0)this.handleTableCellArrowNavigation(t);else{if(!this.curTable||!this.parent||!this.tableModel)return;var n=this.curTable.querySelectorAll(".e-cell-select");if(!n||n.length<1){var i=this.parent.nodeSelection.getRange(this.tableModel.getDocument());if(!i)return;var s=null;(s=i.endContainer.nodeType===Node.ELEMENT_NODE?i.endContainer:i.endContainer.parentElement||null)&&"TD"!==s.tagName&&"TH"!==s.tagName&&(s=sf.base.closest(s,"TD")||sf.base.closest(s,"TH")||null),s&&this.curTable.contains(s)&&this.moveToTargetCell(s)}}t.length>0&&(this.keyDownEventInstance.preventDefault(),e.preventDefault())},e.prototype.handleTableCellArrowNavigation=function(e){var t,n=L(this.curTable),i=k(!sf.base.isNullOrUndefined(e)&&e.length>0?e[0]:this.activeCell,n),s=i[0],r=i[1];switch(this.keyDownEventInstance.keyCode){case 39:t=this.handleRightArrowNavigation(n,s,r,e);break;case 37:t=this.handleLeftArrowNavigation(n,s,r,e);break;case 38:t=this.handleUpArrowNavigation(n,s,r);break;case 40:t=this.handleDownArrowNavigation(n,s,r)}t&&this.moveToTargetCell(t)},e.prototype.moveToTargetCell=function(e){this.parent.observer.notify("TABLE_MOVE",{event:{target:e},selectNode:[this.activeCell]})},e.prototype.setupSelectionState=function(){var e=this.tableModel.getEditPanel().querySelectorAll(".e-cell-select-end");!sf.base.isNullOrUndefined(e)&&e.length>0&&(this.parent.nodeSelection.Clear(this.tableModel.getDocument()),this.parent.nodeSelection.setSelectionText(this.tableModel.getDocument(),e[0],e[0],0,0),this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(),e[0],0))},e.prototype.isTableMultiSelectActive=function(){var e=this.parent.nodeSelection.getRange(this.tableModel.getDocument());if(sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.commonAncestorContainer)||sf.base.isNullOrUndefined(this.activeCell))return!1;var t=e.commonAncestorContainer;if(t.nodeType!==Node.ELEMENT_NODE)return!1;var n=t,i=n.tagName,s="TR"===i||"TBODY"===i||"THEAD"===i||"TABLE"===i;if("TABLE"===i){if(n.querySelectorAll(".e-cell-select, .e-multi-cells-select").length>1)return!0;var r=this.activeCell,o=e.startContainer,a=null;if((a=o.nodeType===Node.ELEMENT_NODE?o:o.parentElement)&&"TD"!==a.tagName&&"TH"!==a.tagName&&(a=sf.base.closest(a,"td,th")),a&&a!==r)return!0;var l=e.endContainer,d=null;return(d=l.nodeType===Node.ELEMENT_NODE?l:l.parentElement)&&"TD"!==d.tagName&&"TH"!==d.tagName&&(d=sf.base.closest(d,"td,th")),null!==d&&d!==r}return s},e.prototype.handleRightArrowNavigation=function(e,t,n,i){return n<e[0].length-1?e[t][n+1]:t<e.length-1?(0===i.length&&t<e.length-1&&(this.activeCell=e[t][0]),e[t+1][n]):(this.resetTableSelection(),null)},e.prototype.handleLeftArrowNavigation=function(e,t,n,i){return 0<n?e[t][n-1]:0<t?(0===i.length&&0<t&&(this.activeCell=e[t][e[t].length-1]),e[t-1][n]):(this.resetTableSelection(),null)},e.prototype.handleUpArrowNavigation=function(e,t,n){return 0<t?e[t-1][n]:(this.resetTableSelection(),null)},e.prototype.handleDownArrowNavigation=function(e,t,n){return t<e.length-1?e[t+1][n]:(this.resetTableSelection(),null)},e.prototype.isTableInteractionPossible=function(e){return!sf.base.isNullOrUndefined(this.parent.nodeSelection)&&this.tableModel.getEditPanel()&&"KeyK"!==e.code},e.prototype.handleTableKeyboardInteractions=function(e){var t=this.parent.nodeSelection.getRange(this.tableModel.getDocument()),n=this.parent.nodeSelection.getParentNodeCollection(t)[0];n=n&&"TD"!==n.tagName&&"TH"!==n.tagName?n.parentElement:n,this.handleTableDeleteOperations(e,t,n),n=this.findClosestTableCell(n),this.handleTableCellNavigation(e,t,n)},e.prototype.handleTableDeleteOperations=function(e,t,n){var i=8===e.keyCode||46===e.keyCode,s=e.ctrlKey&&88===e.keyCode;if(i||s)if(n&&"TBODY"===n.tagName){if(!sf.base.isNullOrUndefined(this.parent)&&this.tableModel.getDocument()&&this.tableModel.getDocument()){var r=this.parent.nodeSelection.save(t,this.tableModel.getDocument());e.preventDefault(),this.tableModel.removeTable(r,e,!0)}}else n&&n.querySelectorAll("table").length>0&&(this.removeResizeElement(),this.tableModel.hideTableQuickToolbar())},e.prototype.findClosestTableCell=function(e){if(e&&"TD"!==e.tagName&&"TH"!==e.tagName){var t=sf.base.closest(e,"td");return!sf.base.isNullOrUndefined(t)&&this.tableModel.getEditPanel().contains(t)?t:e}return e},e.prototype.handleTableCellNavigation=function(e,t,n){if(n&&("TD"===n.tagName||"TH"===n.tagName)){var i=this.tableModel.getEditPanel().querySelectorAll(".e-cell-select-end");!sf.base.isNullOrUndefined(this.activeCell)&&this.activeCell===n||sf.base.isNullOrUndefined(i)||0!==i.length||!t.collapsed&&9!==e.keyCode||(this.activeCell=n);var s=void 0;if(sf.base.isNullOrUndefined(this.parent.nodeSelection)||(s=this.parent.nodeSelection.save(t,this.tableModel.getDocument())),!e.shiftKey||e.shiftKey&&9===e.keyCode)switch(e.keyCode){case 9:case 37:case 39:this.tabSelection(e,s,n);break;case 40:case 38:this.tableArrowNavigation(e,s,n)}}},e.prototype.handleGlobalKeyboardShortcuts=function(e){e.ctrlKey&&"a"===e.key&&this.handleSelectAll()},e.prototype.handleSelectAll=function(){this.cancelResizeAction(),T(this.tableModel.getEditPanel().querySelectorAll(".e-cell-select"),"e-cell-select"),this.removeTableSelection()},e.prototype.handleTableDeletion=function(e){var t="Delete"===e.code&&46===e.which,n="Backspace"===e.code&&8===e.which;if((t||n)&&"HTML"===this.tableModel.editorMode){var i=this.parent.nodeSelection.getRange(this.tableModel.getDocument());if(this.isFakeTableSelectionElement(i.startContainer))return this.deleteTable(),void e.preventDefault();var s=this.getAdjacentTableElement(i,t);s&&(this.updateTableSelection(s),e.preventDefault())}},e.prototype.updateTableSelection=function(e){sf.base.addClass([e],"e-cell-select")},e.prototype.getAdjacentTableElement=function(e,t){if(!e.collapsed||!t&&this.tableModel.isTableQuickToolbarVisible())return null;var n=this.getNodeCollection(e),i=e.collapsed&&this.tableModel.getEditPanel()===e.startContainer&&n&&n.length>0&&n[0]?n[0]:e.startContainer,s=this.getSelectedTableEle(n),r=this.getBrElement(e,n);if(this.shouldSkipForMediaElement(i,e,t))return null;if(this.shouldSkipForTextNode(i,e,t))return null;if(i&&i.nodeType===Node.ELEMENT_NODE&&"TABLE"===i.tagName&&(s=i),s){var o=this.parent.nodeSelection.getIndex(s);e.startOffset===o&&t||e.startOffset!==o&&!t||(s=null)}return!s&&i&&(s=this.getAdjacentElementFromDom(i,r,t)),s&&s.nodeType===Node.ELEMENT_NODE&&"TABLE"===s.tagName?(this.setSelection(s,r),s):null},e.prototype.shouldSkipForMediaElement=function(e,t,n){if(e&&e.nodeType===Node.ELEMENT_NODE&&!!("IMG"===e.tagName||e.querySelector("img")||"AUDIO"===e.tagName||e.querySelector("audio")||"VIDEO"===e.tagName||e.querySelector("video")||e.querySelector(".e-video-clickelem"))){var i=this.tableModel.getDocument().createRange();i.collapse(!0),i.selectNodeContents(e);var s=this.parent.nodeSelection.getIndex(e);return n&&i.startOffset>=t.startOffset||!n&&("IMG"!==e.tagName&&i.startOffset!==t.startOffset||"IMG"===e.tagName&&s!==t.startOffset)}return!1},e.prototype.shouldSkipForTextNode=function(e,t,n){if(e&&e.nodeType===Node.TEXT_NODE)if(n){if(t.endOffset!==t.endContainer.textContent.length&&t.endOffset!==t.endContainer.textContent.trim().length)return!0}else if(0!==t.startOffset)return!0;return!1},e.prototype.getAdjacentElementFromDom=function(e,t,n){for(var i,s=t||e.parentNode,r=e;s&&!i&&s.parentNode;){var o=Array.from(s.childNodes),a=o.indexOf(r);if(-1!==a&&(n&&a<o.length-1||!n&&a>0)?i=o[n?a+1:a-1]:(i=n?s.nextSibling:s.previousSibling,r=s),this.isBrElement(t,e,i))t=r=s=i,i=null;else if(this.isEmptyTextNode(t,i))r=s=i.parentNode,i=null;else{if(this.isListElement(i)&&!(i=this.getAdjacentElementFromList(i,n)))return null;this.isLiElement(s,n)&&(i=s),s=s.parentNode}}return i},e.prototype.isBrElement=function(e,t,n){return!e&&t.nodeType===Node.TEXT_NODE&&n&&n.tagName&&"BR"===n.tagName.toUpperCase()},e.prototype.isEmptyTextNode=function(e,t){return!e&&t&&!(t.nodeType===Node.ELEMENT_NODE&&"TABLE"===t.tagName)&&!sf.base.isNullOrUndefined(t.textContent)&&!t.textContent.trim()},e.prototype.isListElement=function(e){return e&&e.tagName&&-1!==["UL","OL","LI"].indexOf(e.tagName.toUpperCase())},e.prototype.isLiElement=function(e,t){return e&&e.tagName&&"LI"===e.tagName.toUpperCase()&&!t},e.prototype.getAdjacentElementFromList=function(e,t){for(;e;){if(e.tagName&&-1===["UL","OL","LI"].indexOf(e.tagName.toUpperCase())){e.nodeType===Node.ELEMENT_NODE&&"TABLE"===e.tagName||(e=t?e.firstChild:e.lastChild);break}e=t?e.firstChild:e.lastChild}return e},e.prototype.getNodeCollection=function(e){var t=[];if(e.collapsed&&this.tableModel.getEditPanel()===e.startContainer&&e.startContainer.childNodes.length>0){var n=Math.max(0,Math.min(e.startContainer.childNodes.length-1,e.endOffset-1));t.push(e.startContainer.childNodes[n])}else t=this.parent.nodeSelection.getNodeCollection(e);return t},e.prototype.getSelectedTableEle=function(e){if(e&&e.length>0)for(var t=0,n=Array.from(e);t<n.length;t++){var i=n[t];if(i&&"TABLE"===i.tagName)return i}return null},e.prototype.getBrElement=function(e,t){return"BR"===e.endContainer.tagName?e.endContainer:1===t.length&&t[0]&&"BR"===t[0].tagName?t[0]:null},e.prototype.setSelection=function(e,t){if(!e.classList.contains("e-cell-select")){this.parent.nodeSelection.Clear(this.tableModel.getDocument()),t&&(t.parentNode&&1===t.parentNode.childNodes.length&&"BR"===t.parentNode.firstChild.nodeName?sf.base.detach(t.parentNode):sf.base.detach(t));var n=sf.base.createElement("div",{className:"e-table-fake-selection"});n.setAttribute("contenteditable","false"),this.tableModel.getEditPanel().appendChild(n),this.parent.nodeSelection.setSelectionNode(this.tableModel.getDocument(),n)}},e.prototype.deleteTable=function(){var e=this.tableModel.getEditPanel().querySelector("table.e-cell-select");if(this.removeResizeElement(),e){var t=document.createElement("br"),n=t;"DIV"===this.tableModel.enterKey?(n=document.createElement("div")).appendChild(t):"P"===this.tableModel.enterKey&&(n=document.createElement("p")).appendChild(t),e.parentNode.replaceChild(n,e),this.parent.nodeSelection.setSelectionText(this.tableModel.getDocument(),n,n,0,0),this.removeTableSelection()}},e.prototype.isFakeTableSelectionElement=function(e){return e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName&&e.classList.contains("e-table-fake-selection")},e.prototype.handleDeselectionOnTyping=function(e){var t=e.shiftKey&&"Enter"===e.key,n=-1!==we.indexOf(e.key),i=e.key&&1===e.key.length;if(t||n||i){var s=this.tableModel.getEditPanel().querySelector("table.e-cell-select");if(s){if(39===e.keyCode||37===e.keyCode)this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(),s,0);else{var r=s.querySelector("tr").cells[0];this.parent.nodeSelection.setSelectionText(this.tableModel.getDocument(),r,r,0,0)}this.removeTableSelection()}}},e.prototype.setDefaultEmptyContent=function(){if(null===this.tableModel.getEditPanel().innerHTML||""===this.tableModel.getEditPanel().innerHTML){var e=this.tableModel.getEditPanel();"DIV"===this.tableModel.enterKey?e.innerHTML="<div><br/></div>":"BR"===this.tableModel.enterKey?e.innerHTML="<br/>":e.innerHTML="<p><br/></p>"}},e.prototype.tableModulekeyUp=function(e){if(!sf.base.isNullOrUndefined(this.parent.nodeSelection)&&this.tableModel.getEditPanel()){var t=this.parent.nodeSelection.getRange(this.tableModel.getDocument()),n=this.getSelectedElementFromRange(t);!n||"TD"!==n.tagName&&"TH"!==n.tagName||n.classList.contains("e-cell-select")||!t.collapsed&&9!==e.args.keyCode||n.classList.add("e-cell-select"),this.handleTableElementTransition(n,e.args)}},e.prototype.getSelectedElementFromRange=function(e){var t=this.parent.nodeSelection.getParentNodeCollection(e)[0];if((t=t&&"TD"!==t.tagName&&"TH"!==t.tagName?t.parentElement:t)&&"TD"!==t.tagName&&"TH"!==t.tagName){var n=sf.base.closest(t,"td");t=!sf.base.isNullOrUndefined(n)&&this.tableModel.getEditPanel().contains(n)?n:t}return t},e.prototype.handleTableElementTransition=function(e,t){var n=this.previousTableElement!==e,i=!sf.base.isNullOrUndefined(this.previousTableElement),s=!t.shiftKey&&(39===t.keyCode||37===t.keyCode||38===t.keyCode||40===t.keyCode);n&&i&&s&&(T([this.previousTableElement],"e-cell-select"),this.removeTableSelection()),(8===t.which&&"Backspace"===t.code||46===t.which&&"Delete"===t.code)&&this.tableModel.hideTableQuickToolbar()},e.prototype.cellSelect=function(e){if(e&&e.args){var t=this.getTargetCell(e);this.isShiftKeyTableMove(e,t)?this.handleShiftKeyTableMove(e):(this.resetTableSelectionState(e,t),this.isValidTableCell(t)&&this.setActiveCell(t))}},e.prototype.resetTableSelectionState=function(e,t){var n=e.args;this.tableModel.quickToolbarSettings.showOnRightClick&&3===n.which&&t.classList.contains("e-cell-select")||(this&&this.isTableMoveActive&&(this.unwireTableSelectionEvents(),this.isTableMoveActive=!1,this.activeCell=null),this.heightcheck(),this&&(this.removeCellSelectClasses(),this.removeTableSelection()))},e.prototype.unwireTableSelectionEvents=function(){this.curTable&&(sf.base.EventHandler.remove(this.curTable,"mousemove",this.tableMouseMove),sf.base.EventHandler.remove(this.tableModel.getDocument(),"mouseup",this.tableMouseUp),sf.base.EventHandler.remove(this.tableModel.getDocument(),"dragend",this.tableMouseUp),sf.base.EventHandler.remove(this.curTable,"mouseleave",this.tableMouseLeave))},e.prototype.tableMouseMove=function(e){this.parent.observer.notify("TABLE_MOVE",{event:e,selectNode:[this.activeCell]})},e.prototype.tableMouseUp=function(){this.unwireTableSelectionEvents(),this.handleTableSelectionEnd(),this.isTableMoveActive=!1},e.prototype.handleTableSelectionEnd=function(){this.activeCell&&!this.activeCell.classList.contains("e-cell-select")&&this.isTableMoveActive&&(this.activeCell=null)},e.prototype.tableMouseLeave=function(){sf.base.Browser.isDevice||this.resetTableSelection()},e.prototype.getTargetCell=function(e){var t=e.args.target,n=sf.base.closest(t,"td,th"),i="TD"!==t.nodeName,s=null!=n,r=s&&this.tableModel.getEditPanel().contains(n);return i&&s&&r?n:t},e.prototype.isShiftKeyTableMove=function(e,t){var n=e.args;return this&&!sf.base.isNullOrUndefined(this.activeCell)&&n.shiftKey&&!sf.base.isNullOrUndefined(t)&&!sf.base.isNullOrUndefined(t.tagName)&&("TD"===t.tagName||"TH"===t.tagName)&&this.activeCell!==t},e.prototype.handleShiftKeyTableMove=function(e){this.parent.observer.notify("TABLE_MOVE",{event:e.args,selectNode:[this.activeCell]}),e.args.preventDefault()},e.prototype.isValidTableCell=function(e){return e&&e.tagName&&("TD"===e.tagName||"TH"===e.tagName)},e.prototype.setActiveCell=function(e){sf.base.addClass([e],"e-cell-select"),this.activeCell=e,this.curTable||(this.curTable=sf.base.closest(e,"table")),this.wireTableSelectionEvents(),this.isTableMoveActive=!0,this.removeResizeElement(),this.helper&&this.tableModel.getEditPanel().contains(this.helper)&&sf.base.detach(this.helper)},e.prototype.heightcheck=function(){var e=this.tableModel.getEditPanel().querySelector("td.e-cell-select");if(e){var t=e.querySelector("img");t&&t.style&&"string"==typeof t.style.height&&-1!==t.style.height.indexOf("%")&&(e.style.height="inherit")}},e.prototype.wireTableSelectionEvents=function(){this.curTable&&(sf.base.EventHandler.add(this.curTable,"mousemove",this.tableMouseMove,this),sf.base.EventHandler.add(this.tableModel.getDocument(),"mouseup",this.tableMouseUp,this),sf.base.EventHandler.add(this.tableModel.getDocument(),"dragend",this.tableMouseUp,this),sf.base.EventHandler.add(this.curTable,"mouseleave",this.tableMouseLeave,this))},e.prototype.tableCellSelect=function(e){if(e){var t=e.target;if(t){var n=t.parentElement,i=n?n.parentElement:null;if(n&&i){var s=Array.prototype.slice.call(i.children).indexOf(n),r=Array.prototype.slice.call(n.children).indexOf(t),o=this.dlgDiv.querySelectorAll(".e-rte-tablecell");Array.prototype.forEach.call(o,(function(e){var t=e.parentElement,n=t?t.parentElement:null;if(t&&n){var i=Array.prototype.slice.call(n.children).indexOf(t),o=Array.prototype.slice.call(t.children).indexOf(e);T([e],"e-active"),i<=s&&o<=r&&sf.base.addClass([e],"e-active")}})),this.tblHeader.innerHTML=r+1+"x"+(s+1)}}}},e.prototype.tableCellLeave=function(){T(this.dlgDiv.querySelectorAll(".e-rte-tablecell"),"e-active");var e=this.dlgDiv.querySelector(".e-rte-tablecell");e&&sf.base.addClass([e],"e-active"),this.tblHeader.innerHTML="1x1"},e.prototype.afterKeyDown=function(){var e=this;this.curTable&&(this.resizeIconPositionTime=setTimeout((function(){e.updateResizeIconPosition()}),1))},e.prototype.updateResizeIconPosition=function(){if(this.curTable){var e=this.tableModel.getEditPanel().querySelector(".e-table-box");if(!sf.base.isNullOrUndefined(e)){var t=this.calcPos(this.curTable);e.style.cssText="top: "+(t.top+parseInt(getComputedStyle(this.curTable).height,10)-4)+"px; left:"+(t.left+(this.tableModel.enableRtl?0:parseInt(getComputedStyle(this.curTable).width,10))-4)+"px;"}}},e}(),dt={bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,unorderedlist:!1,numberFormatList:!1,bulletFormatList:!1,underline:!1,alignments:null,backgroundcolor:null,fontcolor:null,fontname:null,fontsize:null,formats:null,createlink:!1,insertcode:!1,blockquote:!1,inlinecode:!1,isCodeBlock:!1,isCheckList:!1},ct=function(){function e(){}return e.get=function(e,t,n,i,s,r){for(var o=JSON.parse(JSON.stringify(dt)),a=JSON.parse(JSON.stringify(dt)),l=new et(t),d=l.getRange(e),c=r?[r]:d.collapsed?l.getNodeCollection(d):l.getSelectionNodeCollectionBr(d),h=c.length,p=!1,u=0;u<c.length;u++){for(;c[u]&&3===c[u].nodeType&&3===d.startContainer.nodeType&&c[u].parentNode&&c[u].parentNode.lastElementChild&&"BR"!==c[u].parentNode.lastElementChild.nodeName&&this.getImmediateBlockNode(c[u].parentNode)&&0===this.getImmediateBlockNode(c[u].parentNode).textContent.replace(/\u200B/g,"").length&&0===d.startContainer.textContent.replace(/\u200B/g,"").length&&0===l.get(e).toString().replace(/\u200B/g,"").length;)c[u]=c[u].parentNode.lastElementChild.firstChild,p=!0;p&&c[u]&&(l.setCursorPoint(e,c[u],c[u].textContent.length),p=!1),c[u]&&("BR"!==c[u].nodeName&&3!==c[u].nodeType||h>1&&3===c[u].nodeType&&""===c[u].textContent.trim())&&(c.splice(u,1),u--)}for(u=0;u<c.length;u++){var f=sf.base.closest(c[u],"col, colgroup");sf.base.isNullOrUndefined(f)&&(o=this.getFormatParent(e,o,c[u],t,n,i,s),(0===u&&o.bold||!o.bold)&&(a.bold=o.bold),(0===u&&o.insertcode||!o.insertcode)&&(a.insertcode=o.insertcode),(0===u&&o.isCodeBlock||!o.isCodeBlock)&&(a.isCodeBlock=o.isCodeBlock),(0===u&&o.isCheckList||!o.isCheckList)&&(a.isCheckList=o.isCheckList),(0===u&&o.blockquote||!o.blockquote)&&(a.blockquote=o.blockquote),(0===u&&o.italic||!o.italic)&&(a.italic=o.italic),(0===u&&o.underline||!o.underline)&&(a.underline=o.underline),(0===u&&o.strikethrough||!o.strikethrough)&&(a.strikethrough=o.strikethrough),(0===u&&o.superscript||!o.superscript)&&(a.superscript=o.superscript),(0===u&&o.subscript||!o.subscript)&&(a.subscript=o.subscript),(0===u&&o.fontcolor||!o.fontcolor)&&(a.fontcolor=o.fontcolor),0===u&&o.fontname?a.fontname=o.fontname:a.fontname=o.fontname===a.fontname?o.fontname:"empty",0===u&&o.fontsize?a.fontsize=o.fontsize:a.fontsize=o.fontsize===a.fontsize?o.fontsize:"empty",(0===u&&o.backgroundcolor||!o.backgroundcolor)&&(a.backgroundcolor=o.backgroundcolor),(0===u&&o.orderedlist||!o.orderedlist)&&(a.orderedlist=o.orderedlist),(0===u&&o.unorderedlist||!o.unorderedlist)&&(a.unorderedlist=o.unorderedlist),(0===u&&o.alignments||!o.alignments)&&(a.alignments=o.alignments),0===u&&o.formats?a.formats=o.formats:a.formats=o.formats===a.formats?o.formats:"empty",(0===u&&o.createlink||!o.createlink)&&(a.createlink=o.createlink),(0===u&&o.numberFormatList||!o.numberFormatList)&&(a.numberFormatList=o.numberFormatList),(0===u&&o.bulletFormatList||!o.bulletFormatList)&&(a.bulletFormatList=o.bulletFormatList),(0===u&&o.inlinecode||!o.inlinecode)&&(a.inlinecode=o.inlinecode),o=JSON.parse(JSON.stringify(dt)))}return a},e.getImmediateBlockNode=function(e){do{e=e.parentNode}while(e&&fe.indexOf(e.nodeName.toLocaleLowerCase())<0);return e},e.getFormatParent=function(e,t,n,i,s,r,o){return(i.contains(n)||n&&3===n.nodeType&&3!==i.nodeType&&i.contains(n.parentNode))&&(t=this.isFormattedNode(e,t,n,!1,!1,s,r,o,i)),t},e.checkCodeBlock=function(e){return"CODE"===e.nodeName&&e.parentElement&&"PRE"===e.parentElement.nodeName&&e.parentElement.hasAttribute("data-language")},e.isFormattedNode=function(e,t,n,i,s,r,o,a,l){for(var d=fe,c=n,h=[],p={};c&&!(d.indexOf(c.nodeName.toLowerCase())>-1)&&(!l||c.nodeName!==l.nodeName);){if(1===c.nodeType){var u=c;this.checkCodeBlock(u)||h.push(u.nodeName.toLowerCase()),this.collectStyles(c,p,e,a,o)}c=c.parentNode}for(;c&&c!==l;){var f=c.nodeName.toLowerCase(),m="UL"===c.tagName&&c.classList.contains("e-rte-checklist");t.unorderedlist||"ul"!==f||i||s||m||(t.unorderedlist=!0,i=!0,t.bulletFormatList=this.isBulletFormatList(c),s=null!==t.bulletFormatList),t.orderedlist||"ol"!==f||i||s||(t.orderedlist=!0,i=!0,t.numberFormatList=this.isNumberFormatList(c),s=null!==t.numberFormatList),t.blockquote||"blockquote"!==f||(t.blockquote=!0),t.formats||(t.formats=this.isFormats(c,r),"pre"!==t.formats||"pre"!==f||"CODE"===c.firstChild.nodeName||c.hasAttribute("data-language")||(t.insertcode=!0)),!t.isCodeBlock&&"pre"===c.nodeName.toLocaleLowerCase()&&c.hasAttribute("data-language")&&(t.isCodeBlock=!0),!t.isCheckList&&m&&(t.isCheckList=!0),this.collectStyles(c,p,e,a,o),c=c.parentNode}return(h.indexOf("b")>-1||h.indexOf("strong")>-1)&&(t.bold=!0),(h.indexOf("i")>-1||h.indexOf("em")>-1)&&(t.italic=!0),(h.indexOf("u")>-1||p.underLine)&&(t.underline=!0),(h.indexOf("s")>-1||h.indexOf("del")>-1||p.strikeThrough)&&(t.strikethrough=!0),h.indexOf("sup")>-1&&(t.superscript=!0),h.indexOf("sub")>-1&&(t.subscript=!0),p.color&&(t.fontcolor=p.color),p.backgroundColor&&(t.backgroundcolor=p.backgroundColor),p.fontFamily&&(t.fontname=p.fontFamily),p.fontSize&&(t.fontsize=p.fontSize),p.textAlign&&(t.alignments=p.textAlign),h.indexOf("a")>-1&&(t.createlink=!0),h.indexOf("code")>-1&&(t.inlinecode=!0),t},e.isFontColor=function(e,t){var n=t.style&&t.style.color;return null!=n&&""!==n||3===t.nodeType||(n=this.getComputedStyle(e,t,"color")),null!==n&&""!==n&&void 0!==n?n:null},e.isBackgroundColor=function(e){var t=e.style&&e.style.backgroundColor;return null!==t&&""!==t&&void 0!==t?t:null},e.isFontSize=function(e,t,n){var i=t.style&&t.style.fontSize,s=y.inlineTags.indexOf(t.nodeName.toLowerCase())>-1;return i&&1===t.nodeType&&!s&&(i=null),null!=i&&""!==i||3===t.nodeType||!t.parentElement.classList.contains("e-content")||(i=this.getComputedStyle(e,t,"font-size")),null!==i&&""!==i&&void 0!==i&&(null==n||n.indexOf(i)>-1)?i:null},e.isFontName=function(e,t,n){var i=t.style&&t.style.fontFamily,s=y.inlineTags.indexOf(t.nodeName.toLowerCase())>-1;i&&1===t.nodeType&&!s&&(i=null),null!=i&&""!==i||3===t.nodeType||!s||(i=this.getComputedStyle(e,t,"font-family"));var r=null;return null!==i&&""!==i&&void 0!==i&&(null==n||n.filter((function(e,t){var n=new RegExp(i,"i");(e.replace(/"/g,"").replace(/ /g,"").toLowerCase()===i.replace(/"/g,"").replace(/ /g,"").toLowerCase()||e.split(",")[0]&&!sf.base.isNullOrUndefined(e.split(",")[0].trim().match(n))&&e.split(",")[0].trim()===e.split(",")[0].trim().match(n)[0])&&(r=t)}))&&null!==r)?null!==r?n[r]:i.replace(/"/g,""):null},e.isAlignment=function(e){var t=e.style&&e.style.textAlign;return"left"===t?"justifyleft":"center"===t?"justifycenter":"right"===t?"justifyright":"justify"===t?"justifyfull":null},e.isFormats=function(e,t){return null==t&&fe.indexOf(e.nodeName.toLocaleLowerCase())>-1||null!=t&&t.indexOf(e.nodeName.toLocaleLowerCase())>-1?e.nodeName.toLocaleLowerCase():["tbody","tfoot","thead","ol","ul","table","li","td","th"].indexOf(e.nodeName.toLocaleLowerCase())>-1?"p":null},e.getComputedStyle=function(e,t,n){return e.defaultView.getComputedStyle(t,null).getPropertyValue(n)},e.isNumberFormatList=function(e){var t=e.style&&e.style.listStyleType;return"lower-alpha"===t?"Lower Alpha":"number"===t?"Number":"upper-alpha"===t?"Upper Alpha":"lower-roman"===t?"Lower Roman":"upper-roman"===t?"Upper Roman":"lower-greek"===t?"Lower Greek":"none"===t&&"OL"===e.nodeName?"None":"OL"===e.nodeName||null},e.isBulletFormatList=function(e){var t=e.style&&e.style.listStyleType;return"circle"===t?"Circle":"square"===t?"Square":"none"===t&&"UL"===e.nodeName?"None":"disc"===t?"Disc":"UL"===e.nodeName||null},e.collectStyles=function(e,t,n,i,s){if(t.color||(t.color=this.isFontColor(n,e)),t.backgroundColor||(t.backgroundColor=this.isBackgroundColor(e)),!t.fontFamily){var r=this.isFontName(n,e,i);r&&(t.fontFamily=r)}if(!t.fontSize){var o=this.isFontSize(n,e,s);o&&(t.fontSize=o)}t.textAlign||(t.textAlign=this.isAlignment(e));var a=null;e.style&&e.style.textDecoration?a=e.style.textDecoration:(a=this.getComputedStyle(n,e,"text-decoration"),"A"===e.nodeName&&a.includes("underline")&&(a=null)),a&&(t.underLine||(t.underLine=a.includes("underline")?"underline":null),t.strikeThrough||(t.strikeThrough=a.includes("line-through")?"line-through":null))},e}(),ht=function(){function e(e,t){this.INVALID_TAGS=["A","AUDIO","IMG","VIDEO","IFRAME"],this.parent=e,this.settings=t,this.addEventListener(),this.setDeniedFormats()}return e.prototype.addEventListener=function(){this.parent.observer.on("format_painter_actions",this.actionHandler,this),this.parent.observer.on("model_changed_plugin",this.onPropertyChanged,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.onPropertyChanged=function(e){e&&"formatPainter"===e.module&&(sf.base.isNullOrUndefined(e.newProp.formatPainterSettings.allowedFormats)||(this.settings.allowedFormats=e.newProp.formatPainterSettings.allowedFormats),sf.base.isNullOrUndefined(e.newProp.formatPainterSettings.deniedFormats)||(this.settings.deniedFormats=e.newProp.formatPainterSettings.deniedFormats,this.setDeniedFormats()))},e.prototype.removeEventListener=function(){this.parent.observer.off("format_painter_actions",this.actionHandler),this.parent.observer.off("model_changed_plugin",this.onPropertyChanged),this.parent.observer.off(v,this.destroy)},e.prototype.destroy=function(){this.removeEventListener(),this.INVALID_TAGS=null,this.copyCollection=null,this.deniedFormatsCollection=null,this.newElem=null,this.newElemLastChild=null,this.settings=null,this.parent=null},e.prototype.actionHandler=function(e){if(!sf.base.isNullOrUndefined(e)&&!sf.base.isNullOrUndefined(e.item)&&!sf.base.isNullOrUndefined(e.item.formatPainterAction)){switch(e.item.formatPainterAction){case"format-copy":this.copyAction();break;case"format-paste":this.pasteAction();break;case"escape":this.escapeAction()}this.callBack(e)}},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:"FormatPainter",action:e.item.formatPainterAction,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.generateElement=function(){var e=this.copyCollection.slice();e.reverse();for(var t,n=e.length,i=sf.base.createElement("div",{className:"e-format-paste-wrapper"}),s=0;s<n;s++){var r=e[s],o=r.attrs,a=r.className,l=r.styles,d=r.tagName,c=sf.base.createElement(d);""!==a&&(c.className=a);for(var h=0;h<o.length;h++){var p=o[h].name,u=o[h].value;c.setAttribute(p,u)}for(var f=0;f<l.length;f++){p=l[f].property,u=l[f].value;var m=l[f].priority;c.style.setProperty(p,u,m)}0===i.childElementCount?(i.append(c),t=c):(t.append(c),t=c)}for(var g=this.removeDeniedFormats(i),b=g;b;)null===b.firstChild?(t=b,b=void 0):b=b.firstChild;this.newElem=g,this.newElemLastChild=t},e.prototype.pasteAction=function(){sf.base.isNullOrUndefined(this.copyCollection)||0===this.copyCollection.length?this.paintPlainTextFormat():this.insertFormatNode(this.newElem,this.newElemLastChild)},e.prototype.removeDeniedFormats=function(e){var t=this.deniedFormatsCollection;if(!sf.base.isNullOrUndefined(t)&&t.length>0)for(var n=t.length,i=0;i<n;i++){var s=t[i],r=s.tag;if(r)for(var o=e.querySelectorAll(r),a=0;a<o.length;a++){var l=o[a],d=s.classes,c=s.styles,h=s.attributes,p=!0;if(d.length>0&&""!==d[a].trim()){p=!0;for(var u=0;u<d.length;u++)p=!!l.classList.contains(d[u].trim())}var f=c.length>0&&""!==c[a].trim()||h.length>0&&""!==h[a].trim();if(p){if(f){for(u=0;u<c.length;u++){var m=c[u].trim();m&&l.style.removeProperty(m)}for(u=0;u<h.length;u++){var g=h[u].trim();g&&l.removeAttribute(g)}}if(d.length>0)for(u=0;u<d.length;u++){var b=d[u].trim();b&&sf.base.removeClass([l],b)}0===l.style.length&&l.removeAttribute("style"),0===l.classList.length&&l.removeAttribute("class")}}}return e.firstElementChild},e.prototype.copyAction=function(){var e=[],t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection,i=t.collapsed?n.getSelectionNodeCollection(t):n.getSelectionNodeCollectionBr(t);if(0!==i.length||0!==n.getSelectionNodeCollectionBr(t).length){for(var s=(i=0===i.length?n.getSelectionNodeCollectionBr(t):i)[0].parentElement,r=this.findCurrentContext(s),o=this.settings.allowedFormats.indexOf(";")>-1?this.settings.allowedFormats.split(";"):[this.settings.allowedFormats],a=0;a<o.length;a++)o[a]=o[a].trim();var l=this.getRangeParentElem(r,s),d=l[0],c=l[1];if(null===r&&(r=c),!sf.base.isNullOrUndefined(r)){"#text"===t.startContainer.nodeName&&(s=t.startContainer.parentElement);var h=s;do{if(o.indexOf(s.nodeName.toLowerCase())>-1){var p=s.attributes,u=[];for(a=0;a<p.length;a++)"class"!==p[a].name&&"style"!==p[a].name&&u.push(p[a]);var f=s.className,m=s.style,g=[];for(a=0;a<m.length;a++){var b=m[a],v=m.getPropertyValue(b),y=m.getPropertyPriority(b);g.push({property:b,value:v,priority:y})}e.push({attrs:u,className:f,styles:g,tagName:s.nodeName})}if(d===s?s=void 0:sf.base.isNullOrUndefined(s.parentElement)||(s=s.parentElement),h===s)break}while(!sf.base.isNullOrUndefined(s)||s===this.parent.editableElement);this.copyCollection=e}this.generateElement()}},e.prototype.getRangeParentElem=function(e,t){var n,i=t;switch(3===i.nodeType&&(i=i.parentElement),e){case"Table":n=sf.base.closest(i,"td"),sf.base.isNullOrUndefined(n)&&(n=sf.base.closest(i,"th"));break;case"List":n=sf.base.closest(i,"li");break;case"Text":n=sf.base.closest(i,"p")}if(sf.base.isNullOrUndefined(n)){var s=this.getNearestBlockParentElement(t);sf.base.isNullOrUndefined(s)||"UL"===s||"OL"===s||"LI"===s||(n=sf.base.closest(i,s),e="Text")}return"List"===e&&(n=n.parentElement),[n,e]},e.prototype.getNearestBlockParentElement=function(e){var t=e;for(3===t.nodeType&&(t=t.parentNode);t&&t!==this.parent.editableElement;){if(!sf.base.isNullOrUndefined(t)&&this.isBlockElement(t))return t.nodeName;t=t.parentNode}return null},e.prototype.isBlockElement=function(e){return["P","DIV","UL","OL","LI","H1","H2","H3","H4","H5","H6","ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","FIGCAPTION","FIGURE","FOOTER","HEADER","HR","MAIN","NAV","SECTION","SUMMARY","PRE"].indexOf(e.nodeName)>-1},e.prototype.escapeAction=function(){this.copyCollection=[]},e.prototype.paintPlainTextFormat=function(){var e,t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection,i=t.collapsed?n.getSelectionNodeCollection(t):n.getSelectionNodeCollectionBr(t);if(i.length>1)for(var s=0;s<i.length;s++)e=this.validateELementTag(i[s]);else e=this.validateELementTag(t.startContainer)&&this.validateELementTag(t.endContainer);e||this.parent.execCommand("Clear","ClearFormat",null,null)},e.prototype.validateELementTag=function(e){return 3===e.nodeType&&(e=e.parentElement),this.INVALID_TAGS.indexOf(e.tagName)>-1},e.prototype.findCurrentContext=function(e){var t=sf.base.closest(e,"p"),n=sf.base.closest(e,"li");return t&&!n?"Text":sf.base.closest(e,"li")?sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(n)||t.textContent.trim()===n.textContent.trim()?"List":"Text":sf.base.closest(e,"td")||sf.base.closest(e,"tr")||sf.base.closest(e,"th")?"Table":null},e.prototype.insertFormatNode=function(e,t){var n=e.cloneNode(!0);if(!this.isBlockElement(e)){var i=sf.base.createElement("P");i.appendChild(e),n=i.cloneNode(!0)}for(var s,r=this.parent.editableElement,o=this.parent.currentDocument,a=n.firstChild;a;){if(!this.isBlockElement(a)){s=a.parentNode.removeChild(a);break}a=a.firstChild}var l={element:s,lastChild:t};We.applyFormat(o,null,r,"P",null,"formatPainter",null,l);var d=this.parent.nodeSelection.getRange(o),c=d.collapsed,h=this.parent.domNode.blockNodes();if(this.isListCopied())for(var p=0;p<h.length;p++)sf.base.closest(h[p],"li")&&(h[p]=sf.base.closest(h[p],"li"));var u=!1;1===h.length&&(u=h[0].textContent.trim()===d.toString().trim()),(this.isBlockElement(n)&&c||h.length>1||u)&&this.insertBlockNode(n,d,o,h)},e.prototype.isListCopied=function(){for(var e=!1,t=0;t<this.copyCollection.length;t++)if("OL"===this.copyCollection[t].tagName||"UL"===this.copyCollection[t].tagName){e=!0;break}return e},e.prototype.insertBlockNode=function(e,t,n,i){var s,r,o=this.parent.nodeSelection.save(t,n);this.parent.domNode.setMarker(o);var a=!1;"UL"!==e.nodeName&&"OL"!==e.nodeName||(s=(r=e.cloneNode(!0)).firstChild);for(var l=sf.base.isNullOrUndefined(r)?e:e.firstChild,d=0;d<i.length;d++)if(!(this.INVALID_TAGS.indexOf(i[d].nodeName)>-1||i[d].querySelectorAll("img,audio,video,iframe").length>0)){for(var c=l.cloneNode(!1);i[d].firstChild;)0!==i[d].textContent.trim().length?c.appendChild(i[d].firstChild):i[d].removeChild(i[d].firstChild);if("TD"!==i[d].nodeName&&"TH"!==i[d].nodeName){if(sf.base.isNullOrUndefined(r)||(a=this.isSameListType(e,i[d])),"LI"!==c.nodeName||a?a?this.insertSameList(i,d,r,c):i[d].parentNode.replaceChild(c,i[d]):this.insertNewList(t,i,d,r,c),"LI"!==c.nodeName&&("OL"===c.parentElement.nodeName||"UL"===c.parentElement.nodeName)){var h=c.parentElement;if(this.parent.nodeCutter.SplitNode(t,h,!0),sf.base.isNullOrUndefined(h.previousElementSibling))h.parentElement.prepend(c);else if(h.previousElementSibling.after(c),c.childNodes.length>1)for(var p=0;p<c.childNodes.length;p++){var u=c.childNodes[p];"OL"!==u.nodeName&&"UL"!==u.nodeName||c.after(u)}}}else{if(sf.base.isNullOrUndefined(r)){i[d].appendChild(c);continue}if(0!==d||sf.base.isNullOrUndefined(r)){i[d].appendChild(c);continue}i[d].appendChild(r),r.appendChild(c)}}!sf.base.isNullOrUndefined(s)&&sf.base.detach(s),this.cleanEmptyLists(),this.parent.domNode.saveMarker(o).restore()},e.prototype.insertNewList=function(e,t,n,i,s){if(0===n){var r=t[n].nodeName;t[n]=t[n].parentNode.replaceChild(i,t[n]);var o="LI"===r?i.parentElement:i;if(this.parent.nodeCutter.SplitNode(e,o,!0),"LI"!==t[n].nodeName||sf.base.isNullOrUndefined(o))if(sf.base.isNullOrUndefined(o))i.append(s);else if(sf.base.isNullOrUndefined(o.previousElementSibling)||o.previousElementSibling.nodeName!==i.nodeName)if(sf.base.isNullOrUndefined(o.nextElementSibling)||o.nextElementSibling.nodeName!==i.nodeName)i.append(s);else{var a;for((a=o.nextElementSibling).prepend(s);a.firstChild;)i.append(a.firstChild)}else for((a=o.previousElementSibling).append(s);a.firstChild;)i.append(a.firstChild);else i.append(s),sf.base.isNullOrUndefined(o.parentNode)||o.parentNode.insertBefore(i,o)}else i.append(s);this.detachEmptyBlockNodes(t[n])},e.prototype.insertSameList=function(e,t,n,i){if(0===t){if(!sf.base.isNullOrUndefined(e[t].parentNode)&&("UL"===e[t].parentNode.nodeName||"OL"===e[t].parentNode.nodeName)){if(1===e.length){for(;i.firstChild;)e[t].append(i.firstChild);for(var s=0;s<e[t].parentNode.childNodes.length;s++){var r=e[t].parentNode.childNodes[s];n.append(r.cloneNode(!0))}}else n.append(i);var o=void 0;e[t].parentNode&&(o=Array.from(e[t].parentNode.childNodes).map((function(e){return e.textContent.trim()})).join("")),o===Array.from(e).map((function(e){return e.textContent.trim()})).join("")||e[t].parentNode&&e[t].parentNode.textContent===n.textContent?e[t].parentNode.parentNode.replaceChild(n,e[t].parentNode):e[t].parentNode.replaceChild(i,e[t])}}else n.parentNode?n.append(i):e[t].parentNode.replaceChild(i,e[t]);this.detachEmptyBlockNodes(e[t])},e.prototype.isSameListType=function(e,t){var n=!1,i=sf.base.closest(t,"ol, ul");return!sf.base.isNullOrUndefined(i)&&i.querySelectorAll("li").length>0&&(n=i.nodeName===e.nodeName),n},e.prototype.cleanEmptyLists=function(){for(var e=this.parent.editableElement.querySelectorAll("ol, ul"),t=0;t<e.length;t++)""===e[t].textContent.trim()&&sf.base.detach(e[t])},e.prototype.setDeniedFormats=function(){var e=[];if(!sf.base.isNullOrUndefined(this.settings)&&!sf.base.isNullOrUndefined(this.settings.deniedFormats)){for(var t=this.settings.deniedFormats.indexOf(";")>-1?this.settings.deniedFormats.split(";"):[this.settings.deniedFormats],n=t.length,i=0;i<n;i++){var s=t[i];if(""!==s){s.trim();var r=this.makeDeniedFormatsCollection(s);sf.base.isNullOrUndefined(r)||e.push(r)}}this.deniedFormatsCollection=e}},e.prototype.detachEmptyBlockNodes=function(e){sf.base.isNullOrUndefined(e)||""!==e.textContent.trim()||sf.base.detach(e)},e.prototype.makeDeniedFormatsCollection=function(e){var t=e.indexOf("("),n=e.indexOf(")"),i=e.indexOf("["),s=e.indexOf("]"),r=e.indexOf("{"),o=e.indexOf("}"),a=[],l=[],d=[];t>-1&&n>-1&&(a=e.substring(t+1,n).split(" ")[0].split(")")[0].split(",")),i>-1&&s>-1&&(l=e.substring(i+1,s).split(",")),r>-1&&o>-1&&(d=e.substring(r+1,o).split(","));var c,h=[t,i,r],p=(h=h.filter((function(e){return e>-1}))).length;return 1===p?c=h[0]:2===p?c=Math.min(h[0],h[1]):3===p&&(c=Math.min(h[0],h[1],h[2])),{tag:e.substring(0,c).trim(),styles:d,classes:a,attributes:l}},e}(),pt=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),s=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,a=r.length;o<a;o++,s++)i[s]=r[o];return i},ut=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("code-block",this.applyCodeBlockHandler,this),this.parent.observer.on(v,this.destroy,this),this.parent.observer.on("codeblock_indentation",this.handleCodeBlockIndentation,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("code-block",this.applyCodeBlockHandler),this.parent.observer.off(v,this.destroy),this.parent.observer.off("codeblock_indentation",this.handleCodeBlockIndentation)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.applyCodeBlockHandler=function(e){if(!("CodeBlock"!==e.subCommand||sf.base.isNullOrUndefined(e.item)||sf.base.isNullOrUndefined(e.item.action)||sf.base.isNullOrUndefined(e.event)&&"createCodeBlock"!==e.item.action)){switch(e.item.action){case"createCodeBlock":this.codeBlockCreation(e);break;case"codeBlockPaste":this.codeBlockPasteAction(e);break;case"codeBlockEnter":this.codeBlockEnterAction(e);break;case"codeBlockBackSpace":this.codeBlockBackSpaceAction(e);break;case"codeBlockTabAction":this.codeBlockTabAction(e);break;case"codeBlockShiftTabAction":this.codeBlockShiftTabAction(e)}this.callBack(e)}},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.subCommand,action:e.item.action,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes(!0)})},e.prototype.isValidCodeBlockStructure=function(e){var t="#text"===e.nodeName?e.parentElement:e;return t===this.parent.editableElement||sf.base.isNullOrUndefined(t.closest("pre"))||!t.closest("pre").hasAttribute("data-language")||sf.base.isNullOrUndefined(t.closest("pre").firstChild)||"CODE"!==t.closest("pre").firstChild.nodeName?null:t.closest("pre")},e.prototype.isCodeBlockEnterAction=function(e,t){var n=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;return!(13!==t.keyCode||!n||sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(e.startContainer)))},e.prototype.codeBlockBackSpaceAction=function(e){var t=this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument),n="#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,i="#text"===t.endContainer.nodeName?t.endContainer.parentElement:t.endContainer;"keyup"===e.event.type?this.handleKeyUpBackspace(t,n,i):"keydown"===e.event.type&&this.handleKeyDownBackspace(e,t,n,i)},e.prototype.handleKeyUpBackspace=function(e,t,n){if(this.isCodeBlockElement(t)&&this.isCodeBlockElement(n)){var i=t.closest("pre[data-language]"),s=i.querySelector("code");if(sf.base.isNullOrUndefined(s)&&0===e.startOffset&&0===e.endOffset&&"PRE"===e.startContainer.nodeName&&"PRE"===e.endContainer.nodeName){t.closest("pre[data-language]").firstChild.remove();var r=sf.base.createElement("br"),o=sf.base.createElement("code");o.appendChild(r),i.appendChild(o),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,r,0)}}},e.prototype.isCodeBlockElement=function(e){return!sf.base.isNullOrUndefined(e.closest("pre[data-language]"))},e.prototype.handleKeyDownBackspace=function(e,t,n,i){!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(n))||sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(i))?sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(n))||!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(i))?46!==e.event.which&&8!==e.event.which||t.startContainer!==t.endContainer||t.startOffset!==t.endOffset||this.handleSinglePointDeletion(e,t,n):this.handleSelectionFromCodeBlockToRegular(e,t,n):this.handleSelectionAcrossCodeBlockBoundary(e,t,n,i)},e.prototype.handleSelectionAcrossCodeBlockBoundary=function(e,t,n,i){e.event.preventDefault();var s=this.isValidCodeBlockStructure(i),r=this.parent.domNode.getImmediateBlockNode(n);t.deleteContents();var o=this.parent.nodeSelection.findLastTextPosition(r),a=this.parent.nodeSelection.findLastTextPosition(s.previousSibling),l=s.firstChild;l&&r&&""!==r.textContent&&this.moveContentToParent(l,r,s),this.setCursorAfterBoundaryOperation(r,s,o,a),this.cleanupEmptyElements(s,r)},e.prototype.moveContentToParent=function(e,t,n){for(;e&&e.firstChild;)t===this.parent.editableElement?t.insertBefore(e.firstChild,n):t.appendChild(e.firstChild)},e.prototype.setCursorAfterBoundaryOperation=function(e,t,n,i){""===e.textContent?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t.firstChild,0):e===this.parent.editableElement?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i.node,i.offset):this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n.node,n.offset)},e.prototype.cleanupEmptyElements=function(e,t){""===e.textContent.trim()&&e.remove(),""===t.textContent&&t.remove()},e.prototype.handleSelectionFromCodeBlockToRegular=function(e,t,n){var i=this,s=this.isValidCodeBlockStructure(n),r=this.parent.domNode.blockNodes(!0);t.deleteContents();var o=s.querySelector("code");if(this.addBrElementIfMissing(o,t))e.event.preventDefault();else{var a=e.item.currentFormat,l=this.parent.nodeSelection.findLastTextPosition(s);this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,l.node,l.offset),t=this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument);var d=r.filter((function(e){return i.parent.editableElement.contains(e)}));this.setCursorMarkers(t),this.processCodeBlockAction(t,d,a),e.event.preventDefault()}},e.prototype.addBrElementIfMissing=function(e,t){if(!sf.base.isNullOrUndefined(e)&&0===e.childNodes.length){var n=sf.base.createElement("br");return e.appendChild(n),t.setStartBefore(n),t.setEndBefore(n),!0}return!1},e.prototype.handleSinglePointDeletion=function(e,t,n){var i=e.event.which,s=this.isValidCodeBlockStructure(n);46===i&&this.handleDeleteKeyAtCodeBlockBoundary(e,t,s),this.handleNextSiblingCodeBlockDeletion(e,t,i),this.handleBackspaceAtCodeBlockStart(e,t,i,s),this.handleBackspaceAfterCodeBlock(e,t,i)},e.prototype.handleDeleteKeyAtCodeBlockBoundary=function(e,t,n){if(n){var i="CODE"===t.startContainer.nodeName?t.startContainer.childNodes[t.startOffset]:t.startContainer,s=t.startContainer===t.endContainer&&t.startOffset===t.endOffset;if(s&&this.isBrAsLastChildInCodeBlock(n)){var r=n.querySelector("code");r&&r.lastChild&&"BR"===r.lastChild.nodeName&&r.removeChild(r.lastChild)}var o=s&&1===n.querySelector("code").childNodes.length&&"BR"===n.querySelector("code").childNodes[0].nodeName&&n.querySelector("code").firstChild===i,a=46===e.event.which,l=this.findNextValidSibling(n),d=a&&!sf.base.isNullOrUndefined(n)&&!sf.base.isNullOrUndefined(l)&&this.isValidCodeBlockStructure(t.startContainer).querySelector("code").lastChild===i&&i.textContent.length===("BR"===i.nodeName?0:t.startOffset),c=o&&sf.base.isNullOrUndefined(l),h=o&&!sf.base.isNullOrUndefined(l),p=o&&sf.base.isNullOrUndefined(n.previousSibling);c&&p?this.handleActionWhenNextSiblingIsNull(e,n):h?this.handleActionWhenNextSiblingExists(e,n,l):d&&(e.event.preventDefault(),this.mergeNextContentIntoCodeBlock(n,i))}},e.prototype.isBrAsLastChildInCodeBlock=function(e){var t=e.querySelector("code").lastChild,n=t?t.previousSibling:null;return t&&"BR"===t.nodeName&&!sf.base.isNullOrUndefined(n)&&"BR"!==n.nodeName},e.prototype.handleActionWhenNextSiblingIsNull=function(e,t){e.event.preventDefault(),this.nodeCreateBasedOnEnterAction(t,e.enterAction),sf.base.detach(t)},e.prototype.handleActionWhenNextSiblingExists=function(e,t,n){e.event.preventDefault();var i=this.parent.nodeSelection.findFirstContentNode(n);if("BR"===i.node.nodeName){var s=this.parent.editableElement.ownerDocument.createRange();s.setStartBefore(i.node),s.setEndBefore(i.node),this.parent.nodeSelection.setRange(this.parent.currentDocument,s)}else this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i.node,0);this.processListElement(t)},e.prototype.processListElement=function(e){var t=e.parentElement;if(t&&"LI"!==t.nodeName&&t.lastChild===e&&(t=e.closest("li")),sf.base.detach(e),t&&"LI"===t.nodeName){var n=t.parentElement;sf.base.detach(t),!n||"UL"!==n.nodeName&&"OL"!==n.nodeName||n.querySelector("li")||sf.base.detach(n)}},e.prototype.findNextValidSibling=function(e){var t=e.nextSibling;if(sf.base.isNullOrUndefined(t)&&e!==this.parent.editableElement)for(var n=e.parentElement;n&&n!==this.parent.editableElement;){for(t=n.nextSibling;t&&!this.isValidNode(t);)t=t.nextSibling;if(t&&("TH"===t.nodeName||"TD"===t.nodeName))return null;if(t)break;n=n.parentElement}if(t&&("UL"===t.nodeName||"OL"===t.nodeName)){var i=this.findFirstListItem(t);if(i)return i}return t},e.prototype.findFirstListItem=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if("LI"===n.nodeName){var i=n.querySelector("OL,UL");if(i){var s=this.findFirstListItem(i);if(s)return s}return n}}return null},e.prototype.isValidNode=function(e){return e.nodeType===Node.ELEMENT_NODE||e.nodeType===Node.TEXT_NODE&&e.textContent.trim().length>0},e.prototype.nodeCreateBasedOnEnterAction=function(e,t){var n=sf.base.createElement(t),i=sf.base.createElement("br");if("P"!==t&&"DIV"!==t||n.appendChild(i),e.parentNode.insertBefore(n,e),"BR"===t){var s=this.parent.editableElement.ownerDocument.createRange();s.setStartBefore(n),s.setEndBefore(n),this.parent.nodeSelection.setRange(this.parent.currentDocument,s)}else this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0)},e.prototype.mergeNextContentIntoCodeBlock=function(e,t){var n=this.findNextValidSibling(e),i=e.querySelector("code");"BR"===n.nodeName?(this.processNode(n,i),sf.base.detach(n)):sf.base.isNullOrUndefined(n)||("BR"===t.nodeName&&sf.base.detach(t),this.parent.domNode.isBlockNode(n)?(this.processNode(n,i),n&&"LI"===n.nodeName&&1===n.parentElement.querySelectorAll("li").length?sf.base.detach(n.parentElement):n.parentNode.removeChild(n)):this.processInlineNextSiblings(n,i))},e.prototype.processInlineNextSiblings=function(e,t){for(var n=e,i=!0;n&&i;){var s=n;n=n.nextSibling,"BR"===s.nodeName||this.parent.domNode.isBlockNode(s)?i=!1:(this.processNode(s,t),s.parentNode.removeChild(s))}},e.prototype.handleNextSiblingCodeBlockDeletion=function(e,t,n){var i=this.parent.domNode.getImmediateBlockNode(t.startContainer),s=i!==this.parent.editableElement?i:t.startContainer,r=this.parent.nodeSelection.findLastTextPosition(s),o=r&&r.node===t.startContainer&&r.offset===t.startOffset,a=this.findParentOrNextSiblingCodeBlock(t);46===n&&!sf.base.isNullOrUndefined(a)&&o&&(e.event.preventDefault(),this.mergeCodeBlockWithCurrentNode(a))},e.prototype.mergeCodeBlockWithCurrentNode=function(e){var t=e.nextSibling,n=t.querySelector("code"),i=e.currentNode;if(this.parent.domNode.isBlockNode(i)){for(;n.firstChild;){var s=n.firstChild;i.appendChild(s)}t.parentNode.removeChild(t)}else{for(var r=i.parentNode,o=i.nextSibling;n.firstChild;){s=n.firstChild;r.insertBefore(s,o)}t.parentNode.removeChild(t)}},e.prototype.handleBackspaceAtCodeBlockStart=function(e,t,n,i){var s=this.parent.nodeSelection.findFirstContentNode(this.parent.domNode.getImmediateBlockNode(t.startContainer)),r=s.node&&s.node===("CODE"===t.startContainer.nodeName?t.startContainer.firstChild:t.startContainer)&&0===t.startOffset;if(8===n&&!sf.base.isNullOrUndefined(i)&&r){e.event.preventDefault();var o=i.querySelector("code");if(sf.base.isNullOrUndefined(i.previousSibling))sf.base.isNullOrUndefined(i.previousSibling)&&0===i.textContent.length&&(this.nodeCreateBasedOnEnterAction(i,e.enterAction),sf.base.detach(i));else{var a=i.previousSibling,l=this.parent.nodeSelection.findLastTextPosition(a);this.mergePreviousElementWithCodeBlock(a,o,i),sf.base.isNullOrUndefined(a)||this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,l.node,l.offset)}}},e.prototype.mergePreviousElementWithCodeBlock=function(e,t,n){if(this.parent.domNode.isBlockNode(e)){for(;t.firstChild;){var i=t.firstChild;e.appendChild(i)}n.parentNode.removeChild(n)}else{for(var s=e.parentNode,r=e.nextSibling;t.firstChild;){i=t.firstChild;s.insertBefore(i,r)}n.parentNode.removeChild(n)}},e.prototype.handleBackspaceAfterCodeBlock=function(e,t,n){var i=this.parent.domNode.getImmediateBlockNode(t.startContainer),s=i!==this.parent.editableElement?i:t.startContainer,r=this.parent.nodeSelection.findFirstContentNode(s),o=r.node&&r.node===("CODE"===t.startContainer.nodeName?t.startContainer.firstChild:t.startContainer)&&0===t.startOffset,a=this.findParentOrPreviousSiblingCodeBlock(t),l=a&&"TABLE"===a.currentNode.nodeName;8===n&&!sf.base.isNullOrUndefined(a)&&o&&!l&&(e.event.preventDefault(),this.mergePreviousCodeBlockWithCurrent(a))},e.prototype.mergePreviousCodeBlockWithCurrent=function(e){var t=this,n=e.previousSibling.querySelector("code"),i=e.currentNode,s=null,r=!0,o=function(e,n){t.processNode(e,n),r&&(s=n.lastChild,r=!1)};this.parent.domNode.isBlockNode(i)?this.processMergeBlockNode(i,n,o):this.processMergeInlineNode(i,n,o),s&&s.nodeType===Node.TEXT_NODE&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,s,0)},e.prototype.processMergeBlockNode=function(e,t,n){for(;e.firstChild;){var i=e.firstChild;e.removeChild(i),n(i,t)}e.parentNode.removeChild(e)},e.prototype.processMergeInlineNode=function(e,t,n){for(var i=e;i;){var s=i.nextSibling;if("BR"===i.nodeName||this.parent.domNode.isBlockNode(i))break;i.parentNode&&i.parentNode.removeChild(i),n(i,t),i=s}},e.prototype.codeBlockEnterAction=function(e){var t=this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument),n="#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,i="#text"===t.endContainer.nodeName?t.endContainer.parentElement:t.endContainer;this.isCodeBlockPointSelection(t,n,i)?this.handleCodeBlockPointSelection(e,t,n):this.isSelectionWithinCodeBlock(t,n,i)?this.handleSelectionWithinCodeBlock(e,t):this.isSelectionOutsideToInside(n,i)?this.handleOutsideToInsideSelection(e,t,i):this.isSelectionInsideToOutside(n,i)&&this.handleInsideToOutsideSelection(e,t,n)},e.prototype.isCodeBlockPointSelection=function(e,t,n){var i=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,s=!sf.base.isNullOrUndefined(t.closest("pre[data-language]"))&&!sf.base.isNullOrUndefined(n.closest("pre[data-language]"));if(!i||!s)return!1;var r=this.isFirstAppendScenario(e),o=this.isLastAppendScenario(e);return r||o},e.prototype.isFirstAppendScenario=function(e){return 0===e.startOffset&&0===e.endOffset&&"CODE"===e.startContainer.nodeName&&e.startContainer.childNodes[e.startOffset]&&e.endContainer.childNodes[e.endOffset]&&"BR"===e.startContainer.childNodes[e.endOffset].nodeName&&e.startContainer.childNodes.length>1&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.endOffset+1])},e.prototype.isLastAppendScenario=function(e){return"CODE"===e.startContainer.nodeName&&e.startContainer.childNodes[e.startOffset]&&"BR"===e.startContainer.childNodes[e.startOffset].nodeName&&e.startContainer.lastChild===e.startContainer.childNodes[e.startOffset]&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])&&"BR"===e.startContainer.childNodes[e.startOffset-1].nodeName&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-2])&&"BR"===e.startContainer.childNodes[e.startOffset-2].nodeName},e.prototype.handleCodeBlockPointSelection=function(e,t,n){var i=this.isValidCodeBlockStructure(n),s=i.closest("UL,OL");if(sf.base.isNullOrUndefined(s)){e.event.preventDefault();r=sf.base.createElement(e.enterAction),o=sf.base.createElement("br");"P"!==e.enterAction&&"DIV"!==e.enterAction||r.appendChild(o);a=this.isFirstAppendScenario(t),l=i.querySelector("code");a?(sf.base.detach(l.firstChild),i.parentElement.insertBefore(r,i)):(sf.base.detach(l.lastChild),sf.base.detach(l.lastChild),i.parentElement.insertBefore(r,i.nextElementSibling)),this.setNewRangeBeforeBrElement(o)}else{e.event.preventDefault();var r=sf.base.createElement("LI"),o=sf.base.createElement("br");r.appendChild(o);var a=this.isFirstAppendScenario(t),l=i.querySelector("code");if(a)sf.base.detach(l.firstChild),s.insertBefore(r,i.closest("li"));else{sf.base.detach(l.lastChild),sf.base.detach(l.lastChild);for(var d=i.closest("li"),c=d.querySelectorAll("UL,OL"),h=0;h<c.length;h++)"UL"!==c[h].nodeName&&"OL"!==c[h].nodeName||r.appendChild(c[h]);s.insertBefore(r,d.nextElementSibling)}this.setNewRangeBeforeBrElement(o)}},e.prototype.setNewRangeBeforeBrElement=function(e){var t=this.parent.editableElement.ownerDocument.createRange();t.setStartBefore(e),t.setEndBefore(e),this.parent.nodeSelection.setRange(this.parent.currentDocument,t)},e.prototype.isSelectionWithinCodeBlock=function(e,t,n){return!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t))&&!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(n))},e.prototype.handleSelectionWithinCodeBlock=function(e,t){e.event.preventDefault();var n=this.isValidCodeBlockStructure(t.startContainer);t.startContainer===t.endContainer&&t.startOffset===t.endOffset||t.deleteContents();var i="#text"===t.endContainer.nodeName?t.endContainer.parentElement.closest("code"):t.endContainer.closest("code"),s=i&&i.lastChild===t.startContainer&&t.endOffset===(t.endContainer.nodeType===Node.TEXT_NODE?t.endContainer.textContent.length:t.endContainer.childNodes.length)&&(sf.base.isNullOrUndefined(t.startContainer.nextSibling)||!sf.base.isNullOrUndefined(t.startContainer.nextSibling)&&"BR"!==t.startContainer.nextSibling.nodeName),r=sf.base.createElement("br");if(t.insertNode(r),s){var o=sf.base.createElement("br");r.parentNode.insertBefore(o,r.nextSibling)}n.normalize();var a=r.nextSibling;a&&a.nodeType===Node.TEXT_NODE?(t.setStart(a,0),t.setEnd(a,0)):(t.setStartAfter(r),t.setEndAfter(r)),this.parent.nodeSelection.setRange(this.parent.currentDocument,t)},e.prototype.isSelectionOutsideToInside=function(e,t){return sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(e))&&!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t))},e.prototype.handleOutsideToInsideSelection=function(e,t,n){e.event.preventDefault();var i=this.isValidCodeBlockStructure(n),s=i.querySelector("code"),r=i.previousSibling,o=t.endContainer===s.lastChild&&t.endOffset===s.lastChild.textContent.length;if(t.deleteContents(),o&&0===r.textContent.length)this.nodeCreateBasedOnEnterAction(i,e.enterAction),i.parentNode.removeChild(i),0===r.textContent.length&&r.parentNode.removeChild(r);else if(s&&0!==s.childNodes.length&&""!==s.textContent)this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0);else if(s&&0===s.children.length&&s.childNodes[0]&&"BR"!==s.childNodes[0].nodeName){var a=sf.base.createElement("br");s.appendChild(a),t.setStartAfter(a),t.setEndAfter(a)}},e.prototype.isSelectionInsideToOutside=function(e,t){return!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(e))&&sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t))},e.prototype.handleInsideToOutsideSelection=function(e,t,n){e.event.preventDefault(),t.deleteContents();var i=this.isValidCodeBlockStructure(n),s=i.querySelector("code");if(s&&""===s.innerHTML&&s.childNodes[0]&&"BR"!==s.childNodes[0].nodeName){var r=sf.base.createElement("br");s.appendChild(r),t.setStartAfter(r),t.setEndAfter(r)}var o=i.nextSibling;if(o)if(o.nodeType===Node.TEXT_NODE)this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,o,0);else{var a=this.findFirstTextNode(o);a?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,a,0):this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,o,0)}},e.prototype.findFirstTextNode=function(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var t=0;t<e.childNodes.length;t++){var n=this.findFirstTextNode(e.childNodes[t]);if(!sf.base.isNullOrUndefined(n))return n}return null},e.prototype.getSelectionRange=function(){return this.parent.editableElement.ownerDocument.defaultView.getSelection().getRangeAt(0)},e.prototype.codeBlockPasteAction=function(e){var t=this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument),n="#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,i="#text"===t.endContainer.nodeName?t.endContainer.parentElement:t.endContainer;if(this.isValidCodeBlockStructure(n)||this.isValidCodeBlockStructure(i)){e.event.preventDefault();var s=e.event.clipboardData.getData("text/plain");t&&(this.isPointSelection(t)?this.handlePointSelectionPaste(t,s):this.isSameCodeBlockSelection(n,i)?this.handleSameCodeBlockPaste(t,s):this.handleCrossCodeBlockPaste(t,s,n,i,e))}},e.prototype.isPointSelection=function(e){return e.startContainer===e.endContainer&&e.startOffset===e.endOffset},e.prototype.isSameCodeBlockSelection=function(e,t){return!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t))&&!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(e))&&this.isValidCodeBlockStructure(t)===this.isValidCodeBlockStructure(e)},e.prototype.handlePointSelectionPaste=function(e,t){var n=this.isValidCodeBlockStructure(e.startContainer),i=document.createTextNode(t);e.insertNode(i);var s=this.parent.nodeSelection.findLastTextPosition(i);s&&s.node&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,s.node,s.offset),n.normalize()},e.prototype.handleSameCodeBlockPaste=function(e,t){var n=document.createTextNode(t);e.deleteContents(),e.insertNode(n);var i=this.parent.nodeSelection.findLastTextPosition(n);i&&i.node&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i.node,i.offset)},e.prototype.handleCrossCodeBlockPaste=function(e,t,n,i,s){var r=this,o=this.parent.domNode.blockNodes();e.deleteContents();var a=document.createTextNode(t);if(this.isValidCodeBlockStructure(i))(l=this.isValidCodeBlockStructure(i).querySelector("code")).insertBefore(a,l.firstChild);else if(this.isValidCodeBlockStructure(n)){var l;(l=this.isValidCodeBlockStructure(n).querySelector("code")).appendChild(a)}var d=this.parent.nodeSelection.findLastTextPosition(a);if(d&&d.node){this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,d.node,d.offset);var c=this.getSelectionRange(),h=o.filter((function(e){return r.parent.editableElement.contains(e)}));this.setCursorMarkers(c);var p=s.item.currentFormat;this.processCodeBlockAction(c,h,p)}},e.prototype.extractAndWrapCodeBlockContent=function(e,t){for(var n=e.querySelector("code"),i=e.parentElement,s=n.childNodes,r=[],o=this.parent.currentDocument.createElement(t),a=0;a<s.length;a++)if("BR"!==t){if("BR"!==s[a].nodeName){var l=s[a].cloneNode(!0);o.appendChild(l),s[a+1]||(r.push(o),o=null)}else if("BR"===s[a].nodeName&&(0!==o.childNodes.length&&r.push(o),o=this.parent.currentDocument.createElement(t),a+1<s.length&&"BR"===s[a+1].nodeName)){var d=this.parent.currentDocument.createElement(t);d.innerHTML="<br>",r.push(d)}}else r.push(s[a].cloneNode(!0));for(var c=0;c<r.length;c++)i.insertBefore(r[c],e);return"BR"!==t&&this.parent.editableElement.querySelectorAll(".e-rte-cursor-marker").forEach((function(e){0===e.parentElement.textContent.length&&e.parentElement.appendChild(sf.base.createElement("BR"))})),e.remove(),r},e.prototype.isRevertCodeBlock=function(e,t){return!!(e.event&&e.event.target&&e.event.target.parentElement&&e.event.target.parentElement.classList.contains("e-split-btn")||e.event&&e.event.target&&e.event.target.classList.contains("e-split-btn"))&&(!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t.startContainer))&&!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t.endContainer)))},e.prototype.codeBlockCreation=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);this.isRevertCodeBlock(e,t)?(this.revertCodeBlockToNormalText(t,e.enterAction),this.disableToolbarItems()):this.createNewCodeBlock(t,e)},e.prototype.revertCodeBlockToNormalText=function(e,t){this.setCursorMarkers(e);for(var n=this.getBlockNodes(),i=[],s=0;s<n.length;s++){var r=n[s],o=this.isValidCodeBlockStructure(r);if(o){var a=this.extractAndWrapCodeBlockContent(o,t);i.push.apply(i,a)}}this.restoreCursorFromMarkers();for(s=0;s<i.length;s++)i[s].normalize()},e.prototype.createNewCodeBlock=function(e,t){this.setCursorMarkers(e);var n=this.getBlockNodes(),i=t.item,s=this.checkTableElementInsideSelection(n),r=s.hasTableNodes,o=s.itemList;if(this.isRangeInsideTable(e)||r)if(r)for(var a=0,l=o;a<l.length;a++){var d=l[a];this.processCodeBlockAction(e,d,i)}else for(var c=0,h=n;c<h.length;c++){d=[h[c]];this.processCodeBlockAction(e,d,i)}else this.processCodeBlockAction(e,n,i)},e.prototype.checkTableElementInsideSelection=function(e){for(var t=[],n=[],i=[],s=!1,r=0,o=e;r<o.length;r++){var a=o[r];if(a.nodeType===Node.ELEMENT_NODE){var l=a,d=l.closest("td, th, thead, tbody, tr"),c=l.closest("blockquote");l&&"TABLE"===l.nodeName||d&&!d.classList.contains("e-cell-select")?(n.length>0&&t.push(n),i.length>0&&t.push(i),n=[],i=[],s=!0):c?(n.length>0&&t.push(n),i.push(l),n=[],s=!0):(i.length>0&&t.push(i),n.push(l),i=[])}}return n.length>0&&t.push(pt(n)),i.length>0&&t.push(pt(i)),{hasTableNodes:s,itemList:t}},e.prototype.isRangeInsideTable=function(e){var t=1===e.startContainer.nodeType?e.startContainer:e.startContainer.parentElement,n=1===e.endContainer.nodeType?e.endContainer:e.endContainer.parentElement,i=t.closest("table"),s=n.closest("table");return!(!i||!s||i!==s)&&this.parent.editableElement.querySelectorAll("td.e-multi-cells-select, th.e-multi-cells-select").length>0},e.prototype.getBlockNodes=function(){return this.getTextAndBrNodes()},e.prototype.getTextAndBrNodes=function(){var e=this,t=[],n=this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument),i=this.parent.editableElement.ownerDocument,s=this.parent.editableElement.querySelector('.e-rte-cursor-marker[data-cursor-pos="point"]'),r=this.parent.editableElement.querySelector('.e-rte-cursor-marker[data-cursor-pos="start"]'),o=this.parent.editableElement.querySelector('.e-rte-cursor-marker[data-cursor-pos="end"]');if(!sf.base.isNullOrUndefined(s)){var a=i.createRange();a.setStartBefore(s),a.setEndBefore(s),this.parent.nodeSelection.setRange(this.parent.currentDocument,a)}var l=(n=this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument)).commonAncestorContainer;this.includeFullNodeForRange(r,o,s);for(var d=i.createTreeWalker(l,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,{acceptNode:function(t){var n=t.nodeType===Node.ELEMENT_NODE&&t.previousSibling&&"SPAN"===t.previousSibling.nodeName&&t.previousSibling.classList.contains("e-rte-cursor-marker"),i=e.parent.nodeSelection.getRange(e.parent.editableElement.ownerDocument);return(t.nodeType===Node.TEXT_NODE||"BR"===t.nodeName||n)&&t!==e.parent.editableElement&&i.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),c=d.currentNode;c;)c===this.parent.editableElement||"UL"===c.nodeName||"OL"===c.nodeName||"TD"===c.nodeName||"TH"===c.nodeName||"BLOCKQUOTE"===c.nodeName||("#text"!==c.nodeName||""===c.textContent||1===c.textContent.length&&32===c.textContent.charCodeAt(0))&&"BR"!==c.nodeName||t.push(c),c=d.nextNode();for(var h=[],p=n.startContainer===n.endContainer&&n.startOffset===n.endOffset,u=0;u<t.length;u++){var f="#text"===t[0].nodeName?t[0].parentElement:t[0],m=f&&f.closest("td,th")&&f.closest("td,th").classList.contains("e-multi-cells-select");"BR"===t[u].nodeName?m?this.wrapTableElementToList(h):(u+1<t.length&&"BR"===t[u+1].nodeName||p&&u===t.length-1)&&this.processNodeForBlockNodes(t[u],h):m?this.wrapTableElementToList(h):this.processNodeForBlockNodes(t[u],h)}return h},e.prototype.includeFullNodeForRange=function(e,t,n){var i=null,s=null;if(e&&t||n){if(e=null!=e?e:n,(i=this.parent.domNode.getImmediateBlockNode(e))===this.parent.editableElement||i&&("TH"===i.nodeName||"TD"===i.nodeName))for(i=e;i&&i.previousSibling&&"BR"!==i.previousSibling.nodeName&&!this.parent.domNode.isBlockNode(i.previousSibling);){var r=this.parent.domNode.getImmediateBlockNode(i);if(r!==this.parent.editableElement&&"TD"!==r.nodeName&&"TH"!==r.nodeName)break;i=i.previousSibling}if(t=null!=t?t:n,(s=this.parent.domNode.getImmediateBlockNode(t))===this.parent.editableElement||s&&("TH"===s.nodeName||"TD"===s.nodeName))for(var o=t,a=(s=t)&&s.nextSibling&&"BR"===s.nextSibling.nodeName&&t&&"SPAN"===t.nodeName&&o.className&&-1!==o.className.indexOf("e-rte-cursor-marker");s&&s.nextSibling&&"BR"!==s.nextSibling.nodeName&&!this.parent.domNode.isBlockNode(s.nextSibling)||a;){if(s.nextSibling&&"BR"===s.nextSibling.nodeName&&t&&"SPAN"===t.nodeName&&o.className&&-1!==o.className.indexOf("e-rte-cursor-marker")){s=s.nextSibling;break}s=s.nextSibling}}if(i&&s){var l=(this.parent.editableElement?this.parent.editableElement.ownerDocument:document).createRange();l.setStartBefore(i),l.setEndAfter(s),this.parent.nodeSelection.setRange(this.parent.currentDocument,l)}},e.prototype.wrapTableElementToList=function(e){for(var t=this.parent.editableElement.querySelectorAll("table td.e-multi-cells-select, table th.e-multi-cells-select"),n=0;n<t.length;n++){for(var i=t[n],s=document.createElement("div");i.childNodes.length>0;)s.appendChild(i.childNodes[0]);i.appendChild(s),e.push(s)}},e.prototype.processNodeForBlockNodes=function(e,t){var n=this.parent.domNode.getImmediateBlockNode(e);if(n&&n!==this.parent.editableElement&&"TD"!==n.nodeName&&"TH"!==n.nodeName&&"UL"!==n.nodeName&&"OL"!==n.nodeName&&"BLOCKQUOTE"!==n.nodeName)-1===t.indexOf(n)&&t.push(n);else{for(var i=e,s=e,r=e.previousSibling;r&&"BR"!==r.nodeName&&!this.parent.domNode.isBlockNode(r);)i=r,r=r.previousSibling;for(var o=e.nextSibling;o&&"BR"!==o.nodeName&&!this.parent.domNode.isBlockNode(o);)s=o,o=o.nextSibling;for(var a=this.parent.editableElement.ownerDocument.createElement("div"),l=i,d=[];l&&(d.push(l),l!==s);)l=l.nextSibling;for(var c=0,h=d;c<h.length;c++){var p=h[c];a.appendChild(p.cloneNode(!0))}if(i.parentNode){i.parentNode.insertBefore(a,i);for(var u=0,f=d;u<f.length;u++){(p=f[u]).parentNode&&p.parentNode.removeChild(p)}t.push(a)}}},e.prototype.processCodeBlockAction=function(e,t,n){0!==t.length&&this.formatCodeBlock(e,t,n)},e.prototype.formatCodeBlock=function(e,t,n){var i=this,s=this.parent.editableElement.ownerDocument.createDocumentFragment(),r=sf.base.createElement("pre");r.setAttribute("data-language",n.label),r.setAttribute("spellcheck","false");var o=sf.base.createElement("code");o.className="language-"+n.language.toLowerCase().replace(/\s+/g,""),t.forEach((function(e,n){i.processNode(e,o),n<t.length-1&&o.appendChild(sf.base.createElement("br"))})),r.appendChild(o),s.appendChild(r);var a=t[0],l=a.parentElement;this.insertFragmentAtNode(s,a,l),this.removeNodes(t),this.restoreCursorFromMarkers(),r.normalize(),this.disableToolbarItems()},e.prototype.disableToolbarItems=function(){this.parent.observer.notify("codeblock_disabletoolbar",{})},e.prototype.insertFragmentAtNode=function(e,t,n){for(var i=null,s=t;s&&s!==this.parent.editableElement;){if("LI"===s.nodeName){i=s;break}s=s.parentNode}if(i){var r=sf.base.createElement("li");r.appendChild(e),i.parentNode.insertBefore(r,i),""===i.textContent.trim()&&i.remove()}else n.insertBefore(e,t)},e.prototype.removeNodes=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("#text"!==n.nodeName&&n.closest("li"))n.closest("li").remove();else n.nodeName,n.remove()}},e.prototype.processNode=function(e,t){var n=this;if(e.nodeType===Node.ELEMENT_NODE&&e.classList&&e.classList.contains("e-rte-cursor-marker"))t.appendChild(e.cloneNode(!0));else if(e.nodeType===Node.TEXT_NODE)t.appendChild(this.parent.editableElement.ownerDocument.createTextNode(e.textContent));else if(e.nodeType===Node.ELEMENT_NODE){var i=e;"br"===i.tagName.toLowerCase()?t.appendChild(sf.base.createElement("br")):Array.from(i.childNodes).forEach((function(e){return n.processNode(e,t)}))}},e.prototype.setCursorMarkers=function(e){var t=sf.base.createElement("span");if(t.className="e-rte-cursor-marker",e.startContainer===e.endContainer&&e.startOffset===e.endOffset)return t.setAttribute("data-cursor-pos","point"),(i=e.cloneRange()).insertNode(t),{startMarker:t,endMarker:null};var n=sf.base.createElement("span");n.className="e-rte-cursor-marker",n.setAttribute("data-cursor-pos","start"),n.style.display="inline";var i,s=sf.base.createElement("span");return s.className="e-rte-cursor-marker",s.setAttribute("data-cursor-pos","end"),s.style.display="inline",(i=e.cloneRange()).collapse(!1),i.insertNode(s),(i=e.cloneRange()).collapse(!0),i.insertNode(n),{startMarker:n,endMarker:s}},e.prototype.restoreCursorFromMarkers=function(){var e=this.parent.editableElement.querySelector('[data-cursor-pos="point"]');if(e){(i=this.parent.editableElement.ownerDocument.createRange()).setStartBefore(e),i.setStartAfter(e);var t=e.previousSibling;if(e.parentNode.removeChild(e),this.parent.nodeSelection.setRange(this.parent.currentDocument,i),t){var n=this.parent.nodeSelection.findLastTextPosition(t);n&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n.node,n.offset)}}var i,s=this.parent.editableElement.querySelector('[data-cursor-pos="start"]'),r=this.parent.editableElement.querySelector('[data-cursor-pos="end"]');s&&r&&((i=this.parent.editableElement.ownerDocument.createRange()).setStartAfter(s),i.setEndBefore(r),s.parentNode.removeChild(s),r.parentNode.removeChild(r),this.parent.nodeSelection.setRange(this.parent.currentDocument,i))},e.prototype.findParentOrNextSiblingCodeBlock=function(e){for(var t=e.startContainer;t&&sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t))&&t!==this.parent.editableElement;){for(var n=t.nextSibling;n&&"BR"!==n.nodeName&&this.parent.domNode.isBlockNode(n);){if(this.isValidCodeBlockStructure(n))return{currentNode:t,nextSibling:n};if(this.parent.domNode.isBlockNode(n))break;n=n.nextSibling}if((t=t.parentElement)===this.parent.editableElement)break}return null},e.prototype.findParentOrPreviousSiblingCodeBlock=function(e){for(var t=e.startContainer;t&&sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t))&&t!==this.parent.editableElement;){for(var n=t.previousSibling;n&&"BR"!==n.nodeName&&this.parent.domNode.isBlockNode(n);){var i=this.parent.nodeSelection.findLastTextPosition(n);if(i&&i.node&&this.isValidCodeBlockStructure(i.node))return{currentNode:t,previousSibling:this.isValidCodeBlockStructure(i.node)};if(this.isValidCodeBlockStructure(n))return{currentNode:t,previousSibling:n};if(this.parent.domNode.isBlockNode(n))break;n=n.previousSibling}if((t=t.parentElement)===this.parent.editableElement)break}return null},e.prototype.getCodeBlockPosition=function(e){var t=this.parent.domNode.getImmediateBlockNode(e.startContainer),n=t!==this.parent.editableElement?t:e.startContainer,i=this.parent.nodeSelection.findLastTextPosition(n);return{blockNode:n,cursorAtLastPosition:i&&i.node===e.startContainer&&i.offset===e.startOffset,nextSiblingCodeBlockElement:this.findParentOrNextSiblingCodeBlock(e)}},e.prototype.isActionDisallowedInCodeBlock=function(e,t){if(!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t.startContainer))||!sf.base.isNullOrUndefined(this.isValidCodeBlockStructure(t.endContainer))){var n=e.action;if(!sf.base.isNullOrUndefined(n)&&-1===["paste","cut","copy","decrease-fontsize","increase-fontsize","maximize","minimize","tab","undo","redo","backspace","enter","delete","code-block","space","full-screen","escape","down","up","home","end","toolbar-focus","indents","outdents","ordered-list","unordered-list","shift-tab"].indexOf(n))return!0}return!1},e.prototype.codeBlockTabAction=function(e){var t={subCommand:"TabAction",callBack:e.callBack};this.handleCodeBlockIndentation(t)},e.prototype.codeBlockShiftTabAction=function(e){var t={subCommand:"ShiftTabAction",callBack:e.callBack};this.handleCodeBlockIndentation(t)},e.prototype.handleCodeBlockIndentation=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n="Outdent"===e.subCommand||"ShiftTabAction"===e.subCommand,i=this.isValidCodeBlockStructure(t.startContainer),s=this.parent.nodeSelection.getSelectedNodes(this.parent.editableElement.ownerDocument);if(t.startContainer===t.endContainer&&t.startOffset===t.endOffset)if(n){if(t.startOffset>0&&"\t"===t.startContainer.textContent[t.startOffset-1]){var r=(f=t.startContainer.textContent).substring(0,t.startOffset-1),o=f.substring(t.startOffset),a=this.parent.currentDocument.createTextNode(r),l=this.parent.currentDocument.createTextNode(o),d=t.startContainer.parentElement;d.replaceChild(l,t.startContainer),d.insertBefore(a,l),(c=this.parent.editableElement.ownerDocument.createRange()).setStart(l,0),c.setEnd(l,0),this.parent.nodeSelection.setRange(this.parent.currentDocument,c)}}else{var c,h=this.parent.currentDocument.createTextNode("\t");t.insertNode(h),(c=this.parent.editableElement.ownerDocument.createRange()).setStartAfter(h),c.setEndAfter(h),this.parent.nodeSelection.setRange(this.parent.currentDocument,c)}else if(s&&s.length>0){this.setCursorMarkers(t);for(var p=0;p<s.length;p++){var u=s[p];if(3===u.nodeType){var f=u.textContent||"";n?f.startsWith("\t")&&(u.textContent=f.substring(1)):u.textContent="\t"+f}}this.restoreCursorFromMarkers()}i.normalize(),"TabAction"!==e.subCommand&&"ShiftTabAction"!==e.subCommand&&e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:i})},e}(),ft=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),s=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,a=r.length;o<a;o++,s++)i[s]=r[o];return i},mt=function(){function e(e,t){this.parent=e,this.pasteModel=t,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(v,this.destroy)},e.prototype.updatePasteCleanupModel=function(e){this.pasteModel=e},e.prototype.extractFileFromClipboard=function(e){if(!e||!e.args||!e.args.clipboardData||0===e.args.clipboardData.items.length)return null;var t=e.args.clipboardData.items,n=t[0].getAsFile();return null!==n?n:sf.base.isNullOrUndefined(t[1])?null:t[1].getAsFile()},e.prototype.splitBreakLine=function(e){for(var t=e.split(/\r\n\r\n|\n\n/g),n="",i=this.getHtmlNode(!0),s=this.getHtmlNode(!1),r="BR"===this.pasteModel.enterKey,o=0;o<t.length;o++){var a=t[o],l=this.normalizeSpacesForHtml(a).replace(/\r\n|\n/g,"<br>");0===o?r&&(o!==t.length-1||l.endsWith("<br>"))?o!==t.length-1?n+=l+s+s:n+=l+s:n+=l:r?l.endsWith("<br>")||""===l&&o===t.length-1?n+=l+s:o===t.length-1?n+=l:n+=l+s+s:(""===l.trim()&&(n+="<br>"),n+=i+l+s)}return n},e.prototype.getHtmlNode=function(e){return"P"===this.pasteModel.enterKey?e?"<p>":"</p>":"DIV"===this.pasteModel.enterKey?e?"<div>":"</div>":e?"":"<br>"},e.prototype.normalizeSpacesForHtml=function(e){var t="";if(""===e)return e;for(var n=e.split(" "),i=0;i<n.length;i++){var s=n[i];""===s?t+="&nbsp;":"\t"===s?t+="&nbsp;&nbsp;&nbsp;&nbsp;":(i>0&&i<n.length&&(t+=" "),t+=s)}return t=(t=t.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/&nbsp;&nbsp;/g,"&nbsp; ")},e.prototype.base64ToFile=function(e,t){for(var n=e.split(","),i=n[0].match(/:(.*?);/)[1].split("/")[1],s=atob(n[1]),r=s.length,o=new Uint8Array(r);r--;)o[r]=s.charCodeAt(r);if(sf.base.Browser.isIE||navigator.appVersion.indexOf("Edge")>-1){var a=new Blob([o],{type:i});return sf.base.extend(a,{name:t+"."+(sf.base.isNullOrUndefined(i)?"":i)}),a}return new File([o],t+"."+(sf.base.isNullOrUndefined(i)?"":i),{type:i})},e.prototype.setImageOpacity=function(e){e.style.opacity="0.5"},e.prototype.createPopupElement=function(){var e=sf.base.createElement("div");return this.pasteModel.rootContainer.appendChild(e),e},e.prototype.getBlob=function(e){for(var t=0;t<e.length;t++){var n=e[t].getAttribute("src");if(!sf.base.isNullOrUndefined(n)&&n.split(",")[0].indexOf("base64")>=0){var i=URL.createObjectURL(q(n));e[t].setAttribute("src",i)}}},e.prototype.cleanAppleClass=function(e){for(var t=e.querySelectorAll("br.Apple-interchange-newline"),n=0;n<t.length;n++)sf.base.detach(t[n]);return e},e.prototype.cleanupDeniedTagsAndAttributes=function(e,t){return null!==this.pasteModel.pasteCleanupSettings.deniedTags&&(e=this.deniedTags(e)),(t||null!==this.pasteModel.pasteCleanupSettings.deniedAttrs)&&(e=this.deniedAttributes(e,t)),e},e.prototype.deniedTags=function(e){var t=sf.base.isNullOrUndefined(this.pasteModel.pasteCleanupSettings.deniedTags)?[]:ft(this.pasteModel.pasteCleanupSettings.deniedTags);t=this.attributesfilter(t),t=this.tagGrouping(t);for(var n=0;n<t.length;n++)for(var i=e.querySelectorAll(t[n]),s=i.length-1;s>=0;s--){for(var r=i[s],o=r.parentNode;r.firstChild;)o.insertBefore(r.firstChild,r);o.removeChild(r)}return e},e.prototype.attributesfilter=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.split("[").length>1){for(var i=n.split("[")[1].split("]")[0].split(","),s=[],r=[],o=0;o<i.length;o++){var a=i[o];i[o].indexOf("!")<0?s.push(a.trim()):r.push(a.split("!")[1].trim())}var l=s.length>1?s.join("]["):s.join(),d=r.length>1?r.join("]["):r.join();if(d.length>0){var c=""!==l?n.split("[")[0]+"["+l+"]":n.split("[")[0];e[t]=c+":not(["+d+"])"}else e[t]=n.split("[")[0]+"["+l+"]"}}return e},e.prototype.tagGrouping=function(e){for(var t=ft(e),n=Object.keys(Le),i=n.map((function(e){return Le[""+e]})),s=[],r=0;r<t.length;r++){var o=t[r],a=n.indexOf(o);if(o.split("[").length>1&&(o=o.split("[")[0].trim()),n.indexOf(t[r])>-1)for(var l=0;l<i[a].length;l++)t.indexOf(i[a][l])<0&&s.indexOf(i[a][l])<0&&s.push(i[a][l])}return e.concat(s)},e.prototype.deniedAttributes=function(e,t){var n=sf.base.isNullOrUndefined(this.pasteModel.pasteCleanupSettings.deniedAttrs)?[]:ft(this.pasteModel.pasteCleanupSettings.deniedAttrs);t&&n.push("style");for(var i=0;i<n.length;i++)for(var s=n[i],r=e.querySelectorAll("["+s+"]"),o=0;o<r.length;o++)r[o].removeAttribute(s);return e},e.prototype.allowedStyle=function(e){var t=sf.base.isNullOrUndefined(this.pasteModel.pasteCleanupSettings.allowedStyleProps)?[]:ft(this.pasteModel.pasteCleanupSettings.allowedStyleProps);t.push("list-style-type","list-style");for(var n=e.querySelectorAll("[style]"),i=0;i<n.length;i++){for(var s,r=n[i],o=[],a=r.getAttribute("style").split(";"),l=0;l<a.length;l++)t.indexOf(a[l].split(":")[0].trim())>=0&&o.push(a[l]);r.removeAttribute("style"),(s=""===o.join(";").trim()?o.join(";"):o.join(";")+";")&&(r.style.cssText+=s)}return e},e.prototype.setImageClassAndProps=function(e){for(var t=e.getElementsByTagName("img"),n=0,i=t.length;n<i;n++)null!==t[n].getAttribute("src")&&(t[n].className+=" pasteContent_Img"),this.setImageProperties(t[n]);this.addTempClass(e)},e.prototype.setImageProperties=function(e){"auto"!==this.pasteModel.insertImageSettings.width&&e.setAttribute("width",this.pasteModel.insertImageSettings.width),"0"!==this.pasteModel.insertImageSettings.minWidth&&0!==this.pasteModel.insertImageSettings.minWidth&&(e.style.minWidth=this.pasteModel.insertImageSettings.minWidth.toString()),null!==this.pasteModel.insertImageSettings.maxWidth&&(e.style.maxWidth=this.pasteModel.getInsertImgMaxWidth().toString()),"auto"!==this.pasteModel.insertImageSettings.height&&e.setAttribute("height",this.pasteModel.insertImageSettings.height),"0"!==this.pasteModel.insertImageSettings.minHeight&&0!==this.pasteModel.insertImageSettings.minHeight&&(e.style.minHeight=this.pasteModel.insertImageSettings.minHeight.toString()),null!==this.pasteModel.insertImageSettings.maxHeight&&(e.style.maxHeight=this.pasteModel.insertImageSettings.maxHeight.toString())},e.prototype.addTempClass=function(e){for(var t=e.children,n=0;n<t.length;n++)t[n].classList.add("pasteContent_RTE")},e.prototype.hasPictureElement=function(e){return e.getElementsByTagName("picture").length>0},e.prototype.processPictureElement=function(e){for(var t=e.querySelectorAll("picture"),n=this.pasteModel.getDocument().baseURI,i=0;i<t.length;i++){var s=t[i].querySelector("img"),r=t[i].querySelectorAll("source");if(s&&s.getAttribute("src"))for(var o=s.getAttribute("src"),a=o.indexOf("http")>-1?new URL(o):new URL(o,n),l=0;l<r.length;l++){var d=r[l].getAttribute("srcset");if(d&&-1===d.indexOf("http")){var c=a.origin+d;r[l].setAttribute("srcset",c)}}}},e.prototype.hasContentToPaste=function(e){var t=""!==e.textContent&&""!==e.textContent.replace(/\u200B/g,"").trim(),n=e.getElementsByTagName("img").length>0,i=e.getElementsByTagName("table").length>0,s=e.getElementsByTagName("br").length>0;return t||n||i||s},e.prototype.collectBase64ImageFiles=function(e){var t=[];if(!sf.base.isNullOrUndefined(e.querySelector("img"))){for(var n=e.querySelectorAll("img"),i=[],s=[],r=[],o=0;o<n.length;o++){var a=n[o].getAttribute("src");a&&a.split(",")[0].indexOf("base64")>=0&&(i.push(a),s.push(sf.base.getUniqueID("rte_image")),r.push(n[o]))}var l=[],d=void 0;for(o=0;o<i.length;o++)l.push(this.base64ToFile(i[o],s[o])),d={name:l[o].name,rawFile:l[o],size:l[o].size,type:l[o].type,status:"",validationMessages:{minSize:"",maxSize:""},statusCode:"1"},t.push(d)}return t},e.prototype.addTableClass=function(e,t){for(var n=e.querySelectorAll("table"),i=0;i<n.length;i++){var s=n[i],r=s.parentElement,o=r&&"FIGURE"===r.nodeName;if(!(s.classList.length>0&&s.classList.contains("e-rte-custom-table"))){this.pasteModel.pasteCleanupSettings.keepFormat&&t&&!o?s.classList.add("e-rte-paste-"+t+"-table"):s.classList.contains("e-rte-table")||s.classList.add("e-rte-table");var a=s.nextSibling;sf.base.isNullOrUndefined(s.nextElementSibling)&&a&&""===a.textContent.trim()&&sf.base.detach(a)}}return e},e.prototype.removeTempClass=function(){for(var e=this.pasteModel.getEditPanel().querySelectorAll(".pasteContent_RTE"),t=0;t<e.length;t++)e[t].classList.remove("pasteContent_RTE"),""===e[t].getAttribute("class")&&e[t].removeAttribute("class")},e.prototype.cropImageHandler=function(e){var t=e.querySelectorAll(".e-img-cropped");t.length>0?this.processCroppedImages(t):this.handleBlobOrUpload()},e.prototype.processCroppedImages=function(e){for(var t=this,n=function(n){var s=e[n],r=s.getAttribute("src");if(r&&r.split(",")[0].indexOf("base64")>=0){var o=i.pasteModel.getCropImageData()[n],a=new Image;a.src=r,a.onload=function(){var e=o.goalWidth/a.naturalWidth,n=o.goalHeight/a.naturalHeight,i=o.cropLength/e,r=o.cropTop/n,l=(o.goalWidth-o.cropLength-o.cropR)/e,d=(o.goalHeight-o.cropTop-o.cropB)/n,c=document.createElement("canvas");c.width=l,c.height=d;var h=c.getContext("2d");h&&(h.drawImage(a,i,r,l,d,0,0,l,d),s.setAttribute("src",c.toDataURL("image/png")),s.classList.remove("e-img-cropped"),t.pasteModel.imageUpload(),t.pasteModel.iframeSettings.enable&&t.pasteModel.updateValue())}}},i=this,s=0;s<e.length;s++)n(s)},e.prototype.handleBlobOrUpload=function(){var e=this,t=this.pasteModel.getEditPanel(),n=t.querySelectorAll("img");n.length>0&&n[0].src.startsWith("blob")&&!sf.base.isNullOrUndefined(this.pasteModel.insertImageSettings.saveUrl)&&!sf.base.isNullOrUndefined(this.pasteModel.insertImageSettings.path)?(this.convertBlobToBase64(t),this.iframeUploadTime=setTimeout((function(){e.pasteModel.imageUpload(),e.pasteModel.iframeSettings.enable&&e.pasteModel.updateValue()}),20)):(this.pasteModel.imageUpload(),this.pasteModel.iframeSettings.enable&&!this.pasteModel.enableXhtml&&this.pasteModel.updateValue())},e.prototype.convertBlobToBase64=function(e){for(var t=e.querySelectorAll("img"),n=function(e){var n=t[e].getAttribute("src");if(n&&n.startsWith("blob")){var i=new Image,s=function(){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=i.width,n.height=i.height,r.drawImage(i,0,0);var o=n.toDataURL("image/png");t[e].src=o,i.removeEventListener("load",s)};i.src=n,i.addEventListener("load",s)}},i=0;i<t.length;i++)n(i)},e.prototype.destroy=function(){this.iframeUploadTime&&(clearTimeout(this.iframeUploadTime),this.iframeUploadTime=null),this.removeEventListener()},e}(),gt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent&&this.parent.observer&&(this.parent.observer.on(r,this.keyUp,this),this.parent.observer.on(o,this.keyDown,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(s,this.bindOnEnd,this),this.parent.observer.on("updateProperty",this.updateTableProperty,this),this.parent.observer.on(p,this.docClick,this),this.parent.observer.on("iframe-click",this.onIframeMouseDown,this),this.parent.observer.on(c,this.editAreaClickHandler,this),this.parent.observer.on("createTable",this.renderDlgContent,this),this.parent.observer.on("dropDownSelect",this.dropdownSelect,this),this.parent.observer.on("table-toolbar-action",this.onToolbarAction,this),this.parent.observer.on("afterKeyDown",this.afterKeyDown,this))},e.prototype.removeEventListener=function(){this.parent&&this.parent.observer&&(this.parent.observer.off(r,this.keyUp),this.parent.observer.off(o,this.keyDown),this.parent.observer.off(i,this.destroy),this.parent.observer.off(s,this.bindOnEnd),this.parent.observer.on("updateProperty",this.updateTableProperty),this.parent.observer.off(p,this.docClick),this.parent.observer.off("iframe-click",this.onIframeMouseDown),this.parent.observer.off(c,this.editAreaClickHandler),this.parent.observer.off("createTable",this.renderDlgContent),this.parent.observer.off("dropDownSelect",this.dropdownSelect),this.parent.observer.off("table-toolbar-action",this.onToolbarAction),this.parent.observer.off("tableColorPickerChanged",this.setBGColor),this.parent.observer.off("afterKeyDown",this.afterKeyDown),this.tableObj&&this.parent.observer.off(d,this.tableObj.cellSelect))},e.prototype.bindOnEnd=function(){if("HTML"===this.parent.editorMode&&this.parent.formatter&&this.parent.formatter.editorManager){var e=this.getTableModelProperty();this.parent.formatter.editorManager.tableObj=this.tableObj=new lt(this.parent.formatter.editorManager,e,this.parent.iframeSettings),this.tableObj&&(this.parent.tableSettings.resize&&this.tableObj.addResizeEventHandlers(),this.parent.observer.off(d,this.tableObj.cellSelect),this.parent.observer.off("tableColorPickerChanged",this.setBGColor),this.parent.observer.on(d,this.tableObj.cellSelect,this.tableObj),this.parent.observer.on("tableColorPickerChanged",this.setBGColor,this))}},e.prototype.updateTableProperty=function(){var e=this.getTableModelProperty();this.tableObj.updateTableModel(e)},e.prototype.getTableModelProperty=function(){var e=this;return{tableSettings:this.parent.tableSettings,rteElement:this.parent.element,readonly:this.parent.readonly,enableRtl:this.parent.enableRtl,editorMode:this.parent.editorMode,enterKey:this.parent.enterKey,quickToolbarSettings:this.parent.quickToolbarSettings,getCssClass:function(t){return e.parent.getCssClass(t)},preventDefaultResize:function(t,n){e.parent.preventDefaultResize(t,n)},getDocument:function(){return e.parent.getDocument()},getEditPanel:function(){return e.parent.getEditPanel()},resizeStart:function(t){e.resizeStart(t)},resizing:function(t){e.resizing(t)},resizeEnd:function(t){e.resizeEnd(t)},addRow:function(t,n,i){e.addRow(t,n,i)},hideTableQuickToolbar:function(){e.hideTableQuickToolbar()},removeTable:function(t,n,i){e.removeTable(t,n,i)},isTableQuickToolbarVisible:function(){return e.isTableQuickToolbarVisible()},enableUndo:function(){e.enableUndo()}}},e.prototype.resizeStart=function(e){var t=this;this.parent.getDocument().activeElement!==this.parent.inputElement&&this.parent.focusIn(),this.parent.onResizeStartEnabled&&this.parent.dotNetRef.invokeMethodAsync("ResizeStartEvent",e).then((function(e){e.cancel&&t.tableObj&&t.tableObj.cancelResizeAction()}))},e.prototype.enableUndo=function(){this.parent.formatter&&this.parent.formatter.enableUndo(this.parent)},e.prototype.resizing=function(e){this.tableObj&&this.tableObj.perfomResizing(e.event)},e.prototype.resizeEnd=function(e){this.parent.onResizeStopEnabled&&this.parent.dotNetRef.invokeMethodAsync("ResizeStopEvent",e)},e.prototype.renderDlgContent=function(e){if(this.tableNotifyArgs=e,this.parent.observer.notify(a,{}),sf.base.Browser.isDevice||this.parent.inlineMode.enable||this.parent.quickToolbarSettings.text&&this.parent.quickToolbarSettings.text.length>0&&e.args&&e.args.originalEvent.target&&e.args.originalEvent.target.classList&&e.args.originalEvent.target.classList.contains("e-rte-text-popup"))this.createDialog();else{this.hideTableQuickToolbar();var t=this.parent.getToolbarElement(),n=this.parent.element.querySelector("#"+this.parent.element.id+"_toolbar_CreateTable"),i=t.getBoundingClientRect().height;"Bottom"===this.parent.toolbarSettings.position&&(i=this.parent.getEditPanel().getBoundingClientRect().height-150,this.parent.element.querySelector(".e-rte-character-count")&&(i+=this.parent.element.querySelector(".e-rte-character-count").getBoundingClientRect().height));var s=n.offsetLeft;"Popup"===this.parent.toolbarSettings.type&&t.firstElementChild!==n.parentElement&&(s=n.getBoundingClientRect().left-this.parent.element.getBoundingClientRect().left,i=n.getBoundingClientRect().bottom-this.parent.element.getBoundingClientRect().top);var r=this.parent.getToolbar().querySelector(".e-hscroll-bar");sf.base.isNullOrUndefined(r)||(s=n.offsetLeft-r.scrollLeft),sf.base.isNullOrUndefined(sf.base.select(".e-rte-table-popup",this.parent.element))?this.parent.dotNetRef.invokeMethodAsync("ShowCreateTableDialog",s,i):this.parent.dotNetRef.invokeMethodAsync("CloseCreateTableDialog")}},e.prototype.isTableQuickToolbarVisible=function(){return this.quickToolObj&&this.quickToolObj.getTableQTBarElement&&document.body.contains(this.quickToolObj.getTableQTBarElement())},e.prototype.createTablePopupOpened=function(){if(this.tableObj){for(var e=sf.base.selectAll(".e-rte-table-popup .e-rte-table-row",this.parent.element),t=0;t<e.length;t++){sf.base.EventHandler.add(e[t],"mouseleave",this.tableObj.tableCellLeave,this.tableObj);for(var n=sf.base.selectAll(".e-rte-tablecell",e[t]),i=0;i<n.length;i++)sf.base.EventHandler.add(n[i],"mouseup",this.tableCellClick,this),sf.base.EventHandler.add(n[i],"mousemove",this.tableObj.tableCellSelect,this.tableObj)}this.parent.element.querySelector(".e-toolbar-container").style.zIndex="11";var s=this.parent.element.querySelector(".e-rte-table-popup");s&&s.focus(),sf.base.isNullOrUndefined(this.parent.getToolbarElement().querySelector(".e-expended-nav"))||this.parent.getToolbarElement().querySelector(".e-expended-nav").setAttribute("tabindex","1"),this.tableObj.dlgDiv=this.parent.element.querySelector(".e-rte-table-popup"),this.tableObj.tblHeader=this.parent.element.querySelector(".e-rte-table-popup .e-rte-popup-header")}},e.prototype.createDialog=function(e,t){e&&t?this.parent.dotNetRef.invokeMethodAsync("ShowEditTableDialog",e,t):this.parent.dotNetRef.invokeMethodAsync("ShowTableDialog"),this.quickToolObj&&this.quickToolObj.getInlineQTBarElement()&&document.body.contains(this.quickToolObj.getInlineQTBarElement())&&(this.quickToolObj.hideInlineQTBar(),sf.base.isNullOrUndefined(this.quickToolObj.textQTBar)||sf.base.isNullOrUndefined(this.quickToolObj.textQTBar.element)||!this.quickToolObj.textQTBar.element.classList.contains("e-popup-open")||this.quickToolObj.hideTextQTBar())},e.prototype.tableCellClick=function(e){var t=e.target,n=Array.prototype.slice.call(t.parentElement.parentElement.children).indexOf(t.parentElement)+1,i=Array.prototype.slice.call(t.parentElement.children).indexOf(t)+1;this.tableInsert(n,i,"Create",this)},e.prototype.tableInsert=function(e,t,n,i){var s=i.self?i.self:this,r=this.tableNotifyArgs.selection.range.startContainer;"P"!==r.nodeName||""!==r.textContent.trim()||r.childNodes.length>0||(r.innerHTML="<br />");var o=r.parentNode;if("HTML"===s.parent.editorMode&&(s.parent.iframeSettings.enable&&!te(o.ownerDocument.querySelector("body"),"e-lib")||!s.parent.iframeSettings.enable&&sf.base.isNullOrUndefined(sf.base.closest(o,"#"+s.parent.getPanel().id)))){s.parent.getEditPanel().focus();var a=s.parent.formatter.editorManager.nodeSelection.getRange(s.parent.getDocument());this.tableNotifyArgs.selection=s.parent.formatter.editorManager.nodeSelection.save(a,s.parent.getDocument())}var c={rows:e,columns:t,width:{minWidth:s.parent.tableSettings.minWidth,maxWidth:s.parent.tableSettings.maxWidth,width:s.parent.tableSettings.width},selection:this.tableNotifyArgs.selection};if("Create"===n){if(this.parent.dotNetRef.invokeMethodAsync("CloseCreateTableDialog"),"Popup"===this.parent.toolbarSettings.type&&!this.parent.inlineMode.enable){var h=this.parent.element.querySelector(".e-hor-nav.e-nav-active");if(h){var p=h.nextElementSibling;p&&p.classList.contains("e-popup-open")&&p.classList.contains("e-toolbar-pop")&&h.click()}}}else this.parent.dotNetRef.invokeMethodAsync("CloseTableDialog");this.parent.observer.notify(l,{}),s.parent.formatter.process(s.parent,this.tableNotifyArgs.args,this.tableNotifyArgs.args.originalEvent,c),s.parent.getEditPanel().focus(),s.parent.observer.on(d,s.tableObj.cellSelect,s.tableObj);var u=s.parent.formatter.editorManager.nodeSelection.get(s.parent.getDocument());sf.base.isNullOrUndefined(u)||sf.base.isNullOrUndefined(u.anchorNode)||u.anchorNode.nodeType!==Node.ELEMENT_NODE||"TD"!==u.anchorNode.tagName&&"TH"!==u.anchorNode.tagName||(s.tableObj.curTable=sf.base.closest(u.anchorNode,"table"),s.tableObj.activeCell=u.anchorNode)},e.prototype.customTable=function(e,t){if(e&&t){var n=sf.base.Browser.isDevice||!sf.base.isNullOrUndefined(this.tableNotifyArgs.args)&&!sf.base.isNullOrUndefined(this.tableNotifyArgs.args.originalEvent)&&"insert-table"===this.tableNotifyArgs.args.originalEvent.action||this.parent.inlineMode.enable?this.tableNotifyArgs:this;this.tableInsert(e,t,"",n)}},e.prototype.applyTableProperties=function(e){var t=sf.base.closest(this.tableNotifyArgs.selectNode[0],"table");if(t.style.width=e.width+"px",""!==e.padding.toString()){var n=t.querySelectorAll("th");this.applyCellPadding(n,e.padding);var i=t.querySelectorAll("td");this.applyCellPadding(i,e.padding)}t.cellSpacing=e.spacing.toString(),t.cellSpacing&&"0"!==t.cellSpacing?sf.base.addClass([t],"e-rte-table-border"):T([t],"e-rte-table-border"),this.parent.formatter.saveData(),this.parent.dotNetRef.invokeMethodAsync("CloseTableDialog")},e.prototype.applyCellPadding=function(e,t){for(var n=0;n<e.length;n++){var i="";if(""===e[n].style.padding){var s=e[n].getAttribute("style");i=(sf.base.isNullOrUndefined(s)?"":s)+" padding:"+t+"px;"}else e[n].style.padding=t+"px",i=e[n].getAttribute("style");e[n].style.cssText=i}},e.prototype.selectionEventTriggers=function(){var e=this.parent.getDocument().getSelection(),t=e&&0!==e.rangeCount&&e.getRangeAt(0);if(t){var n="#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer;if(n.closest("table")){var i=n.closest(".e-multi-cells-select");if(!sf.base.isNullOrUndefined(i)){var s=n.closest("table"),r=this.tableObj.extractSelectedTable(s,!1),o={selectedContent:r?r.outerHTML:null};this.parent.selectionChangedEnabled&&this.parent.dotNetRef.invokeMethodAsync("SelectionChanged",o)}}}},e.prototype.editAreaClickHandler=function(e){if(!this.parent.readonly&&sf.base.isNullOrUndefined(sf.base.closest(e.args.target,".e-img-caption"))){var t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick;if(!(2===t.which||n&&1===t.which||!n&&3===t.which)&&"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule){this.quickToolObj=this.parent.quickToolbarModule;var i=this.parent.element.getBoundingClientRect(),s=t.target,r=this.parent.getToolbarElement(),o=r?r.offsetHeight+this.parent.toolbarModule.getExpandTBarPopHeight():0,a=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),l=sf.base.closest(s,"table"),d=(new Date).getTime(),c=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,h=/Version\/\d+\.\d+.*Safari/.test(navigator.userAgent)&&!/Chrome|Edg|Firefox/.test(navigator.userAgent)&&3===t.which;if(s&&"A"!==s.nodeName&&"IMG"!==s.nodeName&&"VIDEO"!==s.nodeName&&!s.classList.contains("e-clickelem")&&"AUDIO"!==s.nodeName&&("TD"===s.nodeName||"TH"===s.nodeName||"TABLE"===s.nodeName||l&&this.parent.getEditPanel().contains(l))&&(3!==a.startContainer.nodeType||a.collapsed||h)&&this.tableObj&&d-this.tableObj.resizeEndTime>100&&(c||l.querySelectorAll(".e-multi-cells-select").length>0)){var p=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());this.parent.formatter.editorManager.nodeSelection.save(p,this.parent.getDocument()),this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.getDocument());sf.base.Browser.isDevice&&e.args.changedTouches[0]?(e.args.changedTouches[0].pageX,e.args.changedTouches[0].pageY):(this.parent.iframeSettings.enable?window.scrollX+i.left+t.clientX:t.pageX,this.parent.iframeSettings.enable?window.scrollY+i.top+o+t.clientY:t.pageY),this.quickToolObj.showTableQTBar(s,e.args),this.parent.formatter.editorManager.nodeSelection.restore()}else this.hideTableQuickToolbar();this.selectionEventTriggers()}}},e.prototype.hideTableQuickToolbar=function(){this.quickToolObj&&this.quickToolObj.hideTableQTBar()},e.prototype.onToolbarAction=function(e){switch(e.args.item.subCommand){case"TableHeader":this.tableHeader(e.selection,e.args);break;case"TableRemove":this.removeTable(e.selection,e.args);break;case"TableEditProperties":sf.base.isNullOrUndefined(this.tableNotifyArgs)&&(this.tableNotifyArgs=e),this.editTable(e)}},e.prototype.tableHeader=function(e,t){this.parent.formatter.process(this.parent,t,t.originalEvent,{selection:e,subCommand:t.item.subCommand})},e.prototype.removeTable=function(e,t,n){if(this.tableObj){var i;n&&(i={item:{command:"Table",subCommand:"TableRemove"}});var s={selection:e,subCommand:n?i.item.subCommand:t.item.subCommand};this.parent.formatter.process(this.parent,n?i:t,t.originalEvent,s),this.parent.getEditPanel().focus(),this.tableObj.setDefaultEmptyContent(),this.tableObj.removeResizeElement(),this.hideTableQuickToolbar()}},e.prototype.editTable=function(e){var t=e.selectParent[0];this.tableNotifyArgs.selectNode=e.selectParent;var n=sf.base.closest(t,"table").getClientRects()[0].width,i=sf.base.closest(t,"td").style.padding,s=sf.base.closest(t,"table").getAttribute("cellspacing");this.hideTableQuickToolbar(),this.createDialog({width:n,padding:parseFloat((""!==i?parseInt(i,10):0).toString()),spacing:parseFloat((""===s||sf.base.isNullOrUndefined(s)?0:parseInt(s,10)).toString())},"Edit")},e.prototype.dropdownSelect=function(e){this.parent.observer.notify(a,{});var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Table"===t.command){var n=/Version\/\d+\.\d+.*Safari/.test(navigator.userAgent)?this.parent.formatter.editorManager.nodeSelection.range:this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),i={args:e,selection:this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.getDocument()),selectParent:this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n)};switch(t.subCommand){case"InsertRowBefore":case"InsertRowAfter":this.addRow(i.selection,e);break;case"InsertColumnLeft":case"InsertColumnRight":this.addColumn(i.selection,e);break;case"DeleteColumn":case"DeleteRow":this.removeRowColumn(i.selection,e);break;case"AlignTop":case"AlignMiddle":case"AlignBottom":this.verticalAlign(i,e);break;case"Dashed":case"Alternate":case"Custom":this.parent.formatter.process(this.parent,e,i,{command:t.command,subCommand:e.item.subCommand});break;case"Merge":case"VerticalSplit":case"HorizontalSplit":this.UpdateCells(i.selection,e)}}},e.prototype.UpdateCells=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,subCommand:t.item.subCommand}),this.hideTableQuickToolbar()},e.prototype.addRow=function(e,t,n){var i;n&&(i={item:{command:"Table",subCommand:"InsertRowAfter"}});var s={selection:e,subCommand:n?i.item.subCommand:t.item.subCommand};this.parent.formatter.process(this.parent,n?i:t,t,s)},e.prototype.addColumn=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,width:this.parent.tableSettings.width,subCommand:t.item.subCommand})},e.prototype.removeRowColumn=function(e,t){this.parent.observer.notify(l,{}),this.parent.formatter.process(this.parent,t,t,{selection:e,subCommand:t.item.subCommand}),this.hideTableQuickToolbar(),this.parent.observer.notify(a,{})},e.prototype.verticalAlign=function(e,t){var n=sf.base.closest(e.selectParent[0],"td")||sf.base.closest(e.selectParent[0],"th");n&&this.parent.formatter.process(this.parent,t,t,{tableCell:n,subCommand:t.item.subCommand})},e.prototype.tableStyles=function(e,t){var n=sf.base.closest(e.selectParent[0],"table");if("Dashed"===t&&(this.parent.element.classList.contains("e-dashed-border")?this.parent.element.classList.remove("e-dashed-border"):this.parent.element.classList.add("e-dashed-border"),n.classList.contains("e-dashed-border")?n.classList.remove("e-dashed-border"):n.classList.add("e-dashed-border")),"Alternate"===t&&(this.parent.element.classList.contains("e-alternate-border")?this.parent.element.classList.remove("e-alternate-border"):this.parent.element.classList.add("e-alternate-border"),n.classList.contains("e-alternate-border")?n.classList.remove("e-alternate-border"):n.classList.add("e-alternate-border")),e.args&&e.args.item.cssClass)for(var i=e.args.item.cssClass.split(" "),s=0;s<i.length;s++)n.classList.contains(i[s])?n.classList.remove(i[s]):n.classList.add(i[s]);this.parent.formatter.saveData(),this.parent.formatter.editorManager.nodeSelection.restore(),this.hideTableQuickToolbar()},e.prototype.setBGColor=function(e){var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.getDocument()).range.startContainer;if((n=3===n.nodeType?sf.base.closest(n.parentNode,"td,th"):sf.base.closest(n,"td, th"))&&("TD"===n.nodeName||"TH"===n.nodeName)){for(var i=sf.base.closest(n,"table").querySelectorAll(".e-cell-select"),s=0;s<i.length;s++)i[s].style.backgroundColor=e.item.value;this.parent.formatter.saveData()}this.hideTableQuickToolbar()},e.prototype.closeOpenedDialog=function(){var e=this.parent.element.querySelector(".e-rte-table-popup"),t=this.parent.element.querySelector(".e-rte-edit-table"),n=document.querySelector(".e-rte-edit-table.e-rte-elements.e-popup-open"),i=this.parent.element.querySelector(".e-toolbar-container");i&&(i.style.zIndex="10"),e&&this.parent.dotNetRef.invokeMethodAsync("CloseCreateTableDialog"),t&&this.parent.dotNetRef.invokeMethodAsync("CloseTableDialog"),n&&this.parent.dotNetRef.invokeMethodAsync("CloseTableDialog")},e.prototype.showDialog=function(e,t){if(e&&this.parent.getEditPanel().focus(),"HTML"===this.parent.editorMode){var n=this.parent.getDocument(),i=this.parent.formatter.editorManager.nodeSelection.getRange(n),s=this.parent.formatter.editorManager.nodeSelection.save(i,n);this.parent.observer.notify(a,{});var r={originalEvent:e?void 0:t.args,item:{command:"Table",subCommand:"CreateTable"}};this.tableNotifyArgs={args:r,selection:s},this.createDialog()}},e.prototype.keyDown=function(e){if(this.tableObj){var t=e.args;this.handleSpecialActions(t,e),this.tableObj.isTableInteractionPossible(t)&&this.tableObj.handleTableKeyboardInteractions(t),"HTML"===this.parent.editorMode&&this.tableObj.handleShiftKeyTableSelection(t),this.tableObj.handleGlobalKeyboardShortcuts(t),this.tableObj.handleTableDeletion(t),this.tableObj.handleDeselectionOnTyping(t)}},e.prototype.handleSpecialActions=function(e,t){switch(e.action){case"escape":break;case"insert-table":"HTML"===this.parent.editorMode?this.showDialog(!1,t):"Markdown"===this.parent.editorMode&&this.parent.formatter.process(this.parent,null,e),e.preventDefault()}},e.prototype.docClick=function(e){if(this.tableObj){var t=e.args.target,n=this.parent.element.querySelector(".e-rte-table-popup"),i=this.parent.element.querySelector(".e-rte-edit-table");t&&t.classList&&(n&&!sf.base.closest(t,"#"+n.id)||i&&!sf.base.closest(t,"#"+i.id))&&!t.classList.contains("e-create-table")&&t.offsetParent&&!t.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")&&(this.closeOpenedDialog(),this.parent.isBlur=!0,sf.base.Browser.isIE&&ee(this.parent.element,"focusout"));var s=sf.base.closest(t,"td")||sf.base.closest(t,"th"),r=!(!s||!this.parent.getEditPanel().contains(s));if(t&&"TD"!==t.tagName&&"TH"!==t.tagName&&!r&&null===sf.base.closest(t,".e-rte-quick-popup")&&t.offsetParent&&!t.offsetParent.classList.contains("e-quick-dropdown")&&!t.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")&&!sf.base.closest(t,".e-rte-dropdown-popup")&&!sf.base.closest(t,".e-rte-elements")){var o=!(!t.closest(".e-toolbar")&&!t.closest(".e-toolbar-container")),a=!!sf.base.closest(t,"#"+this.parent.element.id+"_pasteCleanupDialog");o||a||(this.tableObj.removeCellSelectClasses(),this.tableObj.removeTableSelection()),sf.base.Browser.isIE||this.hideTableQuickToolbar()}!t||!t.classList||t.classList.contains("e-column-resize")||t.classList.contains("e-row-resize")||t.classList.contains("e-table-box")||this.tableObj.removeResizeElement()}},e.prototype.onIframeMouseDown=function(e){if(this.closeOpenedDialog(),!sf.base.isNullOrUndefined(this.parent)&&!sf.base.isNullOrUndefined(this.parent.getEditPanel())&&this.tableObj){if(e&&e.target){var t=e.target;if(t&&t.classList&&t.classList.contains("e-rte-table-resize"))return}this.tableObj.removeResizeElement()}},e.prototype.keyUp=function(e){var t=this;this.tableObj&&this.tableObj.tableModulekeyUp(e),this.selectionTimeout&&(clearTimeout(this.selectionTimeout),this.selectionTimeout=null),this.selectionTimeout=window.setTimeout((function(){t.selectionEventTriggers()}),600)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.afterKeyDown=function(e){this.tableObj&&this.tableObj.afterKeyDown()},e.prototype.closePopup=function(){if("Popup"===this.parent.toolbarSettings.type&&!this.parent.inlineMode.enable){var e=this.parent.element.querySelector(".e-hor-nav.e-nav-active"),t=e.nextElementSibling;e&&t&&t.classList.contains("e-popup-open")&&t.classList.contains("e-toolbar-pop")&&e.click()}},e}(),bt=function(){function n(e){this.pageX=null,this.pageY=null,this.deletedImg=[],this.parent=e,this.rteId=e.element.id,this.addEventListener()}return n.prototype.addEventListener=function(){this.parent.observer.on(r,this.onKeyUp,this),this.parent.observer.on(p,this.docClick,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(h,this.imagePaste,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on("imageSize",this.imageSize,this),this.parent.observer.on("caption",this.caption,this),this.parent.observer.on("delete",this.deleteImg,this),this.parent.observer.on("imgAltText",this.insertAltText,this),this.parent.observer.on(t,this.afterRender,this),this.parent.observer.on("insertImgLink",this.insertImgLink,this),this.parent.observer.on("insertImage",this.imageDialog,this),this.parent.observer.on("resize",this.onWindowResize,this),this.parent.observer.on("dropDownSelect",this.alignmentSelect,this),this.parent.observer.on("iframe-click",this.onIframeMouseDown,this),this.parent.observer.on("image-toolbar-action",this.onToolbarAction,this),this.parent.observer.on(c,this.editAreaClickHandler,this),this.parent.observer.on("insertCompleted",this.showImageQuickToolbar,this),this.parent.observer.on(s,this.bindOnEnd,this)},n.prototype.removeEventListener=function(){this.parent.observer.off(r,this.onKeyUp),this.parent.observer.off(p,this.docClick),this.parent.observer.off(i,this.destroy),this.parent.observer.off(h,this.imagePaste),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off("imageSize",this.imageSize),this.parent.observer.off("caption",this.caption),this.parent.observer.off("delete",this.deleteImg),this.parent.observer.off("imgAltText",this.insertAltText),this.parent.observer.off(t,this.afterRender),this.parent.observer.off("insertImgLink",this.insertImgLink),this.parent.observer.off("insertImage",this.imageDialog),this.parent.observer.off("resize",this.onWindowResize),this.parent.observer.off("dropDownSelect",this.alignmentSelect),this.parent.observer.off("iframe-click",this.onIframeMouseDown),this.parent.observer.off("image-toolbar-action",this.onToolbarAction),this.parent.observer.off(c,this.editAreaClickHandler),this.parent.observer.off("insertCompleted",this.showImageQuickToolbar),this.parent.observer.off(s,this.bindOnEnd);var e=this.parent.iframeSettings.enable?this.parent.inputElement.ownerDocument:this.parent.inputElement;e.removeEventListener("drop",this.dragDrop.bind(this),!0),e.removeEventListener("dragstart",this.dragStart.bind(this),!0),e.removeEventListener("dragenter",this.dragEnter.bind(this),!0),e.removeEventListener("dragover",this.dragOver.bind(this),!0),sf.base.isNullOrUndefined(this.parent.getEditPanel())||(sf.base.EventHandler.remove(this.parent.getEditPanel(),sf.base.Browser.touchEndEvent,this.imageClick),this.parent.formatter.editorManager.observer.off(u,this.undoStack),this.parent.insertImageSettings.resize&&(sf.base.EventHandler.remove(this.parent.getEditPanel(),sf.base.Browser.touchStartEvent,this.resizeStart),sf.base.EventHandler.remove(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick),sf.base.EventHandler.remove(this.parent.getEditPanel(),"cut",this.onCutHandler)))},n.prototype.bindOnEnd=function(){this.parent.formatter.editorManager.imgObj||(this.parent.formatter.editorManager.imgObj=new st(this.parent.formatter.editorManager))},n.prototype.docClick=function(e){var t=e.args.target,n=sf.base.closest(t,"img"),i=!(!n||!this.parent.getEditPanel().contains(n));!t||"IMG"===t.tagName||i||null!==sf.base.closest(t,".e-rte-quick-popup")||!t.offsetParent||t.offsetParent.classList.contains("e-quick-dropdown")||t.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")||sf.base.closest(t,".e-rte-dropdown-popup")||sf.base.closest(t,".e-rte-elements")||this.hideImageQuickToolbar()},n.prototype.afterRender=function(){sf.base.EventHandler.add(this.parent.getEditPanel(),sf.base.Browser.touchEndEvent,this.imageClick,this),this.parent.insertImageSettings.resize&&(sf.base.EventHandler.add(this.parent.getEditPanel(),sf.base.Browser.touchStartEvent,this.resizeStart,this),sf.base.EventHandler.add(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick,this),sf.base.EventHandler.add(this.parent.getEditPanel(),"cut",this.onCutHandler,this));var e=this.parent.iframeSettings.enable?this.parent.inputElement.ownerDocument:this.parent.inputElement;e.addEventListener("drop",this.dragDrop.bind(this),!0),e.addEventListener("dragstart",this.dragStart.bind(this),!0),e.addEventListener("dragenter",this.dragEnter.bind(this),!0),e.addEventListener("dragover",this.dragOver.bind(this),!0)},n.prototype.imageDialog=function(e){if(this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null),this.uploadUrl={url:""},this.selectionObj={selfImage:this,selection:e.selection,args:e.args,selectParent:e.selectParent},!sf.base.isNullOrUndefined(this.parent.insertImageSettings.path)&&"Markdown"===this.parent.editorMode||"HTML"===this.parent.editorMode){var t=this.parent.iframeSettings.enable;if("HTML"===this.parent.editorMode&&(!t&&sf.base.isNullOrUndefined(sf.base.closest(e.selection.range.startContainer.parentNode,"#"+this.parent.getPanel().id))||t&&sf.base.isNullOrUndefined(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body")))){this.parent.getEditPanel().focus();var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());this.imgUploadSave=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.getDocument()),this.imgUploadSelectedParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n)}else this.imgUploadSave=e.selection,this.imgUploadSelectedParent=e.selectParent}var i;if(e.selectNode&&"IMG"===e.selectNode[0].nodeName){var s=new RegExp("([^\\S]|^)(((https?:\\/\\/)|(www\\.))(\\S+))","gi");i={mode:"Edit",url:e.selectNode[0].src.match(s)?e.selectNode[0].src:""}}else i={mode:"Insert"};this.parent.dotNetRef.invokeMethodAsync("ShowImageDialog",i),this.quickToolObj&&(this.quickToolObj.hideImageQTBar(),sf.base.isNullOrUndefined(e.selectParent)||sf.base.removeClass([e.selectParent[0]],"e-img-focus"),this.quickToolObj.hideInlineQTBar(),sf.base.isNullOrUndefined(this.quickToolObj.textQTBar)||sf.base.isNullOrUndefined(this.quickToolObj.textQTBar.element)||!this.quickToolObj.textQTBar.element.classList.contains("e-popup-open")||this.quickToolObj.hideTextQTBar())},n.prototype.checkImageBack=function(e){"#text"!==e.startContainer.nodeName||0!==e.startOffset||sf.base.isNullOrUndefined(e.startContainer.previousSibling)||"IMG"!==e.startContainer.previousSibling.nodeName?"#text"===e.startContainer.nodeName||sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])||"IMG"!==e.startContainer.childNodes[e.startOffset-1].nodeName||this.deletedImg.push(e.startContainer.childNodes[e.startOffset-1]):this.deletedImg.push(e.startContainer.previousSibling)},n.prototype.checkImageDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||sf.base.isNullOrUndefined(e.startContainer.nextSibling)||"IMG"!==e.startContainer.nextSibling.nodeName?"#text"===e.startContainer.nodeName||sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])||"IMG"!==e.startContainer.childNodes[e.startOffset].nodeName||this.deletedImg.push(e.startContainer.childNodes[e.startOffset]):this.deletedImg.push(e.startContainer.nextSibling)},n.prototype.getDropRange=function(e,t){var n=this.parent.getDocument().createRange();this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.getDocument(),n);var i=this.parent.getDocument().elementFromPoint(e,t),s=i.childNodes.length>0?i.childNodes[0]:i,r=0;if("<br>"===this.parent.inputElement.firstChild.innerHTML)n.setStart(s,r),n.setEnd(s,r);else{var o=void 0;do{r++,n.setStart(s,r),n.setEnd(s,r+1),o=n.getBoundingClientRect()}while(o.left<e&&r<s.length-1)}return n},n.prototype.selectRange=function(e){var t;this.parent.getDocument().caretRangeFromPoint?t=this.parent.getDocument().caretRangeFromPoint(e.clientX,e.clientY):e.rangeParent?(t=this.parent.getDocument().createRange()).setStart(e.rangeParent,e.rangeOffset):t=this.getDropRange(e.clientX,e.clientY),this.parent.observer.notify("selectRange",{range:t})},n.prototype.imageDropInitialized=function(e){var t=this.imageDragArgs;if(this.parent.element.querySelector(".e-img-resize")&&sf.base.detach(this.imgResizeDiv),this.selectRange(this.imageDragArgs),!(this.dropFiles.length>1)){this.parent.observer.notify("drop",{args:t});for(var n=this.dropFiles,i=n[0].name,s=i.substring(i.lastIndexOf(".")),r=this.parent.insertImageSettings.allowedTypes,o=0;o<r.length;o++)if(s.toLocaleLowerCase()===r[o].toLowerCase())if(this.parent.insertImageSettings.saveUrl||e)this.onSelect(this.dropFiles);else{var a={text:"",file:n[0]};this.imagePaste(a)}}},n.prototype.insertDragImage=function(e,t){var n=this;e.preventDefault();var i=this.parent.element.querySelector("e-popup-open");this.parent.observer.notify("drop",{args:e}),i&&i.classList.add("e-hide");var s=this.parent.inputElement.ownerDocument.querySelector(".e-rte-drag-image");if(t.length<=0||!sf.base.isNullOrUndefined(s)){var r=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),o=this.parent.inputElement.ownerDocument.querySelector(".e-rte-drag-image");if(o&&"IMG"===o.tagName){var a=o.closest(".e-rte-img-caption");if(sf.base.isNullOrUndefined(a)){var l=o.closest("a");l&&"A"===l.tagName&&this.hasOnlyImage(l)?r.insertNode(l):o.parentNode&&(o.parentNode.removeChild(o),r.insertNode(o))}else r.insertNode(a);o.classList.remove("e-rte-drag-image"),o.addEventListener("load",(function(){n.parent.actionCompleteEnabled&&n.parent.dotNetRef.invokeMethodAsync("ActionCompleteEvent",null)})),this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.getDocument());var d=e;this.parent.insertImageSettings.resize&&this.resizeStart(d,o),this.hideImageQuickToolbar()}}},n.prototype.hasOnlyImage=function(e){for(var t=!1,n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===Node.TEXT_NODE){if(""!==i.textContent.replace(/[\u200B\u200C\u200D]/g,"").trim())return!1}else if(i.nodeType===Node.ELEMENT_NODE){if("IMG"!==i.tagName)return!1;if(t)return!1;t=!0}}return t},n.prototype.onSelect=function(e){var t=this,n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),i={name:"",size:0,status:"",statusCode:"",type:"",rawFile:e[0],validationMessages:{}};this.droppedImage=sf.base.createElement("IMG"),this.droppedImage.style.opacity="0.5",this.droppedImage.classList.add("e-rte-image"),this.droppedImage.classList.add("e-imginline"),this.droppedImage.classList.add("e-resize");var s=i.rawFile,r=new FileReader;r.addEventListener("load",(function(){var e=URL.createObjectURL(q(r.result));t.droppedImage.src="Blob"===t.parent.insertImageSettings.saveFormat?e:r.result})),s&&r.readAsDataURL(s),n.insertNode(this.droppedImage),n.selectNodeContents(this.droppedImage),this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.getDocument(),n),this.droppedImage.addEventListener("load",(function(){t.parent.actionCompleteEnabled&&t.parent.dotNetRef.invokeMethodAsync("ActionCompleteEvent",null)}))},n.prototype.removeDroppedImage=function(){sf.base.detach(this.droppedImage)},n.prototype.dropUploadSuccess=function(e,t){this.droppedImage.style.opacity="1",this.droppedImage.classList.add("e-img-focus"),this.droppedImage.src=e,this.droppedImage.alt=t,this.showImageQuickToolbar({args:this.imageDragArgs,type:"Images",isNotify:void 0,elements:this.droppedImage}),this.resizeStart(this.imageDragArgs,this.droppedImage)},n.prototype.dropUploadChange=function(e,t){t&&(this.droppedImage.src=e,this.droppedImage.style.opacity="1")},n.prototype.imagePaste=function(e){var t=this;if(0===e.text.length&&!sf.base.isNullOrUndefined(e.file)){var n=new FileReader;e.args&&e.args.preventDefault(),n.addEventListener("load",(function(i){var s={cssClass:"inline"===t.parent.insertImageSettings.display.toLowerCase()?"e-imginline":"e-imgbreak",url:"Base64"!==t.parent.insertImageSettings.saveFormat&&sf.base.isNullOrUndefined(e.callBack)?URL.createObjectURL(q(n.result)):n.result,width:{width:t.parent.insertImageSettings.width,minWidth:t.parent.insertImageSettings.minWidth,maxWidth:t.getMaxWidth()},height:{height:t.parent.insertImageSettings.height,minHeight:t.parent.insertImageSettings.minHeight,maxHeight:t.parent.insertImageSettings.maxHeight}};sf.base.isNullOrUndefined(e.callBack)?(t.parent.formatter.process(t.parent,{item:{command:"Images",subCommand:"Image"}},e.args,s),t.showPopupToolBar(e,s)):e.callBack(s)})),n.readAsDataURL(e.file)}},n.prototype.showPopupToolBar=function(e,t){var n=this,i='img[src="'+t.url+'"]',s=this.parent.inputElement.querySelector(i),r={args:e.args,type:"Images",isNotify:void 0,elements:s};s&&setTimeout((function(){n.showImageQuickToolbar(r),n.parent.insertImageSettings.resize&&n.resizeStart(e.args,s)}),0)},n.prototype.undoStack=function(e){if("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=sf.base.createElement("div"),i=ne(this.parent.formatter.getUndoRedoStack()[t].text);n.appendChild(i);var s=n.querySelectorAll("img");if(n.querySelector(".e-img-resize")&&s.length>0){for(var r=0;r<s.length;r++)s[r].style.outline="";sf.base.detach(n.querySelector(".e-img-resize")),this.parent.formatter.getUndoRedoStack()[t].text=n.innerHTML}}},n.prototype.imageResize=function(e){this.resizeBtnInit(),this.imgEle=e,sf.base.addClass([this.imgEle],"e-resize"),this.imgResizeDiv=sf.base.createElement("span",{className:"e-img-resize",id:this.rteId+"_imgResize"}),this.imgResizeDiv.appendChild(sf.base.createElement("span",{className:"e-rte-imageboxmark e-rte-topLeft",styles:"cursor: nwse-resize"})),this.imgResizeDiv.appendChild(sf.base.createElement("span",{className:"e-rte-imageboxmark e-rte-topRight",styles:"cursor: nesw-resize"})),this.imgResizeDiv.appendChild(sf.base.createElement("span",{className:"e-rte-imageboxmark e-rte-botLeft",styles:"cursor: nesw-resize"})),this.imgResizeDiv.appendChild(sf.base.createElement("span",{className:"e-rte-imageboxmark e-rte-botRight",styles:"cursor: nwse-resize"})),sf.base.Browser.isDevice&&sf.base.addClass([this.imgResizeDiv],"e-mob-rte"),e.style.outline="2px solid #4a90e2",this.imgResizePos(e,this.imgResizeDiv),this.resizeImgDupPos(e),this.parent.getEditPanel().appendChild(this.imgResizeDiv),"auto"===this.parent.element.style.height&&this.imgResizePos(e,this.imgResizeDiv)},n.prototype.resizeBtnInit=function(){return this.aspectRatio=null,this.currentResizeHandler=null,this.resizeBtnStat={botLeft:!1,botRight:!1,topRight:!1,topLeft:!1}},n.prototype.imgResizePos=function(e,t){var n=this.calcPos(e),i=n.top,s=n.left,r=e.getBoundingClientRect().width,o=e.getBoundingClientRect().height,a=sf.base.Browser.isDevice?4*parseInt(e.style.outline.slice(-3),10)+2:2*parseInt(e.style.outline.slice(-3),10)+2,l=sf.base.Browser.isDevice?0:2;t.querySelector(".e-rte-botLeft").style.left=s-a+"px",t.querySelector(".e-rte-botLeft").style.top=o-a+i+"px",t.querySelector(".e-rte-botRight").style.left=r-(a-l)+s+"px",t.querySelector(".e-rte-botRight").style.top=o-a+i+"px",t.querySelector(".e-rte-topRight").style.left=r-(a-l)+s+"px",t.querySelector(".e-rte-topRight").style.top=i-a+"px",t.querySelector(".e-rte-topLeft").style.left=s-a+"px",t.querySelector(".e-rte-topLeft").style.top=i-a+"px"},n.prototype.resizeImgDupPos=function(e){this.imgDupPos={width:""!==e.style.height?this.imgEle.style.width:e.width+"px",height:""!==e.style.height?this.imgEle.style.height:e.height+"px"}},n.prototype.calcPos=function(e){for(var t,n={top:0,left:0},i=e.ownerDocument,s=(e.offsetParent&&(e.offsetParent.classList.contains("e-img-caption")||["TD","TH","TABLE","A"].indexOf(e.offsetParent.tagName)>-1)?sf.base.closest(e,"#"+this.rteId+"_rte-edit-view"):e.offsetParent)||i.documentElement;s&&(s===i.body||s===i.documentElement)&&"static"===s.style.position;)s=s.parentNode;return s&&s!==e&&1===s.nodeType&&(n=s.getBoundingClientRect()),e.offsetParent&&e.offsetParent.classList.contains("e-img-caption")?{top:(t=e.getBoundingClientRect()).top-n.top,left:t.left-n.left}:{top:e.offsetTop,left:e.offsetLeft}},n.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].pageX:e.pageX},n.prototype.getPointY=function(e){return e.touches&&e.touches.length?e.touches[0].pageY:e.pageY},n.prototype.imgDupMouseMove=function(e,t,n){parseInt(this.parent.insertImageSettings.minWidth,10)>=parseInt(e,10)||parseInt(this.getMaxWidth(),10)<=parseInt(e,10)&&sf.base.isNullOrUndefined(this.imgEle.style.width)||!this.parent.insertImageSettings.resizeByPercent&&(parseInt(this.parent.insertImageSettings.minHeight,10)>=parseInt(t,10)||parseInt(this.parent.insertImageSettings.maxHeight,10)<=parseInt(t,10))||(this.imgEle.parentElement.style.cursor="pointer",this.setAspectRatio(this.imgEle,parseInt(e,10),parseInt(t,10)),this.resizeImgDupPos(this.imgEle),this.imgResizePos(this.imgEle,this.imgResizeDiv))},n.prototype.setAspectRatio=function(e,t,n){if(!sf.base.isNullOrUndefined(e.width)){var i=e.width===e.height,s=this.parent.insertImageSettings.resizeByPercent?"%":"px",r=""===e.style.width&&""===e.style.height;i||r?(this.setImageWidth(e,t,s),this.parent.insertImageSettings.resizeByPercent?this.removeImageHeight(e):this.setImageHeight(e,n,s)):""!==e.style.width&&""!==e.style.height?this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,s),this.removeImageHeight(e)):(this.setImageWidth(e,t,s),this.setImageHeight(e,n,s)):""!==e.style.width?this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,s),this.removeImageHeight(e)):this.setImageWidth(e,t,s):""!==e.style.height&&(this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,s),this.removeImageHeight(e)):this.setImageHeight(e,n,s))}},n.prototype.getMaxWidth=function(){var e=this.parent.insertImageSettings.maxWidth,t=this.parent.getEditPanel(),n=window.getComputedStyle(t),i=t.offsetWidth-(14+parseFloat(n.paddingLeft.split("px")[0])+parseFloat(n.paddingRight.split("px")[0])+parseFloat(n.marginLeft.split("px")[0])+parseFloat(n.marginRight.split("px")[0]));return sf.base.isNullOrUndefined(e)?i:e},n.prototype.cancelResizeAction=function(){sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing),sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd),this.imgEle&&this.imgResizeDiv&&this.parent.getEditPanel().contains(this.imgResizeDiv)&&(sf.base.detach(this.imgResizeDiv),this.imgEle.style.outline="",this.imgResizeDiv=null,this.pageX=null,this.pageY=null,this.currentResizeHandler=null,this.aspectRatio=null)},n.prototype.removeResizeEle=function(){sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing),sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd),sf.base.detach(this.parent.getEditPanel().querySelector(".e-img-resize"))},n.prototype.onWindowResize=function(){sf.base.isNullOrUndefined(this.parent)||sf.base.isNullOrUndefined(this.parent.getEditPanel().querySelector(".e-img-resize"))||this.cancelResizeAction()},n.prototype.editAreaClickHandler=function(e){if(this.parent.readonly)this.hideImageQuickToolbar();else{var t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick;if(2===t.which||n&&1===t.which||!n&&3===t.which)n&&1===t.which&&!sf.base.isNullOrUndefined(t.target)&&"IMG"===t.target.tagName&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.parent.getDocument(),t.target));else if("HTML"===this.parent.editorMode&&this.parent.quickToolbarModule){this.quickToolObj=this.parent.quickToolbarModule;var i=t.target;"IMG"===i.nodeName&&this.parent.quickToolbarModule?(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.parent.getDocument(),i),C()&&this.parent.observer.notify(a,e),sf.base.addClass([i],"e-img-focus"),this.showImageQuickToolbar({args:t,type:"Images",elements:[t.target]})):this.hideImageQuickToolbar()}}},n.prototype.showImageQuickToolbar=function(e){var t=this;if("Images"===e.type&&!sf.base.isNullOrUndefined(this.parent.quickToolbarModule)){this.quickToolObj=this.parent.quickToolbarModule;var n=e.elements;[].forEach.call(e.elements,(function(e,t){0===t&&(n=e)}));var i=document.body.querySelector("#"+this.parent.id+"_image_toolbar");sf.base.isNullOrUndefined(i.querySelector(".e-insert-link"))||(n.closest("a")?i.classList.add("e-link-enabled"):i.classList.contains("e-link-enabled")&&i.classList.remove("e-link-enabled")),"IMG"===n.nodeName&&sf.base.addClass([n],["e-img-focus"]),this.quickToolObj&&(e.isNotify?setTimeout((function(){t.parent.formatter.editorManager.nodeSelection.Clear(t.parent.getDocument()),t.parent.formatter.editorManager.nodeSelection.setSelectionContents(t.parent.getDocument(),n),t.quickToolObj.showImageQTBar(n,e.args),t.parent.insertImageSettings.resize&&t.resizeStart(e.args,n)}),400):this.quickToolObj.showImageQTBar(n,e.args))}},n.prototype.hideImageQuickToolbar=function(){sf.base.isNullOrUndefined(this.parent.getEditPanel().querySelector(".e-img-focus"))||(sf.base.removeClass([this.parent.getEditPanel().querySelector(".e-img-focus")],"e-img-focus"),this.quickToolObj&&this.quickToolObj.hideImageQTBar())},n.prototype.onToolbarAction=function(e){switch(this.quickToolObj&&(this.quickToolObj.hideImageQTBar(),sf.base.removeClass([e.selectNode[0]],"e-img-focus")),this.selectionObj=e,C()&&this.parent.observer.notify(l,{}),e.args.item.subCommand){case"Replace":this.parent.observer.notify("insertImage",e);break;case"Caption":this.parent.observer.notify("caption",e);break;case"InsertLink":this.parent.observer.notify("insertImgLink",e);break;case"AltText":this.parent.observer.notify("imgAltText",e);break;case"Remove":this.parent.observer.notify("delete",e);break;case"Dimension":this.parent.observer.notify("imageSize",e);break;case"OpenImageLink":this.openImgLink(e);break;case"EditImageLink":this.editImgLink(e);break;case"RemoveImageLink":this.removeImgLink(e)}},n.prototype.openImgLink=function(e){var t=this.parent.htmlEditorModule.sanitizeHelper(e.selectParent[0].parentNode.outerHTML),n=document.createElement("div");n.innerHTML=t;var i=""===e.selectParent[0].parentNode.target?"_self":"_blank";this.parent.formatter.process(this.parent,e.args,e.args,{url:n.firstChild.href,target:i,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),n.remove()},n.prototype.editImgLink=function(e){var t=e.selectParent[0].parentNode,n={url:t.href,target:t.target};this.insertImgLink(e,n)},n.prototype.removeImgLink=function(e){sf.base.Browser.isIE&&this.parent.getEditPanel().focus(),e.selection.restore();var t=!(!this.parent.getEditPanel().contains(this.captionEle)||!sf.base.select("a",this.captionEle)),n=t?[this.captionEle]:[e.selectNode[0].parentElement];this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:e.selectNode[0],selectParent:n,selection:e.selection,subCommand:e.args.item.subCommand}),this.quickToolObj&&(this.quickToolObj.hideImageQTBar(),sf.base.isNullOrUndefined(e.selectParent)||sf.base.removeClass([e.selectParent[0]],"e-img-focus")),t&&sf.base.select(".e-img-inner",this.captionEle).focus()},n.prototype.caption=function(t){var n=t.selectNode[0];if("IMG"===n.nodeName){t.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.cancelResizeAction(),sf.base.addClass([n],"e-rte-image");var i=t.args.item?t.args.item.subCommand:"Caption";if(sf.base.isNullOrUndefined(sf.base.closest(n,"."+e))){this.captionEle=sf.base.createElement("span",{className:e+" e-rte-img-caption",attrs:{contenteditable:"false",draggable:"false"}});var s=sf.base.createElement("span",{className:"e-img-wrap"}),r=sf.base.createElement("span",{className:"e-img-inner",attrs:{contenteditable:"true"}}),o=t.selectNode[0].parentElement;"A"===o.tagName&&o.setAttribute("contenteditable","true"),s.appendChild("A"===o.tagName?o:t.selectNode[0]),s.appendChild(r);var a=this.parent.localeData.imageCaption;r.innerHTML=a,this.captionEle.appendChild(s),n.classList.contains("e-imginline")&&sf.base.addClass([this.captionEle],"e-caption-inline"),n.classList.contains("e-imgbreak")&&sf.base.addClass([this.captionEle],"e-imgbreak"),n.classList.contains("e-imgleft")&&sf.base.addClass([this.captionEle],"e-imgleft"),n.classList.contains("e-imgright")&&sf.base.addClass([this.captionEle],"e-imgright"),n.classList.contains("e-imgcenter")&&sf.base.addClass([this.captionEle],"e-imgcenter"),this.parent.formatter.process(this.parent,t.args,t.args,{insertElement:this.captionEle,selectNode:t.selectNode,subCommand:i}),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.getDocument(),r.childNodes[0],r.childNodes[0],0,r.childNodes[0].textContent.length)}else sf.base.detach(sf.base.closest(n,"."+e)),sf.base.Browser.isIE&&(this.parent.getEditPanel().focus(),t.selection.restore()),"A"===n.parentElement.tagName?this.parent.formatter.process(this.parent,t.args,t.args,{insertElement:n.parentElement,selectNode:t.selectNode,subCommand:i}):this.parent.formatter.process(this.parent,t.args,t.args,{insertElement:n,selectNode:t.selectNode,subCommand:i});this.quickToolObj&&(this.quickToolObj.hideImageQTBar(),sf.base.removeClass([n],"e-img-focus"))}},n.prototype.insertImgLink=function(e,t){var n;"IMG"===e.selectNode[0].nodeName&&(n=sf.base.isNullOrUndefined(t)?{mode:"InsertLink",newWindow:!0,url:""}:{mode:"EditLink",newWindow:!!t.target,url:t.url},this.parent.dotNetRef.invokeMethodAsync("ShowImageDialog",n))},n.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},n.prototype.insertLink=function(e,t,n){if("IMG"===this.selectionObj.selectNode[0].nodeName){var i=document.querySelector(".e-rte-img-dialog .e-img-link");if(""===e)return sf.base.addClass([i],"e-error"),i.setSelectionRange(0,e.length),void i.focus();if(this.isUrl(e)?sf.base.removeClass([i],"e-error"):this.parent.enableAutoUrl||(e=e.indexOf("http")>-1?e:"http://"+e),"HTML"===this.parent.editorMode&&this.selectionObj.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),"A"===this.selectionObj.selectNode[0].parentElement.nodeName)return this.parent.formatter.process(this.parent,this.selectionObj.args,this.selectionObj.args,{url:e,target:t,ariaLabel:n,selectNode:this.selectionObj.selectNode,subCommand:this.selectionObj.args.item.subCommand}),void this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null);this.parent.formatter.process(this.parent,this.selectionObj.args,this.selectionObj.args,{url:e,target:t,ariaLabel:n,selectNode:this.selectionObj.selectNode,subCommand:this.selectionObj.args.item.subCommand,selection:this.selectionObj.selection});var s=sf.base.closest(this.selectionObj.selectNode[0],".e-img-caption");s&&sf.base.select(".e-img-inner",s).focus(),this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null)}},n.prototype.insertAltText=function(e){if("IMG"===e.selectNode[0].nodeName){var t=e.selectNode[0].getAttribute("alt"),n={mode:"AltText",altText:null===t?"":t};this.parent.dotNetRef.invokeMethodAsync("ShowImageDialog",n)}},n.prototype.insertAlt=function(e){this.selectionObj.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.parent.formatter.process(this.parent,this.selectionObj.args,this.selectionObj.args,{altText:e,selectNode:this.selectionObj.selectNode,subCommand:this.selectionObj.args.item.subCommand}),this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null)},n.prototype.deleteImg=function(t,n){if("IMG"===t.selectNode[0].nodeName){var i={src:t.selectNode[0].getAttribute("src")};0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData();var s=t.selection.range.startContainer;if("SPAN"===t.selection.range.startContainer.nodeName&&s.classList.contains("e-img-wrap")&&s.parentElement.classList.contains("e-img-caption"))if(s=s.parentElement,sf.base.isNullOrUndefined(s.previousSibling)){if(!sf.base.isNullOrUndefined(s.nextSibling)){for(var r=s.nextSibling;"#text"!==r.nodeName&&"BR"!==r.nodeName;)r=r.firstChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),r,0)}}else{for(var o=s.previousSibling;"#text"!==o.nodeName&&"BR"!==o.nodeName;)o=o.lastChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),o,"BR"!==o.nodeName?o.textContent.length:0)}else t.selection.restore();this.parent.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle(),this.parent.formatter.process(this.parent,t.args,t.args,{selectNode:t.selectNode,captionClass:e,subCommand:t.args.item.subCommand}),this.quickToolObj&&this.quickToolObj.hideImageQTBar(),this.cancelResizeAction(),sf.base.isNullOrUndefined(n)&&this.parent.imageDeleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("AfterImageDeleteEvent",i)}},n.prototype.imageSize=function(e){if("IMG"===e.selectNode[0].nodeName){var t=e.selectNode[0],n="auto"===t.style.width.toString()||t.style.width.toString()?t.style.width.toString():parseInt(t.getClientRects()[0].width.toString(),10).toString(),i="auto"===t.style.height.toString()||t.style.height.toString()?t.style.height.toString():parseInt(t.getClientRects()[0].height.toString(),10).toString();""===t.style.width&&""===n&&(n="auto"),""===t.style.height&&""===i&&(i="auto");var s={mode:"Dimension",width:n,height:i,maxWidth:parseFloat(this.getMaxWidth())};this.parent.dotNetRef.invokeMethodAsync("ShowImageDialog",s)}},n.prototype.insertSize=function(e,t){this.selectionObj.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.parent.formatter.process(this.parent,this.selectionObj.args,this.selectionObj.args,{width:e,height:t,selectNode:this.selectionObj.selectNode,subCommand:this.selectionObj.args.item.subCommand}),this.imgResizeDiv&&this.imgResizePos(this.selectionObj.selectNode[0],this.imgResizeDiv),this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null)},n.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Images"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),s={args:e,selectNode:i="IMG"===i[0].nodeName?i:[this.imgEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"JustifyLeft":this.alignImage(s,"JustifyLeft");break;case"JustifyCenter":this.alignImage(s,"JustifyCenter");break;case"JustifyRight":this.alignImage(s,"JustifyRight");break;case"Inline":this.inline(s);break;case"Break":this.break(s)}this.quickToolObj&&(this.quickToolObj.hideImageQTBar(),sf.base.removeClass([i[0]],"e-img-focus")),this.cancelResizeAction()}},n.prototype.alignImage=function(e,t){var n=e.args.item?e.args.item.subCommand:t;this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:n})},n.prototype.inline=function(e){if("IMG"===e.selectNode[0].nodeName){var t=e.args.item?e.args.item.subCommand:"Inline";this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})}},n.prototype.break=function(e){if("IMG"===e.selectNode[0].nodeName){var t=e.args.item?e.args.item.subCommand:"Break";this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})}},n.prototype.imageBrowseClick=function(){document.getElementById(this.rteId+"_image").querySelector(".e-rte-img-dialog .e-file-select-wrap button").click()},n.prototype.dialogOpened=function(){var e=sf.base.Browser.isDevice?document.getElementById(this.rteId+"_image").querySelector(".e-img-content"):sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-img-dialog .e-img-content"))?document.querySelector(".e-rte-elements .e-rte-img-dialog .e-img-content"):this.parent.element.querySelector(".e-rte-img-dialog .e-img-content");if(!sf.base.isNullOrUndefined(e)){var t=document.getElementById(this.rteId+"_dropText"),n=document.getElementById(this.rteId+"_insertImage");this.buttonClickElement=sf.base.Browser.isDevice?t:n,sf.base.EventHandler.add(this.buttonClickElement,"click",this.imageBrowseClick,this),!sf.base.isNullOrUndefined(this.parent.insertImageSettings.path)&&"Markdown"===this.parent.editorMode||"HTML"===this.parent.editorMode?e.querySelector("#"+this.rteId+"_insertImage").focus():e.querySelector(".e-img-url").focus()}},n.prototype.imageSelected=function(){this.inputUrl.setAttribute("disabled","true")},n.prototype.imageUploadSuccess=function(e,t){this.inputUrl=this.parent.element.querySelector(".e-rte-img-dialog .e-img-url"),sf.base.isNullOrUndefined(this.parent.insertImageSettings.path)||(this.uploadUrl={url:e,selection:this.imgUploadSave,altText:t,selectParent:this.imgUploadSelectedParent,width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.getMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}},this.inputUrl.setAttribute("disabled","true"))},n.prototype.imageUploadComplete=function(e,t){if("HTML"===this.parent.editorMode&&sf.base.isNullOrUndefined(this.parent.insertImageSettings.path)){var n="Base64"===this.parent.insertImageSettings.saveFormat?e:URL.createObjectURL(q(e));this.uploadUrl={url:n,selection:this.imgUploadSave,altText:t,selectParent:this.imgUploadSelectedParent,width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.getMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}},this.inputUrl.setAttribute("disabled","true")}},n.prototype.imageUploadChange=function(e,t){this.modifiedUrl=e,this.isStreamUrl=t},n.prototype.removing=function(){this.inputUrl.removeAttribute("disabled"),this.uploadUrl&&(this.uploadUrl.url="")},n.prototype.dialogClosed=function(){"HTML"===this.parent.editorMode?this.selectionObj.selection.restore():this.parent.formatter.editorManager.markdownSelection.restore(this.parent.getEditPanel()),this.buttonClickElement&&sf.base.EventHandler.remove(this.buttonClickElement,"click",this.imageBrowseClick)},n.prototype.insertImageUrl=function(){var e=this,t=this.parent.element.ownerDocument.querySelector("#"+this.rteId+"_image");sf.base.Browser.isDevice?this.inputUrl=this.parent.inputElement.ownerDocument.querySelector("#"+this.rteId+"_image").querySelector(".e-rte-img-dialog .e-img-url"):this.inputUrl=sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-img-dialog .e-img-url"))?t.querySelector(".e-rte-elements.e-rte-img-dialog .e-img-url"):this.parent.element.querySelector(".e-rte-img-dialog .e-img-url");var n=this.inputUrl.value,i=sf.base.isNullOrUndefined(t)?null:t.querySelector(".e-rte-img-dialog .e-insertImage");if(i&&i.classList.contains("e-updateImage")){var s={src:this.inputUrl.value};this.parent.imageDeleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("AfterImageDeleteEvent",s)}if("Markdown"===this.parent.editorMode&&""===n&&(n="http://"),this.isStreamUrl&&""!==this.modifiedUrl&&(this.uploadUrl.url=this.modifiedUrl,this.modifiedUrl=""),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.selectionObj.args.item.subCommand=sf.base.isNullOrUndefined(i)||"Update"!==i.innerHTML?this.selectionObj.args.item.subCommand:"Replace",sf.base.isNullOrUndefined(this.uploadUrl)||""===this.uploadUrl.url){if(""!==n){if("HTML"===this.parent.editorMode&&sf.base.isNullOrUndefined(sf.base.closest(this.selectionObj.selection.range.startContainer.parentNode,"#"+this.parent.getPanel().id))){this.parent.getEditPanel().focus();var r=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());this.selectionObj.selection=this.parent.formatter.editorManager.nodeSelection.save(r,this.parent.getDocument()),this.selectionObj.selectParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(r)}var o=/[\w-]+.(jpg|png|jpeg|gif)/g,a=sf.base.isNullOrUndefined(n.match(o))||"HTML"!==this.parent.editorMode?"":n.match(o)[0],l={cssClass:"inline"===this.parent.insertImageSettings.display.toLowerCase()?"e-imginline":"e-imgbreak",url:n,selection:this.selectionObj.selection,altText:a,selectParent:this.selectionObj.selectParent,width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.getMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}};this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null).then((function(){var t=e.parent.element.ownerDocument.querySelector("#"+e.rteId+"_image");sf.base.isNullOrUndefined(t)&&e.parent.formatter.process(e.parent,e.selectionObj.args,e.selectionObj.args.originalEvent,l)}))}}else this.uploadUrl.cssClass="inline"===this.parent.insertImageSettings.display.toLowerCase()?"e-imginline":"e-imgbreak",this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null).then((function(){var t=e.parent.element.ownerDocument.querySelector("#"+e.rteId+"_image");sf.base.isNullOrUndefined(t)&&(e.parent.formatter.process(e.parent,e.selectionObj.args,e.selectionObj.args.originalEvent,e.uploadUrl),e.parent.getEditPanel().querySelector(".e-img-resize")&&(e.imgEle.style.outline="",e.removeResizeEle()))}))},n.prototype.showDialog=function(e,t,n,i,s){var r,o,a,l;e&&!sf.base.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.save(r,this.parent.getDocument()),a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(r),l=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(r)):(o=n,a=i,l=s),"HTML"===this.parent.editorMode?this.imageDialog({args:{item:{command:"Images",subCommand:"Image"},originalEvent:e?void 0:t,name:e?"showDialog":null},selectNode:a,selection:o,selectParent:l}):this.imageDialog({args:{item:{command:"Images",subCommand:"Image"},originalEvent:e?void 0:t},member:"image",text:this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.getEditPanel()),module:"Markdown",name:"insertImage"})},n.prototype.onCutHandler=function(){this.imgResizeDiv&&this.parent.getEditPanel().contains(this.imgResizeDiv)&&this.cancelResizeAction()},n.prototype.onIframeMouseDown=function(e){this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null),this.onDocumentClick(e)},n.prototype.onDocumentClick=function(e){var t=e.target;"IMG"===t.nodeName&&(this.imgEle=t);var n=document.body.querySelector("#"+this.rteId+"_image.e-rte-img-dialog");!sf.base.isNullOrUndefined(n)&&(!sf.base.closest(t,"#"+this.rteId+"_image")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!sf.base.closest(t,"#"+this.rteId+"_toolbar_Image")&&!t.querySelector("#"+this.rteId+"_toolbar_Image"))&&(e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog","Outside Click"),this.parent.isBlur=!0,sf.base.Browser.isIE&&ee(this.parent.element,"focusout"))),"IMG"!==e.target.tagName&&this.imgResizeDiv&&!this.quickToolObj&&this.parent.getEditPanel().contains(this.imgResizeDiv)&&this.cancelResizeAction(),this.parent.getEditPanel().querySelector(".e-img-resize")&&("IMG"!==t.tagName&&this.removeResizeEle(),"IMG"===t.tagName||sf.base.isNullOrUndefined(this.imgEle)?sf.base.isNullOrUndefined(this.prevSelectedImgEle)||this.prevSelectedImgEle===t||(this.prevSelectedImgEle.style.outline=""):this.imgEle.style.outline=""),!this.parent.inlineMode.enable||sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(n)||sf.base.closest(t,"#"+this.rteId+"_image")||this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog","Outside Click")},n.prototype.imageClick=function(e){sf.base.Browser.isDevice&&("IMG"===e.target.tagName&&"A"===e.target.parentElement.tagName||"IMG"===e.target.tagName?(this.parent.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.parent.getEditPanel().setAttribute("contenteditable","true")),"IMG"===e.target.tagName&&"A"===e.target.parentElement.tagName&&e.preventDefault()},n.prototype.onKeyDown=function(t){var n,i,s,r,o,a=t.args;this.deletedImg=[];if("HTML"===this.parent.editorMode&&(o=(n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument())).startContainer===n.endContainer&&n.startOffset===n.endOffset),!o&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(a.which)<0)for(var l=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),d=0;d<l.length;d++)"IMG"===l[d].nodeName&&this.deletedImg.push(l[d]);if("HTML"===this.parent.editorMode&&(8===a.which&&"Backspace"===a.code||46===a.which&&"Delete"===a.code)){var c=n.startContainer===n.endContainer&&n.startOffset===n.endOffset;8===a.which&&"Backspace"===a.code&&c?this.checkImageBack(n):46===a.which&&"Delete"===a.code&&c&&this.checkImageDel(n)}if(sf.base.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||"KeyK"===a.code||(n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n),a.ctrlKey||!a.key||1!==a.key.length&&"enter"!==a.action&&37!==a.keyCode&&38!==a.keyCode&&39!==a.keyCode&&40!==a.keyCode||"IMG"!==r[0].tagName||!r[0].parentElement||(this.parent.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle(),sf.base.removeClass([r[0]],"e-img-focus"),this.quickToolObj&&this.quickToolObj.hideImageQTBar(),sf.base.isNullOrUndefined(this.imgEle)||(this.imgEle.style.outline=""))),!a.ctrlKey||89!==a.keyCode&&90!==a.keyCode||this.undoStack({subCommand:90===a.keyCode?"undo":"redo"}),(8===a.keyCode||46===a.keyCode)&&"HTML"===this.parent.editorMode){var h=this.getImageCursorPosition(n);if(s&&s[0]&&"IMG"===s[0].nodeName&&(h.start&&46===a.keyCode||8===a.keyCode&&h.end)){a.preventDefault();var p={selectNode:s,selection:i,selectParent:r,args:{item:{command:"Images",subCommand:"Remove"},originalEvent:a}};this.deleteImg(p,a.keyCode)}this.parent.getEditPanel().querySelector(".e-img-resize")?this.removeResizeEle():this.parent.getEditPanel().querySelector(".e-rte-imageboxmark")&&this.parent.getEditPanel().querySelectorAll(".e-rte-imageboxmark").forEach((function(e){return e&&sf.base.detach(e)}))}switch(a.action){case"escape":this.parent.dotNetRef.invokeMethodAsync("CloseImageDialog",null);break;case"backspace":case"delete":if("Markdown"!==this.parent.editorMode)if(3===n.startContainer.nodeType)"Backspace"===a.code?n.startContainer.previousElementSibling&&0===n.startOffset&&n.startContainer.previousElementSibling.classList.contains(e)&&n.startContainer.previousElementSibling.classList.contains("e-caption-inline")&&sf.base.detach(n.startContainer.previousElementSibling):n.startContainer.nextElementSibling&&n.endContainer.textContent.length===n.endOffset&&n.startContainer.nextElementSibling.classList.contains(e)&&n.startContainer.nextElementSibling.classList.contains("e-caption-inline")&&sf.base.detach(n.startContainer.nextElementSibling);else if(1===n.startContainer.nodeType)if(n.startContainer.querySelector("."+e+".e-caption-inline"))sf.base.detach(n.startContainer.querySelector("."+e+".e-caption-inline"));else if(n.startContainer.querySelector("."+e+".e-imgbreak"))sf.base.detach(n.startContainer.querySelector("."+e+".e-imgbreak"));else if(n.startContainer.classList.contains("e-img-wrap")&&sf.base.closest(n.startContainer,"."+e)){var u=n.startContainer.parentElement.parentElement;if(sf.base.detach(sf.base.closest(n.startContainer,"."+e)),u&&""===u.textContent.trim()){var f=sf.base.createElement("br");f.classList.add("e-rte-image-remove-focus"),u.appendChild(f)}}break;case"insert-image":this.showDialog(!1,a,i,s,r),a.preventDefault()}a.ctrlKey&&"a"===a.key&&this.handleSelectAll()},n.prototype.isImageCurStartOrEnd=function(e,t){var n=["IMG"],i=e.startContainer,s=e.startOffset;if(e.collapsed&&1===i.nodeType&&i.isContentEditable){var r=t?i.childNodes[s]&&n.indexOf(i.childNodes[s].nodeName)>-1:i.childNodes[s-1]&&n.indexOf(i.childNodes[s-1].nodeName)>-1;return r||!1}return!1},n.prototype.getImageCursorPosition=function(e){return{start:this.isImageCurStartOrEnd(e,!0),startName:"",end:this.isImageCurStartOrEnd(e,!1),endName:""}},n.prototype.handleSelectAll=function(){this.cancelResizeAction();var e=this.parent.inputElement.querySelectorAll(".e-img-focus");sf.base.removeClass(e,"e-img-focus")},n.prototype.onKeyUp=function(e){if(!sf.base.isNullOrUndefined(this.deletedImg)&&this.deletedImg.length>0)for(var t=this.deletedImg.length-1;t>=0;t--){var n={src:this.deletedImg[t].getAttribute("src")};this.parent.imageDeleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("AfterImageDeleteEvent",n),this.deletedImg.splice(t,1)}},n.prototype.resizeStart=function(e,t){var n=this;if(!this.parent.readonly){var i=t||e.target;if(this.prevSelectedImgEle=this.imgEle,"IMG"===i.tagName){this.parent.preventDefaultResize(e,!1);var s=i;this.imgResizeDiv&&this.parent.getEditPanel().contains(this.imgResizeDiv)&&sf.base.detach(this.imgResizeDiv),this.imageResize(s)}if(i.classList.contains("e-rte-imageboxmark")){0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),e.preventDefault(),e.stopImmediatePropagation(),this.resizeBtnInit(),this.quickToolObj&&this.quickToolObj.hideImageQTBar();for(var r=["topLeft","topRight","botLeft","botRight"],o=0;o<r.length;o++){var a=r[o];if(i.classList.contains("e-rte-"+a)){this.resizeBtnStat[a]=!0,this.currentResizeHandler=a,this.aspectRatio=this.findAspectRatio(this.imgEle);break}}if(sf.base.Browser.isDevice&&this.parent.getEditPanel().contains(this.imgResizeDiv)&&!this.imgResizeDiv.classList.contains("e-mob-span"))sf.base.addClass([this.imgResizeDiv],"e-mob-span");else{this.parent.onResizeStartEnabled&&this.parent.dotNetRef.invokeMethodAsync("ResizeStartEvent",{requestType:"Images"}).then((function(e){e.cancel&&n.cancelResizeAction()}))}sf.base.EventHandler.add(this.parent.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing,this),sf.base.EventHandler.add(this.parent.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd,this)}}},n.prototype.findAspectRatio=function(e){return e.clientWidth/e.clientHeight},n.prototype.getResizeFactor=function(e){return ke[e]},n.prototype.setImageWidth=function(e,t,n){e.style.width=this.getImageDimension(t,e)+n,this.parent.insertImageSettings.resizeByPercent||e.setAttribute("width",t.toString())},n.prototype.setImageHeight=function(e,t,n){e.style.height=this.getImageDimension(t,e)+n,this.parent.insertImageSettings.resizeByPercent||e.setAttribute("height",t.toString())},n.prototype.removeImageHeight=function(e){e.style.height="",e.removeAttribute("height")},n.prototype.getImageDimension=function(e,t){if(this.parent.insertImageSettings.resizeByPercent){var n=t.parentElement||t.previousElementSibling;return this.pixToPerc(e,n)}return e},n.prototype.adjustDimensionsByAspectRatio=function(e,t,n){return t=Math.round(e/n),{width:e=Math.round(t*n),height:t}},n.prototype.pixToPerc=function(e,t){return e/parseFloat(getComputedStyle(t).width)*100},n.prototype.resizing=function(e){if(this.parent){if(this.resizeBtnStat.botRight||this.resizeBtnStat.botLeft||this.resizeBtnStat.topRight||this.resizeBtnStat.topLeft)if(this.parent.iframeSettings.enable){var t=this.getResizeFactor(this.currentResizeHandler),n=this.getPointX(e),i=this.getPointY(e),s=this.imgEle.clientWidth,r=this.imgEle.clientHeight,o=n-this.pageX,a=i-this.pageY,l=o*t[0]+s,d=a*t[1]+r,c=this.adjustDimensions(l,d,o,a,this.aspectRatio);this.pageX=n,this.pageY=i,this.imgDupMouseMove(c.width+"px",c.height+"px",e),this.parent.autoResize()}else{var h=this.getPointX(e),p=this.getPointY(e),u=(t=this.getResizeFactor(this.currentResizeHandler),h-this.pageX),f=p-this.pageY;s=this.imgEle.clientWidth,r=this.imgEle.clientHeight,l=u*t[0]+s,d=f*t[1]+r,c=this.adjustDimensions(l,d,u,f,this.aspectRatio);this.pageX=h,this.pageY=p,this.imgDupMouseMove(c.width+"px",c.height+"px",e)}}else this.cancelResizeAction()},n.prototype.adjustDimensions=function(e,t,n,i,s){return e=e<16?16:e,t=t<16?16:t,this.adjustDimensionsByAspectRatio(e,t,s)},n.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.imgEle.parentElement.style.cursor="auto",sf.base.Browser.isDevice&&sf.base.removeClass([e.target.parentElement],"e-mob-span");this.parent.onResizeStopEnabled&&this.parent.dotNetRef.invokeMethodAsync("ResizeStopEvent",{requestType:"Images"}),this.parent.formatter.editorManager.observer.on(u,this.undoStack,this),this.parent.formatter.saveData(),sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing),sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd)},n.prototype.dragStart=function(e){if("IMG"!==e.target.nodeName)return!0;e.dataTransfer.effectAllowed="copyMove",e.target.classList.add("e-rte-drag-image")},n.prototype.dragOver=function(e){if(!("edge"===sf.base.Browser.info.name&&e.dataTransfer.items[0].type.split("/")[0].indexOf("image")>-1||sf.base.Browser.isIE&&"Files"===e.dataTransfer.types[0]))return!0;e.preventDefault()},n.prototype.dragEnter=function(e){e.dataTransfer.dropEffect="copy",e.preventDefault()},n.prototype.dragDrop=function(e){var t=this;this.imageDragArgs=e,this.dropFiles=e.dataTransfer.files;var n=this.parent.inputElement.ownerDocument.querySelector(".e-rte-drag-image");if(!n||"IMG"!==n.tagName)return!0;e.preventDefault(),e.stopPropagation(),(e.dataTransfer.files.length<=0||n)&&this.parent.dotNetRef.invokeMethodAsync("ActionBeginEvent",e).then((function(n){if(!n.cancel){if(sf.base.closest(e.target,"#"+t.rteId+"_toolbar")||"false"===t.parent.inputElement.contentEditable)return;if(t.parent.element.querySelector(".e-img-resize")&&sf.base.detach(t.imgResizeDiv),t.selectRange(e),t.parent.element.querySelector(".e-droparea"))return;t.insertDragImage(e,t.dropFiles)}}))},n.prototype.destroy=function(){this.prevSelectedImgEle=void 0,this.removeEventListener()},n}(),vt=function(){function n(e){this.deletedAud=[],this.parent=e,this.rteId=e.element.id,this.addEventListener()}return n.prototype.addEventListener=function(){this.parent.observer.on(r,this.onKeyUp,this),this.parent.observer.on(p,this.docClick,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on("delete",this.deleteAud,this),this.parent.observer.on(t,this.afterRender,this),this.parent.observer.on("insertAudio",this.audioDialog,this),this.parent.observer.on("dropDownSelect",this.alignmentSelect,this),this.parent.observer.on("iframe-click",this.onIframeMouseDown,this),this.parent.observer.on("audio-toolbar-action",this.onToolbarAction,this),this.parent.observer.on(c,this.editAreaClickHandler,this),this.parent.observer.on("insertCompleted",this.showAudioQuickToolbar,this),this.parent.observer.on(s,this.bindOnEnd,this)},n.prototype.removeEventListener=function(){this.parent.observer.off(r,this.onKeyUp),this.parent.observer.off(p,this.docClick),this.parent.observer.off(i,this.destroy),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off("dropDownSelect",this.alignmentSelect),this.parent.observer.off("iframe-click",this.onIframeMouseDown),this.parent.observer.off("audio-toolbar-action",this.onToolbarAction),this.parent.observer.off(c,this.editAreaClickHandler),this.parent.observer.off("insertCompleted",this.showAudioQuickToolbar),this.parent.observer.off(s,this.bindOnEnd),sf.base.isNullOrUndefined(this.parent.getEditPanel())||(sf.base.EventHandler.remove(this.parent.getEditPanel(),sf.base.Browser.touchEndEvent,this.audioClick),this.parent.formatter.editorManager.observer.off(u,this.undoStack),sf.base.EventHandler.remove(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick))},n.prototype.bindOnEnd=function(){this.parent.formatter.editorManager.audioObj||(this.parent.formatter.editorManager.audioObj=new rt(this.parent.formatter.editorManager))},n.prototype.docClick=function(e){var t=e.args.target,n=sf.base.closest(t,"audio"),i=!(!n||!this.parent.getEditPanel().contains(n));!t||"audio"===t.tagName||i||null!==sf.base.closest(t,".e-rte-quick-popup")||!t.offsetParent||t.offsetParent.classList.contains("e-quick-dropdown")||t.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")||sf.base.closest(t,".e-rte-dropdown-popup")||sf.base.closest(t,".e-rte-elements")||this.hideAudioQuickToolbar()},n.prototype.afterRender=function(){sf.base.EventHandler.add(this.parent.getEditPanel(),sf.base.Browser.touchEndEvent,this.audioClick,this),sf.base.EventHandler.add(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick,this)},n.prototype.isAudioElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&(e.classList.contains("e-audio-wrap")||e.classList.contains("e-rte-audio")||e.classList.contains("e-clickelem")))},n.prototype.audioDialog=function(e){if(this.parent.dotNetRef.invokeMethodAsync("CloseAudioDialog",null),this.uploadUrl={url:""},this.selectionObj={selfAudio:this,selection:e.selection,args:e.args,selectParent:e.selectParent},!sf.base.isNullOrUndefined(this.parent.insertAudioSettings.path)||"HTML"===this.parent.editorMode){var t=this.parent.iframeSettings.enable;if("HTML"===this.parent.editorMode&&(!t&&sf.base.isNullOrUndefined(sf.base.closest(e.selection.range.startContainer.parentNode,"#"+this.parent.getPanel().id))||t&&sf.base.isNullOrUndefined(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body")))){this.parent.getEditPanel().focus();var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());this.audUploadSave=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.getDocument()),this.audUploadSelectedParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n)}else this.audUploadSave=e.selection,this.audUploadSelectedParent=e.selectParent}var i;if(e.selectNode&&this.isAudioElem(e.selectNode[0])){var s=new RegExp("([^\\S]|^)(((https?:\\/\\/)|(www\\.))(\\S+))","gi");i=e.selectNode[0].querySelector("source").src.match(s)?{mode:"Edit",url:e.selectNode[0].querySelector("source").src}:{mode:"Edit",url:""}}else i={mode:"Insert"};this.parent.dotNetRef.invokeMethodAsync("ShowAudioDialog",i),this.quickToolObj&&(this.quickToolObj.hideAudioQTBar(),sf.base.isNullOrUndefined(e.selectParent)||sf.base.removeClass([e.selectParent[0]],"e-audio-focus"),this.quickToolObj.hideInlineQTBar(),sf.base.isNullOrUndefined(this.quickToolObj.textQTBar)||sf.base.isNullOrUndefined(this.quickToolObj.textQTBar.element)||!this.quickToolObj.textQTBar.element.classList.contains("e-popup-open")||this.quickToolObj.hideTextQTBar())},n.prototype.checkAudioBack=function(e){"#text"===e.startContainer.nodeName&&0===e.startOffset&&!sf.base.isNullOrUndefined(e.startContainer.previousSibling)&&this.isAudioElem(e.startContainer.previousSibling)?this.deletedAud.push(e.startContainer.previousSibling):"#text"!==e.startContainer.nodeName&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])&&this.isAudioElem(e.startContainer.childNodes[e.startOffset-1])&&this.deletedAud.push(e.startContainer.childNodes[e.startOffset-1])},n.prototype.checkAudioDel=function(e){"#text"===e.startContainer.nodeName&&e.startOffset===e.startContainer.textContent.length&&!sf.base.isNullOrUndefined(e.startContainer.nextSibling)&&this.isAudioElem(e.startContainer.nextSibling)?this.deletedAud.push(e.startContainer.nextSibling):"#text"!==e.startContainer.nodeName&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])&&this.isAudioElem(e.startContainer.childNodes[e.startOffset])&&this.deletedAud.push(e.startContainer.childNodes[e.startOffset])},n.prototype.undoStack=function(e){if("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=sf.base.createElement("div"),i=ne(this.parent.formatter.getUndoRedoStack()[t].text);n.appendChild(i)}},n.prototype.editAreaClickHandler=function(e){if(this.parent.readonly)this.hideAudioQuickToolbar();else{var t=e.args,n=t.target,i=this.parent.quickToolbarSettings.showOnRightClick;if(2===t.which||i&&1===t.which||!i&&3===t.which)return i&&1===t.which&&!sf.base.isNullOrUndefined(n)&&this.isAudioElem(n)&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.parent.getDocument(),n)),void(this.isAudioElem(n)&&n.querySelector("audio")&&(n.querySelector("audio").style.outline="2px solid #4a90e2"));"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&(this.quickToolObj=this.parent.quickToolbarModule,this.isAudioElem(n)&&this.parent.quickToolbarModule?(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.parent.getDocument(),n),C()&&this.parent.observer.notify(a,e),this.showAudioQuickToolbar({args:t,type:"Audios",elements:[t.target]})):this.hideAudioQuickToolbar())}},n.prototype.showAudioQuickToolbar=function(e){var t=this;if("Audios"===e.type&&!sf.base.isNullOrUndefined(this.parent.quickToolbarModule)){this.quickToolObj=this.parent.quickToolbarModule;var n=e.args,i=e.elements,s=this.parent.element.getBoundingClientRect(),r=this.parent.getToolbarElement(),o=r?r.offsetHeight+this.parent.toolbarModule.getExpandTBarPopHeight():0;if([].forEach.call(e.elements,(function(e,t){0===t&&(i=e)})),this.isAudioElem(i)){var a="AUDIO"===i.tagName?i:i.querySelector("audio");this.audEle=a,sf.base.addClass([a],["e-audio-focus"]),a.style.outline="2px solid #4a90e2"}i&&sf.base.closest(i,"a"),this.isAudioElem(i)&&sf.base.addClass([i],["e-audio-focus"]);this.parent.iframeSettings.enable?(window.scrollX,s.left,n.clientX):n.pageX,this.parent.iframeSettings.enable?(window.scrollY,s.top,n.clientY):n.pageY;this.quickToolObj&&(e.isNotify?setTimeout((function(){t.parent.formatter.editorManager.nodeSelection.Clear(t.parent.getDocument()),t.parent.formatter.editorManager.nodeSelection.setSelectionContents(t.parent.getDocument(),i),t.quickToolObj.showAudioQTBar(i,e.args)}),400):this.quickToolObj.showAudioQTBar(i,e.args))}},n.prototype.hideAudioQuickToolbar=function(){sf.base.isNullOrUndefined(this.parent.getEditPanel().querySelector(".e-audio-focus"))||(sf.base.removeClass([this.parent.getEditPanel().querySelector(".e-audio-focus")],"e-audio-focus"),sf.base.isNullOrUndefined(this.audEle)||(this.audEle.style.outline=""),this.quickToolObj&&this.quickToolObj.hideAudioQTBar())},n.prototype.onToolbarAction=function(e){switch(this.quickToolObj&&(this.quickToolObj.hideAudioQTBar(),sf.base.removeClass([e.selectNode[0]],"e-audio-focus")),this.selectionObj=e,C()&&this.parent.observer.notify(l,{}),e.args.item.subCommand){case"AudioReplace":this.parent.observer.notify("insertAudio",e);break;case"AudioRemove":this.parent.observer.notify("delete",e)}},n.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},n.prototype.deleteAud=function(t,n){if(this.isAudioElem(t.selectNode[0])){var i={src:t.selectNode[0].getAttribute("src")};0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.selection.restore(),this.parent.formatter.process(this.parent,t.args,t.args,{selectNode:t.selectNode,captionClass:e,subCommand:t.args.item.subCommand}),this.quickToolObj&&this.quickToolObj.hideAudioQTBar(),sf.base.isNullOrUndefined(n)&&this.parent.mediaDeleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("MediaDeleted",i)}},n.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Audios"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),s={args:e,selectNode:i=[this.audEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"Inline":this.inline(s);break;case"Break":this.break(s)}this.quickToolObj&&(this.quickToolObj.hideAudioQTBar(),sf.base.removeClass([i[0]],"e-audio-focus"))}},n.prototype.inline=function(e){if("AUDIO"===e.selectNode[0].nodeName){var t=e.args.item?e.args.item.subCommand:"Inline";this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})}},n.prototype.break=function(e){if("AUDIO"===e.selectNode[0].nodeName){var t=e.args.item?e.args.item.subCommand:"Break";this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})}},n.prototype.audioBrowseClick=function(){document.getElementById(this.rteId+"_audio").querySelector(".e-rte-audio-dialog .e-file-select-wrap button").click()},n.prototype.dialogOpened=function(){var e=sf.base.Browser.isDevice||sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-audio-dialog .e-audio-content"))?document.getElementById(this.rteId+"_audio").querySelector(".e-audio-content"):this.parent.element.querySelector(".e-rte-audio-dialog .e-audio-content");if(!sf.base.isNullOrUndefined(e)){var t=document.getElementById(this.rteId+"_dropText"),n=document.getElementById(this.rteId+"_insertAudio");this.buttonClickElement=sf.base.Browser.isDevice?t:n,sf.base.EventHandler.add(this.buttonClickElement,"click",this.audioBrowseClick,this),!sf.base.isNullOrUndefined(this.parent.insertAudioSettings.path)&&"Markdown"===this.parent.editorMode||"HTML"===this.parent.editorMode?e.querySelector("#"+this.rteId+"_insertAudio").focus():e.querySelector(".e-audio-url").focus()}},n.prototype.fileSelected=function(){this.inputUrl&&this.inputUrl.setAttribute("disabled","true")},n.prototype.fileUploadSuccess=function(e,t){this.inputUrl=this.parent.element.querySelector(".e-rte-audio-dialog .e-audio-url"),sf.base.isNullOrUndefined(this.parent.insertAudioSettings.path)||(this.uploadUrl={url:e,selection:this.audUploadSave,fileName:t,selectParent:this.audUploadSelectedParent},this.inputUrl&&this.inputUrl.setAttribute("disabled","true"))},n.prototype.fileUploadComplete=function(e,t){if(this.inputUrl=this.parent.element.querySelector(".e-rte-audio-dialog .e-audio-url"),"HTML"===this.parent.editorMode&&sf.base.isNullOrUndefined(this.parent.insertAudioSettings.path)){var n="Base64"===this.parent.insertAudioSettings.saveFormat?e:URL.createObjectURL(q(e));this.uploadUrl={url:n,selection:this.audUploadSave,fileName:t,selectParent:this.audUploadSelectedParent},this.inputUrl&&this.inputUrl.setAttribute("disabled","true")}},n.prototype.fileUploadChange=function(e,t){this.modifiedUrl=e,this.isStreamUrl=t},n.prototype.fileRemoving=function(){this.inputUrl.removeAttribute("disabled"),this.uploadUrl&&(this.uploadUrl.url="")},n.prototype.dialogClosed=function(){"HTML"===this.parent.editorMode?this.selectionObj.selection.restore():this.parent.formatter.editorManager.markdownSelection.restore(this.parent.getEditPanel()),this.buttonClickElement&&sf.base.EventHandler.remove(this.buttonClickElement,"click",this.audioBrowseClick)},n.prototype.insertAudioUrl=function(){var e=this,t=this.parent.element.ownerDocument.querySelector("#"+this.rteId+"_audio");sf.base.Browser.isDevice?this.inputUrl=this.parent.inputElement.ownerDocument.querySelector("#"+this.rteId+"_Audio").querySelector(".e-rte-audio-dialog .e-audio-url"):this.inputUrl=sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-audio-dialog .e-audio-url"))?t.querySelector(".e-rte-elements .e-rte-audio-dialog .e-audio-url"):this.parent.element.querySelector(".e-rte-audio-dialog .e-audio-url");var n=this.inputUrl.value;if(this.isStreamUrl&&""!==this.modifiedUrl&&(this.uploadUrl.url=this.modifiedUrl,this.modifiedUrl=""),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),sf.base.isNullOrUndefined(this.uploadUrl)||""===this.uploadUrl.url){if(""!==n){if("HTML"===this.parent.editorMode&&sf.base.isNullOrUndefined(sf.base.closest(this.selectionObj.selection.range.startContainer.parentNode,"#"+this.parent.getPanel().id))&&!this.parent.iframeSettings.enable){this.parent.getEditPanel().focus();var i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());this.selectionObj.selection=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.getDocument()),this.selectionObj.selectParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i)}var s="HTML"===this.parent.editorMode?n.split("/")[n.split("/").length-1]:"",r={cssClass:"inline"===this.parent.insertAudioSettings.layoutOption.toLowerCase()?"e-audio-inline":"e-audio-break",url:n,selection:this.selectionObj.selection,fileName:s,selectParent:this.selectionObj.selectParent};this.parent.dotNetRef.invokeMethodAsync("CloseAudioDialog",null).then((function(){var t=e.parent.element.ownerDocument.querySelector("#"+e.rteId+"_audio");sf.base.isNullOrUndefined(t)&&e.parent.formatter.process(e.parent,e.selectionObj.args,e.selectionObj.args.originalEvent,r)}))}}else this.uploadUrl.cssClass="inline"===this.parent.insertAudioSettings.layoutOption.toLowerCase()?"e-audio-inline":"e-audio-break",this.parent.dotNetRef.invokeMethodAsync("CloseAudioDialog",null).then((function(){var t=e.parent.element.ownerDocument.querySelector("#"+e.rteId+"_audio");sf.base.isNullOrUndefined(t)&&e.parent.formatter.process(e.parent,e.selectionObj.args,e.selectionObj.args.originalEvent,e.uploadUrl)}))},n.prototype.showDialog=function(e,t,n,i,s){var r,o,a,l;e&&!sf.base.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.save(r,this.parent.getDocument()),a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(r),l=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(r)):(o=n,a=i,l=s),"HTML"===this.parent.editorMode&&this.audioDialog({args:{item:{command:"Audios",subCommand:"Audio"},originalEvent:e?void 0:t,name:e?"showDialog":null},selectNode:a,selection:o,selectParent:l})},n.prototype.onIframeMouseDown=function(e){this.parent.dotNetRef.invokeMethodAsync("CloseAudioDialog",null),this.onDocumentClick(e)},n.prototype.onDocumentClick=function(e){var t=e.target;this.isAudioElem(t)&&(this.audEle=t.querySelector("audio"));var n=document.body.querySelector("#"+this.rteId+"_audio.e-rte-audio-dialog");!sf.base.isNullOrUndefined(n)&&(!sf.base.closest(t,"#"+this.rteId+"_audio")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!sf.base.closest(t,"#"+this.rteId+"_toolbar_Audio")&&!t.querySelector("#"+this.rteId+"_toolbar_Audio"))&&(e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.dotNetRef.invokeMethodAsync("CloseAudioDialog","Outside Click"),this.parent.isBlur=!0,sf.base.Browser.isIE&&ee(this.parent.element,"focusout"))),this.isAudioElem(t)||(sf.base.isNullOrUndefined(this.audEle)||""===this.audEle.style.outline?sf.base.isNullOrUndefined(this.prevSelectedAudEle)||""===this.prevSelectedAudEle.style.outline||(this.prevSelectedAudEle.style.outline=""):this.audEle.style.outline=""),!this.parent.inlineMode.enable||sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(n)||sf.base.closest(t,"#"+this.rteId+"_audio")||this.parent.dotNetRef.invokeMethodAsync("CloseAudioDialog","Outside Click")},n.prototype.audioClick=function(e){sf.base.Browser.isDevice&&(this.isAudioElem(e.target)&&"A"===e.target.parentElement.tagName||this.isAudioElem(e.target)?(this.parent.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.parent.getEditPanel().setAttribute("contenteditable","true")),this.isAudioElem(e.target)&&"A"===e.target.parentElement.tagName&&e.preventDefault()},n.prototype.onKeyDown=function(e){var t,n,i,s,r,o=e.args;this.deletedAud=[];if("HTML"===this.parent.editorMode&&(r=(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument())).startContainer===t.endContainer&&t.startOffset===t.endOffset),!r&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(o.which)<0)for(var a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),l=0;l<a.length;l++)this.isAudioElem(a[l])&&this.deletedAud.push(a[l]);if("HTML"===this.parent.editorMode&&(8===o.which&&"Backspace"===o.code||46===o.which&&"Delete"===o.code)){var d=t.startContainer===t.endContainer&&t.startOffset===t.endOffset;8===o.which&&"Backspace"===o.code&&d?this.checkAudioBack(t):46===o.which&&"Delete"===o.code&&d&&this.checkAudioDel(t)}if(!sf.base.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&"KeyK"!==o.code&&(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),s=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),!o.ctrlKey&&o.key&&(1===o.key.length||"enter"===o.action||37===o.keyCode||38===o.keyCode||39===o.keyCode||40===o.keyCode)&&this.isAudioElem(s[0])&&s[0].parentElement)){var c=s[0].parentElement.childNodes[0];this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.getDocument(),c,c,c.textContent.length,c.textContent.length),sf.base.removeClass([s[0]],"e-audio-focus"),this.quickToolObj.hideAudioQTBar(),sf.base.isNullOrUndefined(this.audEle)||(this.audEle.style.outline="")}if(!o.ctrlKey||89!==o.keyCode&&90!==o.keyCode||this.undoStack({subCommand:90===o.keyCode?"undo":"redo"}),(8===o.keyCode||46===o.keyCode)&&i&&(this.isAudioElem(i[0])||46===o.keyCode&&i[0].nextSibling&&this.isAudioElem(i[0].nextSibling)||8===o.keyCode&&i[0].previousSibling&&this.isAudioElem(i[0].previousSibling))&&i.length<=2&&"#text"!==i[0].nodeName){o.preventDefault();var h={selectNode:i,selection:n,selectParent:s,args:{item:{command:"Audios",subCommand:"Remove"},originalEvent:o}};this.deleteAud(h,o.keyCode)}switch(o.action){case"escape":this.parent.dotNetRef.invokeMethodAsync("CloseAudioDialog",null);break;case"backspace":case"delete":"Markdown"!==this.parent.editorMode&&(3===t.startContainer.nodeType?"Backspace"===o.code?t.startContainer.previousElementSibling&&0===t.startOffset&&t.startContainer.previousElementSibling.classList.contains("e-audio-wrap")&&sf.base.detach(t.startContainer.previousElementSibling):t.startContainer.nextElementSibling&&t.endContainer.textContent.length===t.endOffset&&t.startContainer.nextElementSibling.classList.contains("e-audio-wrap")&&sf.base.detach(t.startContainer.nextElementSibling):1===t.startContainer.nodeType&&t.startContainer.classList&&(t.startContainer.classList.contains("e-audio-wrap")||t.startContainer.classList.contains("e-clickelem")||t.startContainer.classList.contains("e-video-clickelem"))&&sf.base.detach(t.startContainer));break;case"insert-audio":this.showDialog(!1,o,n,i,s),o.preventDefault()}o.ctrlKey&&"a"===o.key&&this.handleSelectAll()},n.prototype.handleSelectAll=function(){var e=this.parent.inputElement.querySelectorAll(".e-audio-focus");sf.base.removeClass(e,"e-audio-focus")},n.prototype.onKeyUp=function(e){if(!sf.base.isNullOrUndefined(this.deletedAud)&&this.deletedAud.length>0)for(var t=0;t<this.deletedAud.length;t++){var n=this.deletedAud[t],i={src:("SOURCE"===n.tagName?n:n.querySelector("source")).getAttribute("src")};this.parent.mediaDeleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("MediaDeleted",i)}},n.prototype.destroy=function(){this.prevSelectedAudEle=void 0,this.removeEventListener()},n}(),yt=function(){function n(e){this.pageX=null,this.pageY=null,this.mouseX=null,this.deletedVid=[],this.parent=e,this.rteId=e.element.id,this.addEventListener()}return n.prototype.addEventListener=function(){this.parent.observer.on(r,this.onKeyUp,this),this.parent.observer.on(p,this.docClick,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on("videoSize",this.videoSize,this),this.parent.observer.on("delete",this.deleteVid,this),this.parent.observer.on(t,this.afterRender,this),this.parent.observer.on("insertVideo",this.videoDialog,this),this.parent.observer.on("resize",this.onWindowResize,this),this.parent.observer.on("dropDownSelect",this.alignmentSelect,this),this.parent.observer.on("iframe-click",this.onIframeMouseDown,this),this.parent.observer.on("video-toolbar-action",this.onToolbarAction,this),this.parent.observer.on(c,this.editAreaClickHandler,this),this.parent.observer.on("insertCompleted",this.showVideoQuickToolbar,this),this.parent.observer.on(s,this.bindOnEnd,this)},n.prototype.removeEventListener=function(){this.parent.observer.off(r,this.onKeyUp),this.parent.observer.off(p,this.docClick),this.parent.observer.off(i,this.destroy),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off("videoSize",this.videoSize),this.parent.observer.off("delete",this.deleteVid),this.parent.observer.off(t,this.afterRender),this.parent.observer.off("insertVideo",this.videoDialog),this.parent.observer.off("resize",this.onWindowResize),this.parent.observer.off("dropDownSelect",this.alignmentSelect),this.parent.observer.off("iframe-click",this.onIframeMouseDown),this.parent.observer.off("video-toolbar-action",this.onToolbarAction),this.parent.observer.off(c,this.editAreaClickHandler),this.parent.observer.off("insertCompleted",this.showVideoQuickToolbar),this.parent.observer.off(s,this.bindOnEnd),sf.base.isNullOrUndefined(this.parent.getEditPanel())||(sf.base.EventHandler.remove(this.parent.getEditPanel(),sf.base.Browser.touchEndEvent,this.videoClick),this.parent.formatter.editorManager.observer.off(u,this.undoStack),this.parent.insertVideoSettings.resize&&(sf.base.EventHandler.remove(this.parent.getEditPanel(),sf.base.Browser.touchStartEvent,this.resizeStart),sf.base.EventHandler.remove(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick),sf.base.EventHandler.remove(this.parent.getEditPanel(),"cut",this.onCutHandler)))},n.prototype.bindOnEnd=function(){this.parent.formatter.editorManager.videoObj||(this.parent.formatter.editorManager.videoObj=new ot(this.parent.formatter.editorManager))},n.prototype.docClick=function(e){var t=e.args.target,n=sf.base.closest(t,"video"),i=!(!n||!this.parent.getEditPanel().contains(n));!t||"video"===t.tagName||i||null!==sf.base.closest(t,".e-rte-quick-popup")||!t.offsetParent||t.offsetParent.classList.contains("e-quick-dropdown")||t.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")||sf.base.closest(t,".e-rte-dropdown-popup")||sf.base.closest(t,".e-rte-elements")||this.hideVideoQuickToolbar()},n.prototype.afterRender=function(){sf.base.EventHandler.add(this.parent.getEditPanel(),sf.base.Browser.touchEndEvent,this.videoClick,this),this.parent.insertVideoSettings.resize&&(sf.base.EventHandler.add(this.parent.getEditPanel(),sf.base.Browser.touchStartEvent,this.resizeStart,this),sf.base.EventHandler.add(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick,this),sf.base.EventHandler.add(this.parent.getEditPanel(),"cut",this.onCutHandler,this))},n.prototype.isEmbedVidElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&(e.classList.contains("e-video-clickelem")||e.classList.contains("e-embed-video-wrap"))||"IFRAME"===e.nodeName)},n.prototype.videoDialog=function(e){if(this.parent.dotNetRef.invokeMethodAsync("CloseVideoDialog",null),this.uploadUrl={url:""},this.selectionObj={selfVideo:this,selection:e.selection,args:e.args,selectParent:e.selectParent},!sf.base.isNullOrUndefined(this.parent.insertVideoSettings.path)||"HTML"===this.parent.editorMode){var t=this.parent.iframeSettings.enable;if("HTML"===this.parent.editorMode&&(!t&&sf.base.isNullOrUndefined(sf.base.closest(e.selection.range.startContainer.parentNode,"#"+this.parent.getPanel().id))||t&&sf.base.isNullOrUndefined(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body")))){this.parent.getEditPanel().focus();var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());this.vidUploadSave=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.getDocument()),this.vidUploadSelectedParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n)}else this.vidUploadSave=e.selection,this.vidUploadSelectedParent=e.selectParent}var i;if(e.selectNode&&(e.selectNode[0]&&3!==e.selectNode[0].nodeType&&"BR"!==e.selectNode[0].nodeName&&e.selectNode[0].classList&&e.selectNode[0].classList.contains("e-video-clickelem")||"IFRAME"===e.selectNode[0].nodeName||"VIDEO"===e.selectNode[0].nodeName)){var s=new RegExp("([^\\S]|^)(((https?:\\/\\/)|(www\\.))(\\S+))","gi");i=e.selectNode[0].querySelector("source").src.match(s)?{mode:"Edit",url:e.selectNode[0].querySelector("source").src}:{mode:"Edit",url:""}}else i={mode:"Insert"};this.parent.dotNetRef.invokeMethodAsync("ShowVideoDialog",i),this.quickToolObj&&(this.quickToolObj.hideVideoQTBar(),sf.base.isNullOrUndefined(e.selectParent)||sf.base.removeClass([e.selectParent[0]],"e-video-focus"),this.quickToolObj.hideInlineQTBar(),sf.base.isNullOrUndefined(this.quickToolObj.textQTBar)||sf.base.isNullOrUndefined(this.quickToolObj.textQTBar.element)||!this.quickToolObj.textQTBar.element.classList.contains("e-popup-open")||this.quickToolObj.hideTextQTBar())},n.prototype.isVideoWrapElem=function(e){return!!(e&&e.classList&&e.classList.contains("e-video-wrap"))},n.prototype.checkVideoBack=function(e){"#text"!==e.startContainer.nodeName||0!==e.startOffset||sf.base.isNullOrUndefined(e.startContainer.previousSibling)||"VIDEO"!==e.startContainer.previousSibling.nodeName&&!this.isEmbedVidElem(e.startContainer.previousSibling)&&!this.isVideoWrapElem(e.startContainer.previousSibling)?("#text"!==e.startContainer.nodeName&&!sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])&&this.isEmbedVidElem(e.startContainer.childNodes[e.startOffset-1])||this.isVideoWrapElem(e.startContainer.childNodes[e.startOffset-1]))&&this.deletedVid.push(e.startContainer.childNodes[e.startOffset-1]):this.deletedVid.push(e.startContainer.previousSibling)},n.prototype.checkVideoDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||sf.base.isNullOrUndefined(e.startContainer.nextSibling)||"VIDEO"!==e.startContainer.nextSibling.nodeName&&!this.isEmbedVidElem(e.startContainer.nextSibling)&&!this.isVideoWrapElem(e.startContainer.nextSibling)?"#text"===e.startContainer.nodeName||sf.base.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])||"VIDEO"!==e.startContainer.childNodes[e.startOffset].nodeName&&!this.isEmbedVidElem(e.startContainer.childNodes[e.startOffset])&&!this.isVideoWrapElem(e.startContainer.childNodes[e.startOffset])||this.deletedVid.push(e.startContainer.childNodes[e.startOffset]):this.deletedVid.push(e.startContainer.nextSibling)},n.prototype.getDropRange=function(e,t){var n=this.parent.getDocument().createRange();this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.getDocument(),n);var i=this.parent.getDocument().elementFromPoint(e,t),s=i.childNodes.length>0?i.childNodes[0]:i,r=0;if("<br>"===this.parent.inputElement.firstChild.innerHTML)n.setStart(s,r),n.setEnd(s,r);else{var o=void 0;do{r++,n.setStart(s,r),n.setEnd(s,r+1),o=n.getBoundingClientRect()}while(o.left<e&&r<s.length-1)}return n},n.prototype.undoStack=function(e){if("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=sf.base.createElement("div"),i=ne(this.parent.formatter.getUndoRedoStack()[t].text);n.appendChild(i);var s=n.querySelectorAll("video");if(n.querySelector(".e-vid-resize")&&s&&s.length>0){for(var r=0;r<s.length;r++)s[r].style.outline="";sf.base.detach(n.querySelector(".e-vid-resize")),this.parent.formatter.getUndoRedoStack()[t].text=n.innerHTML}}},n.prototype.videoResize=function(e){this.resizeBtnInit(),this.vidEle=e,sf.base.addClass([this.vidEle],"e-resize"),this.vidResizeDiv=sf.base.createElement("span",{className:"e-vid-resize",id:this.rteId+"_vidResize"}),this.vidResizeDiv.appendChild(sf.base.createElement("span",{className:"e-rte-videoboxmark e-rte-topLeft",styles:"cursor: nwse-resize"})),this.vidResizeDiv.appendChild(sf.base.createElement("span",{className:"e-rte-videoboxmark e-rte-topRight",styles:"cursor: nesw-resize"})),this.vidResizeDiv.appendChild(sf.base.createElement("span",{className:"e-rte-videoboxmark e-rte-botLeft",styles:"cursor: nesw-resize"})),this.vidResizeDiv.appendChild(sf.base.createElement("span",{className:"e-rte-videoboxmark e-rte-botRight",styles:"cursor: nwse-resize"})),sf.base.Browser.isDevice&&sf.base.addClass([this.vidResizeDiv],"e-mob-rte"),e.style.outline="2px solid #4a90e2",this.vidResizePos(e,this.vidResizeDiv),this.resizeVidDupPos(e),this.parent.getEditPanel().appendChild(this.vidResizeDiv),"auto"===this.parent.element.style.height&&this.vidResizePos(e,this.vidResizeDiv),sf.base.EventHandler.add(this.parent.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing,this)},n.prototype.resizeBtnInit=function(){return this.resizeBtnStat={botLeft:!1,botRight:!1,topRight:!1,topLeft:!1}},n.prototype.vidResizePos=function(e,t){var n=this.calcPos(e),i=n.top,s=n.left,r=e.getBoundingClientRect().width,o=e.getBoundingClientRect().height,a=sf.base.Browser.isDevice?4*parseInt(e.style.outline.slice(-3),10)+2:2*parseInt(e.style.outline.slice(-3),10)+2,l=sf.base.Browser.isDevice?0:2;t.querySelector(".e-rte-botLeft").style.left=s-a+"px",t.querySelector(".e-rte-botLeft").style.top=parseInt(o.toString(),10)-a+i+"px",t.querySelector(".e-rte-botRight").style.left=parseInt(r.toString(),10)-(a-l)+s+"px",t.querySelector(".e-rte-botRight").style.top=parseInt(o.toString(),10)-a+i+"px",t.querySelector(".e-rte-topRight").style.left=parseInt(r.toString(),10)-(a-l)+s+"px",t.querySelector(".e-rte-topRight").style.top=i-a+"px",t.querySelector(".e-rte-topLeft").style.left=s-a+"px",t.querySelector(".e-rte-topLeft").style.top=i-a+"px"},n.prototype.resizeVidDupPos=function(e){this.vidDupPos={width:""!==e.style.width?this.vidEle.style.width:0===e.width||sf.base.isNullOrUndefined(e.width)||"auto"===e.width?parseInt(getComputedStyle(e).width,10)+"px":e.width+"px",height:""!==e.style.height?this.vidEle.style.height:0===e.height||sf.base.isNullOrUndefined(e.height)||"auto"===e.height?parseInt(getComputedStyle(e).height,10)+"px":e.height+"px"}},n.prototype.calcPos=function(e){for(var t,n={top:0,left:0},i=e.ownerDocument,s=(e.offsetParent&&(e.offsetParent.classList.contains("e-video-clickelem")||["TD","TH","TABLE","A"].indexOf(e.offsetParent.tagName)>-1)?sf.base.closest(e,"#"+this.rteId+"_rte-edit-view"):e.offsetParent)||i.documentElement;s&&(s===i.body||s===i.documentElement)&&"static"===s.style.position;)s=s.parentNode;return s&&s!==e&&1===s.nodeType&&(n=s.getBoundingClientRect()),e&&1===e.nodeType&&"IFRAME"===e.tagName?{top:(t=e.getBoundingClientRect()).top-n.top,left:t.left-n.left}:{top:e.offsetTop,left:e.offsetLeft}},n.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].pageX:e.pageX},n.prototype.getPointY=function(e){return e.touches&&e.touches.length?e.touches[0].pageY:e.pageY},n.prototype.pixToPercent=function(e,t){return e/parseFloat(getComputedStyle(t).width)*100},n.prototype.vidDupMouseMove=function(e,t,n){parseInt(this.parent.insertVideoSettings.minWidth,10)>=parseInt(e,10)||!sf.base.isNullOrUndefined(this.parent.insertVideoSettings.maxWidth)&&parseInt(this.parent.insertVideoSettings.maxWidth,10)<=parseInt(e,10)||!this.parent.insertVideoSettings.resizeByPercent&&(parseInt(this.parent.insertVideoSettings.minHeight,10)>=parseInt(t,10)||parseInt(this.parent.insertVideoSettings.maxHeight,10)<=parseInt(t,10))||(this.vidEle.parentElement.style.cursor="pointer",this.setAspectRatio(this.vidEle,parseInt(e,10),parseInt(t,10),n),this.resizeVidDupPos(this.vidEle),this.vidResizePos(this.vidEle,this.vidResizeDiv))},n.prototype.setAspectRatio=function(e,t,n,i){var s=getComputedStyle(e);if(!sf.base.isNullOrUndefined(s)){var r=RegExp,o=""!==s.width?s.width.match(new r("^\\d+(\\.\\d*)?%$","g"))?parseFloat(s.width):parseInt(s.width,10):""!==e.style.width?parseInt(e.style.width,10):e.width,a=""!==s.height?parseInt(s.height,10):""!==e.style.height?parseInt(e.style.height,10):e.height;(o=o.toString().match(new r("\\b\\d+(\\.\\d*)?(%|$)\\b","g"))?parseFloat(o.toString()):parseInt(o.toString(),10))>(a=a.toString().match(new r("\\b\\d+(\\.\\d*)?(%|$)\\b","g"))?parseFloat(a.toString()):parseInt(a.toString(),10))?(e.style.minWidth=0===parseInt(this.parent.insertVideoSettings.minWidth.toString(),10)?"200px":sf.base.formatUnit(this.parent.insertVideoSettings.minWidth),e.style.minHeight=0===parseInt(this.parent.insertVideoSettings.minHeight.toString(),10)?"90px":sf.base.formatUnit(this.parent.insertVideoSettings.minHeight),this.parent.insertVideoSettings.resizeByPercent?this.updateVidEleWidth(e,o,a,t,n):""===e.style.width&&""!==e.style.height||""===s.width&&""!==s.height?e.style.height=n+"px":""!==e.style.width&&""===e.style.height||""!==s.width&&""===s.height?e.style.width=(o/a*n+o/a).toString()+"px":""!==e.style.width||""!==s.width?(e.style.width=o/a*n+"px",e.style.height=n+"px"):e.setAttribute("width",parseInt((o/a*n+o/a).toString(),10).toString())):a>o?this.parent.insertVideoSettings.resizeByPercent?this.updateVidEleWidth(e,o,a,t,n):""!==e.style.width||""!==s.width?(e.style.width=t+"px",e.style.height=a/o*t+"px"):e.setAttribute("width",this.resizeBtnStat.botRight?(this.getPointX(i)-e.getBoundingClientRect().left).toString():t.toString()):this.parent.insertVideoSettings.resizeByPercent?(e.style.width=this.pixToPercent(t,e.previousElementSibling||e.parentElement)+"%",e.style.height=null,e.removeAttribute("height")):(e.style.width=t+"px",e.style.height=t+"px")}},n.prototype.updateVidEleWidth=function(e,t,n,i,s){if(0!==parseInt(""+e.getBoundingClientRect().width,10)&&0!==parseInt(""+t,10)){var r=(e.offsetWidth+this.mouseX)/e.offsetWidth*("NaN"===parseFloat(e.style.width).toString()?e.offsetWidth/parseFloat(getComputedStyle(this.parent.element).width)*100:parseFloat(e.style.width));e.style.width=(r>3?r:3)+"%"}else e.style.width=t>n?this.pixToPercent(t/n*s,e.previousElementSibling||e.parentElement)+"%":this.pixToPercent(i/n*s,e.previousElementSibling||e.parentElement)+"%";e.style.height=null,e.removeAttribute("height")},n.prototype.getMaxWidth=function(){var e=this.parent.insertVideoSettings.maxWidth,t=this.parent.getEditPanel(),n=window.getComputedStyle(t),i=t.offsetWidth-(14+parseFloat(n.paddingLeft.split("px")[0])+parseFloat(n.paddingRight.split("px")[0])+parseFloat(n.marginLeft.split("px")[0])+parseFloat(n.marginRight.split("px")[0]));return sf.base.isNullOrUndefined(e)?i:e},n.prototype.cancelResizeAction=function(){sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing),sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd),this.vidEle&&this.vidResizeDiv&&this.parent.getEditPanel().contains(this.vidResizeDiv)&&(sf.base.detach(this.vidResizeDiv),this.vidEle.style.outline="",this.vidResizeDiv=null,this.pageX=null,this.pageY=null)},n.prototype.removeResizeEle=function(){sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchMoveEvent,this.resizing),sf.base.EventHandler.remove(this.parent.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd),sf.base.detach(this.parent.getEditPanel().querySelector(".e-vid-resize"))},n.prototype.onWindowResize=function(){sf.base.isNullOrUndefined(this.parent)||sf.base.isNullOrUndefined(this.parent.getEditPanel().querySelector(".e-vid-resize"))||this.cancelResizeAction()},n.prototype.editAreaClickHandler=function(e){if(this.parent.readonly)this.hideVideoQuickToolbar();else{var t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick;if(2===t.which||n&&1===t.which||!n&&3===t.which)!n||1!==t.which||sf.base.isNullOrUndefined(t.target)||"VIDEO"!==t.target.tagName&&!this.isEmbedVidElem(t.target)||(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.parent.getDocument(),t.target));else if("HTML"===this.parent.editorMode&&this.parent.quickToolbarModule){this.quickToolObj=this.parent.quickToolbarModule;var i=t.target;("VIDEO"===i.nodeName||this.isEmbedVidElem(i))&&this.parent.quickToolbarModule?(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.parent.getDocument(),i),C()&&this.parent.observer.notify(a,e),sf.base.addClass([this.isEmbedVidElem(i)?i.querySelector("iframe"):i],"e-video-focus"),this.showVideoQuickToolbar({args:t,type:"Videos",elements:[t.target]})):this.hideVideoQuickToolbar()}}},n.prototype.showVideoQuickToolbar=function(e){var t=this;if("Videos"===e.type&&2!==e.args.detail&&!sf.base.isNullOrUndefined(this.parent.quickToolbarModule)){this.quickToolObj=this.parent.quickToolbarModule;var n=e.args,i=e.elements,s=this.parent.element.getBoundingClientRect(),r=this.parent.getToolbarElement(),o=r?r.offsetHeight+this.parent.toolbarModule.getExpandTBarPopHeight():0;[].forEach.call(e.elements,(function(e,t){0===t&&(i=e)})),i&&sf.base.closest(i,"a"),("VIDEO"===i.tagName||this.isEmbedVidElem(i))&&sf.base.addClass([this.isEmbedVidElem(i)&&"IFRAME"!==i.tagName?i.querySelector("iframe"):i],["e-video-focus"]);this.parent.iframeSettings.enable?(window.scrollX,s.left,n.clientX):n.pageX,this.parent.iframeSettings.enable?(window.scrollY,s.top,n.clientY):n.pageY;this.quickToolObj&&(e.isNotify?setTimeout((function(){t.parent.formatter.editorManager.nodeSelection.Clear(t.parent.getDocument()),t.parent.formatter.editorManager.nodeSelection.setSelectionContents(t.parent.getDocument(),i),t.quickToolObj.showVideoQTBar(i,e.args),!0===t.parent.insertVideoSettings.resize&&t.resizeStart(e.args,i)}),400):this.quickToolObj.showVideoQTBar(i,e.args))}},n.prototype.hideVideoQuickToolbar=function(){sf.base.isNullOrUndefined(this.parent.getEditPanel().querySelector(".e-video-focus"))||(sf.base.removeClass([this.parent.getEditPanel().querySelector(".e-video-focus")],"e-video-focus"),this.quickToolObj&&this.quickToolObj.hideVideoQTBar())},n.prototype.onToolbarAction=function(e){switch(this.quickToolObj&&(this.quickToolObj.hideVideoQTBar(),sf.base.removeClass([e.selectNode[0]],"e-video-focus")),this.selectionObj=e,C()&&this.parent.observer.notify(l,{}),e.args.item.subCommand){case"VideoReplace":this.parent.observer.notify("insertVideo",e);break;case"VideoRemove":this.parent.observer.notify("delete",e);break;case"VideoDimension":this.parent.observer.notify("videoSize",e)}},n.prototype.deleteVid=function(t,n){if("VIDEO"===t.selectNode[0].nodeName||this.isEmbedVidElem(t.selectNode[0])){var i={src:t.selectNode[0].getAttribute("src")};0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.selection.restore(),this.parent.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle(),this.parent.formatter.process(this.parent,t.args,t.args,{selectNode:t.selectNode,captionClass:e,subCommand:t.args.item.subCommand}),this.quickToolObj&&this.quickToolObj.hideVideoQTBar(),this.cancelResizeAction(),sf.base.isNullOrUndefined(n)&&this.parent.mediaDeleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("MediaDeleted",i)}},n.prototype.videoSize=function(e){if("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0])){var t=e.selectNode[0],n=this.isEmbedVidElem(t)&&e.selectNode[1]?e.selectNode[1].style.width:"",i="auto"===t.style.width.toString()||t.style.width.toString()?t.style.width.toString():""!==n?n:parseInt(t.getClientRects()[0].width.toString(),10).toString(),s=this.isEmbedVidElem(t)&&e.selectNode[1]?e.selectNode[1].style.height:"",r="auto"===t.style.height.toString()||t.style.height.toString()?t.style.height.toString():""!==s?s:parseInt(t.getClientRects()[0].height.toString(),10).toString();""===t.style.width&&""===n&&(i="auto"),""===t.style.height&&""===s&&(r="auto");var o={mode:"Dimension",width:i,height:r,maxWidth:parseFloat(this.getMaxWidth())};this.parent.dotNetRef.invokeMethodAsync("ShowVideoDialog",o)}},n.prototype.insertVideoSize=function(e,t){this.selectionObj.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.parent.formatter.process(this.parent,this.selectionObj.args,this.selectionObj.args,{width:e,height:t,selectNode:this.selectionObj.selectNode,subCommand:this.selectionObj.args.item.subCommand}),this.vidResizeDiv&&this.vidResizePos(this.selectionObj.selectNode[0],this.vidResizeDiv),this.parent.dotNetRef.invokeMethodAsync("CloseVideoDialog",null)},n.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Videos"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),s={args:e,selectNode:i=this.isEmbedVidElem(i[0])?i:[this.vidEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"JustifyLeft":this.alignVideo(s,"JustifyLeft");break;case"JustifyCenter":this.alignVideo(s,"JustifyCenter");break;case"JustifyRight":this.alignVideo(s,"JustifyRight");break;case"Inline":this.inline(s);break;case"Break":this.break(s)}this.quickToolObj&&(this.quickToolObj.hideVideoQTBar(),sf.base.removeClass([i[0]],"e-video-focus")),this.cancelResizeAction()}},n.prototype.alignVideo=function(e,t){var n=e.args.item?e.args.item.subCommand:t;this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:n})},n.prototype.inline=function(e){if("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0])){var t=e.args.item?e.args.item.subCommand:"Inline";this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})}},n.prototype.break=function(e){if("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0])){var t=e.args.item?e.args.item.subCommand:"Break";this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})}},n.prototype.videoBrowseClick=function(){document.getElementById(this.rteId+"_video").querySelector(".e-rte-video-dialog .e-file-select-wrap button").click()},n.prototype.dialogOpened=function(){var e=sf.base.Browser.isDevice||sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-video-dialog .e-video-content"))?document.getElementById(this.rteId+"_video").querySelector(".e-video-content"):this.parent.element.querySelector(".e-rte-video-dialog .e-video-content");if(!sf.base.isNullOrUndefined(e)){var t=document.getElementById(this.rteId+"_dropText"),n=document.getElementById(this.rteId+"_insertVideo");this.buttonClickElement=sf.base.Browser.isDevice?t:n,sf.base.EventHandler.add(this.buttonClickElement,"click",this.videoBrowseClick,this),sf.base.isNullOrUndefined(this.parent.insertVideoSettings.path)&&"HTML"!==this.parent.editorMode?e.querySelector(".e-video-url").focus():e.querySelector("#"+this.rteId+"_insertVideo").focus()}},n.prototype.fileSelected=function(){this.inputUrl&&this.inputUrl.setAttribute("disabled","true"),this.embedInputUrl&&this.embedInputUrl.setAttribute("disabled","true")},n.prototype.fileUploadSuccess=function(e,t){this.inputUrl=this.parent.element.querySelector(".e-rte-video-dialog .e-video-url"),this.embedInputUrl=this.parent.element.querySelector(".e-rte-video-dialog .e-embed-video-url"),sf.base.isNullOrUndefined(this.parent.insertVideoSettings.path)||(this.uploadUrl={url:e,selection:this.vidUploadSave,fileName:t,selectParent:this.vidUploadSelectedParent,width:{width:this.parent.insertVideoSettings.width,minWidth:this.parent.insertVideoSettings.minWidth,maxWidth:this.getMaxWidth()},height:{height:this.parent.insertVideoSettings.height,minHeight:this.parent.insertVideoSettings.minHeight,maxHeight:this.parent.insertVideoSettings.maxHeight}},this.inputUrl&&this.inputUrl.setAttribute("disabled","true"),this.embedInputUrl&&this.embedInputUrl.setAttribute("disabled","true"))},n.prototype.fileUploadComplete=function(e,t){if(this.inputUrl=this.parent.element.querySelector(".e-rte-video-dialog .e-video-url"),"HTML"===this.parent.editorMode&&sf.base.isNullOrUndefined(this.parent.insertVideoSettings.path)){var n="Base64"===this.parent.insertVideoSettings.saveFormat?e:URL.createObjectURL(q(e));this.uploadUrl={url:n,selection:this.vidUploadSave,fileName:t,selectParent:this.vidUploadSelectedParent,width:{width:this.parent.insertVideoSettings.width,minWidth:this.parent.insertVideoSettings.minWidth,maxWidth:this.getMaxWidth()},height:{height:this.parent.insertVideoSettings.height,minHeight:this.parent.insertVideoSettings.minHeight,maxHeight:this.parent.insertVideoSettings.maxHeight}},this.inputUrl&&this.inputUrl.setAttribute("disabled","true"),this.embedInputUrl&&this.embedInputUrl.setAttribute("disabled","true")}},n.prototype.fileUploadChange=function(e,t){this.modifiedUrl=e,this.isStreamUrl=t},n.prototype.fileRemoving=function(){this.inputUrl.removeAttribute("disabled"),this.embedInputUrl.removeAttribute("disabled"),this.uploadUrl&&(this.uploadUrl.url="")},n.prototype.dialogClosed=function(){"HTML"===this.parent.editorMode&&this.selectionObj.selection.restore(),this.buttonClickElement&&sf.base.EventHandler.remove(this.buttonClickElement,"click",this.videoBrowseClick)},n.prototype.insertVideoUrl=function(){var e,t,n=this,i=this.parent.element.ownerDocument.querySelector("#"+this.rteId+"_video");if(sf.base.Browser.isDevice?(this.inputUrl=this.parent.inputElement.ownerDocument.querySelector("#"+this.rteId+"_video").querySelector(".e-rte-video-dialog .e-video-url"),this.embedInputUrl=this.parent.inputElement.ownerDocument.querySelector("#"+this.rteId+"_video").querySelector(".e-rte-video-dialog .e-embed-video-url")):(this.inputUrl=sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-video-dialog .e-video-url"))?i.querySelector(".e-rte-elements .e-rte-video-dialog .e-video-url"):this.parent.element.querySelector(".e-rte-video-dialog .e-video-url"),this.embedInputUrl=sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-video-dialog .e-embed-video-url"))?i.querySelector(".e-rte-elements .e-rte-video-dialog .e-embed-video-url"):this.parent.element.querySelector(".e-rte-video-dialog .e-embed-video-url")),sf.base.isNullOrUndefined(this.inputUrl)||(e=this.inputUrl.value),sf.base.isNullOrUndefined(this.embedInputUrl)||(t=this.embedInputUrl.value),this.isStreamUrl&&""!==this.modifiedUrl&&(this.uploadUrl.url=this.modifiedUrl,this.modifiedUrl=""),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),sf.base.isNullOrUndefined(this.uploadUrl)||""===this.uploadUrl.url){if(!("HTML"!==this.parent.editorMode||sf.base.isNullOrUndefined(e)&&sf.base.isNullOrUndefined(t))){if("HTML"===this.parent.editorMode&&sf.base.isNullOrUndefined(sf.base.closest(this.selectionObj.selection.range.startContainer.parentNode,"#"+this.parent.getPanel().id))){this.parent.getEditPanel().focus();var s=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());this.selectionObj.selection=this.parent.formatter.editorManager.nodeSelection.save(s,this.parent.getDocument()),this.selectionObj.selectParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(s)}var r=sf.base.isNullOrUndefined(e)?t:e.split("/")[e.split("/").length-1],o={cssClass:"inline"===this.parent.insertVideoSettings.layoutOption.toLowerCase()?"e-video-inline":"e-video-break",url:e,selection:this.selectionObj.selection,fileName:r,isEmbedUrl:!sf.base.isNullOrUndefined(t),selectParent:this.selectionObj.selectParent,width:{width:this.parent.insertVideoSettings.width,minWidth:this.parent.insertVideoSettings.minWidth,maxWidth:this.getMaxWidth()},height:{height:this.parent.insertVideoSettings.height,minHeight:this.parent.insertVideoSettings.minHeight,maxHeight:this.parent.insertVideoSettings.maxHeight}};this.parent.dotNetRef.invokeMethodAsync("CloseVideoDialog",null).then((function(){var e=n.parent.element.ownerDocument.querySelector("#"+n.rteId+"_video");sf.base.isNullOrUndefined(e)&&n.parent.formatter.process(n.parent,n.selectionObj.args,n.selectionObj.args.originalEvent,o)}))}}else this.uploadUrl.cssClass="inline"===this.parent.insertVideoSettings.layoutOption.toLowerCase()?"e-video-inline":"e-video-break",this.parent.dotNetRef.invokeMethodAsync("CloseVideoDialog",null).then((function(){var e=n.parent.element.ownerDocument.querySelector("#"+n.rteId+"_video");sf.base.isNullOrUndefined(e)&&(n.uploadUrl.isEmbedUrl=!1,n.parent.formatter.process(n.parent,n.selectionObj.args,n.selectionObj.args.originalEvent,n.uploadUrl),n.parent.getEditPanel().querySelector(".e-video-resize")&&(n.vidEle.style.outline="",n.removeResizeEle()))}))},n.prototype.showDialog=function(e,t,n,i,s){var r,o,a,l;e&&!sf.base.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.save(r,this.parent.getDocument()),a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(r),l=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(r)):(o=n,a=i,l=s),"HTML"===this.parent.editorMode&&this.videoDialog({args:{item:{command:"Videos",subCommand:"Video"},originalEvent:e?void 0:t,name:e?"showDialog":null},selectNode:a,selection:o,selectParent:l})},n.prototype.onCutHandler=function(){this.vidResizeDiv&&this.parent.getEditPanel().contains(this.vidResizeDiv)&&this.cancelResizeAction()},n.prototype.onIframeMouseDown=function(e){this.parent.dotNetRef.invokeMethodAsync("CloseVideoDialog",null),this.onDocumentClick(e)},n.prototype.onDocumentClick=function(e){var t=e.target;("VIDEO"===t.nodeName||this.isEmbedVidElem(t))&&(this.vidEle=this.isEmbedVidElem(t)?t.querySelector("iframe"):t);var n=document.body.querySelector("#"+this.rteId+"_video.e-rte-video-dialog");!sf.base.isNullOrUndefined(n)&&(!sf.base.closest(t,"#"+this.rteId+"_video")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!sf.base.closest(t,"#"+this.rteId+"_toolbar_Video")&&!t.querySelector("#"+this.rteId+"_toolbar_Video"))&&(e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.dotNetRef.invokeMethodAsync("CloseVideoDialog","Outside Click"),this.parent.isBlur=!0,sf.base.Browser.isIE&&ee(this.parent.element,"focusout"))),this.parent.getEditPanel().querySelector(".e-vid-resize")&&("VIDEO"===t.tagName||this.isEmbedVidElem(t)||this.removeResizeEle(),"VIDEO"===t.tagName||this.isEmbedVidElem(t)||sf.base.isNullOrUndefined(this.vidEle)?sf.base.isNullOrUndefined(this.prevSelectedVidEle)||this.prevSelectedVidEle===("IFRAME"===t.tagName||"VIDEO"===t.tagName?t:t.querySelector("iframe"))||(this.prevSelectedVidEle.style.outline=""):this.vidEle.style.outline=""),!this.parent.inlineMode.enable||sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(n)||sf.base.closest(t,"#"+this.rteId+"_video")||this.parent.dotNetRef.invokeMethodAsync("CloseVideoDialog","Outside Click")},n.prototype.videoClick=function(e){sf.base.Browser.isDevice&&("VIDEO"===e.target.tagName||this.isEmbedVidElem(e.target)?(this.parent.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.parent.getEditPanel().setAttribute("contenteditable","true")),("VIDEO"===e.target.tagName||this.isEmbedVidElem(e.target)&&!this.parent.userAgentData.isSafari())&&e.preventDefault()},n.prototype.onKeyDown=function(e){var t,n,i,s,r,o=e.args;this.deletedVid=[];if("HTML"===this.parent.editorMode&&(r=(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument())).startContainer===t.endContainer&&t.startOffset===t.endOffset),!r&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(o.which)<0)for(var a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),l=0;l<a.length;l++)"VIDEO"!==a[l].nodeName&&"IFRAME"!==a[l].nodeName||this.deletedVid.push(a[l]);if("HTML"===this.parent.editorMode&&(8===o.which&&"Backspace"===o.code||46===o.which&&"Delete"===o.code)){var d=t.startContainer===t.endContainer&&t.startOffset===t.endOffset;8===o.which&&"Backspace"===o.code&&d?this.checkVideoBack(t):46===o.which&&"Delete"===o.code&&d&&this.checkVideoDel(t)}if(!sf.base.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&"KeyK"!==o.code&&(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),s=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),!o.ctrlKey&&o.key&&(1===o.key.length||"enter"===o.action||37===o.keyCode||38===o.keyCode||39===o.keyCode||40===o.keyCode)&&("VIDEO"===s[0].tagName||this.isEmbedVidElem(s[0]))&&s[0].parentElement)){s[0].parentElement;this.parent.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle(),sf.base.removeClass([s[0]],"e-video-focus"),this.quickToolObj&&this.quickToolObj.hideVideoQTBar(),sf.base.isNullOrUndefined(this.vidEle)||(this.vidEle.style.outline="")}if(!o.ctrlKey||89!==o.keyCode&&90!==o.keyCode||this.undoStack({subCommand:90===o.keyCode?"undo":"redo"}),8===o.keyCode||46===o.keyCode){if(i&&i[0]&&("VIDEO"===i[0].nodeName||this.isEmbedVidElem(i[0])||46===o.keyCode&&i[0].nextSibling&&("e-video-wrap"===i[0].nextSibling.className||this.isEmbedVidElem(i[0].nextSibling))||8===o.keyCode&&i[0].previousSibling&&("e-video-wrap"===i[0].previousSibling.className||this.isEmbedVidElem(i[0].previousSibling)))&&i.length<=2&&"#text"!==i[0].nodeName){o.preventDefault();var c={selectNode:i,selection:n,selectParent:s,args:{item:{command:"Videos",subCommand:"Remove"},originalEvent:o}};this.deleteVid(c,o.keyCode)}this.parent.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle()}switch(o.action){case"escape":this.parent.dotNetRef.invokeMethodAsync("CloseVideoDialog",null);break;case"insert-video":this.showDialog(!1,o,n,i,s),o.preventDefault();break;case"backspace":case"delete":"Markdown"!==this.parent.editorMode&&(3===t.startContainer.nodeType?"Backspace"===o.code?t.startContainer.previousElementSibling&&0===t.startOffset&&t.startContainer.previousElementSibling.classList.contains("e-video-wrap")&&sf.base.detach(t.startContainer.previousElementSibling):t.startContainer.nextElementSibling&&t.endContainer.textContent.length===t.endOffset&&t.startContainer.nextElementSibling.classList.contains("e-video-wrap")&&sf.base.detach(t.startContainer.nextElementSibling):1===t.startContainer.nodeType&&t.startContainer.classList&&t.startContainer.classList.contains("e-video-wrap")?sf.base.detach(t.startContainer):1!==t.startContainer.nodeType||sf.base.isNullOrUndefined(t.startContainer.querySelector(".e-video-wrap"))||"Delete"!==o.code||sf.base.detach(t.startContainer.querySelector(".e-video-wrap")))}o.ctrlKey&&"a"===o.key&&this.handleSelectAll()},n.prototype.handleSelectAll=function(){this.cancelResizeAction();var e=this.parent.inputElement.querySelectorAll(".e-video-focus");sf.base.removeClass(e,"e-video-focus")},n.prototype.onKeyUp=function(e){if(!sf.base.isNullOrUndefined(this.deletedVid)&&this.deletedVid.length>0)for(var t=0;t<this.deletedVid.length;t++){var n={src:this.deletedVid[t].getAttribute("src")};this.parent.mediaDeleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("MediaDeleted",n)}},n.prototype.resizeStart=function(e,t){var n=this;if(!this.parent.readonly){var i=t||(this.isEmbedVidElem(e.target)?e.target.querySelector("iframe"):e.target);if(this.prevSelectedVidEle=this.vidEle,"VIDEO"===i.tagName||"IFRAME"===i.tagName){this.parent.preventDefaultResize(e,!1);var s=i;this.vidResizeDiv&&this.parent.getEditPanel().contains(this.vidResizeDiv)&&sf.base.detach(this.vidResizeDiv),this.videoResize(s)}if(i.classList.contains("e-rte-videoboxmark")){if(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),e.preventDefault(),e.stopImmediatePropagation(),this.resizeBtnInit(),this.quickToolObj&&this.quickToolObj.hideVideoQTBar(),i.classList.contains("e-rte-topLeft")&&(this.resizeBtnStat.topLeft=!0),i.classList.contains("e-rte-topRight")&&(this.resizeBtnStat.topRight=!0),i.classList.contains("e-rte-botLeft")&&(this.resizeBtnStat.botLeft=!0),i.classList.contains("e-rte-botRight")&&(this.resizeBtnStat.botRight=!0),sf.base.Browser.isDevice&&this.parent.getEditPanel().contains(this.vidResizeDiv)&&!this.vidResizeDiv.classList.contains("e-mob-span"))sf.base.addClass([this.vidResizeDiv],"e-mob-span");else{this.parent.onResizeStartEnabled&&this.parent.dotNetRef.invokeMethodAsync("ResizeStartEvent",{requestType:"Videos"}).then((function(e){e.cancel&&n.cancelResizeAction()}))}sf.base.EventHandler.add(this.parent.getDocument(),sf.base.Browser.touchEndEvent,this.resizeEnd,this)}}},n.prototype.resizing=function(e){this.vidEle.offsetWidth>=this.getMaxWidth()&&(this.vidEle.style.maxHeight=this.vidEle.offsetHeight+"px");var t=this.getPointX(e),n=this.getPointY(e),i=this.resizeBtnStat.botLeft||this.resizeBtnStat.topLeft?-(t-this.pageX):t-this.pageX,s=this.resizeBtnStat.topLeft||this.resizeBtnStat.topRight?-(n-this.pageY):n-this.pageY,r=parseInt(this.vidDupPos.width,10)+i,o=parseInt(this.vidDupPos.height,10)+s;this.pageX=t,this.pageY=n,this.mouseX=i,(this.resizeBtnStat.botRight||this.resizeBtnStat.botLeft||this.resizeBtnStat.topRight||this.resizeBtnStat.topLeft)&&this.vidDupMouseMove(r+"px",o+"px",e)},n.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.vidEle.parentElement.style.cursor="auto",sf.base.Browser.isDevice&&sf.base.removeClass([e.target.parentElement],"e-mob-span");this.parent.onResizeStopEnabled&&this.parent.dotNetRef.invokeMethodAsync("ResizeStopEvent",{requestType:"Videos"}),this.parent.formatter.editorManager.observer.on(u,this.undoStack,this),this.parent.formatter.saveData()},n.prototype.destroy=function(){this.prevSelectedVidEle=void 0,this.removeEventListener()},n}(),Ct=function(){return(Ct=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},Nt=function(){function e(){}return e.prototype.process=function(e,t,n,i){var s,r=this,o=e.getDocument().getSelection(),a=o.rangeCount>0?o.getRangeAt(o.rangeCount-1):null,l=!sf.base.isNullOrUndefined(i)&&!sf.base.isNullOrUndefined(i.cssClass)&&"e-video-inline"!==i.cssClass;if("HTML"===e.editorMode&&(sf.base.isNullOrUndefined(t)||l||(sf.base.isNullOrUndefined(t)&&sf.base.isNullOrUndefined(t.name)||!sf.base.isNullOrUndefined(t.name)&&"showDialog"!==t.name&&(!/Version\/\d+\.\d+.*Safari/.test(navigator.userAgent)||"Table"!==t.item.command))&&(s=this.editorManager.nodeSelection.save(a,e.getDocument()))),sf.base.isNullOrUndefined(t)||!t.item.command||"Table"===t.item.command||"Actions"===t.item.command||"Links"===t.item.command||"Images"===t.item.command||"Audios"===t.item.command||"Videos"===t.item.command||!a||e.getEditPanel().contains(this.getAncestorNode(a.commonAncestorContainer))||e.getEditPanel()===a.commonAncestorContainer||e.getPanel()===a.commonAncestorContainer){if(!sf.base.isNullOrUndefined(t)&&-1!==e.maxLength&&!sf.base.isNullOrUndefined(t.item.command)){var d=0;"Links"===t.item.command&&(d=0===i.text.length?i.url.length:i.text.length),"Images"!==t.item.command&&"Videos"!==t.item.command&&"Table"!==t.item.command&&"Files"!==t.item.command||(d=1);var c=e.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length,h=c-e.getSelection().length+d;if(!(-1===e.maxLength||h<=e.maxLength)||-1!==e.maxLength&&c>e.maxLength&&"Undo"!==t.item.subCommand&&"Redo"!==t.item.subCommand)return}if(sf.base.isNullOrUndefined(t)){var p=n.action;t={};var u={originalEvent:n,cancel:!1,requestType:p||n.key+"Key"};if(sf.base.extend(t,t,u,!0),delete t.item,t.originalEvent=Ct(Ct({},t.originalEvent),{target:null}),"tab"!==p&&"enter"!==p&&"space"!==p&&"escape"!==p){"Markdown"===e.editorMode&&"insert-table"===p&&(i={headingText:e.localeData.headingText,colText:e.localeData.colText});var f=o.rangeCount>0?o.getRangeAt(o.rangeCount-1):null,m=f?f.commonAncestorContainer:null;e.actionBeginEnabled&&("backspace"!==p&&"delete"!==p||m&&m.nodeType===Node.ELEMENT_NODE&&m.querySelectorAll("img, audio, video").length>0)&&e.dotNetRef.invokeMethodAsync("ActionBeginEvent",t).then((function(e){t.cancel&&("paste"!==p&&"cut"!==p&&"copy"!==p||n.preventDefault())}))}if(!t.cancel){var g=!!sf.base.isNullOrUndefined(e.tableModule)||!!e.tableModule&&(e.tableModule.tableObj&&e.tableModule.tableObj.ensureInsideTableList);(9===n.which&&g||9!==n.which)&&(13===n.which&&"HTML"===e.editorMode&&(i={enterAction:e.enterKey}),this.editorManager.observer.notify("keydown"===n.type?"keydown":"keyup",{event:n,callBack:this.onSuccess.bind(this,e),value:i,enterAction:e.enterKey,enableTabKey:e.enableTabKey,maxLength:e.maxLength}))}}else!sf.base.isNullOrUndefined(t)&&t.item.command&&t.item.subCommand&&(t.item.command!==t.item.subCommand&&"Font"!==t.item.command&&"Export"!==t.item.command||("FontName"===t.item.subCommand||"FontSize"===t.item.subCommand)&&"dropDownSelect"===t.name||("BackgroundColor"===t.item.subCommand||"FontColor"===t.item.subCommand)&&"colorPickerChanged"===t.name||"FormatPainter"===t.item.subCommand||"CodeBlock"===t.item.subCommand)&&(t.originalEvent=Ct(Ct({},t.originalEvent),{target:null}),sf.base.extend(t,t,{requestType:t.item.subCommand,cancel:!1},!0),e.actionBeginEnabled?e.dotNetRef.invokeMethodAsync("ActionBeginEvent",t).then((function(o){o.cancel||r.actionBeginCallBack(e,t,s,n,i)})):this.actionBeginCallBack(e,t,s,n,i));!(sf.base.isNullOrUndefined(n)||n&&"copy"!==n.action)||n&&n.shiftKey&&"Tab"===n.key||this.enableUndo(e)}},e.prototype.getAncestorNode=function(e){return e=3===e.nodeType?e.parentNode:e},e.prototype.onKeyHandler=function(e,t){var n=this;this.editorManager.observer.notify("keyup",{event:t,callBack:function(){e.observer.notify("content-changed",{}),n.enableUndo(e)},enterAction:e.enterKey})},e.prototype.onSuccess=function(e,t){var n=this;e.observer.notify("content-changed",{}),t&&(sf.base.isNullOrUndefined(t.event)||"copy"!==t.event.action)&&("Paste"===t.requestType?(e.observer.notify("execCommandCallBack",t),this.enableUndo(e)):(this.enableUndo(e),e.observer.notify("execCommandCallBack",t))),t.event=Ct(Ct({},t.event),{target:null}),this.successArgs=Ct({},t),delete t.elements,delete t.range;var i=e.getDocument().getSelection(),s=i.rangeCount>0?i.getRangeAt(i.rangeCount-1):null,r=s?s.commonAncestorContainer:null;e.actionCompleteEnabled&&("delete"!==t.requestType||r&&r.nodeType===Node.ELEMENT_NODE&&r.querySelectorAll("img, audio, video").length>0)?e.dotNetRef.invokeMethodAsync("ActionCompleteEvent",t).then((function(t){n.actionCompleteCallBack(e,t)})):this.actionCompleteCallBack(e,t),"VideosPlayPause"===t.requestType&&e.observer.notify("editAreaClick",{args:{}})},e.prototype.saveData=function(e){this.editorManager.undoRedoManager.saveData(e)},e.prototype.getUndoStatus=function(){return this.editorManager.undoRedoManager.getUndoStatus()},e.prototype.getUndoRedoStack=function(){return this.editorManager.undoRedoManager.undoRedoStack},e.prototype.enableUndo=function(e){var t=this.getUndoStatus();e.undoRedoStatus&&(sf.base.isNullOrUndefined(this.enableUndoRedo)||t.undo!==this.enableUndoRedo.undo||t.redo!==this.enableUndoRedo.redo)&&(!e.inlineMode.enable||sf.base.Browser.isDevice&&!C()?e.toolbarModule&&(e.iframeSettings.enable?e.getPanel().ownerDocument.body.contains(e.element):e.getDocument().body.contains(e.element))&&e.dotNetRef.invokeMethodAsync("UpdateUndoRedoStatus",t):e.dotNetRef.invokeMethodAsync("UpdateUndoRedoStatus",t)),this.enableUndoRedo=t},e.prototype.actionBeginCallBack=function(e,t,n,i,s){0===this.getUndoRedoStack().length&&"Links"!==t.item.command&&"Images"!==t.item.command&&"Audios"!==t.item.command&&"Videos"!==t.item.command&&this.saveData(),e.isBlur=!1,(sf.base.isNullOrUndefined(n)||sf.base.isNullOrUndefined(sf.base.closest(n.range.startContainer.parentElement,".e-img-caption"))||"false"!==sf.base.closest(n.range.startContainer.parentElement,".e-img-caption").getAttribute("contenteditable"))&&e.getEditPanel().focus({preventScroll:!0});var r=!sf.base.isNullOrUndefined(s)&&!sf.base.isNullOrUndefined(s.cssClass)&&"e-video-inline"!==s.cssClass;"HTML"!==e.editorMode||r||!sf.base.isNullOrUndefined(t.selectType)&&(sf.base.isNullOrUndefined(t.selectType)||"showDialog"===t.selectType)||sf.base.isNullOrUndefined(n)||n.restore();var o=t.item.subCommand.toLocaleLowerCase();"paste"===o||"cut"===o||"copy"===o?e.clipboardAction(o,i):(this.editorManager.observer.notify(u,{subCommand:t.item.subCommand}),this.editorManager.execCommand(t.item.command,t.item.subCommand,i,this.onSuccess.bind(this,e),t.item.value,"Pre"===t.item.subCommand&&"dropDownSelect"===t.name?{name:t.name}:s,"# iframe",e.enterKey))},e.prototype.actionCompleteCallBack=function(e,t){if(e.setPlaceHolder(),"Images"===t.requestType||"Audios"===t.requestType||"Videos"===t.requestType||"Links"===t.requestType&&"HTML"===t.editorMode){var n=this.successArgs;if("Links"===t.requestType&&t.event&&"keydown"===t.event.type&&32===t.event.keyCode)return;e.observer.notify("insertCompleted",{args:n.event,type:t.requestType,isNotify:!0,elements:n.elements})}e.autoResize()},e.prototype.getCurrentStackIndex=function(){return this.editorManager.undoRedoManager.getCurrentStackIndex()},e.prototype.clearUndoRedoStack=function(){this.editorManager.undoRedoManager.clear()},e}(),Et=(oe=function(e,t){return(oe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}oe(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),St=function(e){function t(t){var n=e.call(this)||this;return n.initialize(),sf.base.extend(n,n,t,!0),n.currentDocument&&n.element&&n.updateFormatter(n.element,n.currentDocument,t.options,t.formatPainterSettings),n}return Et(t,e),t.prototype.initialize=function(){this.keyConfig=Se},t.prototype.updateFormatter=function(e,t,n,i){e&&t&&(this.editorManager=new Je({document:t,editableElement:e,options:n,formatPainterSettings:i}))},t}(Nt),Tt=function(){function e(e){this.parent=e,this.toolbarStatus=this.prevToolbarStatus={bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,unorderedlist:!1,numberFormatList:!1,bulletFormatList:!1,underline:!1,alignments:null,backgroundcolor:null,fontcolor:null,fontname:null,fontsize:null,formats:null,createlink:!1,insertcode:!1,blockquote:!1,inlinecode:!1,isCodeBlock:!1,isCheckList:!1},this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("toolbar-refresh",this.onRefreshHandler,this),this.parent.observer.on(i,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("toolbar-refresh",this.onRefreshHandler),this.parent.observer.off(i,this.removeEventListener),this.debounceTimer=null},e.prototype.onRefreshHandler=function(e){var t=this;this.parent.readonly||(!(!e.args||!e.args.isKeyboardEvent)?(clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout((function(){t.getToolbarStatus(e)}),100)):(clearTimeout(this.debounceTimer),this.getToolbarStatus(e)))},e.prototype.getToolbarStatus=function(e){if(!this.parent.readonly){var t=[],n=[],i=[];this.parent.fontSize.items.forEach((function(e){t.push(e.value)})),this.parent.fontFamily.items.forEach((function(e){n.push(e.value)})),this.parent.format.items.forEach((function(e){i.push(e.value.toLocaleLowerCase())})),this.toolbarStatus=ct.get(this.parent.getDocument(),this.parent.getEditPanel(),i,t,n,e.documentNode);var s=JSON.stringify(this.toolbarStatus);this.parent.observer.notify("toolbar-updated",this.toolbarStatus),JSON.stringify(this.prevToolbarStatus)!==s&&(this.parent.observer.notify("updateTbItemsStatus",{html:JSON.parse(s),markdown:null}),this.prevToolbarStatus=JSON.parse(s))}},e}(),Lt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("xhtmlValidation",this.enableXhtmlValidation,this),this.parent.observer.on(i,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("xhtmlValidation",this.enableXhtmlValidation),this.parent.observer.off(i,this.removeEventListener)},e.prototype.enableXhtmlValidation=function(){this.parent.enableXhtml&&(sf.base.isNullOrUndefined(this.parent.inputElement)?this.currentElement=this.parent.element:this.currentElement=this.parent.inputElement,this.clean(this.currentElement),this.ImageTags(),this.removeTags(),this.RemoveUnsupported(),this.currentElement.innerHTML=this.selfEncloseValidation(this.currentElement.innerHTML))},e.prototype.selfEncloseValidation=function(e){var t;e=e.replace(/<br>/g,"<br/>").replace(/<hr>/g,"<hr/>").replace(/ /g," ");for(var n=[],i=[],s=[/<img(.*?)>/gi,/<area(.*?)>/gi,/<base(.*?)>/gi,/<col (.*?)>/gi,/<embed(.*?)>/gi,/<input(.*?)>/gi,/<link(.*?)>/gi,/<meta(.*?)>/gi,/<param(.*?)>/gi,/<source(.*?)>/gi,/<track(.*?)>/gi,/<wbr(.*?)>/gi],r=0;r<s.length;r++){for(t=s[r].exec(e);null!==t;)n.push(t[0].toString()),t=s[r].exec(e);i=n.slice(0);for(var o=0;o<n.length;o++)-1!==n[o].indexOf("/")&&n[o].lastIndexOf("/")===n[o].length-2||(n[o]=n[o].substring(0,n[o].length-1)+" /"+n[o].substring(n[o].length-1,n[o].length));for(var a=0;a<=n.length-1;a++)e=e.replace(i[a],n[a])}return e},e.prototype.clean=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];8===n.nodeType||"V:IMAGE"===n.nodeName?(e.removeChild(n),t--):1===n.nodeType&&this.clean(n)}return this.currentElement.innerHTML},e.prototype.ImageTags=function(){for(var e=this.currentElement.querySelectorAll("IMG"),t=e.length-1;t>=0;t--){if(!e[t].hasAttribute("alt"))e[t].setAttribute("alt","")}},e.prototype.removeTags=function(){for(var e=[["br","ul"],["br","ol"],["table","span"],["div","span"],["p","span"]],t=0;t<e.length;t++)this.RemoveElementNode(e[t][0],e[t][1])},e.prototype.RemoveElementNode=function(e,t){for(var n=this.currentElement.querySelectorAll(t),i=0;i<n.length;i++)for(var s=n[i].querySelectorAll(e),r=s.length;r>0;r--)sf.base.detach(s[r-1])},e.prototype.RemoveUnsupported=function(){for(var e=this.currentElement.querySelectorAll("u"),t=e.length-1;t>=0;t--){var n=document.createElement("span");n.style.textDecoration="underline",n.innerHTML=e[t].innerHTML,e[t].parentNode.insertBefore(n,e[t]),sf.base.detach(e[t])}var i=this.currentElement.querySelectorAll("strong");for(t=i.length-1;t>=0;t--){var s=document.createElement("b");s.innerHTML=i[t].innerHTML,i[t].parentNode.insertBefore(s,i[t]),sf.base.detach(i[t])}var r=["language","role","target","contenteditable","cellspacing","cellpadding","border","valign","colspan"];for(t=0;t<=r.length;t++)this.RemoveAttributeByName(r[t])},e.prototype.RemoveAttributeByName=function(e){if(null!==this.currentElement.firstChild&&3!==this.currentElement.firstChild.nodeType)for(var t=0;t<this.currentElement.childNodes.length;t++){var n=this.currentElement.childNodes[t];if(3!==n.nodeType&&"TABLE"!==n.nodeName&&"TBODY"!==n.nodeName&&"THEAD"!==n.nodeName&&"TH"!==n.nodeName&&"TR"!==n.nodeName&&"TD"!==n.nodeName&&(n.hasAttribute(e)&&n.removeAttribute(e),n.hasChildNodes()))for(var i=0;i<n.childNodes.length;i++){var s=n.childNodes[i];if(3!==s.nodeType&&"TABLE"!==s.nodeName&&"TBODY"!==s.nodeName&&"THEAD"!==s.nodeName&&"TH"!==s.nodeName&&"TR"!==s.nodeName&&"TD"!==s.nodeName&&s.hasAttribute(e)&&!s.classList.contains("e-mention-chip")&&s.removeAttribute(e),s.hasChildNodes())for(var r=0;r<s.childNodes.length;r++)3!==s.childNodes[r].nodeType&&"TABLE"!==s.childNodes[r].nodeName&&"TBODY"!==s.childNodes[r].nodeName&&"THEAD"!==s.childNodes[r].nodeName&&"TH"!==s.childNodes[r].nodeName&&"TR"!==s.childNodes[r].nodeName&&"TD"!==s.childNodes[r].nodeName&&s.childNodes[r].hasAttribute(e)&&s.childNodes[r].removeAttribute(e)}}},e}(),Ot=function(){function e(e){this.rangeCollection=[],this.isImageDelete=!1,this.isMention=!1,this.isPreviousNodeBrAfterBackSpace=!1,this.parent=e,this.xhtmlValidation=new Lt(e),this.addEventListener()}return e.prototype.addEventListener=function(){this.nodeSelectionObj=new et(this.parent.inputElement),this.parent.observer.on("html-toolbar-click",this.onToolbarClick,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on(r,this.onKeyUp,this),this.parent.observer.on(t,this.render,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on("selectAll",this.selectAll,this),this.parent.observer.on("selectRange",this.selectRange,this),this.parent.observer.on("getSelectedHtml",this.getSelectedHtml,this),this.parent.observer.on(a,this.onSelectionSave,this),this.parent.observer.on(l,this.onSelectionRestore,this),this.parent.observer.on("readOnlyMode",this.updateReadOnly,this),this.parent.observer.on(h,this.onPaste,this),this.parent.observer.on("tableclass",this.isTableClassAdded,this),this.parent.observer.on("onHandleFontsizeChange",this.onHandleFontsizeChange,this),this.parent.observer.on("hideToolTip",this.hideTooltip,this),this.parent.observer.on("beforeDropDownClose",this.mouseOutEventHandler,this)},e.prototype.isTableClassAdded=function(){for(var e=this.parent.inputElement.querySelectorAll("table"),t=0;t<e.length;t++)e[t].classList.length>0&&e[t].classList.contains("e-rte-custom-table")||e[t].classList.contains("e-rte-table")||e[t].classList.contains("e-rte-paste-table")||e[t].classList.add("e-rte-table")},e.prototype.sanitizeHelper=function(e){return e=K(e,this.parent)},e.prototype.updateReadOnly=function(){this.parent.readonly?(sf.base.attributes(this.parent.getEditPanel(),{contenteditable:"false"}),sf.base.addClass([this.parent.element],"e-rte-readonly")):(sf.base.attributes(this.parent.getEditPanel(),{contenteditable:"true"}),sf.base.removeClass([this.parent.element],"e-rte-readonly"))},e.prototype.onSelectionSave=function(){var e=this.parent.getDocument(),t=this.nodeSelectionObj.getRange(e);this.saveSelection=this.nodeSelectionObj.save(t,e)},e.prototype.onSelectionRestore=function(e){this.parent.isBlur=!1,this.parent.getEditPanel().focus({preventScroll:!0}),(sf.base.isNullOrUndefined(e.items)||e.items)&&this.saveSelection.restore()},e.prototype.onKeyUp=function(e){var t,n=e.args,i=this.parent.getRange(),s=new RegExp("​","g"),r=i.startContainer===i.endContainer&&i.startOffset===i.endOffset&&1===i.startOffset&&1===i.startContainer.textContent.length&&8203===i.startContainer.textContent.charCodeAt(0)&&0===i.startContainer.textContent.replace(s,"").length,o=!1;if(i.startContainer===i.endContainer&&i.startOffset===i.endOffset&&i.startContainer!==this.parent.inputElement&&0!==i.startOffset){var a=3===i.startContainer.nodeType?i.startContainer:i.startContainer.childNodes[i.startOffset-1];o=16===n.keyCode&&8203===a.textContent.charCodeAt(0)&&!sf.base.isNullOrUndefined(a.previousSibling)&&"false"===a.previousSibling.contentEditable}var l=!1;if([8,9,13,17,18,20,27,36,37,38,39,40,44,45,46,91,112,113,114,115,116,117,118,119,120,121,122,123].indexOf(n.keyCode)<0&&!n.shiftKey&&!n.ctrlKey&&!n.altKey&&!r&&!o){if(t=i.startOffset,"#text"===i.startContainer.nodeName?i.startContainer.parentElement!==this.parent.inputElement?i.startContainer.parentElement.classList.add("currentStartMark"):l=!0:i.startContainer.classList.add("currentStartMark"),8203===i.startContainer.textContent.charCodeAt(0)){var d=i.startContainer.textContent.length,c=i.startOffset;this.removeZeroWidthSpaces(i.startContainer,s),t=0===c?c:c-(d-i.startContainer.textContent.length),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),i.startContainer,t)}var h=this.parent.inputElement.innerHTML.length,p=this.parent.inputElement.innerHTML.replace(s,"").length,u=i.startContainer;if(h>p&&!l){if(0!==u.textContent.trim().length&&u.previousSibling){var f=document.createElement("span");f.className="tempSpan",i.insertNode(f)}for(var m=this.parent.inputElement.firstChild;!sf.base.isNullOrUndefined(m);)"#text"!==m.nodeName?(m.textContent.replace(s,"").trim().length>0&&m.textContent.includes("​")&&this.removeZeroWidthSpaces(m,s),m=m.nextElementSibling):m=m.nextElementSibling;var g=this.parent.inputElement.querySelector(".tempSpan");if(g&&g.previousSibling&&0!==u.textContent.trim().length)u=g.previousSibling,t=g.previousSibling.textContent.length,g.parentNode.removeChild(g),g=null;var b=this.parent.inputElement.querySelector(".currentStartMark"),v=b?b.childNodes:[];if(v.length>1){for(var y=0;y<v.length;y++)if("#text"===v[y].nodeName&&0===v[y].textContent.length&&(sf.base.detach(v[y]),y--),!sf.base.isNullOrUndefined(v[y])&&u.textContent.replace(s,"")===v[y].textContent){var C=t<=u.textContent.indexOf("​");t=u.textContent.length>1?u.textContent===v[y].textContent||C?t:t-(u.textContent.length-u.textContent.replace(s,"").length):u.textContent.length,u=v[y]}}else 1===v.length&&u.textContent.replace(s,"")===v[0].textContent&&(u=v[0]);this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),u,t)}var N=this.parent.inputElement.querySelector(".currentStartMark");sf.base.isNullOrUndefined(N)||(N.classList.remove("currentStartMark"),""===N.getAttribute("class").trim()&&N.removeAttribute("class")),!sf.base.isNullOrUndefined(i.startContainer.previousSibling)&&!sf.base.isNullOrUndefined(i.startContainer.previousSibling.parentElement)&&i.startContainer.parentElement===i.startContainer.previousSibling.parentElement&&8203===i.startContainer.previousSibling.textContent.charCodeAt(0)&&i.startContainer.previousSibling.textContent.length<=1&&(i.startContainer.previousSibling.textContent=i.startContainer.previousSibling.textContent.replace(s,"")),8203===i.endContainer.textContent.charCodeAt(i.endOffset)&&(t=i.startOffset,i.endContainer.textContent=i.endContainer.textContent.replace(s,""),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),i.startContainer,t))}if("HTML"===this.parent.editorMode)switch(e.args.which){case 46:case 8:var E=this.parent.getEditPanel().childNodes;if(0===E.length||1===E.length&&0===E[0].childNodes.length&&("BR"===E[0].tagName||("P"===E[0].tagName||"DIV"===E[0].tagName)&&""===E[0].textContent)){var S=this.parent.getEditPanel();"DIV"===this.parent.enterKey?S.innerHTML="<div><br/></div>":"BR"===this.parent.enterKey?S.innerHTML="<br/>":S.innerHTML="<p><br/></p>",this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),S.childNodes[0].parentElement,0)}}},e.prototype.removeZeroWidthSpaces=function(e,t){var n=this;e.nodeType!==Node.TEXT_NODE?e.childNodes.forEach((function(e){n.removeZeroWidthSpaces(e,t)})):null!==e.textContent&&(e.textContent=e.textContent.replace(t,""))},e.prototype.onKeyDown=function(e){var t,n=this,i=e.args;if(this.parent.inputElement.querySelectorAll(".e-cell-select").length>1&&(8===i.keyCode||32===i.keyCode||13===i.keyCode||46===i.keyCode))return this.tableSelectionKeyAction(e),void this.parent.autoResize();if("chrome"===sf.base.Browser.info.name&&(t=this.parent.getRange(),this.backSpaceCleanup(e,t),this.deleteCleanup(e,t)),9===i.keyCode&&this.parent.enableTabKey){if(this.parent.formatter.saveData(e),!this.indentTab())return;if(!sf.base.isNullOrUndefined(i.target)&&sf.base.isNullOrUndefined(sf.base.closest(i.target,".e-rte-toolbar"))){var s=this.nodeSelectionObj.getRange(this.parent.getDocument()),r=this.nodeSelectionObj.getParentNodeCollection(s);if("LI"!==r[0].nodeName&&!sf.base.closest(r[0],"li")&&!sf.base.closest(r[0],"table")){i.preventDefault();var o=this.parent.getDocument().getSelection().getRangeAt(0),a=this.parent.formatter.editorManager.domNode.blockNodes();if("BR"===this.parent.enterKey)if(o.startOffset!==o.endOffset&&0===o.startOffset){var l=this.nodeSelectionObj.save(s,this.parent.getDocument());this.parent.formatter.editorManager.domNode.setMarker(l),a=this.parent.formatter.editorManager.domNode.blockNodes(),this.parent.formatter.editorManager.domNode.convertToBlockNodes(a,!1),this.marginTabAdd(i.shiftKey,a),(l=this.parent.formatter.editorManager.domNode.saveMarker(l)).restore()}else Pe.Insert(this.parent.getDocument(),"&nbsp;&nbsp;&nbsp;&nbsp;",this.parent.element),this.rangeCollection.push(this.nodeSelectionObj.getRange(this.parent.getDocument()));else o.startOffset!==o.endOffset&&0===o.startOffset?this.marginTabAdd(i.shiftKey,a):(Pe.Insert(this.parent.getDocument(),"&nbsp;&nbsp;&nbsp;&nbsp;",this.parent.element),this.rangeCollection.push(this.nodeSelectionObj.getRange(this.parent.getDocument())))}}this.parent.formatter.saveData(e)}if("space"===e.args.action){var d=this.parent.getRange(),c=d.startContainer.textContent.slice(0,d.startOffset),h=this.isOrderedList(c),p=this.isUnOrderedList(c),u=!1;if((h||p)&&(u=this.hasMultipleTextNode(d))&&!this.isMention){var f=d.startContainer;(f=this.parent.formatter.editorManager.domNode.getImmediateBlockNode(f)).childNodes.length>0&&!f.innerHTML.includes("<br>")&&(u=!1)}if(!u&&(h&&!p||p&&!h)){var m={callBack:null,event:e.args,name:"keydown-handler",enterKey:this.parent.enterKey,shiftEnterKey:this.parent.shiftEnterKey,maxLength:this.parent.maxLength};this.parent.dotNetRef.invokeMethodAsync("ActionBeginEvent",{requestType:h?"OL":"UL",cancel:!1}).then((function(e){e.cancel||(n.parent.formatter.editorManager.observer.notify("onBegin",m),n.parent.dotNetRef.invokeMethodAsync("ActionCompleteEvent",{editorMode:n.parent.editorMode,name:"ActionCompleteEvent",requestType:h?"OL":"UL"}))}))}}if("space"===e.args.action||"enter"===e.args.action||13===e.args.keyCode||/[^\w\s\\/\\.\\:@-]/g.test(e.args.key)){var g=this.parent.getRange(),b="#text"===g.endContainer.nodeName?g.endContainer.parentElement:g.endContainer,v=sf.base.closest(b,"a");if(sf.base.isNullOrUndefined(v)&&this.spaceLink(i),"HTML"===this.parent.editorMode){this.parent.observer.notify("enterHandler",{args:e.args}),E(this.parent.getDocument(),this.parent.inputElement);var y=this.parent.getRange(),C="#text"===y.startContainer.nodeName?y.getBoundingClientRect().bottom:y.startContainer.getBoundingClientRect().bottom,N=this.parent.element.getBoundingClientRect().bottom;!sf.base.isNullOrUndefined(y.startContainer)&&"auto"!==this.parent.height&&"#text"!==y.startContainer.nodeName&&!this.parent.iframeSettings.enable&&C>N&&(this.parent.element.querySelector(".e-content").scrollTop+=C-N)}}"chrome"!==sf.base.Browser.info.name||(sf.base.isNullOrUndefined(this.rangeElement)||sf.base.isNullOrUndefined(this.oldRangeElement))&&(sf.base.isNullOrUndefined(this.deleteRangeElement)||sf.base.isNullOrUndefined(this.deleteOldRangeElement))||"TD"===t.startContainer.parentElement.tagName||"TH"===t.startContainer.parentElement.tagName||(this.rangeElement=null,this.oldRangeElement=null,this.deleteRangeElement=null,this.deleteOldRangeElement=null,this.isImageDelete||i.preventDefault(),i.preventDefault())},e.prototype.indentTab=function(){var e=this.parent.maxLength,t=this.parent.getText().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length,n=this.parent.getSelection().length;return-1===e||t-n+4<=e},e.prototype.onHandleFontsizeChange=function(e){var t,n=e.args,i={name:"dropDownSelect",item:{command:"Font",subCommand:"FontSize"}},s=this.parent.fontSize.items;if(sf.base.isNullOrUndefined(document.getElementById(this.parent.id+"_toolbar_FontSize"))||sf.base.isNullOrUndefined(document.getElementById(this.parent.id+"_toolbar_FontSize").innerText)||""===document.getElementById(this.parent.id+"_toolbar_FontSize").innerText){var r=void 0,o=this.parent.getDocument().getSelection();r=o&&o.focusNode&&o.focusNode.parentElement?document.defaultView.getComputedStyle(o.focusNode.parentElement,null).getPropertyValue("font-size"):this.parent.fontSize.width;var a=(r=sf.base.isNullOrUndefined(r)?this.parent.fontSize.width:r).match(/^([\d.]+)(\D+)$/),l=parseInt(a[1],10),d=a[2],c=s[0].value.match(/^([\d.]+)(\D+)$/);if(c[2]===d){var h=s.findIndex((function(e){var t=e.value;return parseInt(t,10)>=l}));t=s[h].text}else{var p=this.convertFontSize(l,d,c[2]);h=s.findIndex((function(e){var t=e.value;return parseInt(t,10)>=p}));t=s[h].text}}else t=document.getElementById(this.parent.id+"_toolbar_FontSize").innerText;var u=s.findIndex((function(e){return e.text===("Font Size"===t?"Default":t)}));if("increase-fontsize"===n.action&&-1!==u)if(u>=s.length-1){var f=s[u].value.match(/^([\d.]+)(\D+)$/);if(f){var m=parseInt(f[1],10),g=(d=f[2],m%10==0?10*Math.ceil((m+1)/10):10*Math.ceil(m/10));i.item.value=g.toLocaleString()+d,i.item.text=g.toLocaleString()+" "+d}this.parent.fontSize.items.push(i.item)}else i.item.value=s[u+1].value,i.item.text=s[u+1].text;else"decrease-fontsize"===n.action&&-1!==u&&u>0?(i.item.value=s[u-1].value,i.item.text=s[u-1].text):u>=0&&u<s.length&&s[u]&&(i.item.value=s[u].value,i.item.text=s[u].text);this.parent.formatter.process(this.parent,i,n)},e.prototype.convertFontSize=function(e,t,n){return-1===m.indexOf(t)&&-1===m.indexOf(n)||(t="px"),e*f[t][n]},e.prototype.isOrderedList=function(e){e=e.replace(/\u200B/g,"");var t=[/^[1]+[.]+$/,/^[i]+[.]+$/,/^[a]+[.]+$/];if(!sf.base.isNullOrUndefined(e))for(var n=0;n<t.length;n++)if(t[n].test(e))return!0;return!1},e.prototype.isUnOrderedList=function(e){e=e.replace(/\u200B/g,"");var t=[/^[*]$/,/^[-]$/];if(!sf.base.isNullOrUndefined(e))for(var n=0;n<t.length;n++)if(t[n].test(e))return!0;return!1},e.prototype.hasMultipleTextNode=function(e){if(this.isMention=!1,e&&e.startContainer&&e.startContainer.parentNode){var t=e.startContainer.parentNode;if(e.startContainer.previousElementSibling&&e.startContainer.previousElementSibling.classList.contains("e-mention-chip")&&!e.startContainer.previousElementSibling.isContentEditable)return this.isMention=!0,!0;if("BR"===this.parent.enterKey||sf.base.closest(t,"table"))return!1;for(var n=t.childNodes,i=[],s=0;s<n.length;s++){var r=n[s];if(r&&r.nodeType===Node.TEXT_NODE&&(i.push(r),i.length>1))return!0}}return!1},e.prototype.isCursorAtBlockStart=function(e){if(0!==e.startOffset||0!==e.endOffset)return!1;var t=e.startContainer,n=t.nodeType===Node.TEXT_NODE?t.parentElement:t;if("TD"===n.tagName||"TH"===n.tagName)return!1;var i=this.parent.formatter.editorManager.domNode.getImmediateBlockNode(n);if(t===i&&0===e.startOffset)return!0;for(var s=n,r=!1;s&&s!==i;){for(var o=s.previousSibling;o;){if(o.nodeType!==Node.TEXT_NODE||o.textContent&&o.textContent.trim()){r=!0;break}o=o.previousSibling}if(r)break;s=s.parentNode}return!r},e.prototype.backSpaceCleanup=function(e,t){var n=!1,i=!0;sf.base.isNullOrUndefined(t.startContainer.previousSibling)||"SPAN"!==t.startContainer.previousSibling.nodeName||(i="false"!==t.startContainer.previousSibling.contentEditable);var s="#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,r=!sf.base.closest("#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,"li")||"li"!==s.nodeName&&sf.base.isNullOrUndefined(s.previousSibling),o=this.isCursorAtBlockStart(t);if("Backspace"===e.args.code&&8===e.args.keyCode&&o&&" "!==t.startContainer.textContent&&" "!==t.startContainer.nodeValue&&0===this.parent.getSelection().length&&t.startContainer.textContent.length>0&&i&&r){if(!this.parent.formatter.editorManager.domNode.isBlockNode(s)&&!sf.base.isNullOrUndefined(s.previousSibling)&&"BR"===s.previousSibling.nodeName||!sf.base.isNullOrUndefined(t.startContainer.previousSibling)&&"BR"===t.startContainer.previousSibling.nodeName)return;var a=this.parent.formatter.editorManager.domNode.getImmediateBlockNode(t.startContainer),l=a!==this.parent.inputElement?a:t.startContainer,d=this.parent.formatter.editorManager.nodeSelection.findFirstContentNode(l),c=d&&d.node===("CODE"===t.startContainer.nodeName?t.startContainer.firstChild:t.startContainer)&&0===t.startOffset,h=this.parent.formatter.editorManager.codeBlockObj.findParentOrPreviousSiblingCodeBlock(t),p=this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(l);if(!sf.base.isNullOrUndefined(h)&&c||!sf.base.isNullOrUndefined(p)&&c)return;if(this.rangeElement=this.getRootBlockNode(t.startContainer),"OL"===this.rangeElement.tagName||"UL"===this.rangeElement.tagName){var u=this.getRangeLiNode(t.startContainer);u.previousElementSibling&&this.parent.inputElement.contains(u.previousElementSibling)&&u.previousElementSibling.childElementCount>0&&(this.oldRangeElement="BR"===u.previousElementSibling.lastElementChild.nodeName?u.previousElementSibling:u.previousElementSibling.lastChild,!sf.base.isNullOrUndefined(u.lastElementChild)&&"BR"!==u.lastElementChild.nodeName&&sf.base.isNullOrUndefined(u.lastElementChild.previousSibling)&&"#text"!==u.lastChild.nodeName?(this.rangeElement=u.lastElementChild,n=!0):this.rangeElement=u)}else{if(this.rangeElement===this.parent.inputElement||"TABLE"===this.rangeElement.tagName||!sf.base.isNullOrUndefined(this.rangeElement.previousElementSibling)&&"TABLE"===this.rangeElement.previousElementSibling.tagName)return;this.oldRangeElement=this.rangeElement.previousElementSibling}var f=this.parent.formatter.editorManager.domNode.blockNodes();!sf.base.isNullOrUndefined(f[0])&&t.collapsed&&0===t.startOffset&&0===t.endOffset&&""!==f[0].style.marginLeft&&(f[0].style.marginLeft=parseInt(f[0].style.marginLeft,10)<=20?"":parseInt(f[0].style.marginLeft,10)-20+"px");var m=f[0].previousSibling?f[0].previousSibling:this.findPreviousElementSibling(f[0]);if(sf.base.isNullOrUndefined(this.oldRangeElement)&&sf.base.isNullOrUndefined(f[0].previousSibling))return;if(m){var g=m,b=f[0];if(g.textContent.trim()){this.removeLastBr(g);var v=this.findLastTextPosition(g),C=v.offset,N=v.node,E=Array.from(b.childNodes),S=this.nodeSelectionObj.save(t,this.parent.getDocument());this.isPreviousNodeBrAfterBackSpace&&this.parent.formatter.editorManager.domNode.setMarker(S);for(var T=this.parent.formatter.editorManager.domNode.getImmediateBlockNode(N),L=0;L<E.length;L++)T.appendChild(E[L].cloneNode(!0));this.isPreviousNodeBrAfterBackSpace?(S=this.parent.formatter.editorManager.domNode.saveMarker(S)).restore():this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),N,C),b.parentNode.removeChild(b),e.args.preventDefault()}else g.parentNode.removeChild(g)}else{"OL"!==this.oldRangeElement.tagName&&"UL"!==this.oldRangeElement.tagName||(this.oldRangeElement=this.oldRangeElement.lastElementChild.lastElementChild?this.oldRangeElement.lastElementChild.lastElementChild:this.oldRangeElement.lastElementChild);for(var O=this.oldRangeElement.lastChild?this.oldRangeElement.lastChild:this.oldRangeElement;3!==O.nodeType&&"#text"!==O.nodeName&&"BR"!==O.nodeName&&!sf.base.isNullOrUndefined(O.lastChild);)O=O.lastChild;if("IMG"===O.nodeName?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),O.parentElement,O.parentElement.childNodes.length):this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),O,O.textContent.length),"#text"!==this.oldRangeElement.nodeName&&1===this.oldRangeElement.querySelectorAll("BR").length){var k=this.oldRangeElement.querySelector("BR");k&&sf.base.isNullOrUndefined(k.nextSibling)&&sf.base.detach(this.oldRangeElement.querySelector("BR"))}if(!sf.base.isNullOrUndefined(this.rangeElement)&&this.oldRangeElement!==this.rangeElement){for(;this.rangeElement.firstChild;)"#text"===this.oldRangeElement.nodeName?this.oldRangeElement.parentElement.appendChild(this.rangeElement.childNodes[0]):this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);n?sf.base.detach(this.rangeElement.parentElement):sf.base.detach(this.rangeElement),this.oldRangeElement.normalize()}}}if("Backspace"===e.args.code&&8===e.args.keyCode&&t.startContainer.nodeType!==Node.TEXT_NODE){var x=sf.base.isNullOrUndefined(t.startContainer.childNodes[t.startOffset-1])||sf.base.isNullOrUndefined(t.startContainer.childNodes[t.startOffset-1].isContentEditable)||t.startContainer.childNodes[t.startOffset-1].isContentEditable?null:t.startContainer.childNodes[t.startOffset-1],w=t.startOffset>1?t.startOffset-1:0;if(x)x.remove(),e.args.preventDefault();else if(s&&""===s.textContent.trim()||t.startContainer.childNodes[w]&&""===t.startContainer.childNodes[w].textContent.trim()){var A=s&&""===s.textContent.trim()?s:t.startContainer.childNodes[w];(function e(t,n){if(void 0===n&&(n=null),!t)return!1;var i=t.nodeName.toUpperCase();if(-1!==["TABLE","IMG","VIDEO","AUDIO"].indexOf(i))return!1;if(t.nodeType===Node.ELEMENT_NODE&&t.hasAttribute("style"))return!0;n||(n=new y);for(var s=0,r=["bold","italic","underline","strikethrough","superscript","subscript","fontcolor","fontname","fontsize","backgroundcolor","inlinecode"];s<r.length;s++){var o=r[s];if(n.isFormattedNode(t,o))return!0}for(var a=0;a<t.childNodes.length;a++)if(e(t.childNodes[a],n))return!0;return!1})(A)&&A.previousSibling&&""===A.previousSibling.textContent.trim()&&(this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),A.previousSibling,0),sf.base.detach(A),e.args.preventDefault())}}},e.prototype.findPreviousElementSibling=function(e){for(var t=e;t;){var n=t.previousElementSibling;if(n)return n;if((t=t.parentElement)&&t===this.parent.inputElement)return null}return null},e.prototype.getLastNode=function(e){for(;e&&e.lastChild;)e=e.lastChild;for(;e&&e.nodeType===Node.TEXT_NODE&&!e.nodeValue.trim();)e=e.previousSibling;return e},e.prototype.removeLastBr=function(e){var t=this.getLastNode(e);t&&"BR"===t.nodeName&&t.parentNode&&(this.isPreviousNodeBrAfterBackSpace=!sf.base.isNullOrUndefined(t.previousSibling)&&"BR"===t.previousSibling.nodeName,t.parentNode.removeChild(t))},e.prototype.findLastTextPosition=function(e){if(e.nodeType===Node.TEXT_NODE)return{node:e,offset:e.textContent?e.textContent.length:0};for(var t=e.childNodes.length-1;t>=0;t--){var n=this.findLastTextPosition(e.childNodes[t]);if(n)return n}return null},e.prototype.deleteCleanup=function(e,t){var n,i,s=!1,r=this.parent.formatter.editorManager.codeBlockObj.getCodeBlockPosition(t);if(("Delete"!==e.args.code||sf.base.isNullOrUndefined(this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(t.startContainer))&&(sf.base.isNullOrUndefined(r.nextSiblingCodeBlockElement)||!r.cursorAtLastPosition))&&"Delete"===e.args.code&&46===e.args.keyCode&&0!==this.parent.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length&&0===this.parent.getSelection().length&&"TD"!==t.startContainer.parentElement.tagName&&"TH"!==t.startContainer.parentElement.tagName){if(this.deleteRangeElement=i=this.getRootBlockNode(t.startContainer),"OL"===this.deleteRangeElement.tagName||"UL"===this.deleteRangeElement.tagName)(n=this.getRangeLiNode(t.startContainer)).nextElementSibling&&n.nextElementSibling.childElementCount>0&&!n.nextElementSibling.querySelector("BR")?sf.base.isNullOrUndefined(n.lastElementChild)?this.deleteRangeElement=n:(this.deleteRangeElement=n.lastElementChild,s=!0):this.deleteRangeElement=this.getRangeElement(n);else if(3===this.deleteRangeElement.nodeType||"TABLE"===this.deleteRangeElement.tagName||!sf.base.isNullOrUndefined(this.deleteRangeElement.nextElementSibling)&&"TABLE"===this.deleteRangeElement.nextElementSibling.tagName)return;if(this.getCaretIndex(t,this.deleteRangeElement)===this.deleteRangeElement.textContent.length){if(sf.base.isNullOrUndefined(n))this.deleteOldRangeElement=this.deleteRangeElement.nextElementSibling;else{var o=this.findNextHierarchySibling(n);this.deleteOldRangeElement=o?this.getRangeElement(o):i.nextElementSibling}if(sf.base.isNullOrUndefined(this.deleteOldRangeElement))return;0===t.startOffset&&1===t.endOffset&&this.deleteRangeElement.childNodes[0]&&"IMG"===this.deleteRangeElement.childNodes[0].nodeName?(this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.getDocument(),this.deleteRangeElement,this.deleteRangeElement,0,1),this.isImageDelete=!0):(this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),this.deleteRangeElement,this.deleteRangeElement.childNodes.length),this.isImageDelete=!1);var a=this.deleteRangeElement.querySelector("BR"),l=this.deleteRangeElement.lastChild,d=void 0;if(l&&(d=l.parentNode),a&&l&&"BR"===l.nodeName){if(sf.base.detach(l),sf.base.isNullOrUndefined(d)||0!==d.childNodes.length||sf.base.detach(d),!sf.base.isNullOrUndefined(this.deleteRangeElement)&&this.deleteOldRangeElement.tagName&&("OL"===this.deleteOldRangeElement.tagName||"UL"===this.deleteOldRangeElement.tagName)&&this.deleteOldRangeElement!==this.deleteRangeElement&&!this.parent.getEditPanel().contains(this.deleteRangeElement)){var c=this.deleteOldRangeElement.querySelector("li");if(c){for(var h=c;h&&h.firstChild&&h.firstChild.nodeType!==Node.TEXT_NODE;)h=h.firstChild;h&&h.firstChild&&h.firstChild.nodeType===Node.TEXT_NODE?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),h.firstChild,0):this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),c,0)}else this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.getDocument(),this.deleteOldRangeElement,this.deleteOldRangeElement,0,0)}e.args.preventDefault()}var p="SPAN"!==this.deleteOldRangeElement.tagName&&"e-img-resize"===this.deleteRangeElement.className,u=!sf.base.isNullOrUndefined(e.args)&&!sf.base.isNullOrUndefined(e.args.action)&&"delete"===e.args.action;if(!sf.base.isNullOrUndefined(this.deleteRangeElement)&&"OL"!==this.deleteOldRangeElement.tagName&&"UL"!==this.deleteOldRangeElement.tagName&&this.deleteOldRangeElement!==this.deleteRangeElement&&(p||u)&&"LI"!==this.deleteOldRangeElement.tagName&&this.deleteOldRangeElement!==this.deleteRangeElement&&this.parent.getEditPanel().contains(this.deleteRangeElement)){for(;this.deleteOldRangeElement.firstChild;)this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);s?sf.base.detach(this.deleteOldRangeElement.parentElement):sf.base.detach(this.deleteOldRangeElement),this.deleteRangeElement.normalize()}else this.deleteRangeElement=null,this.deleteOldRangeElement=null;if(t&&t.startContainer&&t.startContainer.nodeType!==Node.TEXT_NODE&&(t.startContainer.querySelector("video")||t.startContainer.querySelector("audio"))){this.nodeSelectionObj.restore();var f=this.nodeSelectionObj.getRange(this.parent.getDocument());this.nodeSelectionObj.save(f,this.parent.getDocument())}}else this.deleteRangeElement=null}},e.prototype.findNextHierarchySibling=function(e){if("LI"===e.nodeName){if(e.nextElementSibling)return e.nextElementSibling;var t=e.parentElement;if(t.nextElementSibling&&"LI"===t.nextElementSibling.nodeName)return t.nextElementSibling;if("UL"===t.tagName||"OL"===t.tagName){var n=t.parentElement;if(n&&n.nextElementSibling)return n.nextElementSibling;if(n&&"LI"===n.nodeName)return this.findNextHierarchySibling(n)}return null}return e.nextElementSibling},e.prototype.getCaretIndex=function(e,t){var n=0;if(0!==this.parent.getDocument().getSelection().rangeCount){var i=e.cloneRange();i.selectNodeContents(t),i.setEnd(e.endContainer,e.endOffset),n=i.toString().length}return n},e.prototype.getRangeElement=function(e){return e.childNodes.length<=1&&e.lastElementChild?"BR"===e.lastElementChild.tagName?e.lastElementChild.previousElementSibling?e.lastElementChild.previousElementSibling:e:e.lastElementChild:e},e.prototype.getRootBlockNode=function(e){for(;e&&this.parent&&this.parent.inputElement!==e&&e.parentElement!==this.parent.inputElement;e=e.parentElement);return e},e.prototype.getRangeLiNode=function(e){for(var t=e.parentElement;t!==this.parent.inputElement&&(1!==t.nodeType||"LI"!==t.tagName);)t=t.parentElement;return t},e.prototype.onPaste=function(e){var t=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi);if(e.text.match(t)){e.args.preventDefault();for(var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()),i=(this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.getDocument()),new RegExp(/([^\S]|^)(((https?:\/\/)))/gi)),s=new RegExp(/([^\S]|^)(((www\.))(\S+))/gi),r=e.text.split("\n"),o="",a=0;a<r.length;a++)if(""===r[a].trim())o+=$(this.parent);else{for(var l="",d=!0,c=r[a].split(" "),h=0;h<c.length;h++)""===c[h].trim()?l+=d?"&nbsp;":" ":(d=!1,l+=c[h]+" ");o+=0===a?"<span>"+l.trim()+"</span>":"<p>"+l.trim()+"</p>"}var p=document.createElement("div");p.setAttribute("class","pasteContent"),p.style.display="inline",p.innerHTML=o;var u=p.querySelectorAll("span, p");for(a=0;a<u.length;a++){var f=u[a].innerHTML.split(" "),m="";for(h=0;h<f.length;h++)f[h].match(i)||f[h].match(s)?m+='<a className="e-rte-anchor" href="'+f[h]+'" title="'+f[h]+'" target="_blank">'+f[h]+" </a>":m+=f[h]+" ";u[a].innerHTML=m.trim()}var g=p.childNodes[0];sf.base.isNullOrUndefined(g)||sf.base.isNullOrUndefined(g.childNodes[0])||"SPAN"!==g.nodeName||"A"!==g.childNodes[0].nodeName||(p.innerHTML=p.innerHTML.replace("<span>","").replace("</span>","")),e.callBack(p.innerHTML)}},e.prototype.spaceLink=function(e){var t=this.nodeSelectionObj.getRange(this.parent.getDocument());if(t.startContainer.nodeType===Node.TEXT_NODE){var n=this.nodeSelectionObj.getParentNodeCollection(t),i=t.startContainer.textContent.substring(0,t.endOffset),s=i.split(" "),r=s[s.length-1],o=t.startOffset-(i.length-s[s.length-1].length);r=r.slice(0,o);var a=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi);if(n[0]&&"A"!==n[0].nodeName&&r.match(a)){var l=this.nodeSelectionObj.save(t,this.parent.getDocument()),d={url:r.indexOf("http")>-1?r:"http://"+r,selection:l,selectParent:this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),text:r,title:"",target:"_blank"};this.parent.formatter.process(this.parent,{item:{command:"Links",subCommand:"CreateLink"}},e,d)}}},e.prototype.onToolbarClick=function(e){var t,n,i,s,r=e.item;"CodeBlock"!==r.subCommand&&(s=e.originalEvent.target);var o=s&&sf.base.closest(s,".e-rte-quick-popup");if("FormatPainter"===r.command)this.handleFormatPainterClick(e);else if(!o||o.classList.contains("e-rte-inline-popup")||o.classList.contains("e-rte-text-popup")){if("SourceCode"!==r.subCommand&&"Preview"!==r.subCommand&&"FontColor"!==r.subCommand&&"BackgroundColor"!==r.subCommand&&"NumberFormatList"!==r.subCommand&&"BulletFormatList"!==r.subCommand){a=this.nodeSelectionObj.getRange(this.parent.getDocument());t=this.nodeSelectionObj.save(a,this.parent.getDocument()),n=this.nodeSelectionObj.getNodeCollection(a),i=this.nodeSelectionObj.getParentNodeCollection(a)}switch(r.subCommand){case"Maximize":this.parent.observer.notify("enableFullScreen",{args:e});break;case"Minimize":this.parent.observer.notify("disableFullScreen",{args:e});break;case"CreateLink":this.parent.observer.notify("insertLink",{member:"link",args:e,selectNode:n,selection:t,selectParent:i});break;case"RemoveLink":this.parent.observer.notify("unLink",{member:"link",args:e,selectNode:n,selection:t,selectParent:i});break;case"Print":this.parent.print();break;case"ImportWord":this.parent.observer.notify("importWord",{member:"word",args:e,selectNode:n,selection:t,selectParent:i});break;case"Image":this.parent.observer.notify("insertImage",{member:"image",args:e,selectNode:n,selection:t,selectParent:i});break;case"Audio":this.parent.observer.notify("insertAudio",{member:"audio",args:e,selectNode:n,selection:t,selectParent:i});break;case"Video":this.parent.observer.notify("insertVideo",{member:"video",args:e,selectNode:n,selection:t,selectParent:i});break;case"CreateTable":this.parent.observer.notify("createTable",{member:"table",args:e,selection:t});break;case"SourceCode":this.parent.observer.notify("sourceCode",{member:"viewSource",args:e});break;case"Preview":this.parent.observer.notify("updateSource",{member:"updateSource",args:e});break;case"CodeBlock":this.parent.observer.notify("onCodeBlock",{member:"codeBlock",args:e});break;case"FontColor":case"BackgroundColor":break;default:this.parent.formatter.process(this.parent,e,e.originalEvent,null)}}else{if("SourceCode"!==r.subCommand&&"Preview"!==r.subCommand&&"FontColor"!==r.subCommand&&"BackgroundColor"!==r.subCommand){var a=this.nodeSelectionObj.getRange(this.parent.getDocument());!C()||"Images"!==r.command&&"Audios"!==r.command&&"Videos"!==r.command?"Audios"===r.command&&0!==this.nodeSelectionObj.startNodeName.length&&a.startContainer===this.nodeSelectionObj.range.startContainer&&this.nodeSelectionObj.restore():this.nodeSelectionObj.restore(),t=this.nodeSelectionObj.save(a,this.parent.getDocument()),n=this.nodeSelectionObj.getNodeCollection(a),i=this.nodeSelectionObj.getParentNodeCollection(a)}"Images"===r.command&&this.parent.observer.notify("image-toolbar-action",{member:"image",args:e,selectNode:n,selection:t,selectParent:i}),"Audios"===r.command&&this.parent.observer.notify("audio-toolbar-action",{member:"audio",args:e,selectNode:n,selection:t,selectParent:i}),"Videos"===r.command&&this.parent.observer.notify("video-toolbar-action",{member:"video",args:e,selectNode:n,selection:t,selectParent:i}),"Links"===r.command&&this.parent.observer.notify("link-toolbar-action",{member:"link",args:e,selectNode:n,selection:t,selectParent:i}),"Table"===r.command&&this.parent.observer.notify("table-toolbar-action",{member:"table",args:e,selectNode:n,selection:t,selectParent:i})}var l,d=this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument(),c=e.item;l="Lists"===r.command?"UL"===r.subCommand?d.querySelector(".e-rte-bulletformatlist-dropdown"):d.querySelector(".e-rte-numberformatlist-dropdown"):d.querySelector("."+c.icon),this.hideTooltip({target:l,isButton:!0})},e.prototype.handleFormatPainterClick=function(e){var t=this;1===e.originalEvent.detail?(clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout((function(){t.parent.observer.notify("formatPainterClick",{member:"formatPainter",args:e})}),200)):(clearTimeout(this.clickTimeout),this.parent.observer.notify("formatPainterDoubleClick",{member:"formatPainter",args:e}))},e.prototype.hideTooltip=function(e){var t=this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument();if(this.tooltipTargetElement=sf.base.closest(e.target,"[data-tooltip-id]"),!sf.base.isNullOrUndefined(this.tooltipTargetElement)&&!sf.base.isNullOrUndefined(t.querySelector(".e-tooltip-wrap"))){this.tooltipTargetElement.setAttribute("data-title",this.tooltipTargetElement.getAttribute("title")),e.isButton&&sf.base.EventHandler.add(this.tooltipTargetElement,"mouseout",this.mouseOutEventHandler,this);var n=new MouseEvent("mouseout",{bubbles:!0,cancelable:!0,view:window,relatedTarget:document.body});this.tooltipTargetElement.dispatchEvent(n)}},e.prototype.mouseOutEventHandler=function(){if(sf.base.isNullOrUndefined(this.tooltipTargetElement)){var e=this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument();this.tooltipTargetElement=e.querySelector("[data-title]"),this.tooltipTargetElement.setAttribute("title",this.tooltipTargetElement.getAttribute("data-title"))}else sf.base.EventHandler.remove(this.tooltipTargetElement,"mouseout",this.mouseOutEventHandler);this.tooltipTargetElement.removeAttribute("data-title")},e.prototype.render=function(){var e=this.parent.getEditPanel(),t={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};this.initializeFormatter(e,t),this.setupToolbar(),this.applyInlineStyles(e),this.parent.observer.notify(s,{})},e.prototype.initializeFormatter=function(e,t){var n={currentDocument:this.parent.getDocument(),element:e,options:t,formatPainterSettings:this.parent.formatPainterSettings};sf.base.isNullOrUndefined(this.parent.formatter)?this.parent.formatter=new St(n):this.parent.formatter.updateFormatter(e,this.contentRenderer.getDocument(),t,this.parent.formatPainterSettings)},e.prototype.setupToolbar=function(){this.parent.toolbarSettings.enable&&(this.toolbarUpdate=new Tt(this.parent))},e.prototype.applyInlineStyles=function(e){if(this.parent.inlineMode.enable){var t=this.parent,n=t.fontFamily,i=t.fontSize;sf.base.isNullOrUndefined(n.default)||(e.style.fontFamily=n.default),sf.base.isNullOrUndefined(i.default)||(e.style.fontSize=i.default)}},e.prototype.selectAll=function(){var e=function e(t,n){var i=[];for(n=n.firstChild;n;n=n.nextSibling)3===n.nodeType?i.push(n):i=i.concat(e(t,n));return i}(this.parent.getDocument(),this.parent.getEditPanel());e.length>0&&this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.getDocument(),e[0],e[e.length-1],0,e[e.length-1].textContent.length)},e.prototype.selectRange=function(e){this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.getDocument(),e.range)},e.prototype.getSelectedHtml=function(e){e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument()).toString())},e.prototype.removeEventListener=function(){this.parent.observer.off(t,this.render),this.parent.observer.off("html-toolbar-click",this.onToolbarClick),this.parent.observer.off(i,this.destroy),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off(r,this.onKeyUp),this.parent.observer.off("selectAll",this.selectAll),this.parent.observer.off("selectRange",this.selectRange),this.parent.observer.off("getSelectedHtml",this.getSelectedHtml),this.parent.observer.off(a,this.onSelectionSave),this.parent.observer.off(l,this.onSelectionRestore),this.parent.observer.off("readOnlyMode",this.updateReadOnly),this.parent.observer.off(h,this.onPaste),this.parent.observer.off("tableclass",this.isTableClassAdded),this.parent.observer.off("hideToolTip",this.hideTooltip),this.parent.observer.off("beforeDropDownClose",this.mouseOutEventHandler)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.tableSelectionKeyAction=function(e){for(var t=e.args,n=this.parent.inputElement.querySelectorAll(".e-cell-select"),i=0;i<n.length;i++){var s=n[i];T([s],["e-cell-select","e-multi-cells-select","e-cell-select-end"]),0===i?(32===t.keyCode?s.innerHTML="&#8203;<br>":s.innerHTML="<br>",this.nodeSelectionObj.setCursorPoint(this.parent.getDocument(),s.firstChild,0)):s.innerHTML="<br>"}},e.prototype.marginTabAdd=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(!i.closest("li"))if(i.style.marginLeft){var s=parseInt(i.style.marginLeft,10);e?s-=20:s+=20,i.style.marginLeft=s.toString()+"px","0px"===i.style.marginLeft&&i.removeAttribute("style")}else e||(i.style.marginLeft="20px")}},e}(),kt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.showFullScreen=function(e){var t=this;!0===this.parent.toolbarSettings.enable&&"Markdown"!==this.parent.editorMode&&this.parent.quickToolbarModule.hideQuickToolbars(),this.scrollableParent=sf.popups.getScrollableParent(this.parent.element),this.parent.actionBeginEnabled?this.parent.dotNetRef.invokeMethodAsync("ActionBeginEvent",{requestType:"Maximize",cancel:!1}).then((function(e){e.cancel||t.showActionBeginCallback()})):this.showActionBeginCallback(),setTimeout((function(){t.parent.inputElement.focus()}),100)},e.prototype.showActionBeginCallback=function(){this.toggleParentOverflow(!0),this.invokeActionComplete("Maximize")},e.prototype.hideFullScreen=function(e){var t=this;!0===this.parent.toolbarSettings.enable&&"Markdown"!==this.parent.editorMode&&this.parent.quickToolbarModule.hideQuickToolbars();for(var n=document.querySelectorAll(".e-rte-overflow"),i=0;i<n.length;i++)sf.base.removeClass([n[i]],["e-rte-overflow"]);this.parent.actionBeginEnabled?this.parent.dotNetRef.invokeMethodAsync("ActionBeginEvent",{requestType:"Minimize",cancel:!1}).then((function(e){e.cancel||t.hideActionBeginCallback()})):this.hideActionBeginCallback(),setTimeout((function(){t.parent.inputElement.focus()}),100)},e.prototype.hideActionBeginCallback=function(){this.invokeActionComplete("Minimize")},e.prototype.invokeActionComplete=function(e){this.parent.actionCompleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("ActionCompleteEvent",{requestType:e})},e.prototype.toggleParentOverflow=function(e){if(!sf.base.isNullOrUndefined(this.scrollableParent))for(var t=0;t<this.scrollableParent.length;t++)if("#document"===this.scrollableParent[t].nodeName){var n=document.querySelector("body");sf.base.addClass([n],["e-rte-overflow"])}else{n=this.scrollableParent[t];sf.base.addClass([n],["e-rte-overflow"])}},e.prototype.onKeyDown=function(e){var t=e.args;switch(t.action){case"full-screen":this.parent.dotNetRef.invokeMethodAsync("ShowFullScreenClient"),this.showFullScreen(e.args),t.preventDefault();break;case"escape":this.parent.dotNetRef.invokeMethodAsync("HideFullScreenClient"),this.hideFullScreen(e.args),t.preventDefault()}},e.prototype.addEventListener=function(){this.parent.observer.on("enableFullScreen",this.showFullScreen,this),this.parent.observer.on("disableFullScreen",this.hideFullScreen,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on(i,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("enableFullScreen",this.showFullScreen),this.parent.observer.off("disableFullScreen",this.hideFullScreen),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off(i,this.destroy)},e.prototype.destroy=function(){this.parent.element.classList.contains("e-rte-full-screen")&&this.toggleParentOverflow(!1);for(var e=document.querySelectorAll(".e-rte-overflow"),t=0;t<e.length;t++)sf.base.removeClass([e[t]],["e-rte-overflow"]);this.removeEventListener()},e}(),xt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("enterHandler",this.beforeEnterHandler,this),this.parent.observer.on(i,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.removeEventListener=function(){this.parent.observer.off("enterHandler",this.beforeEnterHandler),this.parent.observer.off(i,this.destroy)},e.prototype.getRangeNode=function(){this.range=this.parent.getRange(),this.startNode="#text"===this.range.startContainer.nodeName?this.range.startContainer.parentElement:this.range.startContainer,this.endNode="#text"===this.range.endContainer.nodeName?this.range.endContainer.parentElement:this.range.endContainer},e.prototype.beforeEnterHandler=function(e){var t=this;if(sf.base.isNullOrUndefined(document.querySelector(".e-mention.e-popup-open"))){this.getRangeNode();var n=!0;this.formatTags=["h1","h2","h3","h4","h5","h6","blockquote"];var i=this.processedTableImageCursor(),s=this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(this.range.startContainer)||this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(this.range.endContainer);if(sf.base.isNullOrUndefined(s))if(!i.start&&!i.end||"TABLE"!==i.startName&&"TABLE"!==i.endName)if(!i.start&&!i.end&&"IMG"!==this.range.startContainer.nodeName||"BR"!==this.parent.enterKey||"IMG"!==i.startName&&"IMG"!==i.endName&&"IMG"!==this.range.startContainer.nodeName){if(!sf.base.isNullOrUndefined(this.startNode.closest("TABLE"))&&!sf.base.isNullOrUndefined(this.endNode.closest("TABLE"))){n=!1;for(var r=this.startNode,o=r;!this.parent.formatter.editorManager.domNode.isBlockNode(r);)o=r=r.parentElement;n="TH"!==o.tagName&&"TD"!==o.tagName&&"TBODY"!==o.tagName}var a=e.args;if(13===a.which&&!a.ctrlKey&&(sf.base.Browser.isDevice?"Enter"===a.key:"Enter"===a.code||"NumpadEnter"===a.code)&&sf.base.isNullOrUndefined(this.startNode.closest("LI, UL, OL"))&&sf.base.isNullOrUndefined(this.endNode.closest("LI, UL, OL"))&&sf.base.isNullOrUndefined(this.startNode.closest(".e-img-inner"))&&n&&sf.base.isNullOrUndefined(this.startNode.closest("PRE"))&&sf.base.isNullOrUndefined(this.endNode.closest("PRE"))&&sf.base.isNullOrUndefined(this.startNode.closest("BLOCKQUOTE"))&&sf.base.isNullOrUndefined(this.endNode.closest("BLOCKQUOTE")))if(e.args.preventDefault(),this.parent.actionBeginEnabled){var l={name:"actionBegin",requestType:e.args.shiftKey?"ShiftEnterAction":"EnterAction",originalEvent:e.args,cancel:!1};this.parent.dotNetRef.invokeMethodAsync("ActionBeginEvent",l).then((function(i){i.cancel||t.enterHanlder(e,n)}))}else this.enterHanlder(e,n),this.parent.inputElement.dispatchEvent(new Event("input"))}else this.handleEnterKeyAtImageSide(e,i.start,i.end);else this.handleCursorAtTableSide(e,i.start,i.end);else this.parent.observer.notify("code-block-enter",e)}},e.prototype.enterHanlder=function(e,t){e.args.preventDefault(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData();var n=e.args.shiftKey;if(this.range.startOffset!==this.range.endOffset||this.range.startContainer!==this.range.endContainer)if(this.range.startContainer.nodeType!==Node.TEXT_NODE&&("IMG"===this.range.startContainer.nodeName||this.range.startContainer.querySelector("img")||"SPAN"===this.range.startContainer.nodeName&&(this.range.startContainer.classList.contains("e-video-wrap")||this.range.startContainer.classList.contains("e-audio-wrap")))||this.range.deleteContents(),"#text"===this.range.startContainer.nodeName&&0===this.range.startContainer.textContent.length&&this.range.startContainer.parentElement!==this.parent.inputElement)"BR"===this.parent.enterKey?this.range.startContainer.parentElement.innerHTML="&#8203;":this.range.startContainer.parentElement.innerHTML="<br>";else if(this.range.startContainer===this.parent.inputElement&&""===this.range.startContainer.innerHTML){"P"===this.parent.enterKey?this.range.startContainer.innerHTML="<p><br></p>":"DIV"===this.parent.enterKey?this.range.startContainer.innerHTML="<div><br></div>":this.range.startContainer.innerHTML="<br>";var i=this.range.startContainer.childNodes[this.range.startOffset];this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),i,0)}else if(this.parent.inputElement===this.range.startContainer){if("#text"===(i=this.range.startContainer.childNodes[this.range.startOffset]).nodeName&&0===i.textContent.length)this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),i,0===i.textContent.length?0:i.previousSibling.textContent.length);else if(this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),i,i.textContent.length>=0?0:1),0===i.previousSibling.textContent.length){if(sf.base.detach(i.previousSibling),!n){for(var s=sf.base.isNullOrUndefined(i.lastChild)?i:i.lastChild;!sf.base.isNullOrUndefined(s)&&"#text"!==s.nodeName&&"BR"!==s.nodeName;)s=s.lastChild;"BR"!==s.nodeName&&0===s.parentElement.textContent.length&&0===s.parentElement.innerHTML.length&&"BR"!==s.parentElement.nodeName&&s.parentElement.appendChild(sf.base.createElement("BR")),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),"BR"===s.nodeName?s:s.parentElement,s.parentElement.textContent.length>=0||"BR"===s.nodeName?0:1)}}else if(0===i.textContent.length){for(s="#text"===i.previousSibling.nodeName?i.previousSibling:i.previousSibling.lastChild;!sf.base.isNullOrUndefined(s)&&"#text"!==s.nodeName;)s=s.lastChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),s,s.textContent.length),sf.base.detach(i)}else if("BR"!==this.parent.enterKey&&0!==i.previousSibling.textContent.length&&0!==i.textContent.length)return void e.args.preventDefault();this.getRangeNode()}if(this.range.startContainer===this.range.endContainer&&this.range.startOffset===this.range.endOffset&&this.range.startContainer===this.parent.inputElement){if(sf.base.isNullOrUndefined(this.range.startContainer.childNodes[this.range.startOffset])||sf.base.isNullOrUndefined(this.range.startContainer.childNodes[this.range.startOffset].previousElementSibling)||"TABLE"!==(this.parent.tableModule&&this.parent.tableModule.tableObj&&this.range.startContainer.childNodes[this.range.startOffset]).previousElementSibling.nodeName||this.parent.tableModule.tableObj.removeResizeElement(),1!==this.parent.inputElement.childNodes.length||"TABLE"!==this.parent.inputElement.childNodes[0].nodeName)if(sf.base.isNullOrUndefined(this.range.startContainer.childNodes[this.range.startOffset])){for(var r=this.range.startContainer.childNodes[this.range.startOffset-1];null!==r.lastChild&&"#text"!==r.nodeName;)r=r.lastChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),r,"BR"===r.nodeName?0:r.textContent.length)}else this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),this.range.startContainer.childNodes[this.range.startOffset],0);this.getRangeNode()}var o=this.range.startContainer.childNodes.length>0&&""===this.range.startContainer.childNodes[0].textContent.trim()&&!sf.base.isNullOrUndefined(this.range.startContainer.childNodes[this.range.startOffset])&&"IMG"===this.range.startContainer.childNodes[this.range.startOffset].nodeName;if("P"===this.parent.enterKey&&!n||"DIV"===this.parent.enterKey&&!n||"P"===this.parent.shiftEnterKey&&n||"DIV"===this.parent.shiftEnterKey&&n){if(1===this.range.startOffset&&1===this.parent.inputElement.childNodes.length&&"TABLE"===this.parent.inputElement.childNodes[0].nodeName){(C=this.createInsertElement(n)).appendChild(sf.base.createElement("BR")),this.parent.inputElement.appendChild(C),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),C,0)}else{var a=void 0;a=t&&this.parent.formatter.editorManager.domNode.isBlockNode(this.startNode)?"#text"!==this.range.startContainer.nodeName||sf.base.isNullOrUndefined(this.range.startContainer.previousSibling)||"HR"!==this.range.startContainer.previousSibling.nodeName?this.startNode:this.range.startContainer.nextSibling:this.parent.formatter.editorManager.domNode.blockParentNode(this.startNode);var l=!1,d=!1,c=!1,h=!1;if(re=this.range.startContainer.parentElement){var p=this.parent.getDocument().defaultView.getComputedStyle(re);h="pre-wrap"===p.getPropertyValue("white-space"),c="nowrap"===p.getPropertyValue("text-wrap")}if(0===this.range.startOffset||0===this.range.endOffset||this.range.startContainer!==this.range.endContainer||!sf.base.isNullOrUndefined(a.childNodes[0])&&("IMG"===a.childNodes[0].nodeName||a.querySelectorAll("img, audio, video").length>0))(0===this.range.startOffset&&0===this.range.endOffset||1===this.range.startOffset&&1===this.range.endOffset&&o)&&(d=!0);else{var u=this.range.startContainer.textContent,f=u.substring(0,this.range.startOffset),m=f.charCodeAt(this.range.startOffset-1),g=0===f.trim().length;g&&"#text"!==this.range.startContainer.nodeName&&this.range.startContainer.firstChild&&this.range.startContainer.firstChild.nodeType===Node.ELEMENT_NODE&&"false"===this.range.startContainer.firstChild.getAttribute("contenteditable")&&(g=0===u.trim().length);var b=0!==u.slice(this.range.startOffset).trim().length;!(160!==m&&g&&!h&&!c)&&!(32===m&&(h||c)&&g&&b)||this.range.startContainer.previousSibling||(d=!0)}this.removeBRElement(a);var v=-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&0===this.range.startOffset&&this.range.startContainer===this.range.endContainer&&"#text"===this.range.startContainer.nodeName&&!sf.base.isNullOrUndefined(this.range.startContainer.previousSibling)&&!this.parent.formatter.editorManager.domNode.isBlockNode(this.range.startContainer.previousSibling)&&this.range.startContainer.parentElement===this.range.startContainer.previousSibling.parentElement;if(!(("#text"===this.range.startContainer.nodeName||"BR"===this.range.startContainer.nodeName)&&0===this.range.startOffset&&0===this.range.endOffset&&this.range.startContainer.parentElement===this.parent.inputElement&&"BR"===this.parent.enterKey&&n)&&!v&&(0===this.range.startOffset&&0===this.range.endOffset||d)&&(sf.base.isNullOrUndefined(this.range.startContainer.previousSibling)||"IMG"!==this.range.startContainer.previousSibling.nodeName&&"BR"!==this.range.startContainer.previousSibling.nodeName)){var y=void 0,C=void 0;sf.base.isNullOrUndefined(this.range.startContainer.childNodes)||"#text"===this.range.startContainer.nodeName||0!==this.range.startContainer.textContent.length&&(sf.base.isNullOrUndefined(this.range.startContainer.querySelector(".e-video-clickelem"))||0!==this.range.startContainer.querySelector(".e-video-clickelem").textContent.length)||!(this.range.startContainer.querySelectorAll("img, audio, video").length>0)&&sf.base.isNullOrUndefined(this.range.startContainer.querySelector(".e-video-clickelem"))&&"IMG"!==this.range.startContainer.nodeName&&"TABLE"!==this.range.startContainer.nodeName?0!==a.textContent.trim().length||!sf.base.isNullOrUndefined(a.childNodes[0])&&"IMG"===a.childNodes[0].nodeName||""===a.textContent.trim()&&a.querySelectorAll("img, audio, video").length>0?(this.range.startOffset===this.range.endOffset&&0!==this.range.startOffset?C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,a,!1).cloneNode(!0):(C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,a,!0).cloneNode(!0),l=!0),y=!1):(C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,a,!0).cloneNode(!0),y=!0):(C=this.createInsertElement(n),l=!0,y=!1);var N=void 0;for(N=this.formatTags.indexOf(C.nodeName.toLocaleLowerCase())<0?this.createInsertElement(n):sf.base.createElement(C.nodeName);C.firstChild;)N.appendChild(C.firstChild);var E=!(this.range.startContainer===a||!a.querySelector("img")),S=!(this.range.startContainer===a||!(a.querySelector(".e-video-wrap")||a.querySelector(".e-audio-wrap")&&this.range.startContainer.classList.contains("e-clickelem")));if(S?this.parent.formatter.editorManager.domNode.insertAfter(N,a):a.parentElement.insertBefore(N,a),!y){s=N;var T=void 0;if(this.range.startOffset===this.range.endOffset&&0!==this.range.startOffset)for(;!sf.base.isNullOrUndefined(s)&&"#text"!==s.nodeName&&"BR"!==s.nodeName;)T=s,s=s.lastChild;else T=s;T.innerHTML="<br>",l||sf.base.detach(a)}S||E?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),N,0):this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),N.nextElementSibling,0)}else if(a===this.parent.inputElement||0!==a.textContent.length||!sf.base.isNullOrUndefined(a.childNodes[0])&&"IMG"===a.childNodes[0].nodeName)if(this.range.startContainer===this.range.endContainer&&this.range.startContainer.nodeType!==Node.TEXT_NODE&&("IMG"===this.range.startContainer.nodeName||this.range.startContainer.querySelector("img")||"SPAN"===this.range.startContainer.nodeName&&(this.range.startContainer.classList.contains("e-video-wrap")||this.range.startContainer.classList.contains("e-audio-wrap")))){if(a.textContent.trim().length>0){C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,a,!0);var L=sf.base.isNullOrUndefined(C.previousSibling.querySelector(".e-video-wrap"))?C.previousSibling.querySelector(".e-audio-wrap"):C.previousSibling.querySelector(".e-video-wrap"),O=!1;if(!sf.base.isNullOrUndefined(L)){for(var k=L.previousSibling;!sf.base.isNullOrUndefined(k)&&"#text"!==k.nodeName;)k=k.lastChild;if(sf.base.isNullOrUndefined(k)){var x=sf.base.createElement("br");L.parentElement.appendChild(x),O=!0}O?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),L.parentElement,0):this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),k,k.textContent.length),sf.base.detach(L)}}else{i=(C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,a,!0)).hasChildNodes()?C.previousSibling:C;var w=sf.base.isNullOrUndefined(C.querySelector("img"))?null:C.querySelector("img");N=this.createInsertElement(n);for(sf.base.isNullOrUndefined(w)?sf.base.isNullOrUndefined(w)&&i.querySelector("img")&&(i=C):d?(C.parentElement.insertBefore(N,C),i=C.previousSibling):(this.parent.formatter.editorManager.domNode.insertAfter(N,C),i=C.nextSibling);!sf.base.isNullOrUndefined(i.firstChild);)sf.base.detach(i.firstChild);x=sf.base.createElement("br");i.appendChild(x),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),i,0)}sf.base.isNullOrUndefined(this.parent.audioModule)||this.parent.audioModule.hideAudioQuickToolbar(),sf.base.isNullOrUndefined(this.parent.videoModule)||this.parent.videoModule.hideVideoQuickToolbar()}else if("BR"===this.parent.enterKey&&n&&this.range.startContainer.nodeType===Node.TEXT_NODE&&this.range.startContainer.parentElement&&this.range.startContainer.parentElement===this.parent.inputElement){var A=this.range,B=A.startContainer,M=A.startOffset,R=sf.base.createElement(this.parent.shiftEnterKey);if(B.nodeType===Node.TEXT_NODE&&0!==A.endOffset&&0!==A.startOffset){var D=B;if(M<D.length){var I=D.splitText(M);R.appendChild(I)}else R.innerHTML="<br>";D.parentNode.insertBefore(R,D.nextSibling),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),R,0)}else if(0===M&&0===A.endOffset){if(R.innerHTML="<br>",A.endOffset===B.textContent.length){var U=sf.base.createElement("br");B.parentNode.insertBefore(U,B)}B.parentNode.insertBefore(R,B);var P=A.endOffset===B.textContent.length?R:R.nextSibling;B.parentNode.insertBefore(R,B),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),P,0)}}else{var H=!1,q=null;if(this.range.startContainer===this.range.endContainer){var F=this.getCursorNode(this.range);if(F&&F.parentNode){var z=F,V=z.previousElementSibling&&"BR"===z.previousElementSibling.nodeName,j="BR"===F.nodeName;if(V||j){var W=("P"===this.parent.enterKey||"DIV"===this.parent.enterKey)&&!n,_="#text"===F.nodeName&&this.range.startContainer===F&&this.range.startOffset>0;W&&_||(q=document.createTextNode("​"),F.parentNode.insertBefore(q,F),j&&!z.previousElementSibling&&F.parentNode.insertBefore(document.createElement("br"),q),this.range.setStartAfter(q),this.range.setEndBefore(F),H=!0)}}}C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,a,!0);if(H&&q&&q.parentNode&&"​"===q.textContent&&q.parentNode.removeChild(q),sf.base.isNullOrUndefined(C.childNodes[0])||"#text"!==C.childNodes[0].nodeName||0!==C.childNodes[0].textContent.length||sf.base.detach(C.childNodes[0]),0===C.textContent.trim().length){x=sf.base.createElement("br");if("A"===this.startNode.nodeName||this.startNode.closest("a")){this.startNode="A"===this.startNode.nodeName?this.startNode:this.startNode.closest("a");var Q=this.startNode.parentElement;this.startNode.parentElement.insertBefore(x,this.startNode),sf.base.detach(this.startNode),this.startNode=Q}else"BR"!==this.startNode.nodeName&&this.startNode.appendChild(x);"\n"===C.childNodes[0].textContent&&sf.base.detach(C.childNodes[0]),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),this.startNode,0)}if(("P"===this.parent.enterKey||"DIV"===this.parent.enterKey)&&!n||("DIV"===this.parent.shiftEnterKey||"P"===this.parent.shiftEnterKey)&&n){var K=this.formatTags.indexOf(C.nodeName.toLocaleLowerCase());if(K<0||K>=0&&0===C.textContent.trim().length){for(var X=this.createInsertElement(n);C.firstChild;)X.appendChild(C.firstChild);this.parent.formatter.editorManager.domNode.insertAfter(X,C),sf.base.detach(C);var G=this.parent.formatter.editorManager.domNode.isBlockNode(this.startNode)?X:this.startNode,Y=0;G&&("A"===G.nodeName||G.closest("a"))&&(G="A"===G.nodeName?G:G.closest("a"),(G=this.getFirstTextNode(G)).nodeValue="​"+G.nodeValue,Y=1),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),G,Y)}}}else if(sf.base.isNullOrUndefined(a.children[0])||"BR"===a.children[0].tagName){(N=this.createInsertElement(n)).innerHTML="<br>",this.parent.formatter.editorManager.domNode.insertAfter(N,a),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),N,0)}else{var C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,a,!1).cloneNode(!0);this.parent.formatter.editorManager.domNode.insertAfter(C,a),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),C,C.textContent.length>=0?0:1)}}e.args.preventDefault()}if("BR"===this.parent.enterKey&&!n||"BR"===this.parent.shiftEnterKey&&n){var $=void 0;if(this.parent.formatter.editorManager.domNode.isBlockNode(this.startNode))$=this.startNode;else{for(var J=this.startNode,Z=J;!this.parent.formatter.editorManager.domNode.isBlockNode(J);)Z=J,J=J.parentElement;$=J===this.parent.inputElement?Z:J}var ee=window.getComputedStyle($);this.removeBRElement($);for(var te=$.lastChild;!sf.base.isNullOrUndefined(te)&&"#text"!==te.nodeName&&"BR"!==te.nodeName&&"IMG"!==te.nodeName;)te=te.lastChild;var ne=this.range.startContainer===te?this.range.startContainer.textContent.length:$.textContent.length;E="IMG"===this.range.startContainer.nodeName||1===this.range.startContainer.nodeType&&null!==this.range.startContainer.querySelector("img")||this.range.startContainer.childNodes.length>0&&!sf.base.isNullOrUndefined(this.range.startContainer.childNodes[this.range.startOffset])&&"IMG"===this.range.startContainer.childNodes[this.range.startOffset].nodeName;if($!==this.parent.inputElement&&this.parent.formatter.editorManager.domNode.isBlockNode($)&&this.range.startOffset===this.range.endOffset&&(this.range.startOffset===ne||0===$.textContent.trim().length&&E)){var ie=sf.base.createElement("br");if(0===this.range.startOffset&&"TABLE"===this.range.startContainer.nodeName)this.range.startContainer.parentElement.insertBefore(ie,this.range.startContainer);else if("BR"===te.nodeName&&0===$.textContent.length)this.parent.formatter.editorManager.domNode.insertAfter(ie,te);else if(0===this.range.startOffset&&0===this.range.endOffset&&E){var se="IMG"===this.range.startContainer.nodeName?this.range.startContainer:this.range.startContainer.childNodes[this.range.startOffset];$.insertBefore(ie,se)}else if(1===this.range.startOffset&&1===this.range.endOffset&&o)$.insertBefore(ie,this.range.startContainer);else{var re,oe=sf.base.createElement("br"),ae=void 0;if((re=this.range.startContainer.parentElement)&&"A"===re.nodeName&&re.textContent.length===this.range.startOffset)ae=re;else if(re){var le=re.closest("a");ae=le||this.range.startContainer}this.parent.formatter.editorManager.domNode.insertAfter(ie,ae),this.parent.formatter.editorManager.domNode.insertAfter(oe,ae);var de=ae.nextElementSibling,ce=sf.base.isNullOrUndefined(de)?null:de.nextElementSibling;sf.base.isNullOrUndefined(de)||sf.base.isNullOrUndefined(ce)||sf.base.isNullOrUndefined(ce.nextElementSibling)||"BR"!==de.nodeName||"BR"!==ce.nodeName||"BR"!==ce.nextElementSibling.nodeName||ce.nextElementSibling.remove()}this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),ie,0)}else if(sf.base.isNullOrUndefined($)||$===this.parent.inputElement||"BR"===$.nodeName)this.insertBRElement();else if(0===$.textContent.trim().length||1===$.textContent.trim().length&&8203===$.textContent.charCodeAt(0))if($.childElementCount>0&&"IMG"===$.lastElementChild.nodeName||$.lastElementChild&&"BR"===$.lastElementChild.nodeName||!sf.base.isNullOrUndefined($.firstElementChild)&&($.querySelector(".e-video-wrap")||$.querySelector(".e-audio-wrap")))this.insertBRElement();else{C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,$,!0).cloneNode(!0);this.parent.formatter.editorManager.domNode.insertAfter(C,$);var he=sf.base.createElement("br");C.parentElement.insertBefore(he,C),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),C,0)}else{C=void 0,he=sf.base.createElement("br");if(0!==this.range.startOffset||0!==this.range.endOffset||sf.base.isNullOrUndefined($.previousSibling)||"BR"!==$.previousSibling.nodeName)$===this.parent.inputElement||"inline"!==ee.display&&"inline-block"!==ee.display?"A"===this.startNode.nodeName||this.startNode.closest("A")?(this.startNode="A"===this.startNode.nodeName?this.startNode:this.startNode.closest("A"),this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,this.startNode,!0).cloneNode(!0),this.startNode.parentElement.insertBefore(he,this.startNode),this.startNode.innerHTML="​"+this.startNode.innerHTML,this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),this.startNode,1)):this.insertBRElement():(C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,$,!0).cloneNode(!0),$.parentElement.insertBefore(he,$),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),$,0),this.insertFocusContent());else{C=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,$,!1).cloneNode(!0),this.parent.formatter.editorManager.domNode.insertAfter(he,$),this.insertFocusContent();for(s=he.nextSibling;!sf.base.isNullOrUndefined(s)&&"#text"!==s.nodeName;)s=s.lastChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),s,0)}}e.args.preventDefault()}this.parent.actionCompleteEnabled&&this.triggerActionComplete(e,n)},e.prototype.getCursorNode=function(e){var t=e.startContainer,n=e.startOffset;return t.nodeType===Node.TEXT_NODE?t:t.nodeType===Node.ELEMENT_NODE?t.childNodes[n]||t:null},e.prototype.getFirstTextNode=function(e){return this.parent.getDocument().createTreeWalker(e,NodeFilter.SHOW_TEXT,null).nextNode()},e.prototype.removeBRElement=function(e){-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&this.range.endOffset===e.textContent.length&&(0!==e.textContent.length||e.querySelectorAll("BR").length>1)&&!sf.base.isNullOrUndefined(e.lastChild)&&"BR"===e.lastChild.nodeName&&sf.base.detach(e.lastChild)},e.prototype.insertBRElement=function(){var e=!1,t=!0,n=!1;0===this.range.endContainer.textContent.length&&"BR"===this.range.startContainer.nodeName&&(t=!1);for(var i=sf.base.createElement("br"),s=this.startNode;s.lastChild;)s=s.lastChild;var r="A"===this.startNode.nodeName&&"A"===this.endNode.nodeName&&!sf.base.isNullOrUndefined(this.range.startContainer.parentElement)&&this.range.startOffset===this.range.endOffset&&this.range.startContainer.textContent.trim().length===s.textContent.trim().length;if("BR"===this.startNode.nodeName&&"BR"===this.endNode.nodeName&&0===this.range.startOffset&&this.range.startOffset===this.range.endOffset)this.parent.formatter.editorManager.domNode.insertAfter(i,this.startNode),e=!0;else if(this.startNode!==this.parent.inputElement||sf.base.isNullOrUndefined(this.range.startContainer.previousSibling)||"BR"!==this.range.startContainer.previousSibling.nodeName||0!==this.range.startContainer.textContent.length||(e=!0),r)this.parent.formatter.editorManager.domNode.insertAfter(i,this.startNode);else if("SPAN"===this.startNode.tagName&&(this.startNode.classList.contains("e-video-wrap")||this.startNode.classList.contains("e-audio-wrap"))){this.startNode.parentElement.insertBefore(i,this.startNode);var o=this.parent.formatter.editorManager.domNode.blockParentNode(this.startNode),a=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,o,!0);sf.base.detach(a.previousSibling.childNodes[1]),e=!0}else this.startNode!==this.parent.inputElement&&this.startNode.nodeType===Node.ELEMENT_NODE&&this.startNode.childElementCount>0&&"IMG"===this.startNode.lastElementChild.nodeName?(this.startNode.parentElement.insertBefore(i,this.startNode),e=!0,n=!0):(this.range.insertNode(i),e=!0);var l=!sf.base.isNullOrUndefined(i.nextSibling)&&(i.nextSibling.textContent.length>0||"#text"!==i.nextSibling.nodeName&&i.nextSibling.querySelectorAll("audio,video,table,img").length>0)||!sf.base.isNullOrUndefined(i.nextElementSibling)&&"BR"===i.nextElementSibling.tagName||"BR"===this.range.startContainer.nodeName,d=!sf.base.isNullOrUndefined(i.nextSibling)&&!sf.base.isNullOrUndefined(i.nextSibling.classList)&&(i.nextSibling.classList.contains("e-video-wrap")||i.nextSibling.classList.contains("e-audio-wrap"));if(l&&(e||!sf.base.isNullOrUndefined(i.nextSibling)&&"#text"===i.nextSibling.nodeName&&0===i.nextSibling.textContent.trim().length&&!sf.base.isNullOrUndefined(i.nextSibling.nextSibling)&&i.nextSibling.nextSibling.textContent.trim().length>0))this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),sf.base.isNullOrUndefined(i.nextSibling)||!t||n||d?i:i.nextSibling,0),e=!1;else{var c=sf.base.createElement("br");r?this.parent.formatter.editorManager.domNode.insertAfter(c,this.startNode):this.range.insertNode(c),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),i,0)}},e.prototype.insertFocusContent=function(){0===this.range.startContainer.textContent.length&&("#text"===this.range.startContainer.nodeName?this.range.startContainer.parentElement.innerHTML="&#8203;":this.range.startContainer.innerHTML="&#8203;")},e.prototype.createInsertElement=function(e){var t;"DIV"===this.parent.enterKey&&!e||"DIV"===this.parent.shiftEnterKey&&e?t=sf.base.createElement("div"):("P"===this.parent.enterKey&&!e||"P"===this.parent.shiftEnterKey&&e)&&(t=sf.base.createElement("p"));var n=this.parent.formatter.editorManager.domNode.blockNodes()[0].previousSibling,i=this.parent.formatter.editorManager.domNode.blockNodes()[0].nextSibling;return!sf.base.isNullOrUndefined(n)&&"#text"!==n.nodeName&&n.hasAttribute("style")&&"TABLE"!==n.nodeName&&(t.style.cssText=n.getAttribute("style")),sf.base.isNullOrUndefined(n)&&!sf.base.isNullOrUndefined(i)&&"#text"!==i.nodeName&&i.hasAttribute("style")&&"TABLE"!==i.nodeName&&(t.style.cssText=i.getAttribute("style")),t},e.prototype.handleCursorAtTableSide=function(e,t,n){if("BR"!==this.parent.enterKey){var i=e.args.shiftKey,s=sf.base.createElement(this.parent.enterKey);s.innerHTML="<br>";var r=void 0;t&&(r=this.range.startContainer.childNodes[this.range.startOffset]).parentElement.insertBefore(s,r),n&&(r=this.range.startContainer.childNodes[this.range.startOffset-1],sf.base.isNullOrUndefined(r.nextSibling)?sf.base.isNullOrUndefined(r.nextSibling)&&r.parentElement.appendChild(s):r.parentElement.insertBefore(s,r.nextSibling)),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.getDocument(),s,0),e.args.preventDefault();var o={name:"actionComplete",requestType:i?"ShiftEnterAction":"EnterAction",event:e.args};this.parent.actionCompleteEnabled&&this.parent.dotNetRef.invokeMethodAsync("ActionCompleteEvent",o)}},e.prototype.triggerActionComplete=function(e,t){var n={name:"actionComplete",requestType:t?"ShiftEnterAction":"EnterAction",event:e.args};this.parent.dotNetRef.invokeMethodAsync("ActionCompleteEvent",n)},e.prototype.handleEnterKeyAtImageSide=function(e,t,n){var i=this,s={cancel:!1,name:"actionBegin",requestType:e.args.shiftKey?"ShiftEnterAction":"EnterAction",originalEvent:e.args},r=!1;"IMG"===this.range.startContainer.nodeName&&0===this.range.startOffset&&(r=!0),this.parent.dotNetRef.invokeMethodAsync("actionBegin",s,(function(s){if(!s.cancel&&"BR"===i.parent.enterKey){var o=sf.base.createElement("br"),a=void 0;if(r&&((a=i.range.startContainer).parentElement.insertBefore(o,a),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.getDocument(),a,0)),t&&((a=i.range.startContainer.childNodes[i.range.startOffset]).parentElement.insertBefore(o,a),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.getDocument(),a,0)),n)if(a=i.range.startContainer.childNodes[i.range.startOffset-1],sf.base.isNullOrUndefined(a.nextSibling)){if(sf.base.isNullOrUndefined(a.nextSibling)){a.parentElement.appendChild(o);var l=sf.base.createElement("BR");a.parentElement.appendChild(l),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.getDocument(),l,0)}}else a.parentElement.insertBefore(o,a.nextSibling),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.getDocument(),o.nextSibling,0);e.args.preventDefault(),i.triggerActionComplete(e,e.args.shiftKey)}}))},e.prototype.isTableOrImageStart=function(){var e=this.range.startContainer,t=this.range.startOffset,n=this.range.collapsed&&1===e.nodeType&&e.isContentEditable&&e.childNodes[t]&&["IMG","TABLE"].indexOf(e.childNodes[t].nodeName)>-1;return n?{start:n,startNodeName:e.childNodes[t].nodeName}:{start:!1,startNodeName:""}},e.prototype.isTableOrImageEnd=function(){var e=this.range.startContainer,t=this.range.startOffset,n=this.range.collapsed&&1===e.nodeType&&e.isContentEditable&&e.childNodes[t-1]&&["IMG","TABLE"].indexOf(e.childNodes[t-1].nodeName)>-1;return n?{end:n,endNodeName:e.childNodes[t-1].nodeName}:{end:!1,endNodeName:""}},e.prototype.processedTableImageCursor=function(){var e=this.isTableOrImageStart(),t=e.start,n=e.startNodeName,i=this.isTableOrImageEnd();return{start:t,startName:n,end:i.end,endName:i.endNodeName}},e}(),wt={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,space:32,escape:27,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,semicolon:186,plus:187,comma:188,minus:189,dot:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222,"]":221,"[":219,"=":187,"<":188,">":190,"`":192},At=function(){function e(t,n){var i=this;this.keyPressHandler=function(t){for(var n=t.altKey,s=t.ctrlKey,r=t.shiftKey,o=t.metaKey,a=t.which,l=0,d=Object.keys(i.keyConfigs);l<d.length;l++)for(var c=d[l],h=0,p=i.keyConfigs[c].split(",");h<p.length;h++){var u=p[h],f=e.getKeyConfigData(u.trim());n!==f.altKey||s!==f.ctrlKey&&!o||r!==f.shiftKey||a!==f.keyCode||(t.action=c)}i.keyAction&&i.keyAction(t)},this.element=t,sf.base.extend(this,this,n),this.onKeyPressHandler=this.keyPressHandler.bind(this),this.bind()}return e.prototype.destroy=function(){this.unWireEvents()},e.prototype.bind=function(){this.wireEvents()},e.prototype.wireEvents=function(){this.element.addEventListener(this.eventName,this.onKeyPressHandler)},e.prototype.unWireEvents=function(){this.element.removeEventListener(this.eventName,this.onKeyPressHandler)},e.getKeyConfigData=function(t){if(t in this.configCache)return this.configCache[t];var n=t.toLowerCase().split("+"),i={altKey:-1!==n.indexOf("alt"),ctrlKey:-1!==n.indexOf("ctrl"),shiftKey:-1!==n.indexOf("shift"),keyCode:null};return n[n.length-1].length>1&&Number(n[n.length-1])?i.keyCode=Number(n[n.length-1]):i.keyCode=e.getKeyCode(n[n.length-1]),e.configCache[t]=i,i},e.getKeyCode=function(e){return wt[e]||e.toUpperCase().charCodeAt(0)},e.configCache={},e}(),Bt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("sourceCode",this.sourceCode,this),this.parent.observer.on(t,this.onInitialEnd,this),this.parent.observer.on("updateSource",this.updateSourceCode,this),this.parent.observer.on(i,this.destroy,this)},e.prototype.onInitialEnd=function(){this.parent.formatter.editorManager.observer.on("keydown-handler",this.onKeyDown,this)},e.prototype.removeEventListener=function(){this.unWireEvent(),this.parent.observer.off("sourceCode",this.sourceCode),this.parent.observer.off("updateSource",this.updateSourceCode),this.parent.observer.off(t,this.onInitialEnd),this.parent.observer.off(i,this.destroy),this.parent.formatter.editorManager.observer.off("keydown-handler",this.onKeyDown)},e.prototype.getSourceCode=function(){return sf.base.createElement("textarea",{className:"e-rte-srctextarea",attrs:{"aria-labelledby":this.parent.element.id+"_rte-edit-view"}})},e.prototype.wireEvent=function(e){this.keyboardModule=new At(e,{keyAction:this.previewKeyDown.bind(this),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"}),sf.base.EventHandler.add(this.previewElement,"mousedown",this.mouseDownHandler,this)},e.prototype.unWireEvent=function(){this.keyboardModule&&this.keyboardModule.destroy(),this.previewElement&&sf.base.EventHandler.remove(this.previewElement,"mousedown",this.mouseDownHandler)},e.prototype.wireBaseKeyDown=function(){this.parent.keyboardModule=new At(this.parent.getEditPanel(),{keyAction:this.parent.keyDown.bind(this.parent),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"})},e.prototype.unWireBaseKeyDown=function(){this.parent.keyboardModule.destroy()},e.prototype.mouseDownHandler=function(e){this.parent.observer.notify("sourceCodeMouseDown",{args:e})},e.prototype.previewKeyDown=function(e){switch(e.action){case"html-source":this.parent.dotNetRef.invokeMethodAsync("PreviewCodeClient"),this.updateSourceCode(e),e.preventDefault();break;case"toolbar-focus":if(this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()){var t=this.parent.getToolbarElement().querySelector(".e-toolbar-item:not(.e-overlay)[title]");t.firstElementChild.removeAttribute("tabindex"),t.firstElementChild.focus()}break;case"escape":this.parent.element.classList.contains("e-rte-full-screen")&&(this.parent.dotNetRef.invokeMethodAsync("HideFullScreenClient"),this.parent.fullScreenModule.hideFullScreen(e),e.preventDefault());break;case"full-screen":this.parent.dotNetRef.invokeMethodAsync("ShowFullScreenClient"),this.parent.fullScreenModule.showFullScreen(e),e.preventDefault()}},e.prototype.onKeyDown=function(e){switch(e.event.action){case"html-source":e.event.preventDefault(),this.parent.dotNetRef.invokeMethodAsync("ViewSourceClient"),this.sourceCode(e),e.callBack({requestType:"SourceCode",editorMode:"HTML",event:e.event})}},e.prototype.sourceCode=function(e){var t=this;this.parent.isBlur=!1,sf.base.isNullOrUndefined(this.parent.quickToolbarModule.textQTBar)||sf.base.isNullOrUndefined(this.parent.quickToolbarModule.textQTBar.element)||!this.parent.quickToolbarModule.textQTBar.element.classList.contains("e-popup-open")||this.parent.quickToolbarModule.hideTextQTBar(),this.parent.dotNetRef.invokeMethodAsync("ActionBeginEvent",{requestType:"SourceCode",cancel:!1}).then((function(e){if(!e.cancel){var n=sf.base.selectAll(".e-toolbar-item",t.parent.element);sf.base.isNullOrUndefined(t.previewElement)&&(t.previewElement=t.getSourceCode()),t.parent.inputElement.innerHTML=D(t.replaceAmpersand(t.parent.inputElement.innerHTML),t.parent.editorMode),t.parent.updateValueData();var i=void 0,s=t.parent.inputElement.getBoundingClientRect().height;sf.base.isNullOrUndefined(t.parent.element.querySelector("#"+t.parent.element.id+"_source-view"))?i=sf.base.createElement("div",{className:"e-source-content",id:t.parent.element.id+"_source-view",attrs:{style:"height:"+s+"px"}}):(i=t.parent.element.querySelector("#"+t.parent.element.id+"_source-view")).style.height=s+"px",i.appendChild(t.previewElement);var r=t.parent.toolbarSettings&&"Bottom"===t.parent.toolbarSettings.position,o=t.parent.element.querySelector(".e-toolbar-container");r&&o?t.parent.rootContainer.insertBefore(i,o):t.parent.rootContainer.appendChild(i),t.parent.rootContainer.classList.add("e-source-code-enabled"),t.getPanel().value=D(t.getTextAreaValue(t.parent.getEditPanel()),t.parent.editorMode),t.parent.isBlur=!1,t.parent.getToolbar()&&sf.base.removeClass([t.parent.getToolbar()],["e-expand-open"]),sf.base.removeClass(n,["e-active"]),t.wireEvent(t.previewElement),t.unWireBaseKeyDown(),t.previewElement.focus(),t.parent.inputElement.innerHTML=D(t.replaceAmpersand(t.parent.inputElement.innerHTML),t.parent.editorMode),t.parent.updateValueData(),t.parent.dotNetRef.invokeMethodAsync("ActionCompleteEvent",{requestType:"SourceCode"}).then((function(e){t.parent.invokeChangeEvent()})),!sf.base.isNullOrUndefined(t.parent.saveInterval)&&t.parent.saveInterval>0&&t.parent.autoSaveOnIdle&&(t.codeViewTimeInterval=setInterval((function(){t.parent.observer.notify("updateValueOnIdle",{})}),t.parent.saveInterval))}}))},e.prototype.updateSourceCode=function(e){var t=this;this.parent.isBlur=!1,this.parent.dotNetRef.invokeMethodAsync("ActionBeginEvent",{requestType:"Preview",cancel:!1}).then((function(e){if(!e.cancel){var n=t.getPanel();sf.base.isNullOrUndefined(n)||(n.value=t.parent.enableHtmlSanitizer?H(t.parent.htmlEditorModule.sanitizeHelper(n.value),t.parent.element):H(n.value,t.parent.element),n.value=t.replaceAmpersand(n.value));var i=t.parent.serializeValue(n.value),s=void 0;s=R(s=null===i||""===i?"DIV"===t.parent.enterKey?"<div><br/></div>":"BR"===t.parent.enterKey?"<br/>":"<p><br/></p>":i,t.parent.editorMode),t.parent.rootContainer.classList.remove("e-source-code-enabled");var r=document.createElement("div");r.innerHTML=s;var o="\n"===r.textContent?"":r.textContent;sf.base.detach(r),r=null,t.parent.maxLength>=0&&o.length>t.parent.maxLength&&(s=t.parent.getEditPanel().innerHTML),t.parent.getEditPanel().innerHTML=t.replaceAmpersand(s),t.parent.isBlur=!1,t.parent.getToolbar()&&sf.base.removeClass([t.parent.getToolbar()],["e-expand-open"]),t.unWireEvent(),t.wireBaseKeyDown(),t.parent.getEditPanel().focus(),t.parent.updateValueData(),t.parent.addAudioVideoWrapper(),clearTimeout(t.codeViewTimeInterval),t.parent.dotNetRef.invokeMethodAsync("ActionCompleteEvent",{requestType:"Preview"}).then((function(e){t.parent.invokeChangeEvent()})),t.parent.observer.notify("tableclass",{}),"HTML"===t.parent.editorMode&&t.parent.codeBlockModule.disableToolbarItems()}}))},e.prototype.replaceAmpersand=function(e){var t=this;if("HTML"===this.parent.editorMode){["times","divide","ne"].forEach((function(n){var i=new RegExp("&(amp;)*("+n+")","g");if(t.parent.enableHtmlSanitizer){var s=t.parent.enableHtmlEncode?"&amp;amp;amp;amp;"+n:"&amp;amp;"+n;e=e.replace(i,s)}else e=e.replace(i,"&amp;"+n)}))}return e},e.prototype.getTextAreaValue=function(e){var t=this.parent.enableXhtml?this.parent.getXhtmlString(this.parent.value):this.parent.value;return"<p><br></p>"===e.innerHTML||"<div><br></div>"===e.innerHTML||"<br>"===e.innerHTML||1===e.childNodes.length&&("P"===e.childNodes[0].tagName&&7===e.innerHTML.length||"DIV"===e.childNodes[0].tagName&&11===e.innerHTML.length)?"":t},e.prototype.getPanel=function(){return this.parent.element.querySelector(".e-rte-srctextarea")},e.prototype.getViewPanel=function(){return this.parent.element.querySelector(".e-source-content")},e.prototype.destroy=function(){this.removeEventListener()},e}(),Mt=function(){function e(e){this.parent=e}return e.prototype.renderPopup=function(e,t){this.type=e,this.popupElement=t;var n=sf.base.createElement("div",{className:"e-rte-tip-pointer"});return this.popupElement.prepend(n),this.popup=this.createPopup(this.type,this.popupElement),this.popup},e.prototype.quickToolbarOpen=function(){this.parent.quickTbOpenedEnabled&&this.parent.dotNetRef.invokeMethodAsync("QuickToolbarOpenEvent",this.popup.element.classList.toString(),this.type)},e.prototype.createPopup=function(e,t){var n;switch(e){case"Inline":case"Text":case"Link":case"Audio":n=new sf.popups.Popup(t,{viewPortElement:this.parent.iframeSettings.enable?null:this.parent.getEditPanel(),zIndex:9,collision:{X:"fit",Y:"flip"},position:{X:"left",Y:"top"},actionOnScroll:"none",open:this.quickToolbarOpen.bind(this)});break;case"Video":case"Image":case"Table":n=new sf.popups.Popup(t,{viewPortElement:this.parent.iframeSettings.enable?null:this.parent.getEditPanel(),zIndex:9,collision:{X:"fit",Y:"flip"},position:{X:"left",Y:"top"},actionOnScroll:"none",open:this.quickToolbarOpen.bind(this)})}return n},e}(),Rt=function(){function e(e,t){this.escapeKeyPressed=!1,this.type=e,this.parent=t,this.isRendered=!1,this.popupRenderer=new Mt(t)}return e.prototype.render=function(e){this.element=e,this.popupObj=this.popupRenderer.renderPopup(this.type,e),this.element=this.popupObj.element,this.tipPointerElem=this.element.querySelector(".e-rte-tip-pointer"),this.addEventListener(),this.tipPointerHeight=this.parent.userAgentData.isMobileDevice()?16:10},e.prototype.showPopup=function(e,t){var n=this,i=this.parent.formatter.editorManager.nodeSelection.get(this.parent.inputElement.ownerDocument);if(!(sf.base.isNullOrUndefined(i)&&i.rangeCount<0)){sf.base.addClass([this.element],["e-hide"]),this.parent.iframeSettings.enable?sf.base.append([this.element],this.parent.rootContainer.querySelector(".e-rte-iframe-content")):sf.base.append([this.element],this.parent.getPanel());var s=this.getRelativeElement(i,e);if(null!==s){var r;this.parent.iframeSettings.enable&&(r=this.parent.getPanel().getBoundingClientRect());var o=i.getRangeAt(0),a=o.getClientRects(),l=this.getSelectionDirection(i),d=sf.base.isNullOrUndefined(t)?"none":t.type;"mouseup"===d&&t.detail&&3===t.detail&&(d="trippleclick");var c=0===a.length?o.getBoundingClientRect():"Backward"===l?a[0]:a[a.length-1],h={blockElement:s,blockRect:s.getBoundingClientRect(),range:o,rangeRect:c,iframeRect:r,contentPanelElement:this.parent.getPanel(),editPanelDomRect:this.parent.getEditPanel().getBoundingClientRect(),direction:l,type:d};"75%"!==this.element.style.maxWidth&&sf.base.setStyleAttribute(this.element,{maxWidth:"75%"}),this.popupWidth=this.getPopupDimension(this.popupObj,"width"),this.popupHeight=this.getPopupDimension(this.popupObj,"height"),this.toolbarHeight=sf.base.isNullOrUndefined(this.parent.getToolbarElement())?0:this.parent.getToolbarElement().getBoundingClientRect().height;var p={cancel:!1,targetElement:s,type:d,positionX:this.calculateOffsetX(h),positionY:this.calculateOffsetY(h)};p=this.handleVerticalCollision(h,p),this.setTipPointerPostion(this.currentTipPosition),"Audio"!==this.type&&"Image"!==this.type&&"Video"!==this.type||("Bottom-Center"===this.currentTipPosition||"Bottom-Left"===this.currentTipPosition||"Bottom-Right"===this.currentTipPosition?p.positionY=p.positionY-2:"Top-Center"!==this.currentTipPosition&&"Top-Left"!==this.currentTipPosition&&"Top-Right"!==this.currentTipPosition||(p.positionY=p.positionY+2)),this.parent.onQuickTbOpenEnabled&&"scroll"!==d?this.parent.dotNetRef.invokeMethodAsync("BeforeQuickToolbarOpenEvent").then((function(e){e.cancel||n.openQuickToolbarPopup(e)})):this.openQuickToolbarPopup(p),this.previousTarget=e,sf.base.EventHandler.add(this.element,"keyup",this.keyUpQT,this)}}},e.prototype.openQuickToolbarPopup=function(e){var t={offsetX:e.positionX,offsetY:e.positionY,relateTo:e.targetElement};this.popupObj.setProperties(t),sf.base.removeClass([this.element],["e-hide","e-popup-open"]),this.popupObj.show(),this.isRendered=!0,this.parent.dotNetRef.invokeMethodAsync("UpdateClass",this.popupObj.element.classList.toString(),this.type)},e.prototype.hidePopup=function(){var e=this.parent.viewSourceModule.getViewPanel();sf.base.Browser.isDevice&&!C()&&sf.base.removeClass([this.parent.getToolbar()],["e-hide"]),sf.base.isNullOrUndefined(this.parent.getToolbar())||this.parent.inlineMode.enable||sf.base.isNullOrUndefined(e)||e.style.display,this.removeEleFromDOM(),this.isRendered=!1,sf.base.EventHandler.remove(this.element,"keyup",this.keyUpQT)},e.prototype.removeEleFromDOM=function(){this.popupObj.hide(),this.isRendered&&this.parent.quickTbClosedEnabled&&this.parent.dotNetRef.invokeMethodAsync("QuickToolbarCloseEvent")},e.prototype.updateStatus=function(e){if(this.element.classList.contains("e-rte-inline-popup")||this.element.classList.contains("e-rte-text-popup")){var t,n;if(this.parent.inlineMode.enable&&!this.parent.quickToolbarModule.textQTBar){if((t=sf.base.selectAll(".e-toolbar-item",this.element)).length<=0)return;n={args:e,dropDownModule:null,parent:this.parent,tbElements:t,tbItems:this.parent.toolbarSettings.items}}else if(!this.parent.inlineMode.enable&&!sf.base.isNullOrUndefined(this.parent.quickToolbarModule.textQTBar)){if((t=sf.base.selectAll(".e-toolbar-item",this.parent.quickToolbarModule.textQTBar.element)).length<=0)return;n={args:e,dropDownModule:null,parent:this.parent,tbElements:t,tbItems:this.parent.quickToolbarSettings.text}}sf.base.isNullOrUndefined(n)||se(n)}},e.prototype.keyUpQT=function(e){27!==e.which||this.escapeKeyPressed||this.parent.observer.notify("focusChange",{}),this.escapeKeyPressed=!1},e.prototype.preventQuickToolbarClose=function(e){e.linkQTBar&&(e.linkQTBar.escapeKeyPressed=!0),e.imageQTBar&&(e.imageQTBar.escapeKeyPressed=!0),e.audioQTBar&&(e.audioQTBar.escapeKeyPressed=!0),e.videoQTBar&&(e.videoQTBar.escapeKeyPressed=!0),e.tableQTBar&&(e.tableQTBar.escapeKeyPressed=!0),e.inlineQTBar&&(e.inlineQTBar.escapeKeyPressed=!0)},e.prototype.addEventListener=function(){this.parent.observer.on(i,this.destroy,this),(this.parent.inlineMode.enable||this.parent.quickToolbarModule.textQTBar)&&this.parent.observer.on("toolbar-updated",this.updateStatus,this),this.parent.observer.on("preventQuickToolbarClose",this.preventQuickToolbarClose,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(i,this.destroy),(this.parent.inlineMode.enable||this.parent.quickToolbarModule.textQTBar)&&this.parent.observer.off("toolbar-updated",this.updateStatus),this.parent.observer.off("preventQuickToolbarClose",this.preventQuickToolbarClose)},e.prototype.destroy=function(){this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.destroy(),this.removeEleFromDOM(),this.parent.element.append(this.element)),this.removeEventListener(),this.previousTarget=null},e.prototype.getRelativeElement=function(e,t){var n,i=e.focusNode;switch(this.type){case"Inline":case"Text":"TD"!==(n=this.parent.formatter.editorManager.domTree.isBlockNode(i)?i:this.parent.formatter.editorManager.domTree.getParentBlockNode(i)).nodeName&&"TH"!==n.nodeName||(n=sf.base.closest(t,"table"));break;case"Link":n=3===i.nodeType?i.parentElement:i,n=sf.base.closest(n,"a");break;case"Image":case"Audio":case"Video":n=t;break;case"Table":n=sf.base.closest(t,"table")}return n},e.prototype.getSelectionDirection=function(e){if(e&&e.rangeCount>0&&e.getRangeAt(0).collapsed)return"Forward";var t=new Range;return t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t.collapsed?"Backward":"Forward"},e.prototype.getPopupDimension=function(e,t){var n=e.element;n.classList.remove("e-popup-close");var i="width"===t?n.clientWidth:n.clientHeight;return n.classList.add("e-popup-close"),i},e.prototype.calculateOffsetX=function(e){var t,n=this.popupWidth;switch(this.type){case"Text":case"Inline":var i="Backward"===e.direction?e.rangeRect.left:e.rangeRect.right,s=!1===this.parent.iframeSettings.enable?i-e.blockRect.left:i;s<n/4?(t=s-16.5,this.currentTipPosition="Top-Left"):s>n/4&&s<n/2?(t=s-n/4,this.currentTipPosition="Top-LeftMiddle"):s>n/2&&s<3*n/4?(t=s-n/2,this.currentTipPosition="Top-Center"):s>3*n/4&&s<n?(t=s-3*n/4,this.currentTipPosition="Top-RightMiddle"):(t=s-n+16.5,this.currentTipPosition="Top-Right");break;case"Link":case"Image":case"Audio":case"Video":case"Table":var r=e.blockRect.left-e.editPanelDomRect.left,o=e.editPanelDomRect.right-e.blockRect.right;e.blockRect.width>n||r>n/2&&o>n/2?(t=e.blockRect.width/2-n/2,"Link"===this.type?this.currentTipPosition="Top-Center":this.currentTipPosition="Bottom-Center"):o<n/2?(t=-(n-e.blockRect.width),"Link"===this.type?this.currentTipPosition="Top-Right":this.currentTipPosition="Bottom-Right"):r<n/2&&(t=0,"Link"===this.type?this.currentTipPosition="Top-Left":this.currentTipPosition="Bottom-Left"),this.parent.iframeSettings.enable&&(t+=e.blockRect.left)}return t},e.prototype.calculateOffsetY=function(e){var t;switch(this.type){case"Text":case"Inline":case"Link":t=this.parent.iframeSettings.enable?e.rangeRect.bottom+this.tipPointerHeight:e.rangeRect.bottom-e.blockRect.top+this.tipPointerHeight;break;case"Image":case"Audio":case"Video":case"Table":t=this.parent.iframeSettings.enable?-100:-(this.popupHeight+this.tipPointerHeight)}return t},e.prototype.setTipPointerPostion=function(e){if(this.tipPointerElem.className="",this.tipPointerElem.classList.add("e-rte-tip-pointer"),"None"!==e){var t=e.split("-"),n=t[0],i=t[1];this.tipPointerElem.classList.add("e-rte-tip-"+n.toLowerCase()),this.tipPointerElem.classList.add("e-rte-tip-"+i.toLowerCase())}},e.prototype.handleVerticalCollision=function(e,t){return this.parent.iframeSettings.enable?(t="Audio"===this.type||"Image"===this.type||"Table"===this.type||"Video"===this.type?this.handleIFrameMediaCollision(e,t):this.handleIFrameTextVerticalCollision(e,t)).targetElement=this.parent.getPanel().parentElement:t="Audio"===this.type||"Image"===this.type||"Table"===this.type||"Video"===this.type?this.handleMediaVerticalCollision(e,t):this.handleTextVerticalCollision(e,t),t},e.prototype.handleMediaVerticalCollision=function(e,t){var n,i,s=this.parent.scrollParentElements&&this.parent.scrollParentElements.length>0&&"#document"!==this.parent.scrollParentElements[0].nodeName?this.parent.scrollParentElements[0]:this.parent.inputElement,r=s.getBoundingClientRect(),o=e.blockRect,a=this.parent.getToolbarElement().getBoundingClientRect(),l="Bottom"===this.parent.toolbarSettings.position,d=this.parent.toolbarSettings.enableFloating,c=d&&"Top"===this.parent.toolbarSettings.position,h=d&&"Bottom"===this.parent.toolbarSettings.position,p=e.editPanelDomRect,u=this.getSpaceAbove(e,c,a,r),f=this.getSpaceBelow(e,h,a,r),m=this.tipPointerHeight+this.popupHeight,g=this.isElemVisible(o,"top",!1)&&u>m,b=this.isElemVisible(o,"bottom",!1)&&f>m;if(g)n="top",i="flip",this.currentTipPosition=this.currentTipPosition.replace("Top","Bottom"),t.positionY=-(this.popupHeight+this.tipPointerHeight);else if(b)n="bottom",i="flip",this.currentTipPosition=this.currentTipPosition.replace("Bottom","Top"),t.positionY=this.tipPointerHeight;else if(u<m&&f<m){n="top",i="fit";var v=-o.top+a.bottom,y=s===this.parent.inputElement?-o.top:-o.top+p.top;l?t.positionY=y:d?a.top<0?t.positionY=-o.top:t.positionY=v:s===this.parent.inputElement?t.positionY=y:p.top<0?t.positionY=-o.top:t.positionY=-(o.top-r.top),this.currentTipPosition="None"}var C={position:{Y:n,X:this.popupObj.position.X},collision:{Y:i,X:this.popupObj.collision.X}};return this.popupObj.setProperties(C),this.popupObj.dataBind(),t},e.prototype.isElemVisible=function(e,t,n,i){if(n){var s=i.top+e.top,r=i.top+e.bottom;return"top"===t?s>=0&&s<=window.innerHeight:r<=window.innerHeight&&r>=0}return"top"===t?e.top>=0&&e.top<=window.innerHeight:e.bottom<=window.innerHeight&&e.bottom>=0},e.prototype.handleIFrameMediaCollision=function(e,t){var n=this.parent.scrollParentElements&&this.parent.scrollParentElements.length>0&&"#document"!==this.parent.scrollParentElements[0].nodeName?this.parent.scrollParentElements[0]:this.parent.inputElement,i=n.getBoundingClientRect(),s=this.parent.toolbarSettings.enableFloating,r=this.parent.getToolbarElement().getBoundingClientRect(),o=this.parent.getToolbarElement().getBoundingClientRect(),a="Bottom"===this.parent.toolbarSettings.position,l=e.blockRect,d=s&&"Top"===this.parent.toolbarSettings.position,c=s&&"Bottom"===this.parent.toolbarSettings.position,h=this.getIFrameSpaceAbove(e,d,r,i),p=this.getIFrameSpaceBelow(e,c,r,i),u=this.tipPointerHeight+this.popupHeight;if(this.isElemVisible(l,"top",!0,e.iframeRect)&&h>u)t.positionY=l.top-u,this.currentTipPosition=this.currentTipPosition.replace("Top","Bottom");else if(this.isElemVisible(l,"bottom",!0,e.iframeRect)&&p>u)t.positionY=l.bottom+this.tipPointerHeight,this.currentTipPosition=this.currentTipPosition.replace("Bottom","Top");else if(h<u&&p<u){var f=-e.iframeRect.top+r.bottom,m=n===this.parent.inputElement?-e.iframeRect.top:-e.iframeRect.top+i.top;a?t.positionY=m:s?o.top<0?t.positionY=-e.iframeRect.top:t.positionY=f:(this.parent.inputElement,e.iframeRect.top<0?t.positionY=m:t.positionY=f),this.currentTipPosition="None"}return t},e.prototype.getSpaceAbove=function(e,t,n,i){var s,r=e.blockRect,o=e.editPanelDomRect,a=this.getTopCollisionType(r,o,t?n:i);if(t)switch(a){case"ParentElement":case"ScrollableContainer":s=r.top-n.top-n.height;break;case"ViewPort":case"Hidden":s=r.top}else switch(a){case"ParentElement":s=r.top-o.top;break;case"ScrollableContainer":s=i.top-o.top;break;case"ViewPort":case"Hidden":s=r.top}return s},e.prototype.getSpaceBelow=function(e,t,n,i){var s,r=e.blockRect,o=e.editPanelDomRect,a=this.getBottomCollisionType(r,o,t?n:i);if(t)switch(a){case"Hidden":case"ParentElement":case"ScrollableContainer":s=o.bottom-r.bottom-n.height;break;case"ViewPort":s=r.bottom}else switch(a){case"Hidden":case"ParentElement":s=o.bottom-r.bottom;break;case"ScrollableContainer":s=i.bottom-r.bottom;break;case"ViewPort":s=window.innerHeight-r.bottom}var l=t?this.toolbarHeight:0;return window.innerHeight-r.bottom-l<this.popupHeight+this.tipPointerHeight&&(s=0),s},e.prototype.handleTextVerticalCollision=function(e,t){var n=(this.parent.scrollParentElements&&this.parent.scrollParentElements.length>0&&"#document"!==this.parent.scrollParentElements[0].nodeName?this.parent.scrollParentElements[0]:this.parent.inputElement).getBoundingClientRect(),i=e.blockRect,s=this.parent.getToolbarElement().getBoundingClientRect(),r=this.parent.toolbarSettings.enableFloating,o=r&&"Top"===this.parent.toolbarSettings.position,a=r&&"Bottom"===this.parent.toolbarSettings.position,l=i.top,d=i.bottom,c=this.getSpaceAbove(e,o,s,n),h=this.getSpaceBelow(e,a,s,n),p=this.tipPointerHeight+this.popupHeight,u=this.isElemVisible(i,"top",!1)&&c>p&&l>p;return"Backward"===e.direction&&u||!(this.isElemVisible(i,"bottom",!1)&&h>p&&d>p)?(u&&(t.positionY=-(this.popupHeight+10)+(e.rangeRect.top-e.blockRect.top),this.currentTipPosition=this.currentTipPosition.replace("Top","Bottom")),t):t},e.prototype.handleIFrameTextVerticalCollision=function(e,t){var n=(this.parent.scrollParentElements&&this.parent.scrollParentElements.length>0&&"#document"!==this.parent.scrollParentElements[0].nodeName?this.parent.scrollParentElements[0]:this.parent.inputElement).getBoundingClientRect(),i=this.parent.toolbarSettings.enableFloating,s=this.parent.getToolbarElement().getBoundingClientRect(),r=i&&"Top"===this.parent.toolbarSettings.position,o=i&&"Bottom"===this.parent.toolbarSettings.position,a=this.getIFrameSpaceAbove(e,r,s,n),l=this.getIFrameSpaceBelow(e,o,s,n),d=e.blockRect,c=this.tipPointerHeight+this.popupHeight,h=this.isElemVisible(d,"top",!0,e.iframeRect)&&a>c;return"Backward"===e.direction&&h||!(this.isElemVisible(d,"bottom",!0,e.iframeRect)&&l>c)?(h&&(t.positionY=e.rangeRect.top-c,this.currentTipPosition=this.currentTipPosition.replace("Top","Bottom")),t):t},e.prototype.getTopCollisionType=function(e,t,n){return e.top<0||e.top>=window.innerHeight?"Hidden":t.top>0?"ParentElement":n.top<0?"ViewPort":n.top>0?"ScrollableContainer":"ParentElement"},e.prototype.getBottomCollisionType=function(e,t,n){return e.bottom<0||e.bottom>=window.innerHeight?"Hidden":n.bottom>=window.innerHeight&&t.bottom>=window.innerHeight?"ViewPort":t.bottom<=n.bottom?"ParentElement":"ScrollableContainer"},e.prototype.getIFrameSpaceAbove=function(e,t,n,i){var s,r=e.blockRect,o=e.editPanelDomRect;e.editPanelDomRect.top===i.top&&e.editPanelDomRect.bottom==e.editPanelDomRect.bottom&&(i=e.editPanelDomRect);var a=this.getIFrameTopCollisionType(r,o,t?n:i,e.iframeRect);if(t)switch(a){case"ParentElement":case"ScrollableContainer":s=e.iframeRect.top+r.top-n.top-n.height;break;case"ViewPort":case"Hidden":s=e.iframeRect.top+r.top-n.height}else switch(a){case"ScrollableContainer":s=e.iframeRect.top+e.blockRect.top>i.top?e.iframeRect.top+e.blockRect.top-i.top:-(i.top-(e.iframeRect.top+e.blockRect.top));break;case"ParentElement":s=e.iframeRect.top+r.top-(e.iframeRect.top+e.editPanelDomRect.top);break;case"ViewPort":case"Hidden":s=n.top<0?e.iframeRect.top+r.top:e.iframeRect.top+r.top-n.bottom}return s},e.prototype.getIFrameSpaceBelow=function(e,t,n,i){var s,r=e.blockRect,o=e.editPanelDomRect,a=e.editPanelDomRect.top===i.top&&e.editPanelDomRect.bottom==e.editPanelDomRect.bottom;a&&(i=e.iframeRect);var l=this.getIFrameBottomCollisionType(r,o,t?n:i,e.iframeRect);if(t)switch(l){case"Hidden":case"ParentElement":case"ScrollableContainer":s=e.iframeRect.bottom-(e.iframeRect.top+r.bottom);break;case"ViewPort":s=window.innerHeight-(e.iframeRect.top+r.bottom)}else switch(l){case"Hidden":case"ParentElement":case"ScrollableContainer":s=a||"ParentElement"!==l?i.bottom-(e.iframeRect.top+r.bottom):e.iframeRect.bottom-(e.iframeRect.top+r.bottom);break;case"ViewPort":s=window.innerHeight-(e.iframeRect.top+r.bottom)}var d=e.iframeRect.top+r.bottom,c=this.popupHeight+this.tipPointerHeight,h=d>window.innerHeight,p=d>e.iframeRect.bottom&&d+c>i.bottom;return(h||p)&&(s=0),s},e.prototype.getIFrameTopCollisionType=function(e,t,n,i){return i.top+e.top<0||i.top+e.top>=window.innerHeight?"Hidden":i.top+t.top>0?"ParentElement":n.top<=0?"ViewPort":n.top>0?"ScrollableContainer":"ParentElement"},e.prototype.getIFrameBottomCollisionType=function(e,t,n,i){return i.top+e.bottom<0||i.top+e.bottom>=window.innerHeight||i.top+e.bottom>=i.bottom||i.top+e.bottom>=n.bottom?"Hidden":n.bottom>=window.innerHeight&&i.top+t.bottom>=window.innerHeight?"ViewPort":i.top+t.bottom<=n.bottom?"ParentElement":"ScrollableContainer"},e}(),Dt=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.showImageQTBar=function(e,t){var n=this;if(!this.parent.readonly&&this.parent.quickToolbarSettings.enable){var i=document.querySelector("#"+this.parent.element.id+"_Image_Quick_Popup");sf.base.isNullOrUndefined(this.imageQTBar)&&(this.imageQTBar=new Rt("Image",this.parent),this.imageQTBar.render(i)),this.parent.dotNetRef.invokeMethodAsync("ShowImagePopup",this.imageQTBar.popupObj.element.classList.toString()).then((function(){n.imageQTBar&&n.imageQTBar.showPopup(e,t)}))}},e.prototype.showAudioQTBar=function(e,t){var n=this;if(!this.parent.readonly&&this.parent.quickToolbarSettings.enable){var i=document.querySelector("#"+this.parent.element.id+"_Audio_Quick_Popup");sf.base.isNullOrUndefined(this.audioQTBar)&&(this.audioQTBar=new Rt("Audio",this.parent),this.audioQTBar.render(i)),this.parent.dotNetRef.invokeMethodAsync("ShowAudioQuickToolbar",this.audioQTBar.popupObj.element.classList.toString()).then((function(){n.audioQTBar.showPopup(e,t)}))}},e.prototype.showVideoQTBar=function(e,t){var n=this;if(!this.parent.readonly&&this.parent.quickToolbarSettings.enable){var i=document.querySelector("#"+this.parent.element.id+"_Video_Quick_Popup");sf.base.isNullOrUndefined(this.videoQTBar)&&(this.videoQTBar=new Rt("Video",this.parent),this.videoQTBar.render(i)),this.parent.dotNetRef.invokeMethodAsync("ShowVideoQuickToolbar",this.videoQTBar.popupObj.element.classList.toString()).then((function(){n.videoQTBar&&n.videoQTBar.showPopup(e,t)}))}},e.prototype.hideImageQTBar=function(){this.imageQTBar&&this.imageQTBar.isRendered&&(this.imageQTBar.hidePopup(),this.parent.dotNetRef.invokeMethodAsync("HideImagePopup"))},e.prototype.hideAudioQTBar=function(){this.audioQTBar&&this.audioQTBar.isRendered&&(this.audioQTBar.hidePopup(),this.parent.dotNetRef.invokeMethodAsync("HideAudioQuickToolbar"))},e.prototype.hideVideoQTBar=function(){this.videoQTBar&&this.videoQTBar.isRendered&&(this.videoQTBar.hidePopup(),this.parent.dotNetRef.invokeMethodAsync("HideVideoQuickToolbar"))},e.prototype.showLinkQTBar=function(e,t){var n=this;if(!this.parent.readonly&&this.parent.quickToolbarSettings.enable){var i=document.querySelector("#"+this.parent.element.id+"_Link_Quick_Popup");sf.base.isNullOrUndefined(this.linkQTBar)&&(this.linkQTBar=new Rt("Link",this.parent),this.linkQTBar.render(i)),this.parent.dotNetRef.invokeMethodAsync("ShowLinkPopup",this.linkQTBar.popupObj.element.classList.toString()).then((function(){n.linkQTBar.showPopup(e,t)}))}},e.prototype.hideLinkQTBar=function(){this.linkQTBar&&this.linkQTBar.isRendered&&(this.linkQTBar.hidePopup(),this.parent.dotNetRef.invokeMethodAsync("HideLinkPopup"))},e.prototype.showTableQTBar=function(e,t){var n=this;if(!this.parent.readonly&&this.parent.quickToolbarSettings.enable){var i=document.querySelector("#"+this.parent.element.id+"_Table_Quick_Popup");sf.base.isNullOrUndefined(this.tableQTBar)&&(this.tableQTBar=new Rt("Table",this.parent),this.tableQTBar.render(i));var s=e.closest("th")?e.closest("th").nodeName:"";this.parent.dotNetRef.invokeMethodAsync("ShowTablePopup",this.tableQTBar.popupObj.element.classList.toString(),s).then((function(){n.tableQTBar&&n.tableQTBar.showPopup(e,t)}))}},e.prototype.hideTableQTBar=function(){this.tableQTBar&&this.tableQTBar.isRendered&&(this.tableQTBar.hidePopup(),this.parent.dotNetRef.invokeMethodAsync("HideTablePopup"))},e.prototype.showInlineQTBar=function(e,t){var n=this;if("HTML"===e.nodeName||"#document"===e.nodeName){var i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.getDocument());e=i.commonAncestorContainer.parentElement}if(!this.parent.readonly&&this.parent.inlineMode.enable&&this.parent.inlineMode.enable&&(!sf.base.Browser.isDevice||C())){var s=document.querySelector("#"+this.parent.element.id+"_Inline_Quick_Popup");sf.base.isNullOrUndefined(this.inlineQTBar)&&(this.inlineQTBar=new Rt("Inline",this.parent),this.inlineQTBar.render(s)),sf.base.EventHandler.add(this.inlineQTBar.element,"mousedown",this.onMouseDown,this);var r=this.inlineQTBar.popupObj.element.classList.toString();this.parent.dotNetRef.invokeMethodAsync("ShowInlinePopup",r).then((function(){n.inlineQTBar.showPopup(e,t)}))}},e.prototype.showTextQTBar=function(e,t){var n=this;if(!this.parent.readonly&&this.parent.quickToolbarSettings.text.length>0){var i=document.querySelector("#"+this.parent.element.id+"_Text_Quick_Popup");sf.base.isNullOrUndefined(this.textQTBar)&&(this.textQTBar=new Rt("Text",this.parent),this.textQTBar.render(i)),sf.base.EventHandler.add(this.textQTBar.element,"mousedown",this.onMouseDown,this);var s=this.textQTBar.popupObj.element.classList.toString();this.parent.dotNetRef.invokeMethodAsync("ShowTextPopup",s).then((function(){n.textQTBar.showPopup(e,t)}))}},e.prototype.hideInlineQTBar=function(){this.inlineQTBar&&this.inlineQTBar.isRendered&&(this.inlineQTBar.hidePopup(),this.parent.dotNetRef.invokeMethodAsync("HideInlinePopup"))},e.prototype.hideTextQTBar=function(){this.textQTBar&&this.textQTBar.isRendered&&(this.textQTBar.hidePopup(),this.parent.dotNetRef.invokeMethodAsync("HideTextPopup"))},e.prototype.hideQuickToolbars=function(){sf.base.isNullOrUndefined(this.linkQTBar)||this.hideLinkQTBar(),sf.base.isNullOrUndefined(this.imageQTBar)||this.hideImageQTBar(),sf.base.isNullOrUndefined(this.audioQTBar)||this.hideAudioQTBar(),sf.base.isNullOrUndefined(this.videoQTBar)||this.hideVideoQTBar(),sf.base.isNullOrUndefined(this.tableQTBar)||this.hideTableQTBar(),!this.parent.inlineMode.enable||sf.base.Browser.isDevice&&!C()||this.hideInlineQTBar(),sf.base.isNullOrUndefined(this.textQTBar)||this.hideTextQTBar()},e.prototype.selectionChangeHandler=function(e){var t=this;this.parent.inlineMode.onSelection&&(clearTimeout(this.deBouncer),this.deBouncer=window.setTimeout((function(){t.onSelectionChange(e)}),1e3))},e.prototype.onSelectionChange=function(e){sf.base.isNullOrUndefined(sf.base.select(".e-rte-inline-popup.e-popup",document.body))&&(this.parent.getDocument().getSelection().isCollapsed||this.mouseUpHandler({args:e}))},e.prototype.toolbarUpdated=function(e){sf.base.isNullOrUndefined(this.linkQTBar)||this.hideLinkQTBar(),sf.base.isNullOrUndefined(this.imageQTBar)||this.hideImageQTBar(),sf.base.isNullOrUndefined(this.audioQTBar)||this.hideAudioQTBar(),sf.base.isNullOrUndefined(this.videoQTBar)||this.hideVideoQTBar(),sf.base.isNullOrUndefined(this.tableQTBar)||this.hideTableQTBar()},e.prototype.deBounce=function(e,t){var n=this;clearTimeout(this.deBouncer),this.deBouncer=window.setTimeout((function(){n.showInlineQTBar(e,t)}),1e3)},e.prototype.onMouseDown=function(e){this.parent.isBlur=!1,this.parent.isRTE=!0},e.prototype.mouseUpHandler=function(e){if(this.parent.inlineMode.enable&&(!sf.base.Browser.isDevice||C())){var t=e.args.touches?e.args.changedTouches[0]:e.args,n=this.parent.getRange(),i=e.args.target,s=sf.base.select(".e-rte-inline-popup",document.body);if(sf.base.isNullOrUndefined(s)||s.classList.contains("e-rte-hidden")){if(C()&&e.touchData&&e.touchData.prevClientX!==e.touchData.clientX&&e.touchData.prevClientY!==e.touchData.clientY)return;this.hideInlineQTBar();var r=this.parent.element.getBoundingClientRect().left;if(this.offsetX=this.parent.iframeSettings.enable?window.scrollX+r+t.clientX:t.pageX,this.offsetY=re(t,this.parent.element,this.parent.iframeSettings.enable),"TEXTAREA"===i.nodeName)this.showInlineQTBar(i,e.args);else{var o=sf.base.closest(i,"a");if(!("IMG"===(i=o||i).tagName||"A"===i.tagName||sf.base.closest(i,"td,th")&&n.collapsed)){var a=n.startOffset===n.endOffset&&n.startContainer===n.endContainer;if(this.parent.inlineMode.onSelection&&a||!this.parent.inlineMode.onSelection&&!a)return;this.target=i,this.showInlineQTBar(i,e.args)}}}}if(!this.parent.inlineMode.enable&&"HTML"===this.parent.editorMode){t=e.args.touches?e.args.changedTouches[0]:e.args,i=e.args.target;this.hideQuickToolbars();r=this.parent.element.getBoundingClientRect().left;if(this.offsetX=this.parent.iframeSettings.enable?this.parent.element.ownerDocument.documentElement.scrollLeft+r+t.clientX:t.pageX,this.offsetY=re(t,this.parent.element,this.parent.iframeSettings.enable),(n=this.parent.getRange()).endContainer.parentElement.tagName===n.startContainer.parentElement.tagName&&"A"===n.startContainer.parentElement.tagName&&"A"===n.endContainer.parentElement.tagName||"IMG"===i.tagName||"VIDEO"===i.tagName||this.parent.videoModule.isEmbedVidElem(i)||"AUDIO"===i.tagName||i.childNodes[0]&&1===i.childNodes[0].nodeType&&i.childNodes[0].classList.contains("e-rte-audio")||this.parent.getRange().startOffset===this.parent.getRange().endOffset||this.hasResizeElement(this.parent.inputElement))return;this.target=i,this.showTextQTBar(i,e.args)}},e.prototype.hasResizeElement=function(e){return!(!e||!e.querySelector(".e-img-resize")&&!e.querySelector(".e-vid-resize"))},e.prototype.keyDownHandler=function(e){e.args.altKey||!this.parent.inlineMode.enable||sf.base.Browser.isDevice&&!C()||sf.base.isNullOrUndefined(sf.base.select(".e-rte-inline-popup.e-popup",document))||this.hideInlineQTBar(),sf.base.isNullOrUndefined(this.textQTBar)||sf.base.isNullOrUndefined(this.textQTBar.element)||!this.textQTBar.element.classList.contains("e-popup-open")||this.hideTextQTBar()},e.prototype.inlineQTBarMouseDownHandler=function(){!this.parent.inlineMode.enable||sf.base.Browser.isDevice&&!C()||sf.base.isNullOrUndefined(sf.base.select(".e-rte-inline-popup.e-popup",document))||this.hideInlineQTBar(),sf.base.isNullOrUndefined(this.textQTBar)||sf.base.isNullOrUndefined(this.textQTBar.element)||!this.textQTBar.element.classList.contains("e-popup-open")||this.hideTextQTBar()},e.prototype.keyUpHandler=function(e){var t=this,n=e.args;if(this.parent.inlineMode.enable&&!sf.base.Browser.isDevice){if(this.parent.inlineMode.onSelection)return void(this.parent.getSelection().length>0&&(n.ctrlKey&&65===n.keyCode||n.shiftKey&&(33===n.keyCode||34===n.keyCode||35===n.keyCode||36===n.keyCode||37===n.keyCode||38===n.keyCode||39===n.keyCode||40===n.keyCode))&&(this.showInlineQTBarTimeOut&&(clearTimeout(this.showInlineQTBarTimeOut),this.showInlineQTBarTimeOut=null),this.showInlineQTBarTimeOut=window.setTimeout((function(){t.showInlineQTBar(n.target,e.args)}),600)));this.deBounce(n.target,e.args)}this.parent.quickToolbarSettings.text&&!sf.base.Browser.isDevice&&this.parent.getSelection().length>0&&(n.ctrlKey&&65===n.keyCode||n.shiftKey&&(33===n.keyCode||34===n.keyCode||35===n.keyCode||36===n.keyCode||37===n.keyCode||38===n.keyCode||39===n.keyCode||40===n.keyCode))&&this.showTextQTBar(n.target,e.args)},e.prototype.onKeyDown=function(e){var t=e.args;8!==t.which&&46!==t.which||(this.imageQTBar&&!te(this.imageQTBar.element,"e-popup-close")&&this.imageQTBar.hidePopup(),this.audioQTBar&&!te(this.audioQTBar.element,"e-popup-close")&&this.audioQTBar.hidePopup(),this.videoQTBar&&!te(this.videoQTBar.element,"e-popup-close")&&this.videoQTBar.hidePopup())},e.prototype.onIframeMouseDown=function(){this.hideQuickToolbars(),this.hideInlineQTBar()},e.prototype.addEventListener=function(){this.parent.inlineMode.enable&&this.parent.inlineMode.onSelection&&C()&&sf.base.EventHandler.add(this.parent.getDocument(),"selectionchange",this.selectionChangeHandler,this),this.parent.observer.on("toolbar-updated",this.toolbarUpdated,this),this.wireInlineQTBarEvents(),"hide"===this.parent.quickToolbarSettings.actionOnScroll?(this.parent.observer.on("scroll",this.hideQuickToolbars,this),this.parent.observer.on("contentscroll",this.hideQuickToolbars,this)):(this.parent.observer.on("scroll",this.onScroll,this),this.parent.observer.on("contentscroll",this.onScroll,this)),this.parent.observer.on("focusChange",this.hideQuickToolbars,this),this.parent.observer.on("iframe-click",this.onIframeMouseDown,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on("resize",this.onWindowResize,this),this.parent.observer.on("selectionChangeMouseUp",this.mouseUpHandler,this)},e.prototype.removeEventListener=function(){sf.base.EventHandler.remove(this.parent.getDocument(),"selectionchange",this.selectionChangeHandler),this.parent.observer.off("toolbar-updated",this.toolbarUpdated),this.unWireInlineQTBarEvents(),this.parent.observer.off("focusChange",this.hideQuickToolbars),this.parent.observer.off(i,this.destroy),this.parent.observer.off("iframe-click",this.onIframeMouseDown),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off("resize",this.onWindowResize),this.parent.observer.off("selectionChangeMouseUp",this.mouseUpHandler)},e.prototype.wireInlineQTBarEvents=function(){this.parent.observer.on("mouseUp",this.mouseUpHandler,this),this.parent.observer.on(d,this.inlineQTBarMouseDownHandler,this),this.parent.observer.on(o,this.keyDownHandler,this),this.parent.observer.on(r,this.keyUpHandler,this),this.parent.observer.on("sourceCodeMouseDown",this.mouseUpHandler,this)},e.prototype.unWireInlineQTBarEvents=function(){this.parent.observer.off("mouseUp",this.mouseUpHandler),this.parent.observer.off(d,this.inlineQTBarMouseDownHandler),this.parent.observer.off(o,this.keyDownHandler),this.parent.observer.off(r,this.keyUpHandler),this.parent.observer.off("sourceCodeMouseDown",this.mouseUpHandler)},e.prototype.destroy=function(){this.linkQTBar&&(sf.base.EventHandler.remove(this.linkQTBar.element,"mousedown",this.onMouseDown),this.linkQTBar.destroy()),this.imageQTBar&&(sf.base.EventHandler.remove(this.imageQTBar.element,"mousedown",this.onMouseDown),this.imageQTBar.destroy()),this.audioQTBar&&(sf.base.EventHandler.remove(this.audioQTBar.element,"mousedown",this.onMouseDown),this.audioQTBar.destroy()),this.videoQTBar&&(sf.base.EventHandler.remove(this.videoQTBar.element,"mousedown",this.onMouseDown),this.videoQTBar.destroy()),this.tableQTBar&&(sf.base.EventHandler.remove(this.tableQTBar.element,"mousedown",this.onMouseDown),this.tableQTBar.destroy()),this.inlineQTBar&&(sf.base.EventHandler.remove(this.inlineQTBar.element,"mousedown",this.onMouseDown),C()&&sf.base.EventHandler.remove(document,"selectionchange",this.selectionChangeHandler),this.inlineQTBar.destroy()),this.removeEventListener()},e.prototype.getInlineQTBarElement=function(){return this.inlineQTBar&&this.inlineQTBar.element?this.inlineQTBar.element:null},e.prototype.getQuickToolbarInstance=function(){return[this.linkQTBar,this.imageQTBar,this.audioQTBar,this.videoQTBar,this.tableQTBar,this.inlineQTBar,this.textQTBar]},e.prototype.getTableQTBarElement=function(){return this.tableQTBar&&this.tableQTBar.element?this.tableQTBar.element:null},e.prototype.onScroll=function(e){this.refreshQuickToolbarPopup(e)},e.prototype.refreshQuickToolbarPopup=function(e){for(var t=0,n=this.getQuickToolbarInstance();t<n.length;t++){var i=n[t];if(i&&i.isRendered&&i.element&&i.element.classList.contains("e-popup-open")){i.hidePopup();var s=i.previousTarget;i.showPopup(s,e)}}},e.prototype.onWindowResize=function(e){sf.base.isNullOrUndefined(e.args)||this.refreshQuickToolbarPopup(e.args)},e}(),It="e-file-status",Ut="e-upload-file-list",Pt="e-file-abort-btn",Ht="e-file-reload-btn",qt="e-file-remove-btn",Ft="e-file-delete-btn",zt="e-upload-progress-bar",Vt="e-upload-progress-wrap",jt=function(){function e(e,t,n){this.fileList=[],this.filesData=[],this.files=[],this.minFileSize=0,this.maxFileSize=3e7,this.uploadedFilesData=[],this.base64String=[],this.isForm=!1,this.allTypes=!1,this.btnTabIndex="0",this.disableKeyboardNavigation=!1,this.actionCompleteCount=0,this.flag=!0,this.selectedFiles=[],this.uploaderName="UploadFiles",this.element=t,this.parent=n,this.cssClass=e.cssClass,this.asyncSettings=e.asyncSettings,this.allowedExtensions=e.allowedExtensions,this.addEventListener(),this.render()}return e.prototype.addEventListener=function(){this.parent.observer.on("beforePasteUploadCallBack",this.beforePasteUploadCallBack,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("beforePasteUploadCallBack",this.beforePasteUploadCallBack)},e.prototype.render=function(){this.browserName=sf.base.Browser.info.name,this.uploaderName=this.element.getAttribute("name"),this.initializeUpload(),this.wireEvents(),this.setExtensions(this.allowedExtensions),this.setRTL(),this.setCSSClass()},e.prototype.initializeUpload=function(){this.element.setAttribute("aria-label","Uploader"),this.element.setAttribute("tabindex","-1");var e=sf.base.createElement("span",{className:"e-file-select",attrs:{style:"display: none;"}});this.element.parentElement.insertBefore(e,this.element),this.dropAreaWrapper=sf.base.createElement("div",{className:"e-file-select-wrap"}),this.element.parentElement.insertBefore(this.dropAreaWrapper,this.element),e.appendChild(this.element),this.dropAreaWrapper.appendChild(e),this.uploadWrapper=sf.base.createElement("div",{className:"e-upload e-lib e-control-wrapper",attrs:{style:"background: white"}}),this.dropAreaWrapper.parentElement.insertBefore(this.uploadWrapper,this.dropAreaWrapper),this.uploadWrapper.appendChild(this.dropAreaWrapper)},e.prototype.setExtensions=function(e){""===e||sf.base.isNullOrUndefined(e)?this.element.removeAttribute("accept"):this.element.setAttribute("accept",e)},e.prototype.setRTL=function(){this.enableRtl?sf.base.addClass([this.uploadWrapper],"e-rtl"):sf.base.removeClass([this.uploadWrapper],"e-rtl")},e.prototype.setCSSClass=function(e){var t=this.cssClass;sf.base.isNullOrUndefined(this.cssClass)||""===this.cssClass||(t=this.cssClass.replace(/\s+/g," ").trim()),sf.base.isNullOrUndefined(this.cssClass)||""===t||sf.base.addClass([this.uploadWrapper],t.split(t.indexOf(",")>-1?",":" "));var n=e;sf.base.isNullOrUndefined(e)||(n=e.replace(/\s+/g," ").trim()),sf.base.isNullOrUndefined(e)||""===n||sf.base.removeClass([this.uploadWrapper],n.split(" "))},e.prototype.createFileList=function(e,t){if(this.createParentUL(),this.isFormUpload())this.uploadWrapper.classList.add("e-form-upload"),this.formFileList(e,this.element.files);else for(var n=0,i=e;n<i.length;n++){var s=i[n],r=sf.base.createElement("li",{className:Ut,attrs:{"data-file-name":s.name,"data-files-count":"1"}}),o=sf.base.createElement("span",{className:"e-file-container"}),a=sf.base.createElement("span",{className:"e-file-name",attrs:{title:s.name}});a.innerHTML=this.getFileNameOnly(s.name);var l=sf.base.createElement("span",{className:"e-file-type"});if(l.innerHTML="."+this.getFileType(s.name),this.enableRtl){var d=sf.base.createElement("span",{className:"e-rtl-container"});d.appendChild(l),d.appendChild(a),o.appendChild(d)}else o.appendChild(a),o.appendChild(l);var c=sf.base.createElement("span",{className:"e-file-size"});c.innerHTML=this.bytesToSize(s.size),o.appendChild(c);var h=sf.base.createElement("span",{className:It});o.appendChild(h),h.innerHTML=s.status,r.appendChild(o);var p=sf.base.createElement("span",{className:" e-icons",attrs:{tabindex:this.btnTabIndex}});"msie"===this.browserName&&p.classList.add("e-msie"),p.setAttribute("title","Remove"),r.appendChild(p),sf.base.EventHandler.add(p,"click",this.removeFiles,this),"2"===s.statusCode?(h.classList.add("e-upload-success"),p.classList.add(Ft),p.setAttribute("title","Delete file")):"1"!==s.statusCode&&(h.classList.remove("e-upload-success"),h.classList.add("e-validation-fails")),"1"===s.statusCode&&""!==this.asyncSettings.saveUrl&&(h.innerHTML=""),p.classList.contains(Ft)||p.classList.add(qt),this.listParent.appendChild(r),this.fileList.push(r),this.truncateName(a);var u=this.flag;this.isPreLoadFile(s)&&(this.flag=!1,this.checkActionComplete(!0),this.flag=u)}},e.prototype.createParentUL=function(){sf.base.isNullOrUndefined(this.listParent)&&(this.listParent=sf.base.createElement("ul",{className:"e-upload-files"}),this.uploadWrapper.appendChild(this.listParent))},e.prototype.isFormUpload=function(){var e=!1;return!this.isForm||!sf.base.isNullOrUndefined(this.asyncSettings.saveUrl)&&""!==this.asyncSettings.saveUrl||!sf.base.isNullOrUndefined(this.asyncSettings.removeUrl)&&""!==this.asyncSettings.removeUrl||(e=!0),e},e.prototype.getFileType=function(e){var t,n=e.lastIndexOf(".");return n>=0&&(t=e.substring(n+1)),t||""},e.prototype.getFileNameOnly=function(e){var t=this.getFileType(e);return e.split("."+t)[0]},e.prototype.truncateName=function(e){var t=e;("edge"!==this.browserName&&t.offsetWidth<t.scrollWidth||t.offsetWidth+1<t.scrollWidth)&&this.getSlicedName(t)},e.prototype.getSlicedName=function(e){var t=e.textContent;e.dataset.tail=t.slice(t.length-10)},e.prototype.setListToFileInfo=function(e,t){for(var n=0,i=e;n<i.length;n++){i[n].list=t}},e.prototype.getFileSize=function(e){for(var t=0,n=0,i=e;n<i.length;n++){t+=i[n].size}return t},e.prototype.bytesToSize=function(e){var t=-1;if(!e)return"0.0 KB";do{e/=1024,t++}while(e>99);return t>=2&&(e*=1024,t=1),Math.max(e,0).toFixed(1)+" "+["KB","MB"][t]},e.prototype.createFormInput=function(e){var t=this.element.cloneNode(!0);t.classList.add("e-hidden-file-input");for(var n=0,i=e;n<i.length;n++){i[n].input=t}t.setAttribute("name",this.uploaderName),this.uploadWrapper.querySelector(".e-file-select").appendChild(t),"msie"!==this.browserName&&"edge"!==this.browserName&&(this.element.value="")},e.prototype.checkActionComplete=function(e){e?++this.actionCompleteCount:--this.actionCompleteCount,this.filesData.length===this.actionCompleteCount&&this.flag&&(this.flag=!1)},e.prototype.isPreLoadFile=function(e){for(var t=!1,n=0;n<this.files.length;n++)this.files[n].name===e.name.slice(0,e.name.lastIndexOf("."))&&this.files[n].type===e.type&&(t=!0);return t},e.prototype.validatedFileSize=function(e){var t="",n="";return e<this.minFileSize?t="File size is too small":e>this.maxFileSize?n="File size is too large":(t="",n=""),{minSize:t,maxSize:n}},e.prototype.isBlank=function(e){return!e||/^\s*$/.test(e)},e.prototype.addInvalidClass=function(e){e.classList.add("e-file-invalid")},e.prototype.checkExtension=function(e){var t=e;if(!this.isBlank(this.allowedExtensions)){for(var n=[],i=0,s=this.allowedExtensions.split(",");i<s.length;i++){var r=s[i];n.push(r.trim().toLocaleLowerCase())}for(var o=0;o<e.length;o++)-1===n.indexOf(("."+e[o].type).toLocaleLowerCase())&&(e[o].status="File type is not allowed",e[o].statusCode="0")}return t},e.prototype.getFilesData=function(e){return sf.base.isNullOrUndefined(e)?this.filesData:this.getSelectedFiles(e)},e.prototype.getFilesInArray=function(e){var t=[];return e instanceof Array?t=e:t.push(e),t},e.prototype.formValidateFileInfo=function(e,t){var n=e.status,i=this.validatedFileSize(e.size);""===i.minSize&&""===i.maxSize||(this.addInvalidClass(t),n=""!==i.minSize?"File size is too small":""!==i.maxSize?"File size is too large":n);var s=this.checkExtension(this.getFilesInArray(e))[0].status;return"File type is not allowed"===s&&(this.addInvalidClass(t),n=s),n},e.prototype.clearAll=function(){if(sf.base.isNullOrUndefined(this.listParent))return"msie"!==this.browserName&&(this.element.value=""),void(this.filesData=[]);this.clearData(),this.actionCompleteCount=0},e.prototype.clearData=function(e){sf.base.isNullOrUndefined(this.listParent)||(sf.base.detach(this.listParent),this.listParent=null),"msie"===this.browserName||e||(this.element.value=""),this.fileList=[],this.filesData=[],this.removeActionButtons()},e.prototype.removeActionButtons=function(){this.actionButtons&&(sf.base.detach(this.actionButtons),this.actionButtons=null)},e.prototype.checkActionButtonStatus=function(){if(this.actionButtons){var e=this.uploadWrapper.querySelectorAll(".e-validation-fails").length+this.uploadWrapper.querySelectorAll(".e-upload-fails:not(.e-upload-progress)").length+this.uploadWrapper.querySelectorAll("span.e-upload-success").length+this.uploadWrapper.querySelectorAll("span.e-upload-progress").length;e>0&&e===this.uploadWrapper.querySelectorAll("li").length?this.uploadButton.setAttribute("disabled","disabled"):this.uploadButton.removeAttribute("disabled")}},e.prototype.getSelectedFiles=function(e){for(var t=[],n=this.fileList[e],i=this.getFilesData(),s=+n.getAttribute("data-files-count"),r=0,o=0;o<e;o++)r+=+this.fileList[o].getAttribute("data-files-count");for(var a=r;a<r+s;a++)t.push(i[a]);return t},e.prototype.formFileList=function(e,t){var n=sf.base.createElement("li",{className:Ut});n.setAttribute("data-files-count",e.length+"");for(var i,s=sf.base.createElement("span",{className:"e-file-container"}),r=0,o=e;r<o.length;r++){var a=o[r],l=sf.base.createElement("span",{className:"e-file-name"});l.innerHTML=this.getFileNameOnly(a.name);var d=sf.base.createElement("span",{className:"e-file-type"});if(d.innerHTML="."+this.getFileType(a.name),this.enableRtl){var c=sf.base.createElement("span",{className:"e-rtl-container"});c.appendChild(d),c.appendChild(l),s.appendChild(c)}else s.appendChild(l),s.appendChild(d);this.truncateName(l),i=this.formValidateFileInfo(a,n)}n.appendChild(s),this.setListToFileInfo(e,n);var h=sf.base.createElement("span");if(n.classList.contains("e-file-invalid")?(h.classList.add(It),h.classList.add("e-file-invalid"),h.innerText=e.length>1?"invalidFileSelection":i):(h.classList.add(e.length>1?"e-file-information":"e-file-size"),h.innerText=e.length>1?"totalFiles: "+e.length+" , size: "+this.bytesToSize(this.getFileSize(e)):this.bytesToSize(e[0].size),this.createFormInput(e)),s.appendChild(h),sf.base.isNullOrUndefined(n.querySelector(".e-icons"))){var p=sf.base.createElement("span",{className:"e-icons",attrs:{tabindex:this.btnTabIndex}});"msie"===this.browserName&&p.classList.add("e-msie"),p.setAttribute("title","Remove"),n.appendChild(s),n.appendChild(p),sf.base.EventHandler.add(p,"click",this.removeFiles,this),p.classList.add(qt)}this.listParent.appendChild(n),this.fileList.push(n)},e.prototype.removeFiles=function(e){var t=e.target.parentElement,n=this.fileList.indexOf(t),i=this.fileList[n],s=this.isFormUpload(),r=s?this.getSelectedFiles(n):this.getFilesInArray(this.filesData[n]);if(!sf.base.isNullOrUndefined(r)){if(e.target.classList.contains(Pt)&&!s){if(r[0].statusCode="5",!sf.base.isNullOrUndefined(i)){var o=i.querySelector("."+Pt);sf.popups.createSpinner({target:o,width:"20px"}),sf.popups.showSpinner(o)}i.classList.contains("e-restrict-retry")||this.checkActionComplete(!0)}else sf.base.closest(e.target,".e-spinner-pane")||this.remove(r,!1,!1,!0,e);this.element.value="",this.checkActionButtonStatus()}},e.prototype.spliceFiles=function(e){for(var t=this.fileList[e],n=this.getFilesData(),i=+t.getAttribute("data-files-count"),s=0,r=0;r<e;r++)s+=+this.fileList[r].getAttribute("data-files-count");for(var o=s+i-1;o>=s;o--)n.splice(o,1)},e.prototype.remove=function(e,t,n,i,s){sf.base.isNullOrUndefined(i)&&(i=!0);var r={event:s,cancel:!1,filesData:[],customFormData:[],postRawFile:i,currentRequest:null};if(this.isFormUpload()){r.filesData=e,this.parent.observer.notify("removing",r);for(var o=!1,a=void 0,l=0,d=this.getFilesInArray(e);l<d.length;l++){var c=d[l];if(o||(a=this.fileList.indexOf(c.list)),a>-1){var h=sf.base.isNullOrUndefined(c.input)?null:c.input;h&&sf.base.detach(h),this.spliceFiles(a),sf.base.detach(this.fileList[a]),this.fileList.splice(a,1),o=!0,a=-1}}}else if(this.isForm&&(sf.base.isNullOrUndefined(this.asyncSettings.removeUrl)||""===this.asyncSettings.removeUrl))r.filesData=this.getFilesData(),this.parent.observer.notify("removing",r),this.clearAll();else{var p=[];(e=sf.base.isNullOrUndefined(e)?this.filesData:e)instanceof Array?p=e:p.push(e),r.filesData=p;for(var u=this.asyncSettings.removeUrl,f=""!==u&&!sf.base.isNullOrUndefined(u),m=0,g=p;m<g.length;m++){var b=g[m],v=this.uploadedFilesData.indexOf(b);("2"===b.statusCode||"4"===b.statusCode||"0"===b.statusCode&&-1!==v)&&f?this.removeUploadedFile(b,r,n,t):(n||this.parent.observer.notify("removing",r),this.removeFilesData(b,t)),s&&!s.target.classList.contains(qt)&&this.checkActionComplete(!1)}}},e.prototype.updateCustomHeader=function(e,t){if(t.length>0&&t[0])for(var n=function(n){var i=t[n],s=Object.keys(i).map((function(e){return i[e]}));e.setRequestHeader(Object.keys(i)[0],s)},i=0;i<t.length;i++)n(i)},e.prototype.removeUploadedFile=function(e,t,n,i){var s=this,r=e,o=new sf.base.Ajax(this.asyncSettings.removeUrl,"POST",!0,null);o.emitError=!1;var a=new FormData;o.beforeSend=function(i){t.currentRequest=o.httpRequest,s.currentRequestHeader&&s.updateCustomHeader(o.httpRequest,s.currentRequestHeader),s.customFormDatas&&s.updateFormData(a,s.customFormDatas),n||s.parent.observer.notify("removing",t),s.removingEventCallback(t,a,r,e)},o.onLoad=function(e){return s.removeCompleted(e,r,i),{}},o.onError=function(e){return s.removeFailed(e,r,i),{}},o.send(a)},e.prototype.getResponse=function(e){var t=e.currentTarget;return{readyState:t.readyState,statusCode:t.status,statusText:t.statusText,headers:t.getAllResponseHeaders(),withCredentials:t.withCredentials}},e.prototype.removeCompleted=function(e,t,n){var i=e&&e.currentTarget?this.getResponse(e):null,s=e.target;if(4===s.readyState&&s.status>=200&&s.status<=299){var r={e:e,response:i,operation:"Remove",file:this.updateStatus(t,"File removed successfully","2")};this.parent.observer.notify("success",r),this.removeFilesData(t,n);var o=this.uploadedFilesData.indexOf(t);this.uploadedFilesData.splice(o,1)}else this.removeFailed(e,t,n)},e.prototype.removeFailed=function(e,t,n){var i={e:e,response:e&&e.currentTarget?this.getResponse(e):null,operation:"Remove",file:this.updateStatus(t,"Unable to remove file","0")};if(!n){var s=this.filesData.indexOf(t),r=this.fileList[s];if(r){r.classList.remove("e-upload-success"),r.classList.add("e-upload-fails");var o=r.querySelector("."+It);o&&(o.classList.remove("e-upload-success"),o.classList.add("e-upload-fails"))}this.checkActionButtonStatus()}this.parent.observer.notify("failure",i);var a=this.getLiElement(t);if(!sf.base.isNullOrUndefined(a)&&!sf.base.isNullOrUndefined(a.querySelector("."+Ft))){var l=a.querySelector("."+Ft);sf.popups.hideSpinner(l),sf.base.detach(a.querySelector(".e-spinner-pane"))}},e.prototype.updateStatus=function(e,t,n,i){if(void 0===i&&(i=!0),""===t||sf.base.isNullOrUndefined(t)||""===n||sf.base.isNullOrUndefined(n)||(e.status=t,e.statusCode=n),i){var s=this.getLiElement(e);sf.base.isNullOrUndefined(s)||sf.base.isNullOrUndefined(s.querySelector("."+It))||""===t||sf.base.isNullOrUndefined(t)||(s.querySelector("."+It).textContent=t)}return e},e.prototype.removingEventCallback=function(e,t,n,i){var s=this.element.getAttribute("name"),r=this.getLiElement(i);if(!(sf.base.isNullOrUndefined(r)||sf.base.isNullOrUndefined(r.querySelector("."+Ft))&&sf.base.isNullOrUndefined(r.querySelector("."+qt)))){var o=r.querySelector("."+Ft)?r.querySelector("."+Ft):r.querySelector("."+qt);sf.popups.createSpinner({target:o,width:"20px"}),sf.popups.showSpinner(o)}e.postRawFile&&!sf.base.isNullOrUndefined(n.rawFile)&&""!==n.rawFile?t.append(s,n.rawFile,n.name):t.append(s,n.name),this.updateFormData(t,e.customFormData)},e.prototype.updateFormData=function(e,t){if(t.length>0&&t[0])for(var n=function(n){var i=t[n],s=Object.keys(i).map((function(e){return i[e]}));e.append(Object.keys(i)[0],s)},i=0;i<t.length;i++)n(i)},e.prototype.getLiElement=function(e){for(var t,n=0;n<this.filesData.length;n++)(sf.base.isNullOrUndefined(this.filesData[n].id)||sf.base.isNullOrUndefined(e.id)?this.filesData[n].name===e.name:this.filesData[n].name===e.name&&this.filesData[n].id===e.id)&&(t=n);return this.fileList[t]},e.prototype.removeFilesData=function(e,t){if(!t){var n=this.getLiElement(e);if(!sf.base.isNullOrUndefined(n)){sf.base.detach(n);var i=this.fileList.indexOf(n);this.fileList.splice(i,1),this.filesData.splice(i,1),0!==this.fileList.length||sf.base.isNullOrUndefined(this.listParent)||(sf.base.detach(this.listParent),this.listParent=null,this.removeActionButtons())}}},e.prototype.upload=function(e,t){this.updateFiles=e||this.filesData,this.beforeUploadCustom=!sf.base.isNullOrUndefined(t)&&t;this.parent.observer.notify("beforePasteUpload",{customFormData:[],currentRequest:null,cancel:!1}),sf.base.isNullOrUndefined(this.parent.insertImageSettings.saveUrl)&&this.updateFilesAfterPaste()},e.prototype.beforePasteUploadCallBack=function(e){e.cancel||(this.currentRequestHeader=e.currentRequest?e.currentRequest:this.currentRequestHeader,this.customFormDatas=e.customFormData&&e.customFormData.length>0?e.customFormData:this.customFormDatas),this.updateFilesAfterPaste()},e.prototype.updateFilesAfterPaste=function(){this.beforeUploadFiles=this.getFilesInArray(this.updateFiles),this.uploadFiles(this.beforeUploadFiles,this.beforeUploadCustom)},e.prototype.filterfileList=function(e){for(var t=[],n=0;n<e.length;n++)this.getLiElement(e[n]).classList.contains("e-upload-success")||t.push(e[n]);return t},e.prototype.uploadFiles=function(e,t){var n=[];if(""!==this.asyncSettings.saveUrl&&!sf.base.isNullOrUndefined(this.asyncSettings.saveUrl)){n=!t||sf.base.isNullOrUndefined(t)?this.filterfileList(e):e;for(var i=0;i<n.length;i++)this.uploadFilesRequest(n,i,t)}},e.prototype.updateCustomheader=function(e,t){if(t.length>0&&t[0])for(var n=function(n){var i=t[n],s=Object.keys(i).map((function(e){return i[e]}));e.setRequestHeader(Object.keys(i)[0],s)},i=0;i<t.length;i++)n(i)},e.prototype.eventCancelByArgs=function(e,t,n){var i=this;if(e.cancel=!0,"5"!==t.fileData.statusCode){t.fileData.statusCode="5",t.fileData.status="File upload canceled";var s=this.getLiElement(t.fileData);if(s){sf.base.isNullOrUndefined(s.querySelector("."+It))||(s.querySelector("."+It).innerHTML="File upload canceled",s.querySelector("."+It).classList.add("e-upload-fails")),this.pauseButton=sf.base.createElement("span",{className:"e-icons e-file-reload-btn",attrs:{tabindex:this.btnTabIndex}});var r=s.querySelector("."+qt);r&&r.parentElement.insertBefore(this.pauseButton,r),this.pauseButton.setAttribute("title","Retry"),this.pauseButton.addEventListener("click",(function(e){i.reloadcanceledFile(e,n,s)}),!1),this.checkActionButtonStatus()}}},e.prototype.reloadcanceledFile=function(e,t,n,i){t.statusCode="1",t.status="Ready to upload",i||(n.querySelector("."+It).classList.remove("e-upload-fails"),sf.base.isNullOrUndefined(n.querySelector("."+Ht))||sf.base.detach(n.querySelector("."+Ht)),this.pauseButton=null),n.classList.add("e-restrict-retry"),this.upload([t])},e.prototype.uploadFilesRequest=function(e,t,n){var i=this,s=new sf.base.Ajax(this.asyncSettings.saveUrl,"POST",!0,null);s.emitError=!1;var r={fileData:e[t],customFormData:[],cancel:!1},o=new FormData;if(s.beforeSend=function(n){r.currentRequest=s.httpRequest,r.fileData.rawFile=i.base64String[t],i.currentRequestHeader&&i.updateCustomheader(s.httpRequest,i.currentRequestHeader),i.customFormDatas&&i.updateFormData(o,i.customFormDatas),i.parent.observer.notify("uploading",r),r.cancel&&i.eventCancelByArgs(n,r,e[t]),i.updateFormData(o,r.customFormData)},"1"===e[t].statusCode){var a=this.element.getAttribute("name");o.append(a,e[t].rawFile,e[t].name),s.onLoad=function(s){return i.uploadComplete(s,e[t],n),{}},s.onUploadProgress=function(r){return i.uploadInProgress(r,e[t],n,s),{}},s.onError=function(n){return i.uploadFailed(n,e[t]),{}},s.send(o)}},e.prototype.cancelUploadingFile=function(e,t,n,i){var s=this;if("5"===e.statusCode){var r={event:t,fileData:e,cancel:!1,customFormData:[]};if(this.parent.observer.notify("canceling",r),r.cancel){if(e.statusCode="3",!sf.base.isNullOrUndefined(i)){var o=i.querySelector("."+Pt);sf.base.isNullOrUndefined(o)||(sf.popups.hideSpinner(o),sf.base.detach(i.querySelector(".e-spinner-pane")))}}else{n.emitError=!1,n.httpRequest.abort();var a=new FormData;if("5"===e.statusCode){var l=this.element.getAttribute("name");a.append(l,e.name),a.append("cancel-uploading",e.name),this.updateFormData(a,r.customFormData);var d=new sf.base.Ajax(this.asyncSettings.removeUrl,"POST",!0,null);d.emitError=!1,d.onLoad=function(t){return s.removecanceledFile(t,e),{}},d.send(a)}}}},e.prototype.removecanceledFile=function(e,t){var n=this.getLiElement(t);if(!n.querySelector("."+Ht)&&!sf.base.isNullOrUndefined(n.querySelector("."+Pt))){this.updateStatus(t,"File upload canceled","5"),this.renderFailureState(e,t,n);var i=n.querySelector("."+qt);sf.base.isNullOrUndefined(n)||(sf.popups.hideSpinner(i),sf.base.detach(n.querySelector(".e-spinner-pane")));var s={event:e,response:e&&e.currentTarget?this.getResponse(e):null,operation:"Cancel",file:t};this.parent.observer.notify("success",s)}},e.prototype.uploadInProgress=function(e,t,n,i){var s=this.getLiElement(t);if(!sf.base.isNullOrUndefined(s)||n)if(sf.base.isNullOrUndefined(s))this.cancelUploadingFile(t,e,i);else{"5"===t.statusCode&&this.cancelUploadingFile(t,e,i,s),s.querySelectorAll("."+Vt).length>0||!s.querySelector("."+It)||(s.querySelector("."+It).classList.add("e-upload-progress"),this.createProgressBar(s),this.updateProgressBarClasses(s,"e-upload-progress"),s.querySelector("."+It).classList.remove("e-upload-fails")),this.updateProgressbar(e,s);var r=s.querySelector("."+qt);sf.base.isNullOrUndefined(r)||(r.classList.add(Pt,"e-upload-progress"),r.setAttribute("title","Abort"),r.classList.remove(qt))}},e.prototype.changeProgressValue=function(e,t){e.querySelector("."+zt).style.width=t,e.querySelector(".e-progress-bar-text").textContent=t},e.prototype.updateProgressbar=function(e,t){if(!isNaN(Math.round(e.loaded/e.total*100))&&!sf.base.isNullOrUndefined(t.querySelector("."+zt)))if(sf.base.isNullOrUndefined(this.progressInterval)||""===this.progressInterval)this.changeProgressValue(t,Math.round(e.loaded/e.total*100).toString()+"%");else{var n=Math.round(e.loaded/e.total*100)%parseInt(this.progressInterval,10);0!==n&&100!==n||this.changeProgressValue(t,Math.round(e.loaded/e.total*100).toString()+"%")}},e.prototype.createProgressBar=function(e){var t=sf.base.createElement("span",{className:Vt}),n=sf.base.createElement("progressbar",{className:zt,attrs:{value:"0",max:"100"}}),i=sf.base.createElement("span",{className:"e-progress-inner-wrap"});n.style.width="0%";var s=sf.base.createElement("span",{className:"e-progress-bar-text"});s.textContent="0%",i.appendChild(n),t.appendChild(i),t.appendChild(s),e.querySelector(".e-file-container").appendChild(t)},e.prototype.updateProgressBarClasses=function(e,t){var n=e.querySelector("."+zt);sf.base.isNullOrUndefined(n)||n.classList.add(t)},e.prototype.raiseSuccessEvent=function(e,t){var n={e:e,response:e&&e.currentTarget?this.getResponse(e):null,operation:"upload",file:this.updateStatus(t,"File uploaded successfully","2",!1),statusText:"File uploaded successfully"},i=this.getLiElement(t);if(!sf.base.isNullOrUndefined(i)){var s=i.querySelector(".e-spinner-pane");sf.base.isNullOrUndefined(s)||(sf.popups.hideSpinner(i),sf.base.detach(s))}this.parent.observer.notify("success",n),this.updateStatus(t,n.statusText,"2"),this.uploadedFilesData.push(t),this.checkActionButtonStatus(),this.fileList.length>0&&(this.getLiElement(t).classList.contains("e-restrict-retry")?this.getLiElement(t).classList.remove("e-restrict-retry"):this.checkActionComplete(!0))},e.prototype.uploadComplete=function(e,t,n){var i=e.target;if(4===i.readyState&&i.status>=200&&i.status<=299){var s=this.getLiElement(t);if(sf.base.isNullOrUndefined(s)&&(!n||sf.base.isNullOrUndefined(n)))return;if(!sf.base.isNullOrUndefined(s)){this.updateProgressBarClasses(s,"e-upload-success"),this.removeProgressbar(s,"success");var r=s.querySelector("."+Pt);sf.base.isNullOrUndefined(r)||(r.classList.add(Ft),r.setAttribute("title","Delete file"),r.classList.remove(Pt),r.classList.remove("e-upload-progress"))}this.raiseSuccessEvent(e,t)}else this.uploadFailed(e,t)},e.prototype.uploadFailed=function(e,t){var n=this.getLiElement(t),i={e:e,response:e&&e.currentTarget?this.getResponse(e):null,operation:"upload",file:this.updateStatus(t,"File failed to upload","0",!1),statusText:"File failed to upload"};sf.base.isNullOrUndefined(n)||this.renderFailureState(e,t,n),this.parent.observer.notify("failure",i),this.updateStatus(t,i.statusText,"0"),this.checkActionButtonStatus(),this.checkActionComplete(!0)},e.prototype.renderFailureState=function(e,t,n){var i=this;this.updateProgressBarClasses(n,"e-upload-fails"),this.removeProgressbar(n,"failure"),sf.base.isNullOrUndefined(n.querySelector(".e-file-status"))||n.querySelector(".e-file-status").classList.add("e-upload-fails");var s=n.querySelector("."+Pt);sf.base.isNullOrUndefined(s)||(s.classList.remove(Pt,"e-upload-progress"),s.classList.add(qt),s.setAttribute("title","Remove"),this.pauseButton=sf.base.createElement("span",{className:"e-icons e-file-reload-btn",attrs:{tabindex:this.btnTabIndex}}),s.parentElement.insertBefore(this.pauseButton,s),this.pauseButton.setAttribute("title","Retry"),n.querySelector("."+Ht).addEventListener("click",(function(e){i.reloadcanceledFile(e,t,n,!1)}),!1))},e.prototype.removeProgressbar=function(e,t){var n=this;sf.base.isNullOrUndefined(e.querySelector("."+Vt))||(this.progressAnimation=new sf.base.Animation({duration:1250}),this.progressAnimation.animate(e.querySelector("."+Vt),{name:"FadeOut"}),this.progressAnimation.animate(e.querySelector(".e-progress-bar-text"),{name:"FadeOut"}),setTimeout((function(){n.animateProgressBar(e,t)}),750))},e.prototype.animateProgressBar=function(e,t){"success"===t?sf.base.isNullOrUndefined(e.querySelector("."+It))||(e.querySelector("."+It).classList.remove("e-upload-progress"),this.progressAnimation.animate(e.querySelector("."+It),{name:"FadeIn"}),e.querySelector("."+It).classList.add("e-upload-success")):sf.base.isNullOrUndefined(e.querySelector("."+It))||(e.querySelector("."+It).classList.remove("e-upload-progress"),this.progressAnimation.animate(e.querySelector("."+It),{name:"FadeIn"}),e.querySelector("."+It).classList.add("e-upload-fails")),e.querySelector("."+Vt)&&sf.base.detach(e.querySelector("."+Vt))},e.prototype.onSelectFiles=function(e){var t;if("drop"===e.type){var n=this.sortFilesList=e.dataTransfer.files;"msie"!==this.browserName&&"edge"!==this.browserName&&(this.element.files=n),n.length>0&&(t=this.sortFileList(n),this.renderSelectedFiles(e,t))}else t=[].slice.call(e.target.files),this.renderSelectedFiles(e,t)},e.prototype.sortFileList=function(e){for(var t=e=e||this.sortFilesList,n=[],i=0;i<t.length;i++)n.push(t[i].name);for(var s=[],r=0,o=n.sort();r<o.length;r++){var a=o[r];for(i=0;i<t.length;i++)a===t[i].name&&s.push(t[i])}return s},e.prototype.renderSelectedFiles=function(e,t,n,i){this.base64String=[];var s={event:e,cancel:!1,filesData:[],isModified:!1,modifiedFilesData:[],progressInterval:"",isCanceled:!1,currentRequest:null,customFormData:null};if(t.length<1)return s.isCanceled=!0,void this.parent.observer.notify("selected",s);this.flag=!0;for(var r=[],o=0;o<t.length;o++){var a=n?t[o].file:t[o];this.updateInitialFileDetails(e,t,a,o,r,n,i)}s.filesData=r,this.allowedExtensions.indexOf("*")>-1&&(this.allTypes=!0),this.allTypes||(r=this.checkExtension(r)),this.parent.observer.notify("selected",s),s.cancel=!0,this._internalRenderSelect(s,r)},e.prototype._internalRenderSelect=function(e,t){if(!e.cancel){if(this.currentRequestHeader=e.currentRequest,this.customFormDatas=e.customFormData,this.selectedFiles=this.selectedFiles.concat(t),this.btnTabIndex=this.disableKeyboardNavigation?"-1":"0",e.isModified&&e.modifiedFilesData.length>0){for(var n=0;n<e.modifiedFilesData.length;n++)for(var i=0;i<t.length;i++)e.modifiedFilesData[n].id===t[i].id&&(e.modifiedFilesData[n].rawFile=t[i].rawFile);var s=this.allTypes?e.modifiedFilesData:this.checkExtension(e.modifiedFilesData);this.updateSortedFileList(s),this.filesData=s,this.isForm&&!this.allowUpload()||this.checkAutoUpload(s)}else this.createFileList(t,!0),this.filesData=this.filesData.concat(t),this.isForm&&!this.allowUpload()||this.checkAutoUpload(t);sf.base.isNullOrUndefined(e.progressInterval)||""===e.progressInterval||(this.progressInterval=e.progressInterval),this.filesData.length===this.actionCompleteCount&&this.flag&&(this.flag=!1)}},e.prototype.allowUpload=function(){var e=!1;return this.isForm&&!sf.base.isNullOrUndefined(this.asyncSettings.saveUrl)&&""!==this.asyncSettings.saveUrl&&(e=!0),e},e.prototype.checkAutoUpload=function(e){this.upload(e),this.removeActionButtons(),this.checkActionButtonStatus()},e.prototype.updateSortedFileList=function(e){var t=sf.base.createElement("div",{id:"clonewrapper"}),n=-1;if(this.listParent){for(var i=0;i<this.listParent.querySelectorAll("li").length;i++){var s=this.listParent.querySelectorAll("li")[i];t.appendChild(s.cloneNode(!0))}for(var r=0,o=this.listParent.querySelectorAll("li");r<o.length;r++){var a=o[r];sf.base.detach(a)}this.removeActionButtons();var l=[].slice.call(t.childNodes);sf.base.detach(this.listParent),this.listParent=null,this.fileList=[],this.createParentUL();for(var d=0;d<e.length;d++){for(var c=0;c<this.filesData.length;c++)this.filesData[c].name===e[d].name&&(this.listParent.appendChild(l[c]),sf.base.EventHandler.add(l[c].querySelector(".e-icons"),"click",this.removeFiles,this),this.fileList.push(l[c]),n=d);n!==d&&this.createFileList([e[d]])}}else this.createFileList(e)},e.prototype.updateInitialFileDetails=function(e,t,n,i,s,r,o){var a={name:r?t[i].path.substring(1,t[i].path.length):o?sf.base.getUniqueID(n.name.substring(0,n.name.lastIndexOf(".")))+"."+this.getFileType(n.name):n.name,rawFile:n,size:n.size,status:"Ready to upload",type:this.getFileType(n.name),validationMessages:this.validatedFileSize(n.size),statusCode:"1",id:sf.base.getUniqueID(n.name.substring(0,n.name.lastIndexOf(".")))+"."+this.getFileType(n.name)};o&&(a.fileSource="paste"),a.status=""!==a.validationMessages.minSize?"File size is too small":""!==a.validationMessages.maxSize?"File size is too large":a.status,""===a.validationMessages.minSize&&""===a.validationMessages.maxSize||(a.statusCode="0"),s.push(a)},e.prototype.wireEvents=function(){sf.base.EventHandler.add(this.element,"change",this.onSelectFiles,this)},e.prototype.unWireEvents=function(){sf.base.EventHandler.remove(this.element,"change",this.onSelectFiles)},e.prototype.destroy=function(){this.unWireEvents(),this.removeEventListener()},e}(),Wt=function(){function e(e){this.uploadImgElements=new Map,this.containsHtml=!1,this.cropImageData=[],this.isNotFromHtml=!1,this.pastedValue="",this.isClipboardHTMLDataNull=!1,this.inlineNode=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"],this.blockNode=["div","h1","h2","h3","h4","h5","h6","address","blockquote","button","center","dd","dir","dl","dt","fieldset","frameset","hr","iframe","isindex","li","map","menu","noframes","noscript","object","ol","pre","td","tr","th","tbody","tfoot","thead","table","ul","header","article","nav","footer","section","aside","main","figure","figcaption"],this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.nodeSelectionObj=new et(this.parent.inputElement),this.parent.observer.on("success",this.success,this),this.parent.observer.on("failure",this.failure,this),this.parent.observer.on("selected",this.selected,this),this.parent.observer.on("uploading",this.uploading,this),this.parent.observer.on("pasteClean",this.pasteClean,this),this.parent.observer.on("removing",this.cancelingAndRemoving,this),this.parent.observer.on("canceling",this.cancelingAndRemoving,this),this.parent.observer.on("beforePasteUpload",this.beforeImageUpload,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on("afterPasteCleanUp",this.pasteUpdatedValue,this),this.parent.observer.on(p,this.docClick,this),this.parent.observer.on(s,this.bindOnEnd,this),this.parent.observer.on("updateProperty",this.updatePasteCleanupProperty,this)},e.prototype.destroy=function(){this.refreshPopupTime&&(clearTimeout(this.refreshPopupTime),this.refreshPopupTime=null),this.removeEventListener(),this.pastedValue=""},e.prototype.removeEventListener=function(){this.parent.observer.off("success",this.success),this.parent.observer.off("failure",this.failure),this.parent.observer.off("selected",this.selected),this.parent.observer.off("uploading",this.uploading),this.parent.observer.off("pasteClean",this.pasteClean),this.parent.observer.off("removing",this.cancelingAndRemoving),this.parent.observer.off("canceling",this.cancelingAndRemoving),this.parent.observer.off("beforePasteUpload",this.beforeImageUpload),this.parent.observer.off(i,this.destroy),this.parent.observer.off("afterPasteCleanUp",this.pasteUpdatedValue),this.parent.observer.off(p,this.docClick),this.parent.observer.off(s,this.bindOnEnd),this.parent.observer.off("updateProperty",this.updatePasteCleanupProperty)},e.prototype.bindOnEnd=function(){if("HTML"===this.parent.editorMode&&this.parent.formatter&&this.parent.formatter.editorManager){var e=this.getPasteCleanupModel();this.parent.formatter.editorManager.pasteObj=this.pasteObj=new mt(this.parent.formatter.editorManager,e)}},e.prototype.updatePasteCleanupProperty=function(){var e=this.getPasteCleanupModel();this.pasteObj.updatePasteCleanupModel(e)},e.prototype.getPasteCleanupModel=function(){var e=this;return{rteElement:this.parent.element,enterKey:this.parent.enterKey,rootContainer:this.parent.rootContainer,enableXhtml:this.parent.enableXhtml,iframeSettings:this.parent.iframeSettings,pasteCleanupSettings:this.parent.pasteCleanupSettings,insertImageSettings:this.parent.insertImageSettings,getInsertImgMaxWidth:function(){return e.parent.getInsertImgMaxWidth()},getDocument:function(){return e.parent.getDocument()},getEditPanel:function(){return e.parent.getEditPanel()},updateValue:function(){e.parent.updateValueData()},imageUpload:function(){e.imgUploading(e.parent.inputElement)},getCropImageData:function(){return e.getCropImageData()}}},e.prototype.getCropImageData=function(){return this.cropImageData},e.prototype.pasteClean=function(e){this.isClipboardHTMLDataNull=!1;var t={requestType:"Paste",editorMode:this.parent.editorMode,event:e};if(e.args&&"HTML"===this.parent.editorMode){var n,i=null;if(sf.base.isNullOrUndefined(e.args.clipboardData)||(i=e.args.clipboardData.getData("text/html"),e.args.clipboardData.getData("text/plain")&&(this.pastedValue=e.args.clipboardData.getData("text/plain"))),null!==i)if(0===i.length){var s=this.handlePlainTextPaste(e,t);i=s.value,n=s.file}else i.length>0&&(i=this.handleHtmlPaste(e,t,i));this.processPastedValue(e,t,i,n)}},e.prototype.handlePlainTextPaste=function(e,t){var n=new RegExp(/<\/[a-z][\s\S]*>/i),i=e.args.clipboardData.getData("text/plain");this.parent.beforePasteCleanupEnabled&&this.parent.dotNetRef.invokeMethodAsync("BeforePasteCleanUp",{value:i}),this.isNotFromHtml=""!==i,i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.containsHtml=n.test(i),this.pastedValue=i;var s=this.pasteObj.extractFileFromClipboard(e);if(i=this.notifyPasteEvent(e,t,i,s),!n.test(i)){var r=sf.base.createElement("div");r.innerHTML=this.pasteObj.splitBreakLine(i),i=r.innerHTML,this.isClipboardHTMLDataNull=!0}return{value:i,file:s}},e.prototype.notifyPasteEvent=function(e,t,i,s){var r,o=this,a=i;return this.parent.observer.notify(h,{file:s,args:e.args,text:i,callBack:function(i){"object"===n(r=i)?o.parent.formatter.editorManager.execCommand("Images","Image",e.args,o.imageFormatting.bind(o,t),"pasteCleanup",r,"pasteCleanupModule"):a=r}}),a},e.prototype.handleHtmlPaste=function(e,t,n){var i=this;return this.parent.beforePasteCleanupEnabled&&this.parent.dotNetRef.invokeMethodAsync("BeforePasteCleanUp",{value:n}),this.parent.formatter.editorManager.observer.notify("ms_word_cleanup",{args:e.args,text:e.text,allowedStylePropertiesArray:this.parent.pasteCleanupSettings.allowedStyleProps,callBack:function(e,s,r){n=e.trim(),t.pasteTableSource=r,i.cropImageData=s}}),n},e.prototype.processPastedValue=function(e,t,n,i){null!==n&&""!==n&&(n=n.replace(/<base[^>]*>/g,""));var s=this.parent.getDocument(),r=this.nodeSelectionObj.getRange(s);this.saveSelection=this.nodeSelectionObj.save(r,s);var o=sf.base.createElement("div");o.innerHTML=n;var a=""!==o.textContent||!sf.base.isNullOrUndefined(o.querySelector("img"))||!sf.base.isNullOrUndefined(o.querySelector("table"));n=this.cleanupResizeElements(n),sf.base.isNullOrUndefined(n)||(n=H(n,this.parent.element)),this.determinePasteHandlingMethod(e,t,n,a,i)},e.prototype.cleanupResizeElements=function(e){var t=e;return this.parent.observer.notify("cleanupResizeElements",{value:e,callBack:function(e){t=e}}),t},e.prototype.determinePasteHandlingMethod=function(e,t,n,i,s){var r=-1!==sf.base.Browser.userAgent.indexOf("Firefox");this.parent.pasteCleanupSettings.prompt&&!e.isPlainPaste?i?(e.args.preventDefault(),this.pasteDialog(n,t)):r&&sf.base.isNullOrUndefined(s)&&this.fireFoxImageUpload():i||this.parent.pasteCleanupSettings.plainText||!r?this.parent.pasteCleanupSettings.plainText?(e.args.preventDefault(),this.plainFormatting(n,t)):this.parent.pasteCleanupSettings.keepFormat||e.isPlainPaste?(e.args.preventDefault(),this.formatting(n,!1,t)):(e.args.preventDefault(),this.formatting(n,!0,t)):(e.args.preventDefault(),this.fireFoxImageUpload())},e.prototype.fireFoxImageUpload=function(){var e=this;setTimeout((function(){if(-1!==sf.base.Browser.userAgent.indexOf("Firefox")){var t=e.nodeSelectionObj.getRange(document).startContainer;if("#text"!==t.nodeName&&(t=t.childNodes[e.nodeSelectionObj.getRange(document).startOffset]),t.previousSibling&&"IMG"===t.previousSibling.nodeName){var n=t.previousSibling;n.classList.add("pasteContent_Img"),n.classList.add("e-rte-image"),"inline"===e.parent.insertImageSettings.display.toLowerCase()?n.classList.add("e-imginline"):n.classList.add("e-imgbreak"),e.pasteObj.setImageProperties(n)}e.imgUploading(e.parent.inputElement)}}),500)},e.prototype.imgUploading=function(e){var t=e.querySelectorAll(".pasteContent_Img");this.parent.insertImageSettings.saveUrl&&t.length>0?this.processImagesForUpload(t):"Blob"===this.parent.insertImageSettings.saveFormat&&this.pasteObj.getBlob(t),this.cleanupImageClasses(e)},e.prototype.processImagesForUpload=function(e){for(var t=[],n=[],i=[],s=0;s<e.length;s++){var r=e[s].getAttribute("src");r&&r.split(",")[0].indexOf("base64")>=0&&(t.push(r),n.push(sf.base.getUniqueID("rte_image")),i.push(e[s]))}var o=this.createFilesFromBase64(t,n);this.uploadFiles(o,i),(sf.base.isNullOrUndefined(this.parent.insertImageSettings.saveUrl)||sf.base.isNullOrUndefined(this.parent.insertImageSettings.path))&&"Blob"===this.parent.insertImageSettings.saveFormat&&this.pasteObj.getBlob(e)},e.prototype.createFilesFromBase64=function(e,t){for(var n=[],i=0;i<e.length;i++)n.push(this.pasteObj.base64ToFile(e[i],t[i]));return n},e.prototype.uploadFiles=function(e,t){for(var n=0;n<e.length;n++)this.uploadMethod(e[n],t[n])},e.prototype.cleanupImageClasses=function(e){for(var t=e.querySelectorAll(".pasteContent_Img"),n=0;n<t.length;n++)t[n].classList.remove("pasteContent_Img"),""===t[n].getAttribute("class").trim()&&t[n].removeAttribute("class")},e.prototype.uploadMethod=function(e,t){this.uploadImgElem=t,this.pasteObj.setImageOpacity(this.uploadImgElem);var n=this.pasteObj.createPopupElement();this.createUploadElement();this.createPopupObject(n,t,e),this.configureUploader(e)},e.prototype.createUploadElement=function(){var e=document.createElement("div");return document.body.appendChild(e),e.style.display="none",e},e.prototype.configureUploader=function(e){this.rawFile=void 0;var t={asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl},cssClass:"e-rte-dialog-upload",enableRtl:this.parent.enableRtl,allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString()};this.uploadObj=new jt(t,this.popupObj.element.childNodes[0],this.parent);var n=[{name:e.name,rawFile:e,size:e.size,type:e.type,validationMessages:{minSize:"",maxSize:""},statusCode:"1"}];this.uploadObj.createFileList(n),this.uploadObj.filesData.push(n[0]),this.rawFile=n,this.uploadObj.upload(n),this.hideFileSelectWrapper()},e.prototype.hideFileSelectWrapper=function(){var e=this.popupObj.element.getElementsByClassName("e-file-select-wrap")[0];e&&(e.style.display="none");var t=this.popupObj.element.querySelector(".e-rte-dialog-upload .e-file-select-wrap");t&&sf.base.detach(t)},e.prototype.createPopupObject=function(e,t,n){var i=this,s=sf.base.createElement("input",{id:this.parent.element.id+"_upload",attrs:{type:"File",name:"UploadFiles"}});this.popupObj=new sf.popups.Popup(e,{relateTo:t,height:"85px",width:"300px",content:s,viewPortElement:this.parent.inputElement,enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){i.parent.isBlur=!1,i.popupObj.destroy(),sf.base.detach(i.popupObj.element)}}),this.configurePopupStyles(),this.schedulePopupRefresh(t,n)},e.prototype.configurePopupStyles=function(){this.popupObj&&this.popupObj.element&&(this.popupObj.element.style.display="none",sf.base.addClass([this.popupObj.element],["e-popup-open","e-rte-upload-popup"]))},e.prototype.schedulePopupRefresh=function(e,t){var n=this,i=t.size>1e6?300:100;this.refreshPopupTime=setTimeout((function(){n.refreshPopup(e,n.popupObj)}),i)},e.prototype.uploading=function(e){this.parent.inputElement.contentEditable="false"},e.prototype.success=function(e){e&&e.file&&e.file.name&&this.uploadImgElements.has(e.file.name)&&(this.uploadImgElem=this.uploadImgElements.get(e.file.name)),this.popupClose(this.popupObj,this.uploadImgElem,e)},e.prototype.failure=function(e){var t=this;setTimeout((function(){t.uploadFailure(t.uploadImgElem,t.popupObj,e)}),900)},e.prototype.selected=function(e){e&&e.filesData&&(this.rawFile=e.filesData)},e.prototype.cancelingAndRemoving=function(e){this.parent.inputElement.contentEditable="true",this.uploadImgElem&&this.uploadImgElem.nextSibling&&" "===this.uploadImgElem.nextSibling.textContent&&sf.base.detach(this.uploadImgElem.nextSibling),this.uploadImgElem&&sf.base.detach(this.uploadImgElem),this.popupObj&&this.popupObj.close()},e.prototype.beforeImageUpload=function(e){if(this.parent.beforeUploadImageEnabled)return this.handleEnabledUpload(e);this.handleNonEnabledUpload(e)},e.prototype.handleNonEnabledUpload=function(e){sf.base.isNullOrUndefined(this.parent.insertImageSettings.saveUrl)?this.popupClose(this.popupObj,this.uploadImgElem,null):this.parent.observer.notify("beforePasteUploadCallBack",e)},e.prototype.handleEnabledUpload=function(e){var t=this,n=JSON.parse(JSON.stringify(e));return n.filesData=this.rawFile,new Promise((function(i){t.parent.dotNetRef.invokeMethodAsync("BeforeUpload",n).then((function(n){n.cancel||(t.uploadObj&&(t.uploadObj.currentRequestHeader=e.currentRequest?e.currentRequest:t.uploadObj.currentRequestHeader,t.uploadObj.customFormDatas=e.customFormData&&e.customFormData.length>0?e.customFormData:t.uploadObj.customFormDatas),sf.base.isNullOrUndefined(t.parent.insertImageSettings.saveUrl)?t.popupClose(t.popupObj,t.uploadImgElem,null):t.parent.observer.notify("beforePasteUploadCallBack",e),i())}))}))},e.prototype.uploadFailure=function(e,t,n){this.parent.inputElement.contentEditable="true",e&&sf.base.detach(e),t&&t.close(),this.parent.onImageUploadFailedEnabled&&this.parent.dotNetRef.invokeMethodAsync("PasteImageUploadFailed",n),this.uploadObj&&(this.uploadObj.destroy(),this.uploadObj=void 0)},e.prototype.popupClose=function(e,t,n){this.parent.inputElement.contentEditable="true",n&&(n.detectImageSource=j.Pasted,!sf.base.isNullOrUndefined(this.parent.insertImageSettings.saveUrl)&&this.parent.onImageUploadSuccessEnabled?this.handleSuccessCallback(t,n):this.pasteUploadSuccessCallback(t,n)),e&&e.close(),t&&(t.style.opacity="1"),this.uploadObj&&(this.uploadObj.destroy(),this.uploadObj=void 0)},e.prototype.handleSuccessCallback=function(e,t){var n=this;this.parent.dotNetRef.invokeMethodAsync("PasteImageUploadSuccess",t).then((function(i){n.pasteUploadSuccessCallback(e,t,i)}))},e.prototype.docClick=function(e){var t=e.args.target,n="#"+this.parent.element.id+"_pasteCleanupDialog",i=this.parent.element.querySelector(n);t&&t.classList&&!sf.base.isNullOrUndefined(i)&&!sf.base.closest(t,n)&&this.parent.dotNetRef.invokeMethodAsync("ClosePasteDialog","Outside Click")},e.prototype.pasteUploadSuccessCallback=function(e,t,n){sf.base.isNullOrUndefined(this.parent.insertImageSettings.path)||(sf.base.isNullOrUndefined(n)||sf.base.isNullOrUndefined(n.file)||sf.base.isNullOrUndefined(n.file.name)?t&&t.file&&t.file.name&&this.updateImageSource(e,t.file.name):this.updateImageSource(e,n.file.name))},e.prototype.updateImageSource=function(e,t){var n=this.parent.insertImageSettings.path+t;e.src=n,e.setAttribute("alt",t)},e.prototype.refreshPopup=function(e,t){t&&e&&(this.calculateImagePosition(e)>this.parent.element.offsetTop+this.parent.element.offsetHeight?this.positionPopupAboveEditor(t):this.positionPopupAtImage(t,e))},e.prototype.calculateImagePosition=function(e){return this.parent.iframeSettings.enable?this.parent.element.offsetTop+e.offsetTop:e.offsetTop},e.prototype.positionPopupAboveEditor=function(e){e.offsetY=this.parent.iframeSettings.enable?-30:-65,e.element.style.display="block"},e.prototype.positionPopupAtImage=function(e,t){e.refreshPosition(t),e.element.style.display="block"},e.prototype.imageFormatting=function(e,t){t.elements[0].classList.add("pasteContent_Img");var n=sf.base.createElement("span");n.appendChild(t.elements[0]);var i=n.innerHTML;this.saveCurrentSelection(),this.isClipboardHTMLDataNull=!1,this.handleImageFormattingBySettings(i,e)},e.prototype.saveCurrentSelection=function(){var e=document,t=this.nodeSelectionObj.getRange(e);this.saveSelection=this.nodeSelectionObj.save(t,e)},e.prototype.handleImageFormattingBySettings=function(e,t){this.parent.pasteCleanupSettings.prompt?this.pasteDialog(e,t):this.parent.pasteCleanupSettings.plainText?this.plainFormatting(e,t):this.parent.pasteCleanupSettings.keepFormat?this.formatting(e,!1,t):this.formatting(e,!0,t)},e.prototype.selectFormatting=function(e){this.restoreOriginalHeight(),this.applySelectedFormatting(e)},e.prototype.restoreOriginalHeight=function(){""!==this.newRTEHeight&&(this.parent.element.style.height=this.preRTEHeight)},e.prototype.applySelectedFormatting=function(e){switch(e){case"KeepFormat":this.formatting(this.currentValue,!1,this.currentArgs);break;case"CleanFormat":this.formatting(this.currentValue,!0,this.currentArgs);break;case"PlainTextFormat":this.plainFormatting(this.currentValue,this.currentArgs)}},e.prototype.pasteDialog=function(e,t){this.currentValue=e,this.currentArgs=t,this.preRTEHeight=this.parent.height.toString(),this.newRTEHeight="",this.adjustEditorHeight(),this.parent.openPasteDialog()},e.prototype.adjustEditorHeight=function(){this.parent.element.offsetHeight<265&&(this.newRTEHeight=305..toString()),""!==this.newRTEHeight&&(this.parent.element.style.height=this.newRTEHeight+"px")},e.prototype.formatting=function(e,t,n){var i=this.createClipboardElement(e);i=this.processClipboardContent(i,t),this.saveSelection.restore(),i=this.sanitizeClipboardContent(i),this.processSpecialElements(i),this.pasteObj.hasContentToPaste(i)&&this.handleContentToPaste(i,e)},e.prototype.createClipboardElement=function(e){var t=sf.base.createElement("div",{className:"pasteContent",styles:"display:inline;"});return this.isNotFromHtml&&this.containsHtml&&(e=this.pasteObj.splitBreakLine(e)),t.innerHTML=this.parent.addAnchorAriaLabel(e),t},e.prototype.processClipboardContent=function(e,t){return e=this.pasteObj.cleanAppleClass(e),e=this.pasteObj.cleanupDeniedTagsAndAttributes(e,t),null!==this.parent.pasteCleanupSettings.allowedStyleProps&&(e=this.pasteObj.allowedStyle(e)),e},e.prototype.sanitizeClipboardContent=function(e){var t=e.innerHTML;return this.parent.enableHtmlSanitizer&&(t=e.innerHTML.split("&").join("&amp;")),e.innerHTML=K(t,this.parent),e},e.prototype.processSpecialElements=function(e){this.pasteObj.setImageClassAndProps(e),this.pasteObj.hasPictureElement(e)&&this.pasteObj.processPictureElement(e)},e.prototype.handleContentToPaste=function(e,t){this.parent.afterPasteCleanupEnabled?this.handleAfterPasteCleanup(e,t):this.pasteUpdatedValue(e.innerHTML)},e.prototype.handleAfterPasteCleanup=function(e,t){var n=sf.base.createElement("div");n.innerHTML=e.innerHTML;var i=this.pasteObj.collectBase64ImageFiles(n);i.length>0?this.pastedValue=t:this.pastedValue="";var s=e.innerHTML;this.parent.dotNetRef.invokeMethodAsync("AfterPasteCleanUp",{value:s,filesData:i})},e.prototype.pasteUpdatedValue=function(e){var t=this.determineValueToUse(e),n=this.prepareClipboardElement(e,t);this.executeInsertHtmlCommand(e,n),this.performPostPasteOperations()},e.prototype.determineValueToUse=function(e){return this.parent.afterPasteCleanupEnabled?""===this.pastedValue?e.text:this.pastedValue:e},e.prototype.prepareClipboardElement=function(e,t){var n=sf.base.createElement("div",{className:"pasteContent",styles:"display:inline;"});return n.innerHTML=t,n=this.pasteObj.addTableClass(n,e.pasteTableSource)},e.prototype.executeInsertHtmlCommand=function(e,t){var n=this;this.parent.formatter.editorManager.execCommand("inserthtml","pasteCleanup",e,(function(t){"string"==typeof e&&(e={text:e,name:"afterPasteCleanUp"}),sf.base.extend(e,{elements:t.elements,imageElements:t.imgElem,requestType:"Paste"},!0),n.parent.formatter.onSuccess(n.parent,e)}),t,null,null,this.parent.enterKey)},e.prototype.performPostPasteOperations=function(){E(this.parent.getDocument(),this.parent.inputElement),this.pasteObj.removeTempClass(),this.parent.observer.notify("toolbar-refresh",{}),this.pasteObj.cropImageHandler(this.parent.inputElement)},e.prototype.addTempClass=function(e){for(var t=e.children,n=0;n<t.length;n++)t[n].classList.add("pasteContent_RTE")},e.prototype.plainFormatting=function(e,t){var n=this.createPlainTextContainer(e);this.processToPlainText(n),""!==n.textContent.trim()?this.handleNonEmptyPlainText(n,t,e):this.handleEmptyPlainText(t)},e.prototype.createPlainTextContainer=function(e){var t=sf.base.createElement("div",{className:"pasteContent",styles:"display:inline;"});return t.innerHTML=e,t},e.prototype.processToPlainText=function(e){this.detachInlineElements(e),this.getTextContent(e)},e.prototype.handleNonEmptyPlainText=function(e,t,n){this.processFirstElement(e),this.prepareCleanPlainText(e),e=this.formatBasedOnEnterKey(e),this.insertPlainTextContent(e,t,n)},e.prototype.processFirstElement=function(e){if(!sf.base.isNullOrUndefined(e.firstElementChild)&&"BR"!==e.firstElementChild.tagName){var t=e.firstElementChild;if(!sf.base.isNullOrUndefined(e.firstElementChild)){var n=sf.base.createElement("span");this.moveChildNodesToSpan(t,n,e),t.hasChildNodes()||sf.base.detach(t)}}},e.prototype.moveChildNodesToSpan=function(e,t,n){for(var i=0,s=0;i<e.childNodes.length;i++,s++){var r=e.childNodes[i];if("#text"===r.nodeName)t.appendChild(r),n.insertBefore(t,n.firstElementChild),i--;else{if("#text"===r.nodeName||0!==s)break;this.moveNestedChildNodes(r,t,n),i--}}},e.prototype.moveNestedChildNodes=function(e,t,n){for(var i=0;i<e.childNodes.length;i++)t.appendChild(e.childNodes[i]),n.insertBefore(t,n.firstElementChild),i--},e.prototype.prepareCleanPlainText=function(e){this.removeEmptyElements(e),this.saveSelection.restore(),e.innerHTML=K(e.innerHTML,this.parent),this.addTempClass(e),this.removingComments(e)},e.prototype.formatBasedOnEnterKey=function(e){return"BR"!==this.parent.enterKey||this.isClipboardHTMLDataNull?("DIV"===this.parent.enterKey&&(e.innerHTML=e.innerHTML.replace(/<p class="pasteContent_RTE">/g,"<div>").replace(/<\/p>/g,"</div>")),e):this.reframeToBrContent(e)},e.prototype.insertPlainTextContent=function(e,t,n){if(this.parent.afterPasteCleanupEnabled){var i=e.innerHTML;this.parent.dotNetRef.invokeMethodAsync("AfterPasteCleanUp",{value:i,filesData:[]})}else this.pasteUpdatedValue(e.innerHTML)},e.prototype.handleEmptyPlainText=function(e){this.saveSelection.restore(),sf.base.extend(e,{elements:[]},!0),this.parent.formatter.onSuccess(this.parent,e)},e.prototype.removingComments=function(e){if(e){var t=e.innerHTML;t=t.replace(/<!--[\s\S]*?-->/g,""),e.innerHTML=t}},e.prototype.reframeToBrContent=function(e){for(var t=sf.base.createElement("div",{className:"pasteContent",styles:"display:inline;"});!sf.base.isNullOrUndefined(e.firstChild);)this.processNodeForBrContent(e.firstChild,t);return t},e.prototype.processNodeForBrContent=function(e,t){var n=sf.base.createElement("br");"#text"===e.nodeName?this.handleTextNodeForBr(e,t,n):this.handleElementNodeForBr(e,t,n)},e.prototype.handleTextNodeForBr=function(e,t,n){var i=!sf.base.isNullOrUndefined(e.nextSibling);t.appendChild(e),i&&t.appendChild(n)},e.prototype.handleElementNodeForBr=function(e,t,n){var i="BR"===e.nodeName;i?t.appendChild(e):e.childNodes.length>0&&t.appendChild(e.childNodes[0]),sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.nextSibling)||t.appendChild(n),i||sf.base.isNullOrUndefined(e)||sf.base.detach(e)},e.prototype.getTextContent=function(e){this.processBlockNodes(e),this.removeAllAttributes(e)},e.prototype.processBlockNodes=function(e){for(var t=0;t<this.blockNode.length;t++){var n=e.querySelectorAll(this.blockNode[t]);this.processBlockElements(n)}},e.prototype.processBlockElements=function(e){for(var t=0;t<e.length;t++){for(var n=e[t],i=null,s="",r=0;r<n.childNodes.length;r++){var o=n.childNodes[r];this.shouldMoveNodeToParent(o)?(i=this.moveNodeToParent(o),r--):(i=this.handleOtherNode(o,s),r--,s="text")}i&&sf.base.detach(i)}},e.prototype.shouldMoveNodeToParent=function(e){return"DIV"===e.nodeName||"P"===e.nodeName||"#text"===e.nodeName&&"&nbsp;"!==e.nodeValue.replace(/\u00a0/g,"&nbsp;")&&""===e.textContent.trim()},e.prototype.moveNodeToParent=function(e){var t=e.parentElement;return t&&t.parentElement&&t.parentElement.insertBefore(e,t),t},e.prototype.handleOtherNode=function(e,t){var n=e.parentElement;if("text"===t&&n&&n.previousElementSibling)n.previousElementSibling.appendChild(e);else if(n&&n.parentElement){var i=sf.base.createElement("div",{id:"newDiv"});i.appendChild(e),n.parentElement.insertBefore(i,n)}return n},e.prototype.removeAllAttributes=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++)this.removeAllAttributesFromElement(t[n])},e.prototype.removeAllAttributesFromElement=function(e){for(var t=e.attributes,n=0;n<t.length;n++){var i=t[n].name;e.removeAttribute(i),n--}},e.prototype.detachInlineElements=function(e){for(var t=0;t<this.inlineNode.length;t++){var n=e.querySelectorAll(this.inlineNode[t]);this.processInlineElements(e,n)}},e.prototype.processInlineElements=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];this.shouldSkipElement(e,i)||this.moveChildrenToParent(i)}},e.prototype.shouldSkipElement=function(e,t){return t===e.firstChild&&"SPAN"===t.nodeName},e.prototype.moveChildrenToParent=function(e){for(var t=null,n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];(t=i.parentElement)&&t.parentElement&&(t.parentElement.insertBefore(i,t),n--)}t&&sf.base.detach(t)},e.prototype.findDetachEmptyElem=function(e){var t=e.parentElement;if(sf.base.isNullOrUndefined(e.parentElement))return null;var n=""===t.textContent.trim(),i="pasteContent"!==t.getAttribute("class");return n&&i?this.findDetachEmptyElem(t):e},e.prototype.removeEmptyElements=function(e){if(e)for(var t=e.querySelectorAll(":empty"),n=0;n<t.length;n++)this.processEmptyElement(t[n])},e.prototype.processEmptyElement=function(e){if("BR"!==e.tagName){var t=this.findDetachEmptyElem(e);t&&sf.base.detach(t)}},e}(),_t=function(){function e(){}return e.prototype.getLineNumber=function(e,t){return e.value.substr(0,t).split("\n").length},e.prototype.getSelectedText=function(e){var t=e.selectionStart,n=e.selectionEnd;return e.value.substring(t,n)},e.prototype.getAllParents=function(e){return e.split("\n")},e.prototype.getSelectedLine=function(e){return this.getAllParents(e.value)[this.getLineNumber(e,e.selectionStart)-1]},e.prototype.getLine=function(e,t){return this.getAllParents(e.value)[t]},e.prototype.getSelectedParentPoints=function(e){var t=this.getAllParents(e.value),n=this.getLineNumber(e,e.selectionStart),i=this.getLineNumber(e,e.selectionEnd),s=this.getSelectedText(e).split("\n"),r=[],o=t[n-1],a=t.slice(0,n-1).join("").length,l={};if(l.line=n-1,l.start=a+l.line,l.end=""!==o?l.start+o.length+1:l.start+o.length,l.text=o,r.push(l),s.length>1){for(var d=1;d<s.length-1;d++){var c={};c.line=r[d-1].line+1,c.start=(s[d],r[d-1].end),c.end=c.start+s[d].length+1,c.text=s[d],r.push(c)}var h={};h.line=r[r.length-1].line+1,h.start=r[r.length-1].end,h.end=h.start+t[i-1].length+1,h.text=t[i-1],r.push(h)}return r},e.prototype.setSelection=function(e,t,n){e.setSelectionRange(t,n),e.focus()},e.prototype.save=function(e,t){this.selectionStart=e,this.selectionEnd=t},e.prototype.restore=function(e){this.setSelection(e,this.selectionStart,this.selectionEnd)},e.prototype.isStartWith=function(e,t){var n=!1,i=RegExp;e&&(n=(e.trim()===t.trim()?new i("^("+this.replaceSpecialChar(t.trim())+")","gim"):new i("^("+this.replaceSpecialChar(t)+")","gim")).test(e.trim()));return n},e.prototype.replaceSpecialChar=function(e){return e.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"\\$&")},e.prototype.isClear=function(e,t){for(var n=RegExp,i=0;i<e.length;i++)if(new n(t,"gim").test(e[i].text))return!0;return!1},e.prototype.getSelectedInlinePoints=function(e){return{start:e.selectionStart,end:e.selectionEnd,text:this.getSelectedText(e)}},e}(),Qt=function(){function e(e){this.toolbarStatus=this.prevToolbarStatus={bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,uppercase:!1,lowercase:!1,inlinecode:!1,unorderedlist:!1,formats:null},this.selection=new _t,this.parent=e,this.element=this.parent.getEditPanel(),this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("toolbar-refresh",this.onRefreshHandler,this),this.parent.observer.on(i,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("toolbar-refresh",this.onRefreshHandler),this.parent.observer.off(i,this.removeEventListener)},e.prototype.onRefreshHandler=function(e){var t=this.selection.getSelectedParentPoints(this.element);this.toolbarStatus={orderedlist:!e.documentNode&&this.isListsApplied(t,"OL"),unorderedlist:!e.documentNode&&this.isListsApplied(t,"UL"),formats:this.currentFormat(t,e.documentNode),bold:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("Bold"),italic:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("Italic"),inlinecode:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("InlineCode"),strikethrough:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("StrikeThrough"),subscript:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("SubScript"),superscript:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("SuperScript"),uppercase:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("UpperCase")},this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("InlineCode")&&(this.toolbarStatus.formats="pre");var n=JSON.stringify(this.toolbarStatus);this.parent.observer.notify("toolbar-updated",this.toolbarStatus),JSON.stringify(this.prevToolbarStatus)!==n&&(this.parent.observer.notify("updateTbItemsStatus",{html:null,markdown:JSON.parse(n)}),this.prevToolbarStatus=JSON.parse(n))},e.prototype.isListsApplied=function(e,t){var n=!0;if("OL"===t)for(var i=0;i<e.length;i++){var s=e[i].text.trim().split(" ",2)[0]+" ";if(!/^[\d.]+[ ]+$/.test(s)){n=!1;break}}else for(i=0;i<e.length;i++)if(!this.selection.isStartWith(e[i].text,this.parent.formatter.listSyntax[t])){n=!1;break}return n},e.prototype.currentFormat=function(e,t){for(var n="p",i=Object.keys(this.parent.formatter.formatSyntax),s="backward"===this.element.selectionDirection?e[0].text:e[e.length-1].text,r=0;!t&&r<i.length;r++){if("pre"!==i[r]&&this.selection.isStartWith(s,this.parent.formatter.formatSyntax[i[r]])){n=i[r];break}if("pre"===i[r]&&this.codeFormat()){n=i[r];break}}return n},e.prototype.codeFormat=function(){var e,t=!1,n=this.parent.inputElement,i=n.selectionStart,s=(e=i,function(t){return[t.slice(0,e),t.slice(e)]})(n.value),r=this.parent.formatter.formatSyntax.pre,o=this.getSelectedText(n);if(""!==o&&o===o.toLocaleUpperCase())return!0;if(""===o){var a=n.value.substring(s[0].length-1,1),l=s[1].substring(0,1);if(""!==a&&""!==l&&a.match(/[a-z]/i)&&a===a.toLocaleUpperCase()&&l===l.toLocaleUpperCase())return!0}return this.isCode(s[0],r)&&this.isCode(s[1],r)&&s[0].match(this.multiCharRegx(r)).length%2==1&&s[1].match(this.multiCharRegx(r)).length%2==1&&(t=!0),t},e.prototype.getSelectedText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},e.prototype.isCode=function(e,t){return-1!==e.search("\\"+t)},e.prototype.multiCharRegx=function(e){return new RegExp("(\\"+e+")","g")},e}(),Kt=function(){function e(e){sf.base.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("lists-commands",this.applyListsHandler,this),this.parent.observer.on("keydown-handler",this.keyDownHandler,this),this.parent.observer.on("keyup-handler",this.keyUpHandler,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("lists-commands",this.applyListsHandler),this.parent.observer.off("keydown-handler",this.keyDownHandler),this.parent.observer.off("keyup-handler",this.keyUpHandler),this.parent.observer.off(v,this.destroy)},e.prototype.keyDownHandler=function(e){switch(e.event.which){case 9:this.tabKey(e)}switch(e.event.action){case"ordered-list":this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault();break;case"unordered-list":this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.keyUpHandler=function(e){switch(e.event.which){case 13:this.enterKey(e)}},e.prototype.tabKey=function(e){var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=t.selectionStart,i=t.selectionEnd,s=this.selection.getSelectedParentPoints(t),r=0,o=this.isNotFirstLine(t,s[0]);if(o||e.event.shiftKey){var a=this.olListType(),l=this.getListRegex();this.currentAction=this.getAction(s[0].text);for(var d=0;d<s.length;d++){var c=(e.event.shiftKey,s[d].line-1),h=this.selection.getLine(t,c);if(h&&(!e.event.shiftKey&&o||e.event.shiftKey)){var p=h.split(". "),u=e.event.shiftKey?-"\t".length:"\t".length,f=s[d].text.split("\t");if(e.event.shiftKey&&1===f.length)break;if("OL"===this.currentAction&&/^\d+$/.test(p[0].trim())&&a){e.event.preventDefault(),s[d].text=e.event.shiftKey?f.splice(1,f.length).join("\t"):"\t"+s[d].text;var m=this.getTabSpace(s[d].text),g=this.getTabSpace(h),b=s[d].text.split(". ");if(m===g)this.changeTextAreaValue(b,this.nextOrderedListValue(p[0].trim()),e,t,s,d,i);else if(g<m)this.changeTextAreaValue(b,"1. ",e,t,s,d,i);else for(;g.length>m.length;null){c-=1;var v=(h=this.selection.getLine(t,c)).trim().split(". ");if(/^\d+$/.test(v[0])&&(g=this.getTabSpace(h)).length<=m.length){this.changeTextAreaValue(b,this.nextOrderedListValue(v[0]),e,t,s,d,i);break}}}else("UL"===this.currentAction&&l.test(h.trim())||!a)&&(e.event.preventDefault(),s[d].text=e.event.shiftKey?f.splice(1,f.length).join("\t"):"\t"+s[d].text,t.value=t.value.substr(0,s[d].start)+s[d].text+"\n"+t.value.substr(s[d].end,t.value.length));if(n=0===d?n+u:n,r+=u,1!==s.length)for(var y=d;y<s.length;y++)s[y].start=0!==y?s[y].start+u:s[y].start,s[y].end=s[y].end+u}}this.restore(t,n,i+r,e)}else this.restore(t,n,i+r,e)},e.prototype.changeTextAreaValue=function(e,t,n,i,s,r,o){var a=t;e.splice(0,1);var l,d=this.selection.getAllParents(i.value).length,c="",h=this.getTabSpace(s[r].text),p=parseInt(a.split(".")[0],null),u=this.getTabSpace(s[r].text),f=!0,m=!0,g=-1,b=!0,v=0,y="";c=""!==this.selection.getLine(i,s[0].line+1)?"":c+i.value.substr(s[0].end,i.value.length);for(var C=1;C<d&&!sf.base.isNullOrUndefined(this.selection.getLine(i,s[0].line+C))&&""!==this.selection.getLine(i,s[0].line+C);C++){var N=this.selection.getLine(i,s[0].line+C),E=this.getTabSpace(N),S=N.split(". ");if(1===S.length){c+=i.value.substr(s[0].end+v,i.value.length);break}v+=N.length;var T=!1;if(l=n.event.shiftKey?h.length+1:h.length-1,E.length>u.length&&(b=!1),h.length!==E.length&&E.length<u.length?(m=!0,f=!1,T=!(!n.event.shiftKey||h.length!==E.length)&&(m=!1,!0)):b&&n.event.shiftKey&&h.length===E.length&&E.length===u.length&&(m=!1,T=!0),y=""===c?"":"\n",l===E.length&&m){var L=n.event.shiftKey?(g++,this.nextOrderedListValue(g.toString())):this.previousOrderedListValue(S[0]);S.splice(0,1),c=c+y+E+L+S.join(". ")}else if(h.length===E.length&&f||T){L=this.nextOrderedListValue(p.toString());p++,S.splice(0,1),c=c+y+E+L+S.join(". ")}else c=c+y+N,m=!1;u=this.getTabSpace(N)}s[r].text=this.getTabSpace(s[r].text)+a+e.join(". ")+"\n",i.value=i.value.substr(0,s[r].start)+s[r].text+c},e.prototype.getTabSpace=function(e){for(var t=e.split("\t"),n="",i=0;i<t.length&&""===t[i];i++)n+="\t";return n},e.prototype.isNotFirstLine=function(e,t){var n,i=t.text,s=t.line-1,r=this.selection.getLine(e,s),o=this.getListRegex(),a=!1;if(r){this.currentAction=this.getAction(r);var l=r.split(". ");n="OL"===this.currentAction?/^\d+$/.test(l[0].trim()):o.test(r.trim())}if(r&&n){var d=this.getTabSpace(i),c=this.getTabSpace(r);for(a=d===c||a;c.length>d.length;null){s-=1;l=(r=this.selection.getLine(e,s)).trim().split(". ");if(("OL"===this.currentAction?/^\d+$/.test(l[0]):o.test(r.trim()))&&(c=this.getTabSpace(r)).length<=d.length){a=!0;break}}}return a},e.prototype.getAction=function(e){var t=e.split(". ")[0],n=/^\d+$/.test(t.trim()),i=e.trim().split(new RegExp("^("+this.selection.replaceSpecialChar(this.syntax.UL).trim()+")"))[1];return n?"OL":i?"UL":"NOTLIST"},e.prototype.nextOrderedListValue=function(e){return(parseInt(e,null)+1).toString()+". "},e.prototype.previousOrderedListValue=function(e){return(parseInt(e,null)-1).toString()+". "},e.prototype.enterKey=function(e){var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=t.selectionStart,i=t.selectionEnd,s=this.selection.getSelectedParentPoints(t),r=this.selection.getLine(t,s[0].line-1),o=this.olListType(),a=this.getListRegex(),l=[];sf.base.isNullOrUndefined(r)||(l=r.split(". "),this.currentAction=this.getAction(r));var d=0;if("OL"===this.currentAction&&l.length>1&&/^\d+$/.test(l[0].trim())&&o&&""!==l[1]){var c=this.getTabSpace(r);this.currentAction=this.getAction(r);var h=this.nextOrderedListValue(l[0]);s[0].text=c+h+s[0].text;for(var p=this.selection.getAllParents(t.value).length,u="\n",f=this.getTabSpace(r),m=this.getTabSpace(s[0].text),g=!0,b=1;b<p&&""!==t.value.substr(s[0].end,t.value.length);b++){var v=this.selection.getLine(t,s[0].line+b);if(sf.base.isNullOrUndefined(v))u+="";else{var y=v.split(". "),C=this.getTabSpace(v);if(C.length<m.length&&(g=!1),y.length>1&&/^\d+$/.test(y[0].trim())&&f.length===C.length&&g){var N=this.nextOrderedListValue(y[0]);y.splice(0,1),u=u+C+N+y.join(". ")+"\n"}else u=u+v+"\n",m=this.getTabSpace(v)}}t.value=t.value.substr(0,s[0].start)+f+h+this.selection.getLine(t,s[0].line)+u,n=n+h.length+c.length,d+=h.length+c.length}else if("UL"===this.currentAction&&r&&a.test(r.trim())&&""!==r.trim().replace(a,"")||"OL"===this.currentAction&&!o&&""!==l[1]){c=this.getTabSpace(r),h=this.syntax[this.currentAction];s[0].text=c+h+s[0].text+(s[0].text.trim().length>0?"\n":""),t.value=t.value.substr(0,s[0].start)+s[0].text+t.value.substr(s[0].end,t.value.length),n=n+h.length+c.length,d+=h.length+c.length}this.restore(t,n,i+d,e)},e.prototype.olListType=function(){var e=this.syntax.OL.split(".,");return(1===e.length?null:parseInt(e[2].trim(),null)-parseInt(e[0].trim(),null))?1:0},e.prototype.applyListsHandler=function(e){var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd),this.currentAction=e.subCommand;for(var n,i=t.selectionStart,s=t.selectionEnd,r=0,o=0,a=0,l=this.selection.getSelectedParentPoints(t),d="",c=this.olListType(),h={},p=0;p<l.length;p++)if(n=c?"OL"===this.currentAction?p+c+". ":this.syntax[this.currentAction]:"OL"===this.currentAction?this.syntax.OL:this.syntax[this.currentAction],this.selection.isStartWith(l[p].text,n))l[p].text=l[p].text.replace(n,""),t.value=t.value.substr(0,l[p].start+a)+l[p].text+"\n"+t.value.substr(l[p].end+a,t.value.length),a-=n.length,o=n.length,this.restore(t,i-o,s+a,null);else{if(""===l[p].text&&0===p&&(this.selection.save(i,s),1!==l.length))for(var u=p;u<l.length;u++)l[u].start=0!==u?1+l[u].start:l[u].start,l[u].end=1+l[u].end;var f=sf.base.isNullOrUndefined(l[p-1])?0:this.getTabSpace(l[p-1].text).length,m=this.appliedLine(l[p].text,n,h,f);if(d=m.line?d:n,l[p].text=m.line?m.line:d+l[p].text,m.space=m.space?m.space:0,t.value=t.value.substr(0,l[p].start+a)+l[p].text+"\n"+t.value.substr(l[p].end,t.value.length),i=0===p?i+d.length+m.space>0?i+d.length+m.space:0:i,r+=d.length+m.space,1!==l.length)for(u=p;u<l.length;u++)l[u].start=0!==u?d.length+l[u].start+m.space:l[u].start,l[u].end=d.length+l[u].end+m.space;this.restore(t,i<=n.length?0:i,s+r,null)}this.restore(t,null,null,e)},e.prototype.appliedLine=function(e,t,n,i){var s={},r=new RegExp("^["+this.syntax.UL.trim()+"]"),o=e.split(". "),a=o[0]+". ",l=r.test(e.trim())||e.trim()===this.syntax.OL.trim()||e.trim()===this.syntax.UL.trim()||/^\d+$/.test(o[0].trim()),d=this.olListType(),c=this.getTabSpace(e).length;if("OL"===this.currentAction&&d&&(n[c.toString()]=sf.base.isNullOrUndefined(n[c.toString()])?1:n[c.toString()].valueOf()+1,t=n[c.toString()].valueOf().toString()+". ",!sf.base.isNullOrUndefined(i)&&i>c&&(n[i.toString()]=0)),l){var h=void 0,p=void 0;r.test(e.trim())?(p=this.syntax.UL,h=t,s.space=t.trim().length-this.syntax.UL.trim().length):/^\d+$/.test(o[0].trim())&&d?(p=o[0].trim()+". ",h=t,s.space=this.syntax.UL.trim().length-a.trim().length):/^\d+$/.test(o[0].trim())&&(p=o[0].trim()+". ",h=this.syntax.UL,s.space=this.syntax.UL.trim().length-a.trim().length),s.line=e.replace(p,h)}return s},e.prototype.restore=function(e,t,n,i){sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(t)||this.selection.save(t,n),sf.base.isNullOrUndefined(i)||this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.getListRegex=function(){for(var e="",t=Object.keys(this.syntax),n=RegExp,i=0;i<t.length;i++){var s=this.selection.replaceSpecialChar(this.syntax[t[i]]);e+=""===e?"^("+s+")|^("+s.trim()+")":"|^("+s+")|^("+s.trim()+")"}return new n(e)},e.prototype.destroy=function(){this.removeEventListener()},e}(),Xt=function(){function e(e){sf.base.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("format-type",this.applyFormats,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("format-type",this.applyFormats),this.parent.observer.off(v,this.destroy)},e.prototype.applyFormats=function(e){e.subCommand=e.subCommand.toLowerCase();var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=this.selection.getSelectedParentPoints(t);if(this.isAppliedFormat(n)===e.subCommand){if("pre"===e.subCommand){if(!(n.length>1))return;this.applyCodeBlock(t,e,n)}return this.cleanFormat(t),void this.restore(t,t.selectionStart,t.selectionEnd,e)}if("p"===e.subCommand)return this.cleanFormat(t),void this.restore(t,t.selectionStart,t.selectionEnd,e);("pre"===e.subCommand&&1!==n.length||"pre"!==e.subCommand)&&this.cleanFormat(t,e.subCommand);var i=t.selectionStart,s=t.selectionEnd,r=0;if(n=this.selection.getSelectedParentPoints(t),"pre"!==e.subCommand){for(var o=0;o<n.length;o++)if(""===n[o].text||this.selection.isStartWith(n[o].text,"\\"+this.syntax[e.subCommand])){if(""===n[o].text&&0===o&&(this.selection.save(i,s),0===this.selection.getSelectedText(t).length&&(n[o].text=this.syntax[e.subCommand],t.value=t.value.substr(0,n[o].start)+this.syntax[e.subCommand]+t.value.substr(n[o].end,t.value.length),i=0===o?i+this.syntax[e.subCommand].length:i,r+=this.syntax[e.subCommand].length),1!==n.length))for(a=o;a<n.length;a++)n[a].start=0!==a?1+n[a].start:n[a].start,n[a].end=1+n[a].end}else if(n[o].text=this.syntax[e.subCommand]+n[o].text,t.value=t.value.substr(0,n[o].start)+n[o].text+"\n"+t.value.substr(n[o].end,t.value.length),i=0===o?i+this.syntax[e.subCommand].length:i,r+=this.syntax[e.subCommand].length,1!==n.length)for(var a=o;a<n.length;a++)n[a].start=0!==a?this.syntax[e.subCommand].length+n[a].start:n[a].start,n[a].end=this.syntax[e.subCommand].length+n[a].end;this.restore(t,i,s+r,e)}else n.length>1?this.applyCodeBlock(t,e,n):(sf.base.extend(e,e,{subCommand:"InlineCode"},!0),this.parent.observer.notify("command-type",e))},e.prototype.clearRegex=function(){for(var e="",t=Object.keys(this.syntax),n=0;n<t.length&&"pre"!==t[n]&&"p"!==t[n];n++)e+=""===e?"^("+this.selection.replaceSpecialChar(this.syntax[t[n]].trim())+")":"|^("+this.selection.replaceSpecialChar(this.syntax[t[n]].trim())+")";return e},e.prototype.cleanFormat=function(e,t){var n=this.selection.getSelectedParentPoints(e),i=e.selectionStart,s=e.selectionEnd,r=0;if(this.selection.isClear(n,this.clearRegex())){for(var o=0;o<n.length;o++){for(var a=Object.keys(this.syntax),l=0;""!==n[o].text&&l<a.length;l++){var d=this.syntax[a[l]];if(a[l]!==t){var c=new RegExp("^("+this.selection.replaceSpecialChar(d)+")","gim");if(c.test(n[o].text)){if(n[o].text=n[o].text.replace(c,""),e.value=e.value.substr(0,n[o].start)+n[o].text+"\n"+e.value.substr(n[o].end,e.value.length),i=0===o?i-d.length>0?i-d.length:0:i,r+=d.length,1!==n.length)for(var h=0;h<n.length;h++)n[h].start=0!==h?n[h].start-d.length:n[h].start,n[h].end=n[h].end-d.length;break}}}if(""===n[o].text&&0===o&&(this.selection.save(i,s),1!==n.length))for(l=o;l<n.length;l++)n[l].start=0!==l?1+n[l].start:n[l].start,n[l].end=1+n[l].end}this.restore(e,i,s-r)}},e.prototype.applyCodeBlock=function(e,t,n){var i=t.subCommand,s=n[0].start,r=n[n.length-1].end,o=this.selection.getAllParents(e.value),a=o[n[0].line-1],l=o[n.length+1+1];if(this.selection.isStartWith(a,this.syntax.pre.split("\n")[0])||this.selection.isStartWith(l,this.syntax.pre.split("\n")[0])){var d=this.syntax[""+i],c=this.parent.markdownSelection.getSelectedInlinePoints(e),h=e.value.substr(0,e.selectionStart).lastIndexOf(d),p=e.value.substr(e.selectionEnd,e.selectionEnd).indexOf(d);p+=c.end;var u=this.replaceAt(e.value.substr(0,c.start),d,"",h,c.start),f=this.replaceAt(e.value.substr(c.end,e.value.length),d,"",0,p);e.value=u+c.text+f,s=this.selection.selectionStart-d.length,r=this.selection.selectionEnd-d.length}else{var m=e.value.substring(s,r).split("\n"),g=""===m[m.length-1]?"":"\n";e.value=e.value.substr(0,s)+this.syntax[""+i]+e.value.substring(s,r)+g+this.syntax[""+i]+e.value.substr(r,e.value.length),s=this.selection.selectionStart+this.syntax[""+i].length,r=this.selection.selectionEnd+this.syntax[""+i].length-1}this.restore(e,s,r,t)},e.prototype.replaceAt=function(e,t,n,i,s){return e.slice(0,i)+e.slice(i,s).replace(t,n)+e.slice(s)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.isAppliedFormat=function(e,t){for(var n="p",i=(Object.keys(this.syntax),Object.keys(this.syntax)),s="backward"===this.parent.element.selectionDirection?e[0].text:e[e.length-1].text,r=0;!t&&r<i.length;r++){if("pre"!==i[r]&&this.selection.isStartWith(s,this.syntax[i[r]])){n=i[r];break}if("pre"===i[r]){var o=this.selection.getAllParents(this.parent.element.value),a=o[e[0].line-1],l=o[e.length+1];if(this.selection.isStartWith(a,this.syntax[i[r]].split("\n")[0])&&this.selection.isStartWith(l,this.syntax[i[r]].split("\n")[0])){n=i[r];break}}}return n},e.prototype.destroy=function(){this.removeEventListener()},e}(),Gt=function(){function e(e){sf.base.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("command-type",this.applyCommands,this),this.parent.observer.on("keydown-handler",this.keyDownHandler,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("command-type",this.applyCommands),this.parent.observer.off("keydown-handler",this.keyDownHandler),this.parent.observer.off(v,this.destroy)},e.prototype.keyDownHandler=function(e){switch(e.event.action){case"bold":this.applyCommands({subCommand:"Bold",callBack:e.callBack}),e.event.preventDefault();break;case"italic":this.applyCommands({subCommand:"Italic",callBack:e.callBack}),e.event.preventDefault();break;case"strikethrough":this.applyCommands({subCommand:"StrikeThrough",callBack:e.callBack}),e.event.preventDefault();break;case"uppercase":this.applyCommands({subCommand:"UpperCase",callBack:e.callBack}),e.event.preventDefault();break;case"lowercase":this.applyCommands({subCommand:"LowerCase",callBack:e.callBack}),e.event.preventDefault();break;case"superscript":this.applyCommands({subCommand:"SuperScript",callBack:e.callBack}),e.event.preventDefault();break;case"subscript":this.applyCommands({subCommand:"SubScript",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.isBold=function(e,t){return-1!==e.search("\\"+t+"\\"+t)},e.prototype.isItalic=function(e,t){return-1!==e.search("\\"+t)},e.prototype.isMatch=function(e,t){var n=[""];switch(t){case this.syntax.Italic:case this.syntax.InlineCode:case this.syntax.StrikeThrough:n=e.match(this.singleCharRegx(t))}return n},e.prototype.multiCharRegx=function(e){return new RegExp("(\\"+e+"\\"+e+")","g")},e.prototype.singleCharRegx=function(e){return new RegExp("(\\"+e+")","g")},e.prototype.isAppliedCommand=function(e){var t,n=!1,i=this.parent.element,s=i.selectionStart,r=(t=s,function(e){return[e.slice(0,t),e.slice(t)]})(i.value),o=this.syntax.Bold.substr(0,1),a=this.syntax.Italic,l=this.parent.markdownSelection.getSelectedText(i);if(""!==l&&l===l.toLocaleUpperCase()&&"UpperCase"===e)return!0;if(""===l){var d=i.value.substr(r[0].length-1,1),c=r[1].substr(0,1);if(""!==d&&""!==c&&d.match(/[a-z]/i)&&d===d.toLocaleUpperCase()&&c===c.toLocaleUpperCase()&&"UpperCase"===e)return!0}return this.isBold(r[0],o)||this.isItalic(r[0],a)||this.isBold(r[1],o)||this.isItalic(r[1],a)||(sf.base.isNullOrUndefined(this.isMatch(r[0],this.syntax.StrikeThrough))||sf.base.isNullOrUndefined(this.isMatch(r[1],this.syntax.StrikeThrough))||this.isMatch(r[0],this.syntax.StrikeThrough).length%2!=1||this.isMatch(r[1],this.syntax.StrikeThrough).length%2!=1||"StrikeThrough"!==e||(n=!0),sf.base.isNullOrUndefined(this.isMatch(r[0],this.syntax.InlineCode))||sf.base.isNullOrUndefined(this.isMatch(r[1],this.syntax.InlineCode))||this.isMatch(r[0],this.syntax.InlineCode).length%2!=1||this.isMatch(r[1],this.syntax.InlineCode).length%2!=1||"InlineCode"!==e||(n=!0),sf.base.isNullOrUndefined(r[0].match(/\<sub>/g))||sf.base.isNullOrUndefined(r[1].match(/\<\/sub>/g))||r[0].match(/\<sub>/g).length%2!=1||r[1].match(/\<\/sub>/g).length%2!=1||"SubScript"!==e||(n=!0),sf.base.isNullOrUndefined(r[0].match(/\<sup>/g))||sf.base.isNullOrUndefined(r[1].match(/\<\/sup>/g))||r[0].match(/\<sup>/g).length%2!=1||r[1].match(/\<\/sup>/g).length%2!=1||"SuperScript"!==e||(n=!0)),this.isBold(r[0],o)&&this.isBold(r[1],o)&&r[0].match(this.multiCharRegx(o)).length%2==1&&r[1].match(this.multiCharRegx(o)).length%2==1&&"Bold"===e&&(n=!0),r[0]=this.isBold(r[0],o)?r[0].replace(this.multiCharRegx(o),"$%@"):r[0],r[1]=this.isBold(r[1],o)?r[1].replace(this.multiCharRegx(o),"$%@"):r[1],sf.base.isNullOrUndefined(this.isMatch(r[0],this.syntax.Italic))||sf.base.isNullOrUndefined(this.isMatch(r[1],this.syntax.Italic))||this.isMatch(r[0],this.syntax.Italic).length%2!=1||this.isMatch(r[1],this.syntax.Italic).length%2!=1||"Italic"!==e||(n=!0),sf.base.isNullOrUndefined(this.isMatch(r[0],this.syntax.StrikeThrough))||sf.base.isNullOrUndefined(this.isMatch(r[1],this.syntax.StrikeThrough))||this.isMatch(r[0],this.syntax.StrikeThrough).length%2!=1||this.isMatch(r[1],this.syntax.StrikeThrough).length%2!=1||"StrikeThrough"!==e||(n=!0),sf.base.isNullOrUndefined(this.isMatch(r[0],this.syntax.InlineCode))||sf.base.isNullOrUndefined(this.isMatch(r[1],this.syntax.InlineCode))||this.isMatch(r[0],this.syntax.InlineCode).length%2!=1||this.isMatch(r[1],this.syntax.InlineCode).length%2!=1||"InlineCode"!==e||(n=!0),sf.base.isNullOrUndefined(r[0].match(/\<sub>/g))||sf.base.isNullOrUndefined(r[1].match(/\<\/sub>/g))||r[0].match(/\<sub>/g).length%2!=1||r[1].match(/\<\/sub>/g).length%2!=1||"SubScript"!==e||(n=!0),sf.base.isNullOrUndefined(r[0].match(/\<sup>/g))||sf.base.isNullOrUndefined(r[1].match(/\<\/sup>/g))||r[0].match(/\<sup>/g).length%2!=1||r[1].match(/\<\/sup>/g).length%2!=1||"SuperScript"!==e||(n=!0),n},e.prototype.applyCommands=function(e){this.currentAction=e.subCommand;var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=t.selectionStart,i=t.selectionEnd,s=0,r=this.parent.markdownSelection.getSelectedInlinePoints(t);if(this.isAppliedCommand(e.subCommand)&&""!==r.text){var o=this.syntax[e.subCommand],a="SubScript"===e.subCommand?"</sub>":"SuperScript"===e.subCommand?"</sup>":this.syntax[e.subCommand],l="UpperCase"===e.subCommand||"LowerCase"===e.subCommand?0:o.length,d=t.value.substr(0,r.start).lastIndexOf(o),c=t.value.substr(r.end,t.value.length).indexOf(a);c+=r.end;var h=this.replaceAt(t.value.substr(0,r.start),o,"",d,r.start),p=this.replaceAt(t.value.substr(r.end,t.value.length),a,"",0,c);return t.value=h+r.text+p,void this.restore(t,n-l,i-l,e)}if(""===r.text||this.isApplied(r,e.subCommand))"UpperCase"!==e.subCommand&&"LowerCase"!==e.subCommand?("SubScript"===e.subCommand||"SuperScript"===e.subCommand?(r.text=this.textReplace(r.text,e.subCommand),r.text=this.syntax[e.subCommand]+r.text+"</"+this.syntax[e.subCommand].substring(1,5)):(r.text=this.textReplace(r.text,e.subCommand),r.text=this.syntax[e.subCommand]+r.text+this.syntax[e.subCommand]),t.value=t.value.substr(0,r.start)+r.text+t.value.substr(r.end,t.value.length),s=this.syntax[e.subCommand].length,r.start===r.end?this.restore(t,n+s,i+s,e):this.restore(t,n+s,i-s,e)):this.restore(t,n,i,e);else{s="UpperCase"===e.subCommand||"LowerCase"===e.subCommand?0:this.syntax[e.subCommand].length;var u=t.value.substr(r.start-this.syntax[e.subCommand].length,this.syntax[e.subCommand].length),f=void 0;if(u===e.subCommand||r.start-this.syntax[e.subCommand].length===t.value.indexOf(this.syntax[e.subCommand])&&(r.end===t.value.lastIndexOf(this.syntax[e.subCommand])||r.end===t.value.lastIndexOf("</"+this.syntax[e.subCommand].substring(1,5)))){f="SubScript"===e.subCommand||"SuperScript"===e.subCommand?t.value.substr(r.end,this.syntax[e.subCommand].length+1):t.value.substr(r.end,this.syntax[e.subCommand].length);h=this.replaceAt(t.value.substr(0,r.start),u,"",r.start-this.syntax[e.subCommand].length,r.start),p=this.replaceAt(t.value.substr(r.end,t.value.length),f,"",0,f.length);t.value=h+r.text+p,this.restore(t,n-s,i-s,e)}else"SubScript"===e.subCommand||"SuperScript"===e.subCommand?r.text=this.syntax[e.subCommand]+r.text+"</"+this.syntax[e.subCommand].substring(1,5):"UpperCase"===e.subCommand||"LowerCase"===e.subCommand?r.text="UpperCase"===e.subCommand?r.text.toUpperCase():r.text.toLowerCase():r.text=this.syntax[e.subCommand]+r.text+this.syntax[e.subCommand],t.value=t.value.substr(0,r.start)+r.text+t.value.substr(r.end,t.value.length),this.restore(t,n+s,i+s,e)}this.parent.undoRedoManager.saveData()},e.prototype.replaceAt=function(e,t,n,i,s){return e.slice(0,i)+e.slice(i,s).replace(t,n)+e.slice(s)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.textReplace=function(e,t){var n=this.singleCharRegx(this.syntax[""+t]);switch(t){case"Bold":n=this.multiCharRegx(this.syntax[""+t].substr(0,1)),e=e.replace(n,"");break;case"Italic":if(this.isBold(e,this.syntax[""+t].substr(0,1))){var i=this.multiCharRegx(this.syntax[""+t].substr(0,1)),s=e;s=s.replace(i,"$%@").replace(n,"");var r=new RegExp("\\$%@","g");e=s.replace(r,this.syntax[""+t].substr(0,1)+this.syntax[""+t].substr(0,1))}else e=e.replace(n,"");break;case"StrikeThrough":case"InlineCode":e=e.replace(n,"");break;case"SubScript":e=e.replace(/<sub>/g,"").replace(/<\/sub>/g,"");break;case"SuperScript":e=e.replace(/<sup>/g,"").replace(/<\/sup>/g,"")}return e},e.prototype.isApplied=function(e,t){var n=this.singleCharRegx(this.syntax[""+t]);switch(t){case"SubScript":case"SuperScript":return(n=this.singleCharRegx(this.syntax[""+t])).test(e.text);case"Bold":case"StrikeThrough":return(n=this.multiCharRegx(this.syntax[""+t].substr(0,1))).test(e.text);case"UpperCase":case"LowerCase":return(n=new RegExp("^["+this.syntax[""+t]+"]*$","g")).test(e.text);case"Italic":var i=void 0,s=this.multiCharRegx(this.syntax[""+t].substr(0,1));if(s.test(e.text)){var r=e.text;r=r.replace(s,"$%#"),i=n.test(r)}else i=n.test(e.text);return i;case"InlineCode":return n.test(e.text)}},e.prototype.destroy=function(){this.removeEventListener()},e}(),Yt=function(){function e(e,t){this.undoRedoStack=[],this.parent=e,this.undoRedoSteps=sf.base.isNullOrUndefined(t)?30:t.undoRedoSteps,this.undoRedoTimer=sf.base.isNullOrUndefined(t)?300:t.undoRedoTimer,this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){var e=sf.base.debounce(this.keyUp,this.undoRedoTimer);this.parent.observer.on("keyup-handler",e,this),this.parent.observer.on("keydown-handler",this.keyDown,this),this.parent.observer.on("action",this.onAction,this),this.parent.observer.on("model_changed_plugin",this.onPropertyChanged,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++){switch(n[t]){case"undoRedoSteps":this.undoRedoSteps=e.newProp.undoRedoSteps;break;case"undoRedoTimer":this.undoRedoTimer=e.newProp.undoRedoTimer}}},e.prototype.removeEventListener=function(){var e=sf.base.debounce(this.keyUp,300);this.parent.observer.off("keyup-handler",e),this.parent.observer.off("keydown-handler",this.keyDown),this.parent.observer.off("action",this.onAction),this.parent.observer.off("model_changed_plugin",this.onPropertyChanged),this.parent.observer.off(v,this.destroy)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.onAction=function(e){"Undo"===e.subCommand?this.undo(e):this.redo(e)},e.prototype.keyDown=function(e){var t=e.event;switch(t.action){case"undo":t.preventDefault(),this.undo(e);break;case"redo":t.preventDefault(),this.redo(e)}},e.prototype.keyUp=function(e){17===e.event.keyCode||e.event.ctrlKey||this.saveData(e)},e.prototype.saveData=function(e){var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=t.selectionStart,i=t.selectionEnd,s={text:this.parent.element.value,start:n,end:i};this.undoRedoStack.length>=this.steps&&(this.undoRedoStack=this.undoRedoStack.slice(0,this.steps+1)),this.undoRedoStack.length>1&&this.undoRedoStack[this.undoRedoStack.length-1].start===n&&this.undoRedoStack[this.undoRedoStack.length-1].end===i||(this.undoRedoStack.push(s),this.steps=this.undoRedoStack.length-1,this.steps>this.undoRedoSteps&&(this.undoRedoStack.shift(),this.steps--),e&&e.callBack&&e.callBack())},e.prototype.undo=function(e){if(this.steps>0){this.currentAction="Undo";var t=this.undoRedoStack[this.steps-1].start,n=this.undoRedoStack[this.steps-1].end,i=this.undoRedoStack[this.steps-1].text;this.parent.element.value=i,this.parent.element.focus(),this.steps--,this.restore(this.parent.element,t,n,e)}},e.prototype.redo=function(e){if(null!=this.undoRedoStack[this.steps+1]){this.currentAction="Redo";var t=this.undoRedoStack[this.steps+1].start,n=this.undoRedoStack[this.steps+1].end;this.parent.element.value=this.undoRedoStack[this.steps+1].text,this.parent.element.focus(),this.steps++,this.restore(this.parent.element,t,n,e)}},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.getUndoStatus=function(){var e={undo:!1,redo:!1};return this.steps>0&&(e.undo=!0),null!=this.undoRedoStack[this.steps+1]&&(e.redo=!0),e},e.prototype.getCurrentStackIndex=function(){return this.steps},e.prototype.clear=function(){this.undoRedoStack=[],this.steps=null},e}(),$t=function(){function e(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("link-commands",this.createLink,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("link-commands",this.createLink),this.parent.observer.off(v,this.destroy)},e.prototype.createLink=function(e){var t=this.parent.element;t.focus();var n=t.selectionStart,i=t.selectionEnd,s="Image"===e.subCommand?this.selection.getSelectedText(t):e.item.text,r="Image"===e.subCommand?n+2:n+1,o="Image"===e.subCommand?i+2:i+1;s="Image"===e.subCommand?"!["+s+"]("+e.item.url+")":"["+s+"]("+e.item.url+")",t.value=t.value.substr(0,n)+s+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,r,o),this.restore(t,r,o,e)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Jt=function(){function e(e){sf.base.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("insert-table",this.createTable,this),this.parent.observer.on("keydown-handler",this.onKeyDown,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("insert-table",this.createTable),this.parent.observer.off("keydown-handler",this.onKeyDown),this.parent.observer.off(v,this.destroy)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.onKeyDown=function(e){"insert-table"===e.event.action&&(e.item=e.value,this.createTable(e))},e.prototype.createTable=function(e){this.element=this.parent.element;var t=this.element.selectionStart,n=this.element.selectionEnd,i=this.element.value;this.locale=e,this.selection.save(t,n),this.restore(this.element.selectionStart,this.element.selectionEnd,null),this.insertTable(t,n,i,e)},e.prototype.getTable=function(){var e="";return e+=this.textNonEmpty(),e+=this.tableHeader(this.locale),e+=this.tableCell(this.locale)},e.prototype.tableHeader=function(e){for(var t="",n=1;n<=2;n++){t+="|";for(var i=1;i<=2;i++)t+=1===n?e.item.headingText+" "+i+"|":"---------|";t+=this.insertLine()}return t},e.prototype.tableCell=function(e){for(var t="",n=1;n<=2;n++){t+="|";for(var i=1;i<=2;i++)t+=e.item.colText+" "+this.convertToLetters(n)+i+"|";t+=this.insertLine()}return t+=this.insertLine()},e.prototype.insertLine=function(){var e=document.createElement("div");return e.innerHTML="\n",e.textContent},e.prototype.insertTable=function(e,t,n,i){var s=this.selection.getSelectedParentPoints(this.element),r=s[s.length-1].text.split(" ",2),o=this.getFormatTag();r.length<2?(this.element.value=this.updateValue(this.getTable()),this.makeSelection(n,e,t)):this.ensureFormatApply(s[s.length-1].text)?this.checkValid(e,t,this.getTable(),n,i,r,s,o):(this.element.value=this.updateValue(this.getTable()),this.makeSelection(n,e,t)),this.restore(this.element.selectionStart,this.element.selectionEnd,i)},e.prototype.makeSelection=function(e,t,n){n=t+(e.length>0?12:10),t+=e.length>0?3:1,this.selection.setSelection(this.element,t,n)},e.prototype.getFormatTag=function(){for(var e=Object.keys(this.syntaxTag.Formats),t=Object.keys(this.syntaxTag.List),n=[],i=0;i<e.length;i++)n.push(this.syntaxTag.Formats[e[i]]);for(var s=0;s<t.length;s++)n.push(this.syntaxTag.List[t[s]]);return n},e.prototype.ensureFormatApply=function(e){for(var t=this.getFormatTag(),n=e.trim().split(" ",2)[0]+" ",i=0;i<t.length;i++)if(n===t[i]||/^[\d.]+[ ]+$/.test(n))return!0;return!1},e.prototype.ensureStartValid=function(e,t){for(var n=t[0].text.split(" ",2),i=e+1;i<=e+n[0].length-1;i++)if(this.element.selectionStart===i||this.element.selectionEnd===i)return!1;return!0},e.prototype.ensureEndValid=function(e,t){for(var n=e+1;n<=e+t-1;n++)if(this.element.selectionEnd===n)return!1;return!0},e.prototype.updateValueWithFormat=function(e,t){var n=this.element.value.substring(this.element.selectionEnd,this.element.value.length);return t+=n.replace(n,e[0]+" "+n),this.element.value.substr(0,this.element.selectionStart)+t},e.prototype.updateValue=function(e){return this.element.value.substr(0,this.element.selectionStart)+e+this.element.value.substr(this.element.selectionEnd,this.element.value.length)},e.prototype.checkValid=function(e,t,n,i,s,r,o,a){this.ensureStartValid(o[0].start,o)&&this.ensureEndValid(o[o.length-1].start,r[0].length)&&(e===o[0].start?e!==t&&t!==o[o.length-1].end-1?this.element.value=this.updateValueWithFormat(r,n):this.element.value=this.updateValue(n):t===o[o.length-1].end-1?this.element.value=this.updateValue(n):this.element.value=this.updateValueWithFormat(r,n),this.makeSelection(i,e,t))},e.prototype.convertToLetters=function(e){var t="A".charCodeAt(0),n="";do{e-=1,n=String.fromCharCode(t+e%26)+n,e=e/26>>0}while(e>0);return n},e.prototype.textNonEmpty=function(){var e="";return(this.isCursorBased()||this.isSelectionBased())&&this.element.value.length>0&&(e+=this.insertLine(),e+=this.insertLine()),e},e.prototype.isCursorBased=function(){return this.element.selectionStart===this.element.selectionEnd},e.prototype.isSelectionBased=function(){return this.element.selectionStart!==this.element.selectionEnd},e.prototype.restore=function(e,t,n){this.selection.save(e,t),this.selection.restore(this.element),n&&n.callBack&&(sf.base.isNullOrUndefined(n.subCommand)&&"action"in n.event&&"insert-table"===n.event.action&&(n.subCommand="CreateTable"),n.callBack({requestType:n.subCommand,selectedText:this.selection.getSelectedText(this.element),editorMode:"Markdown",event:n.event}))},e}(),Zt=function(){function e(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("clear-commands",this.clear,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("clear-commands",this.clear),this.parent.observer.off(v,this.destroy)},e.prototype.replaceRegex=function(e){return e.replace(/\*/gi,"\\*").replace(/\&/gi,"\\&").replace(/\-/gi,"\\-").replace(/\^/gi,"\\^").replace(/\$/gi,"\\$").replace(/\./gi,"\\.").replace(/\|/gi,"\\|").replace(/\?/gi,"\\?").replace(/\+/gi,"\\+").replace(/\-/gi,"\\-").replace(/\&/gi,"\\&")},e.prototype.clearSelectionTags=function(e){for(var t=this.parent.selectionTags,n=Object.keys(t),i=0;i<n.length;i++){var s=n[i];if(Object.prototype.hasOwnProperty.call(t,s)&&""!==t[""+s]){var r=this.replaceRegex(t[""+s]),o=void 0,a=t[""+s].length,l="<sup>"===t[""+s]||"<sub>"===t[""+s]?t[""+s].length+1:t[""+s].length;if("<sup>"===t[""+s])o=new RegExp("<sup>(.*?)</sup>","ig");else if("<sub>"===t[""+s])o=new RegExp("<sub>(.*?)</sub>","ig");else{o=new RegExp(r+"(.*?)"+r,"ig")}for(var d=e.match(o),c=0;d&&c<d.length&&""!==d[c];c++)e=e.replace(d[c],d[c].substr(a,d[c].length-l-a))}}return e},e.prototype.clearFormatTags=function(e){var t=e.split("\n");return this.clearFormatLines(t)},e.prototype.clearFormatLines=function(e){for(var t=[this.parent.formatTags,this.parent.listTags],n="",i=0;i<e.length;i++){for(var s=0;s<t.length;s++)for(var r=t[s],o=Object.keys(r),a=0;a<o.length;a++){var l=o[a];Object.prototype.hasOwnProperty.call(r,l)&&""!==r[""+l]&&0===e[i].indexOf(r[""+l])&&(e[i]=e[i].replace(r[""+l],""),e[i]=this.clearFormatLines([e[i]]))}n=n+e[i]+(i!==e.length-1?"\n":"")}return n},e.prototype.clear=function(e){var t=this.parent.element;t.focus();var n=t.selectionStart,i=t.selectionEnd,s=this.selection.getSelectedText(t);s=this.clearSelectionTags(s),s=this.clearFormatTags(s),t.value=t.value.substr(0,n)+s+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,n,n+s.length),this.restore(t,n,n+s.length,e)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.destroy=function(){this.removeEventListener()},e}(),en=function(){function e(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("insert-text",this.InsertTextExec,this),this.parent.observer.on(v,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off("insert-text",this.InsertTextExec),this.parent.observer.off(v,this.destroy)},e.prototype.InsertTextExec=function(e){var t=this.parent.element;t.focus();var n=t.selectionStart,i=t.selectionEnd,s=e.value.text,r=n+s.length,o=i+s.length;t.value=t.value.substr(0,n)+s+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,r,o),this.restore(t,r,o,e)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.destroy=function(){this.removeEventListener()},e}(),tn=function(){function e(e){this.initialize(),sf.base.extend(this,this,e,!0),this.observer=new sf.base.Observer(this),this.markdownSelection=new _t,this.listObj=new Kt({parent:this,syntax:this.listTags}),this.formatObj=new Xt({parent:this,syntax:this.formatTags}),this.undoRedoManager=new Yt(this,e.options),this.mdSelectionFormats=new Gt({parent:this,syntax:this.selectionTags}),this.linkObj=new $t(this),this.tableObj=new Jt({parent:this,syntaxTag:{Formats:this.formatTags,List:this.listTags}}),this.clearObj=new Zt(this),this.insertTextObj=new en(this),this.wireEvents()}return e.prototype.initialize=function(){this.formatTags=Ce,this.listTags=Ee,this.selectionTags=Ne},e.prototype.wireEvents=function(){this.observer.on("keydown",this.editorKeyDown,this),this.observer.on("keyup",this.editorKeyUp,this),this.observer.on("model_changed",this.onPropertyChanged,this)},e.prototype.unwireEvents=function(){this.observer.off("keydown",this.editorKeyDown),this.observer.off("keyup",this.editorKeyUp),this.observer.off("model_changed",this.onPropertyChanged)},e.prototype.onPropertyChanged=function(e){this.observer.notify("model_changed_plugin",e)},e.prototype.editorKeyDown=function(e){this.observer.notify("keydown-handler",e)},e.prototype.editorKeyUp=function(e){this.observer.notify("keyup-handler",e)},e.prototype.execCommand=function(e,t,n,i,s,r){switch(e.toLocaleLowerCase()){case"lists":this.observer.notify("lists-commands",{subCommand:t,event:n,callBack:i});break;case"formats":this.observer.notify("format-type",{subCommand:t,event:n,callBack:i});break;case"actions":this.observer.notify("action",{subCommand:t,event:n,callBack:i});break;case"style":case"effects":case"casing":this.observer.notify("command-type",{subCommand:t,event:n,callBack:i});break;case"links":case"images":this.observer.notify("link-commands",{subCommand:t,event:n,callBack:i,item:r});break;case"table":switch(t.toString().toLocaleLowerCase()){case"createtable":this.observer.notify("insert-table",{subCommand:t,item:r,event:n,callBack:i})}break;case"clear":this.observer.notify("clear-commands",{subCommand:t,event:n,callBack:i});break;case"inserttext":this.observer.notify("insert-text",{subCommand:t,event:n,callBack:i,value:{text:r}})}},e.prototype.destroy=function(){this.observer.notify(v,{}),this.unwireEvents()},e}(),nn=(ae=function(e,t){return(ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}ae(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),sn=function(e){function t(t){var n=e.call(this)||this;return n.initialize(),sf.base.extend(n,n,t,!0),t&&n.element&&n.updateFormatter(n.element,document,t.options),n}return nn(t,e),t.prototype.initialize=function(){this.keyConfig=Te,this.formatSyntax=Ce,this.listSyntax=Ee,this.selectionSyntax=Ne},t.prototype.updateFormatter=function(e,t,n){e&&(this.editorManager=new tn({element:e,formatTags:this.formatSyntax,listTags:this.listSyntax,selectionTags:this.selectionSyntax,options:n}))},t}(Nt),rn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.saveSelection=new _t,this.parent.observer.on(t,this.render,this),this.parent.observer.on("markdown-toolbar-click",this.onToolbarClick,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on("selectAll",this.selectAll,this),this.parent.observer.on("getSelectedHtml",this.getSelectedHtml,this),this.parent.observer.on(a,this.onSelectionSave,this),this.parent.observer.on(l,this.onSelectionRestore,this),this.parent.observer.on("readOnlyMode",this.updateReadOnly,this)},e.prototype.updateReadOnly=function(){this.parent.readonly?(this.parent.getEditPanel().setAttribute("readonly","readonly"),sf.base.addClass([this.parent.element],"e-rte-readonly")):(this.parent.getEditPanel().removeAttribute("readonly"),sf.base.removeClass([this.parent.element],"e-rte-readonly"))},e.prototype.onSelectionSave=function(){var e=this.parent.getEditPanel();this.saveSelection.save(e.selectionStart,e.selectionEnd)},e.prototype.onSelectionRestore=function(e){this.parent.getEditPanel().focus();var t=this.parent.getEditPanel();this.saveSelection.restore(t)},e.prototype.onToolbarClick=function(e){var t,n=e.item,i=this.parent.getEditPanel();i.focus();var s=i.selectionStart,r=i.selectionEnd,o=i.value.substring(s,r);switch(n.subCommand){case"Maximize":this.parent.observer.notify("enableFullScreen",{args:e});break;case"Minimize":this.parent.observer.notify("disableFullScreen",{args:e});break;case"CreateLink":this.parent.observer.notify("insertLink",{member:"link",args:e,text:o,module:"Markdown"});break;case"Image":this.parent.observer.notify("insertImage",{member:"image",args:e,text:o,module:"Markdown"});break;case"CreateTable":t={headingText:this.parent.localeData.headingText,colText:this.parent.localeData.colText},this.parent.formatter.process(this.parent,e,e.originalEvent,t);break;default:this.parent.formatter.process(this.parent,e,e.originalEvent,null)}},e.prototype.removeEventListener=function(){this.parent.observer.off(t,this.render),this.parent.observer.off(i,this.destroy),this.parent.observer.off("markdown-toolbar-click",this.onToolbarClick),this.parent.observer.off("selectAll",this.selectAll),this.parent.observer.off("getSelectedHtml",this.getSelectedHtml),this.parent.observer.off(a,this.onSelectionSave),this.parent.observer.off(l,this.onSelectionRestore),this.parent.observer.off("readOnlyMode",this.updateReadOnly)},e.prototype.render=function(){var e=this.parent.getEditPanel(),t={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};sf.base.isNullOrUndefined(this.parent.adapter)?this.parent.formatter=new sn({element:e,options:t}):this.parent.formatter=new sn(sf.base.extend({},this.parent.adapter,{element:e,options:t})),this.parent.toolbarSettings.enable&&(this.toolbarUpdate=new Qt(this.parent)),this.parent.observer.notify(s,{})},e.prototype.selectAll=function(){this.parent.formatter.editorManager.markdownSelection.setSelection(this.parent.getEditPanel(),0,this.parent.getEditPanel().value.length)},e.prototype.getSelectedHtml=function(e){e.callBack(this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.getEditPanel()))},e.prototype.destroy=function(){this.removeEventListener()},e}(),on=function(){function e(e){this.isSticky=!1,this.isActive=!1,this.isDestroyed=!1,this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("formatPainterClick",this.toolbarClick,this),this.parent.observer.on("formatPainterDoubleClick",this.toolbarDoubleClick,this),this.parent.observer.on(c,this.editAreaClick,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(s,this.bindOnEnd,this)},e.prototype.bindOnEnd=function(){this.parent.formatter.editorManager.formatPainterObj||(this.parent.formatter.editorManager.formatPainterObj=new ht(this.parent.formatter.editorManager,this.parent.formatPainterSettings))},e.prototype.toolbarClick=function(e){this.parent.focusIn(),this.isSticky?(e.args.action="escape",this.actionHandler(e,"keyBoard")):(this.isActive=!0,this.actionHandler(e,"click")),this.hideQuickToolbar()},e.prototype.toolbarDoubleClick=function(e){this.isActive=!0,this.isSticky=!0,this.parent.focusIn(),this.actionHandler(e,"dbClick")},e.prototype.onKeyDown=function(e){var t=e.args;if(!sf.base.isNullOrUndefined(t)&&!sf.base.isNullOrUndefined(t.action)){var n=t.action,i="format-copy"===n||"format-paste"===n,s="escape"===n&&("format-copy"===this.previousAction||"format-paste"===this.previousAction);if(i||s){i&&t.stopPropagation();var r=this.parent.userAgentData.getBrowser();"Firefox"!==r&&"Safari"!==r||t.preventDefault(),this.actionHandler(e,"keyBoard")}}},e.prototype.actionHandler=function(e,t){var n,i,s,r,o,a,l=!1;switch(t){case"dbClick":a=(n=this.extractToolbarClickDetails(e,"format-copy")).item,o=n.originalEvent,r=n.action;break;case"keyBoard":o=e.args,l=!0,r=(i=this.processKeyboardAction(e)).action,a=i.item;break;case"click":a=(s=this.extractToolbarClickDetails(e,"format-copy")).item,o=s.originalEvent,r=s.action;break;case"docClick":o=e,r="format-paste"}var d={requestType:"FormatPainter",originalEvent:o,name:r,item:a||this.defaultToolbarItem()},c={formatPainterAction:r};this.parent.formatter.process(this.parent,d,o,c),d.cancel||(this.updateCursor(l),this.updateToolbarBtn("docClick"!==t&&"escape"!==r)),this.previousAction=r},e.prototype.extractToolbarClickDetails=function(e,t){var n=e.args;return{item:n.item,originalEvent:n.originalEvent,action:t}},e.prototype.processKeyboardAction=function(e){var t=e.args.action;return this.resetStickyStateIfEscape(t),{action:t,item:null}},e.prototype.resetStickyStateIfEscape=function(e){"escape"===e&&(this.isSticky=!1,this.isActive=!1)},e.prototype.defaultToolbarItem=function(){return{command:"FormatPainter",subCommand:"FormatPainter"}},e.prototype.updateCursor=function(e){this.parent.inputElement.classList.contains("e-rte-cursor-brush")||e?this.isSticky||sf.base.removeClass([this.parent.inputElement],"e-rte-cursor-brush"):sf.base.addClass([this.parent.inputElement],"e-rte-cursor-brush")},e.prototype.updateToolbarBtn=function(e){var t=this.parent.element.querySelector(".e-rte-format-painter"),n=this.parent.element.querySelector("#"+this.parent.element.id+"_toolbar_FormatPainter");sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(n)||(e?sf.base.addClass([n],"e-active"):sf.base.removeClass([n],"e-active"))},e.prototype.editAreaClick=function(e){this.isActive&&(this.isSticky||(this.isActive=!1),this.actionHandler(e,"docClick"),this.updateToolbarBtn(!1))},e.prototype.destroy=function(){this.isDestroyed||(this.removeListeners(),this.cleanup(),this.isDestroyed=!0)},e.prototype.removeListeners=function(){this.parent.observer.off("formatPainterClick",this.toolbarClick),this.parent.observer.off(c,this.editAreaClick),this.parent.observer.off("formatPainterDoubleClick",this.toolbarDoubleClick),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off(i,this.destroy),this.parent.observer.off(s,this.bindOnEnd)},e.prototype.cleanup=function(){this.parent=null,this.isSticky=null,this.isActive=null,this.previousAction=null},e.prototype.hideQuickToolbar=function(){this.parent.quickToolbarModule&&this.isTextQuickToolbarAvailable()&&this.parent.quickToolbarModule.textQTBar.hidePopup()},e.prototype.isTextQuickToolbarAvailable=function(){var e=this.parent.quickToolbarSettings;return 0!==e.text.length&&!sf.base.isNullOrUndefined(e.text)&&this.parent.quickToolbarModule.textQTBar&&this.parent.element.ownerDocument.contains(this.parent.quickToolbarModule.textQTBar.element)},e.prototype.getModuleName=function(){return"formatPainter"},e}(),an=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("execCommandCallBack",this.commandCallBack,this),this.parent.observer.on(i,this.removeEventListener,this)},e.prototype.commandCallBack=function(e){var t=!sf.base.isNullOrUndefined(e.requestType)&&"FormatPainter"===e.requestType&&"format-copy"===e.name;"Undo"===e.requestType||"Redo"===e.requestType||t||this.parent.formatter.saveData(),this.parent.observer.notify("toolbar-refresh",{args:e}),this.parent.observer.notify("count",{})},e.prototype.removeEventListener=function(){this.parent.observer.off("execCommandCallBack",this.commandCallBack),this.parent.observer.off(i,this.removeEventListener)},e}(),ln=function(){function e(e){this.parent=e,this.isDestroyed=!1,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on("onCodeBlock",this.onCodeBlock,this),this.parent.observer.on("code-block-paste-content",this.onPaste,this),this.parent.observer.on("code-block-enter",this.codeBlockEnter,this),this.parent.observer.on(o,this.onKeyDown,this),this.parent.observer.on(r,this.onKeyUp,this),this.parent.observer.on(c,this.editAreaClickHandler,this),this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(s,this.bindOnEnd,this)},e.prototype.onCodeBlock=function(e){if("codeBlock"===e.member&&e.args&&e.args.item){var t=this.parent.codeBlockSettings,n=void 0;if(t.languages&&t.languages.length>0){var i=sf.base.isNullOrUndefined(t.defaultLanguage)?[]:t.languages.filter((function(e){return e.language===t.defaultLanguage}));n=i.length>0?i[0]:t.languages[0],this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{language:n.language,label:n.label,action:"createCodeBlock",enterAction:this.parent.enterKey})}}},e.prototype.onPaste=function(e){var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.inputElement.ownerDocument);if(this.codeBlockObj.isValidCodeBlockStructure(t.startContainer)||this.codeBlockObj.isValidCodeBlockStructure(t.endContainer)){var n=sf.base.isNullOrUndefined(this.codeBlockObj.isValidCodeBlockStructure(t.startContainer))?this.codeBlockObj.isValidCodeBlockStructure(t.endContainer):this.codeBlockObj.isValidCodeBlockStructure(t.startContainer),i=this.parent.codeBlockSettings.languages.slice().filter((function(e){return e.label===n.getAttribute("data-language")})),s=e.item;sf.base.isNullOrUndefined(s)&&(s={command:"CodeBlock",subCommand:"CodeBlock"});var r={originalEvent:e.args,item:s};this.parent.formatter.process(this.parent,r,e.args,{action:"codeBlockPaste",currentFormat:{label:i[0].label,language:i[0].language}})}},e.prototype.codeBlockEnter=function(e){if(e.args&&13===e.args.which){var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.inputElement.ownerDocument);if(this.codeBlockObj.isValidCodeBlockStructure(t.startContainer)||this.codeBlockObj.isValidCodeBlockStructure(t.endContainer)){var n=e.item;sf.base.isNullOrUndefined(n)&&(n={command:"CodeBlock",subCommand:"CodeBlock"});var i={originalEvent:e.args,item:n};this.parent.formatter.process(this.parent,i,e.args,{action:"codeBlockEnter"})}}},e.prototype.codeBlockTab=function(e){var t=e.args&&9===e.args.which&&!e.args.shiftKey,n=e.args&&9===e.args.which&&e.args.shiftKey;if(t||n){var i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.inputElement.ownerDocument);if(this.codeBlockObj.isSelectionWithinCodeBlock(i,i.startContainer,i.endContainer)){var s=this.createToolbarItem(e),r={originalEvent:e.args,item:s},o=t?"codeBlockTabAction":"codeBlockShiftTabAction";this.parent.formatter.process(this.parent,r,e.args,{action:o}),e.args.preventDefault()}}},e.prototype.onKeyDown=function(e){var t=e.args;if(9!==t.which){var n=8===t.which||46===t.which,i="code-block"===t.action;if(n||i){var s=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.inputElement.ownerDocument);if(!this.isSelectionAllContent(s)){var r=this.parent.formatter.editorManager,o=r.codeBlockObj.getCodeBlockPosition(s),a=!sf.base.isNullOrUndefined(o.nextSiblingCodeBlockElement)&&o.cursorAtLastPosition,l=r.nodeSelection.findFirstContentNode(o.blockNode),d=l&&l.node===s.startContainer&&0===s.startOffset,c=r.codeBlockObj.findParentOrPreviousSiblingCodeBlock(s),h=!sf.base.isNullOrUndefined(c)&&c.currentNode&&"UL"!==c.currentNode.nodeName&&"OL"!==c.currentNode.nodeName&&d,p=!sf.base.isNullOrUndefined(this.codeBlockObj.isValidCodeBlockStructure(s.startContainer)),u=!sf.base.isNullOrUndefined(this.codeBlockObj.isValidCodeBlockStructure(s.endContainer)),f=p||u;if(f||a||h||i){var m=this.createToolbarItem(e),g={originalEvent:e.args,item:m};i?this.createCodeBlockWithDefaultLanguage(g,e):this.processCodeBlockDeletion(g,e,a,h,f,s)}}}}else this.codeBlockTab(e)},e.prototype.createToolbarItem=function(e){var t=e.item;return sf.base.isNullOrUndefined(t)&&(t={command:"CodeBlock",subCommand:"CodeBlock"}),t},e.prototype.processCodeBlockDeletion=function(e,t,n,i,s,r){if(n||i||!s)this.parent.formatter.process(this.parent,e,t.args,{action:"codeBlockBackSpace"});else{var o=(sf.base.isNullOrUndefined(this.codeBlockObj.isValidCodeBlockStructure(r.startContainer))?this.codeBlockObj.isValidCodeBlockStructure(r.endContainer):this.codeBlockObj.isValidCodeBlockStructure(r.startContainer)).getAttribute("data-language"),a=this.parent.codeBlockSettings.languages.slice().filter((function(e){return e.label===o}));a.length>0&&this.parent.formatter.process(this.parent,e,t.args,{action:"codeBlockBackSpace",currentFormat:{label:a[0].label,language:a[0].language}})}},e.prototype.createCodeBlockWithDefaultLanguage=function(e,t){var n=this.parent.codeBlockSettings;if(n.languages&&0!==n.languages.length){var i;if(!sf.base.isNullOrUndefined(n.defaultLanguage)){var s=n.languages.filter((function(e){return e.language===n.defaultLanguage}));i=s.length>0?s[0]:n.languages[0]}else i=n.languages[0];this.parent.formatter.process(this.parent,e,t.args,{language:i.language,label:i.label,action:"createCodeBlock",enterAction:this.parent.enterKey})}},e.prototype.isSelectionAllContent=function(e){var t=document.createElement("div");return t.appendChild(e.cloneContents()),t.innerHTML===this.parent.inputElement.innerHTML},e.prototype.onKeyUp=function(e){if(8===e.args.which||46===e.args.which){var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.inputElement.ownerDocument),n="#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,i="#text"===t.endContainer.nodeName?t.endContainer.parentElement:t.endContainer;if(n.closest("pre[data-language]")&&i.closest("pre[data-language]")){var s=e.item;sf.base.isNullOrUndefined(s)&&(s={command:"CodeBlock",subCommand:"CodeBlock"});var r={originalEvent:e.args,item:s};this.parent.formatter.process(this.parent,r,e.args,{action:"codeBlockBackSpace"})}}this.disableToolbarItems()},e.prototype.editAreaClickHandler=function(e){this.disableToolbarItems()},e.prototype.disableToolbarItems=function(){var e=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.inputElement.ownerDocument),t="#text"===e.startContainer.nodeName?e.startContainer.parentElement:e.startContainer,n="#text"===e.endContainer.nodeName?e.endContainer.parentElement:e.endContainer;this.codeBlockObj.isValidCodeBlockStructure(t)||this.codeBlockObj.isValidCodeBlockStructure(n)?this.disableToolbarItemForCodeBlock(!0):this.disableToolbarItemForCodeBlock(!1)},e.prototype.disableToolbarItemForCodeBlock=function(e){var t=["CodeBlock","Indent","Outdent","SourceCode","EmojiPicker","ImportWord","ExportWord","ExportPdf","LowerCase","UpperCase","Blockquote","NumberFormatList","BulletFormatList","UnorderedList","OrderedList","FullScreen","UL","OL"],n=["Undo","Redo"],i=this.parent.toolbarSettings.items.filter((function(e){return null!==e})),s=this.getToolbarElement();if(!sf.base.isNullOrUndefined(s)){var r=s.querySelectorAll(".e-toolbar-item:not(.e-separator)");this.updateToolbarItemsState(r,i,e,n,t);var o=sf.base.isNullOrUndefined(this.parent.quickToolbarModule&&this.parent.quickToolbarModule.textQTBar&&this.parent.quickToolbarModule.textQTBar.element)?null:this.parent.quickToolbarModule.textQTBar.element;if(o){var a=this.parent.quickToolbarSettings.text.filter((function(e){return null!==e})),l=o.querySelectorAll(".e-toolbar-item:not(.e-separator)");this.updateToolbarItemsState(l,a,e,n,t)}}},e.prototype.updateToolbarItemsState=function(e,t,n,i,s){for(var r=function(r){var o=t[r],a=e[r],l=o.subCommand?o.subCommand.toLowerCase():"";if(i.some((function(e){return e.toLowerCase()===l})))return"continue";var d=s.some((function(e){return e.toLowerCase()===l}));n?d||a.classList.add("e-overlay"):a.classList.remove("e-overlay")},o=0;o<t.length;o++)r(o)},e.prototype.getToolbarElement=function(){return this.parent.inlineMode.enable?this.parent.element.ownerDocument.querySelector("#"+this.parent.id+"_Inline_Quick_Popup"):this.parent.getToolbarElement()},e.prototype.removeEventListener=function(){this.parent.observer.off("onCodeBlock",this.onCodeBlock),this.parent.observer.off("code-block-paste-content",this.onPaste),this.parent.observer.off("code-block-enter",this.codeBlockEnter),this.parent.observer.off(o,this.onKeyDown),this.parent.observer.off(r,this.onKeyUp),this.parent.observer.off(c,this.editAreaClickHandler),this.parent.observer.off(i,this.destroy),this.parent.observer.off(s,this.bindOnEnd),this.parent.formatter.editorManager.observer.off("codeblock_disabletoolbar",this.editAreaClickHandler)},e.prototype.destroy=function(){this.isDestroyed||(this.isDestroyed=!0,this.removeEventListener())},e.prototype.getModuleName=function(){return"codeBlock"},e.prototype.bindOnEnd=function(){this.parent.formatter.editorManager.codeBlockObj||(this.parent.formatter.editorManager.codeBlockObj=new ut(this.parent.formatter.editorManager),this.codeBlockObj=this.parent.formatter.editorManager.codeBlockObj,this.parent.formatter.editorManager.observer.on("codeblock_disabletoolbar",this.editAreaClickHandler,this))},e}(),dn=function(){function e(e){this.parent=e,this.rteId=e.element.id,this.quickToolObj=this.parent.quickToolbarModule,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(i,this.destroy,this),this.parent.observer.on(p,this.docClick,this),this.parent.observer.on("importWord",this.wordDialog,this),this.parent.observer.on(t,this.afterRender,this),this.parent.observer.on("iframe-click",this.onIframeMouseDown,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(i,this.destroy),this.parent.observer.off(p,this.docClick),this.parent.observer.off("importWord",this.wordDialog),this.parent.observer.off(t,this.afterRender),this.parent.observer.off("iframe-click",this.onIframeMouseDown)},e.prototype.docClick=function(e){var t=e.args.target,n=(this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument()).querySelector("#"+this.rteId+"_import.e-rte-import-dialog");if(!sf.base.isNullOrUndefined(n)&&(!sf.base.closest(t,"#"+this.rteId+"_import")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(t)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(t)&&!sf.base.closest(t,"#"+this.rteId+"_toolbar_ImportWord")&&!t.querySelector("#"+this.rteId+"_toolbar_ImportWord"))){var i=e.args;i.offsetX>t.clientWidth||i.offsetY>t.clientHeight||(this.parent.dotNetRef.invokeMethodAsync("CloseWordDialog","Outside Click"),this.parent.isBlur=!0,sf.base.Browser.isIE&&ee(this.parent.element,"focusout"))}!this.parent.inlineMode.enable||sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(n)||sf.base.closest(t,"#"+this.rteId+"_import")||this.parent.dotNetRef.invokeMethodAsync("CloseWordDialog","Outside Click")},e.prototype.afterRender=function(){sf.base.EventHandler.add(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick,this)},e.prototype.wordDialog=function(e){var t=this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument();this.parent.dotNetRef.invokeMethodAsync("CloseWordDialog",null),this.selectionObj={selfWord:this,selection:e.selection,args:e.args,selectParent:e.selectParent};var n=this.parent.iframeSettings.enable;if(!n&&sf.base.isNullOrUndefined(sf.base.closest(e.selection.range.startContainer.parentNode,"#"+this.parent.getPanel().id))||n&&sf.base.isNullOrUndefined(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"))){this.parent.getEditPanel().focus();var i=this.parent.formatter.editorManager.nodeSelection.getRange(t);this.wordUploadSave=this.parent.formatter.editorManager.nodeSelection.save(i,t),this.wordUploadSelectedParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i)}else this.wordUploadSave=e.selection,this.wordUploadSelectedParent=e.selectParent;this.parent.dotNetRef.invokeMethodAsync("ShowWordDialog"),this.quickToolObj&&(this.quickToolObj.hideInlineQTBar(),sf.base.isNullOrUndefined(this.quickToolObj.textQTBar)||sf.base.isNullOrUndefined(this.quickToolObj.textQTBar.element)||!this.quickToolObj.textQTBar.element.classList.contains("e-popup-open")||this.quickToolObj.hideTextQTBar())},e.prototype.dialogOpened=function(){var e=this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument(),t=sf.base.Browser.isDevice?e.getElementById(this.rteId+"_import").querySelector(".e-import-content"):sf.base.isNullOrUndefined(this.parent.element.querySelector(".e-rte-import-dialog .e-import-content"))?e.querySelector(".e-rte-elements .e-rte-import-dialog .e-import-content"):this.parent.element.querySelector(".e-rte-import-dialog .e-import-content");if(!sf.base.isNullOrUndefined(t)){var n=e.getElementById(this.rteId+"_dropText"),i=e.getElementById(this.rteId+"_importWord");this.buttonClickElement=sf.base.Browser.isDevice?n:i,sf.base.EventHandler.add(this.buttonClickElement,"click",this.wordBrowseClick,this),t.querySelector("#"+this.rteId+"_importWord").focus()}},e.prototype.dialogClosed=function(){this.selectionObj.selection.restore(),this.buttonClickElement&&sf.base.EventHandler.remove(this.buttonClickElement,"click",this.wordBrowseClick)},e.prototype.wordBrowseClick=function(){(this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument()).getElementById(this.rteId+"_import").querySelector(".e-rte-import-dialog .e-file-select-wrap button").click()},e.prototype.onIframeMouseDown=function(e){this.onDocumentClick(e)},e.prototype.onDocumentClick=function(e){var t=e.target,n=(this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument()).body.querySelector("#"+this.rteId+"_import.e-rte-import-dialog");!sf.base.isNullOrUndefined(n)&&(!sf.base.closest(t,"#"+this.rteId+"_import")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!sf.base.closest(t,"#"+this.rteId+"_toolbar_ImportWord")&&!t.querySelector("#"+this.rteId+"_toolbar_ImportWord"))&&(e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.dotNetRef.invokeMethodAsync("CloseWordDialog","Outside Click"),this.parent.isBlur=!0,sf.base.Browser.isIE&&ee(this.parent.element,"focusout"))),!this.parent.inlineMode.enable||sf.base.isNullOrUndefined(t)||sf.base.isNullOrUndefined(n)||sf.base.closest(t,"#"+this.rteId+"_import")||this.parent.dotNetRef.invokeMethodAsync("CloseWordDialog","Outside Click")},e.prototype.showDialog=function(e){var t,n,i,s,r=this.parent.iframeSettings.enable?this.parent.getPanel().ownerDocument:this.parent.getDocument();e&&!sf.base.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&(t=this.parent.formatter.editorManager.nodeSelection.getRange(r),n=this.parent.formatter.editorManager.nodeSelection.save(t,r),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),s=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)),this.wordDialog({args:{item:{command:"ImportWord",subCommand:"ImportWord"},originalEvent:e?void 0:event,name:e?"showDialog":null},selectNode:i,selection:n,selectParent:s})},e.prototype.destroy=function(){this.removeEventListener(),sf.base.EventHandler.remove(this.parent.element.ownerDocument,"mousedown",this.onDocumentClick)},e}(),cn=function(){return(cn=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},hn=function(){function e(e){this.undoRedoSteps=30,this.undoRedoTimer=300,this.floatingToolbarOffset=0,this.enableHtmlEncode=!1,this.importWordValue={},this.defaultResetValue=null,this.isInitial=!0,this.blurEnabled=!1,this.focusEnabled=!1,this.undoRedoStatus=!1,this.createdEnabled=!1,this.isIframeRteElement=!0,this.actionBeginEnabled=!1,this.imageDeleteEnabled=!1,this.mediaDeleteEnabled=!1,this.onResizeStopEnabled=!1,this.quickTbClosedEnabled=!1,this.quickTbOpenedEnabled=!1,this.onQuickTbOpenEnabled=!1,this.onResizeStartEnabled=!1,this.actionCompleteEnabled=!1,this.beforeUploadImageEnabled=!1,this.onImageUploadFailedEnabled=!1,this.onImageUploadSuccessEnabled=!1,this.beforeUploadMediaEnabled=!1,this.onMediaUploadFailedEnabled=!1,this.onMediaUploadSuccessEnabled=!1,this.beforePasteCleanupEnabled=!1,this.afterPasteCleanupEnabled=!1,this.selectionChangedEnabled=!1,this.isPlainPaste=!1,this.hasContentChanged=!1,this.isSelecting=!1,this.isSelectionStartInRTE=!1,this.isSelectAll=!1,this.clickPoints={clientX:0,clientY:0},this.inlineCloseItems=["CreateLink","Image","CreateTable","Maximize","Minimize","Video","Audio"],window.sfBlazor=window.sfBlazor,this.updateContext(e),window.sfBlazor&&(sf.base.isNullOrUndefined(window.sfBlazor.instances)&&(window.sfBlazor.instances=[]),window.sfBlazor.instances[this.dataId]=this),this.observer=new sf.base.Observer(this),this.userAgentData=new je(sf.base.Browser.userAgent,!1),this.onClickBoundfn=this.clickHandler.bind(this),this.initModules(),this.initialize()}return e.prototype.updateContext=function(e){sf.base.extend(this,this,e)},e.prototype.initModules=function(){this.id=this.element.id,this.updateContentElements(),this.rootContainer=this.element.firstChild,this.inputElement=this.getEditPanel(),sf.base.isNullOrUndefined(this.fontFamily.default)||(this.inputElement.style.fontFamily=this.fontFamily.default),sf.base.isNullOrUndefined(this.fontSize.default)||(this.inputElement.style.fontSize=this.fontSize.default),this.valueContainer=this.element.querySelector("textarea"),this.toolbarSettings.enable&&(this.isUndoRedoStatus(),this.toolbarModule=new le(this)),this.linkModule=new it(this),this.imageModule=new bt(this),"HTML"===this.editorMode&&(this.audioModule=new vt(this),this.videoModule=new yt(this)),this.showCharCount&&(this.countModule=new g(this)),this.quickToolbarSettings.enable&&(this.quickToolbarModule=new Dt(this)),"HTML"===this.editorMode?this.htmlEditorModule=new Ot(this):this.markdownEditorModule=new rn(this),this.tableModule=new gt(this),"HTML"===this.editorMode&&(this.pasteCleanupModule=new Wt(this)),this.enableResize&&(this.resizeModule=new b(this)),"HTML"===this.editorMode&&(this.formatPainterModule=new on(this),this.viewSourceModule=new Bt(this)),this.fullScreenModule=new kt(this),"HTML"===this.editorMode&&(this.enterKeyModule=new xt(this),this.codeBlockModule=new ln(this)),"HTML"===this.editorMode&&(this.wordModule=new dn(this))},e.prototype.initialize=function(){this.value=this.replaceEntities(this.value),this.onBlurHandler=this.blurHandler.bind(this),this.onFocusHandler=this.focusHandler.bind(this),this.onResizeHandler=this.resizeHandler.bind(this,!1);new an(this);this.readonly&&this.setReadOnly(!0),this.iframeSettings&&this.iframeSettings.enable&&this.setIframeSettings(),(sf.base.isNullOrUndefined(this.value)||""===this.value)&&(this.value=this.element.querySelector(".e-rte-value-wrapper").innerHTML.replace(/<!--!-->/gi,"").trim()),this.setPanelValue(this.value),this.observer.notify(t,{}),this.enableXhtml&&(this.value=this.getXhtml()),null!==this.value&&(this.defaultResetValue=this.value),this.enabled&&!this.readonly?this.wireEvents():this.unWireEvents(),this.observer.notify("tableclass",{}),this.addAudioVideoWrapper(),this.autoResize(),this.createdEnabled&&this.dotNetRef.invokeMethodAsync("CreatedEvent")},e.prototype.addAnchorAriaLabel=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelectorAll("a");if(n.length>0)for(var i=0;i<n.length;i++)n[i].hasAttribute("target")&&"_blank"===n[i].getAttribute("target")&&(n[i].hasAttribute("aria-label")&&""!==n[i].getAttribute("aria-label")||n[i].setAttribute("aria-label",this.localeData.linkAriaLabel));return t.innerHTML},e.prototype.addAudioVideoWrapper=function(){for(var e,t=this,n=this.element.querySelectorAll("audio"),i=0;i<n.length;i++)if(n[i].classList.contains("e-rte-audio")||(n[i].classList.add("e-rte-audio"),n[i].classList.add("e-audio-inline")),!n[i].parentElement.classList.contains("e-clickelem")&&!n[i].parentElement.classList.contains("e-audio-wrap")){var s=sf.base.createElement("span",{className:"e-audio-wrap"});s.contentEditable="false";var r=sf.base.createElement("span",{className:"e-clickelem"});s.appendChild(r),n[i].parentNode.insertBefore(s,n[i].nextSibling),r.appendChild(n[i]),null===s.nextElementSibling&&(e=sf.base.createElement("br"),s.parentNode.insertBefore(e,s.nextSibling))}var o=this.element.querySelectorAll("video");for(i=0;i<o.length;i++){if(o[i].classList.contains("e-rte-video")||(o[i].classList.add("e-rte-video"),o[i].classList.add("e-video-inline")),!o[i].parentElement.classList.contains("e-clickelem")&&!o[i].parentElement.classList.contains("e-video-wrap")){var a=sf.base.createElement("span",{className:"e-video-wrap"});a.contentEditable="false",o[i].parentNode.insertBefore(a,o[i].nextSibling),a.appendChild(o[i]),null===a.nextElementSibling&&(e=sf.base.createElement("br"),a.parentNode.insertBefore(e,a.nextSibling))}-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&(o[i].addEventListener("play",(function(e){t.observer.notify(d,{args:e}),t.observer.notify("editAreaClick",{args:e})})),o[i].addEventListener("pause",(function(e){t.observer.notify(d,{args:e}),t.observer.notify("editAreaClick",{args:e})})))}},e.prototype.isUndoRedoStatus=function(){for(var e=0;e<this.toolbarSettings.items.length;e++)if(!sf.base.isNullOrUndefined(this.toolbarSettings.items[e])&&("Undo"===this.toolbarSettings.items[e].subCommand||"Redo"===this.toolbarSettings.items[e].subCommand)){this.undoRedoStatus=!0;break}},e.prototype.setPanelValue=function(e,t){var n;e=this.serializeValue(e),this.value="HTML"!==this.editorMode||sf.base.isNullOrUndefined(e)?e:this.addAnchorAriaLabel(e),"HTML"===this.editorMode&&this.enableXhtml&&(this.inputElement.innerHTML=R(e,this.editorMode),this.observer.notify("xhtmlValidation",{}),e=U(H(e=this.inputElement.innerHTML,this.element),this.enterKey,this.enableHtmlEncode)),"HTML"!==this.editorMode||t||((sf.base.isNullOrUndefined(e)||""===e)&&(n=""),e=Y(sf.base.isNullOrUndefined(e)?"":e,this),e=this.enableXhtml?this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e):e),this.updatePanelValue(e,n),this.value=""===n?n:this.valueContainer.value,this.value!==D(this.cloneValue,this.editorMode)&&(this.enableXhtml&&(this.valueContainer.value=this.getXhtmlString(this.valueContainer.value)),ee(this.valueContainer,"change"),this.isInitial?this.isInitial=!1:this.dotNetRef.invokeMethodAsync("UpdateValue",this.value),this.cloneValue=this.value),this.setPlaceHolder()},e.prototype.updateContentElements=function(){"HTML"===this.editorMode&&this.iframeSettings&&this.iframeSettings.enable?(this.contentPanel=this.element.querySelector("iframe"),this.updateIframeHtmlContents()):this.contentPanel=this.element.querySelector(".e-rte-content")},e.prototype.iframeHeader=function(){return"\n            <!DOCTYPE html> \n            <html>\n                 <head>\n                    <meta charset='utf-8' /> \n                    <style> "+this.getEditorStyles()+"\n                    </style>\n                </head>\n        "},e.prototype.getEditorStyles=function(){return"\n@charset \"UTF-8\";\n\n* {\n    box-sizing: border-box;\n}\n\nhtml {\n    height: auto;\n}\n\nhtml, body {\n    margin: 0;\n}\n\nbody {\n    color: #333;\n    word-wrap: break-word;\n}\n\n.e-content {\n    background: unset;\n    min-height: 100px;\n    outline: 0 solid transparent;\n    padding: 16px;\n    position: relative;\n    overflow-x: auto;\n    font-weight: normal;\n    line-height: 1.5;\n    font-size: 14px;\n    text-align: inherit;\n    font-family: \"Roboto\", \"Segoe UI\", \"GeezaPro\", \"DejaVu Serif\", \"sans-serif\", \"-apple-system\", \"BlinkMacSystemFont\";\n}\n\n.e-content p {\n    margin: 0 0 10px;\n    margin-bottom: 10px;\n}\n.e-rte-checklist > li:not(.e-rte-checklist-hidden) {\n    list-style: none;\n    position: relative;\n}\n.e-rte-checklist > li::before {\n    content: '';\n    position: absolute;\n    top: 2px;\n    box-sizing: content-box;\n    left: -25px;\n    width: 16px;\n    height: 16px;\n    border-radius: 2px;\n    cursor: pointer;\n}\n.e-rte-checklist li.e-rte-checklist-checked::after {\n    border-style: solid;\n    border-width: 0 calc(16px / 8) calc(16px / 8) 0;\n    box-sizing: content-box;\n    content: '';\n    display: block;\n    height: 8px;\n    width: 4px;\n    left: -19px;\n    position: absolute;\n    top: 4.5px;\n    transform: rotate(45deg);\n    cursor: pointer;\n}\n.e-rtl {\n    .e-rte-checklist li.e-rte-checklist-checked::after {\n        right: -19px;\n    }\n    .e-rte-checklist > li::before {\n        right: -25px;\n    }\n}\n.e-content h1 {\n    font-size: 2.857em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h2 {\n    font-size: 2.285em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h3 {\n    font-size: 2em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h4 {\n    font-size: 1.714em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h5 {\n    font-size: 1.428em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h6 {\n    font-size: 1.142em;\n    font-weight: 600;\n    line-height: 1.5;\n    margin: 10px 0;\n}\n\n.e-content blockquote {\n    margin: 10px 0;\n    padding-left: 12px;\n    border-left: 2px solid #5c5c5c;\n}\n\n.e-rtl.e-content blockquote {\n    padding-left: 0;\n    padding-right: 12px;\n}\n\n.e-content pre {\n    border: 0;\n    border-radius: 0;\n    color: #333;\n    font-size: inherit;\n    line-height: inherit;\n    margin: 0 0 10px;\n    overflow: visible;\n    padding: 0;\n    white-space: pre-wrap;\n    word-break: inherit;\n    word-wrap: break-word;\n}\n\n.e-content code {\n    background: #9d9d9d26;\n    color: #ed484c;\n}\n\n.e-content strong,\n.e-content b {\n    font-weight: bold;\n}\n\n.e-content hr {\n    margin: 10px 0;\n    border: 2px solid rgba(176, 179, 184, 1);\n}\n\n.e-content hr:hover {\n    cursor: default;\n}\n\nhr.e-rte-hr-focus {\n    outline: 2px solid rgba(33, 150, 243, .3);\n    outline-offset: 3px;\n}\n\n.e-content a {\n    text-decoration: none;\n    user-select: auto;\n}\n\n.e-content a:hover {\n    text-decoration: underline;\n}\n\n.e-content li {\n    margin-bottom: 10px;\n}\n\n.e-content li ol,\n.e-content li ul {\n    margin-block-start: 10px;\n}\n\n.e-content ul {\n    list-style-type: disc;\n}\n\n.e-content ul ul,\n.e-content ol ul {\n    list-style-type: circle;\n}\n\n.e-content ul ul ul,\n.e-content ol ul ul,\n.e-content ul ol ul,\n.e-content ol ol ul {\n    list-style-type: square;\n}\n\n.e-content p:last-child,\n.e-content pre:last-child,\n.e-content blockquote:last-child {\n    margin-bottom: 0;\n}\n\n.e-content h3 + h4,\n.e-content h4 + h5,\n.e-content h5 + h6 {\n    margin-top: 0.6em;\n}\n\n.e-content ul:last-child {\n    margin-bottom: 0;\n}\n\n.e-content table {\n    margin-bottom: 10px;\n    border-collapse: collapse;\n    border-spacing: 0;\n    empty-cells: show;\n}\n\n.e-content table.e-cell-select {\n    position: relative;\n}\n\n.e-content table.e-cell-select::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    border: 2px double #4a90e2;\n    pointer-events: none;\n}\n\ntable .e-cell-select {\n    border: 1px double #4a90e2 !important;\n}\n\n.e-content table.e-rte-table th {\n    background-color: rgba(157, 157, 157, .15);\n}\n\n.e-rte-table td,\n.e-rte-table th {\n    border: 1px solid #BDBDBD;\n    height: 20px;\n    min-width: 20px;\n    padding: 2px 5px;\n}\n\n.e-rte-table td.e-cell-select.e-multi-cells-select,\n.e-rte-table th.e-cell-select.e-multi-cells-select {\n    position: relative;\n}\n\n.e-rte-table td.e-cell-select.e-multi-cells-select::after,\n.e-rte-table th.e-cell-select.e-multi-cells-select::after {\n    background-color: rgba(13, 110, 253, 0.08);\n    content: \"\";\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    bottom: 0;\n    pointer-events: none;\n    right: 0;\n}\n\ntable td.e-multi-cells-select ::selection,\ntable th.e-multi-cells-select ::selection {\n    background-color: transparent;\n}\n\ntd.e-multi-cells-select,\nth.e-multi-cells-select {\n    user-select: none !important;\n}\n\n.e-rte-table.e-dashed-border > tbody > tr > td,\n.e-rte-table.e-dashed-border > tbody > tr > th {\n    border-style: dashed;\n}\n\n.e-rte-table.e-alternate-border > tbody > tr:nth-child(2n),\n.e-rte-table.e-alternate-border > tbody > tr:nth-child(2n) > td,\n.e-rte-table.e-alternate-border > tbody > tr:nth-child(2n) > th {\n    background-color: #F5F5F5;\n}\n\n.e-rte-image,\n.e-rte-audio,\n.e-rte-video  {\n    border: 0;\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-imginline,\n.e-rte-audio.e-audio-inline,\n.e-rte-video.e-video-inline {\n    margin-left: 5px;\n    margin-right: 5px;\n    display: inline-block;\n    float: none;\n    max-width: 100%;\n    padding: 1px;\n    vertical-align: bottom;\n}\n\n.e-rte-image.e-imgcenter,\n.e-rte-video.e-video-center {\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-imgright,\n.e-rte-video.e-video-right {\n    float: right;\n    margin: 0 auto;\n    margin-left: 5px;\n    text-align: right;\n}\n\n.e-rte-image.e-imgleft,\n.e-rte-video.e-video-left {\n    float: left;\n    margin: 0 auto;\n    margin-right: 5px;\n    text-align: left;\n}\n\n.e-rte-img-caption {\n    display: inline-block;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-img-caption.e-caption-inline {\n    display: inline-block;\n    margin: 5px auto;\n    margin-left: 5px;\n    margin-right: 5px;\n    max-width: calc(100% - (2 * 5px));\n    position: relative;\n    text-align: center;\n    vertical-align: bottom;\n}\n\n.e-rte-img-caption.e-imgcenter {\n    display: contents;\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.e-rte-img-caption.e-imgright {\n    display: contents;\n    margin-left: auto;\n    margin-right: 0;\n}\n\n.e-rte-img-caption.e-imgleft {\n    display: contents;\n    margin-left: 0;\n    margin-right: auto;\n}\n\n.e-img-caption.e-rte-img-caption.e-imgbreak {\n    display: contents;\n}\n\n.e-rte-img-caption .e-img-inner {\n    display: block;\n    font-size: 16px;\n    font-weight: initial;\n    margin: auto;\n    opacity: .9;\n    position: relative;\n    text-align: center;\n    width: 100%;\n}\n\n.e-img-wrap {\n    display: inline-block;\n    margin: auto;\n    padding: 0;\n    text-align: center;\n    width: 100%;\n}\n\n.e-imgleft,\n.e-video-left {\n    float: left;\n    margin: 0 5px 0 0;\n    text-align: left;\n}\n\n.e-imgright,\n.e-video-right {\n    float: right;\n    margin: 0 0 0 5px;\n    text-align: right;\n}\n\n.e-imgcenter,\n.e-video-center {\n    cursor: pointer;\n    display: block;\n    float: none;\n    height: auto;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-control img:not(.e-resize) {\n    border: 2px solid transparent;\n    z-index: 1000\n}\n\n.e-imginline,\n.e-audio-inline,\n.e-video-inline {\n    display: inline-block;\n    float: none;\n    margin-left: 5px;\n    margin-right: 5px;\n    vertical-align: bottom;\n}\n\n.e-imgbreak,\n.e-audio-break,\n.e-video-break {\n    border: 0;\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-img-focus:not(.e-resize),\n.e-audio-focus:not(.e-resize),\n.e-video-focus:not(.e-resize) {\n    border: solid 2px #4a90e2;\n}\n\nimg.e-img-focus::selection,\naudio.e-audio-focus::selection,\n.e-video-focus::selection {\n    background: transparent;\n    color: transparent;\n}\n\nspan.e-rte-imageboxmark,\nspan.e-rte-videoboxmark {\n    width: 10px;\n    height: 10px;\n    position: absolute;\n    display: block;\n    background: #4a90e2;\n    border: 1px solid #fff;\n    z-index: 1000;\n}\n\n.e-mob-rte.e-mob-span span.e-rte-imageboxmark,\n.e-mob-rte.e-mob-span span.e-rte-videoboxmark {\n    background: #4a90e2;\n    border: 1px solid #fff;\n}\n\n.e-mob-rte span.e-rte-imageboxmark,\n.e-mob-rte span.e-rte-videoboxmark {\n    background: #fff;\n    border: 1px solid #4a90e2;\n    border-radius: 15px;\n    height: 20px;\n    width: 20px;\n}\n\n.e-mob-rte.e-mob-span span.e-rte-imageboxmark,\n.e-mob-rte.e-mob-span span.e-rte-videoboxmark {\n    background: #4a90e2;\n    border: 1px solid #fff;\n}\n\n.e-content img.e-resize,\n.e-content video.e-resize {\n    z-index: 1000;\n}\n\n.e-img-caption .e-img-inner {\n    outline: 0;\n}\n\n.e-rte-img-caption.e-imgleft .e-img-inner {\n    float: left;\n    text-align: left;\n}\n\n.e-rte-img-caption.e-imgright .e-img-inner {\n    float: right;\n    text-align: right;\n}\n\n.e-rte-img-caption.e-imgleft .e-img-wrap,\n.e-rte-img-caption.e-imgright .e-img-wrap {\n    display: contents;\n}\n\n.e-img-caption a:focus-visible {\n    outline: none;\n}\n\n.e-rte-img-caption .e-rte-image.e-imgright {\n    margin-left: auto;\n    margin-right: 0;\n}\n\n.e-rte-img-caption .e-rte-image.e-imgleft {\n    margin: 0;\n}\n\n.e-content {\n    .e-clickelem::after {\n        left: 0;\n        right: 0;\n        z-index: 1;\n    }\n    .e-clickelem::before {\n        left: 0;\n        right: 0;\n        z-index: 1;\n    }\n    .e-clickelem::before {\n        bottom: 70%;\n        top: 0;\n    }\n    .e-clickelem::after {\n        bottom: 0;\n        top: 70%;\n    }\n\n    .e-audio-wrap {\n        display: inline-block;\n    }\n\n    .e-clickelem {\n        display: block;\n        margin: 0;\n        outline: none;\n        padding: 0;\n        position: relative;\n    }\n\n    .e-clickelem::after {\n        background: transparent;\n        content: '';\n        cursor: default;\n        display: block;\n        position: absolute;\n    }\n\n    .e-clickelem::before {\n        background: transparent;\n        content: '';\n        cursor: default;\n        display: block;\n        position: absolute;\n    }\n}\n\nspan.e-table-box {\n    cursor: nwse-resize;\n    display: block;\n    height: 10px;\n    position: absolute;\n    width: 10px;\n    background-color: #ffffff;\n    border: 1px solid #BDBDBD;\n}\n\nspan.e-table-box.e-rmob {\n    height: 14px;\n    width: 14px;\n    background-color: #BDBDBD;\n    border: 1px solid #BDBDBD;\n}\n\n.e-rte-table-resize.e-tb-col-insert,\n.e-rte-table-resize.e-tb-row-insert {\n  position: absolute;\n  background-color: transparent;\n  text-align: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  opacity: 0;\n  color: #0F6CBD;\n}\n\n.e-rte-table-resize.e-tb-col-insert {\n  width: 26px;\n  height: 22px;\n}\n\n.e-rte-table-resize.e-tb-row-insert {\n  width: 22px;\n  height: 26px;\n}\n\n.e-rte-table-resize.e-tb-row-insert.e-insert-cell-rtl {\n  right: 2px;\n}\n\n.e-rte-table-resize.e-tb-col-insert .e-icons.e-circle-add,\n.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle-add {\n  font-size: 16px;\n  line-height: 16px;\n  border: 1px;\n  position: absolute;\n}\n\n.e-rte-table-resize.e-tb-col-insert .e-icons.e-circle-add {\n  top: -1px;\n  left: 5px;\n}\n\n.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle-add {\n  top: 5.5px;\n  left: -0.8px;\n}\n\n.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle-add.e-insert-cell-rtl {\n  left: 7px;\n}\n\n.e-rte-table-resize.e-tb-col-insert .e-icons.e-circle,\n.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle {\n  font-size: 8px;\n  line-height: 8px;\n  border: 1px;\n  position: absolute;\n}\n\n.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle {\n  top: 9px;\n  left: 4px;\n}\n\n.e-rte-table-resize.e-tb-col-insert .e-icons.e-circle {\n  top: 4px;\n  left: 9px;\n}\n\n.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle.e-insert-cell-rtl {\n  left: 10px;\n}\n\n.e-row-resize,\n.e-column-resize {\n    background-color: transparent;\n    background-repeat: repeat;\n    bottom: 0;\n    cursor: col-resize;\n    height: 1px;\n    overflow: visible;\n    position: absolute;\n    width: 1px;\n}\n\n.e-row-resize {\n    cursor: row-resize;\n    height: 1px;\n}\n\n.e-table-rhelper {\n    cursor: col-resize;\n    opacity: .87;\n    position: absolute;\n}\n\n.e-table-rhelper.e-column-helper {\n    width: 1px;\n}\n\n.e-table-rhelper.e-row-helper {\n    height: 1px;\n}\n\n.e-icons.e-circle::before {\n  content: '';\n  display: inline-block;\n  width: 8px;\n  height: 8px;\n  background-image: url('data:image/svg+xml,%3Csvg%20width%3D%228%22%20height%3D%228%22%20viewBox%3D%220%200%208%208%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%20%20%3Cg%20clip-path%3D%22url(%23clip0_circle_8)%22%3E%0A%20%20%20%20%3Crect%20width%3D%228%22%20height%3D%228%22%20fill%3D%22black%22%20fill-opacity%3D%220.01%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M3.82767%200.571429L3.64626%200.589569L3.47392%200.60771L3.14739%200.680273L2.98413%200.725627L2.82086%200.780047L2.51247%200.907027L2.22222%201.07029L1.95011%201.25837L1.82313%201.35147L1.69615%201.46032L1.46032%201.69615L1.35147%201.82313L1.25837%201.95011L1.07029%202.22222L0.907027%202.51247L0.780047%202.82086L0.725627%202.98413L0.680273%203.14739L0.60771%203.47392L0.589569%203.64626L0.571429%203.82767V4.17233L0.589569%204.35374L0.60771%204.52608L0.680273%204.85261L0.725627%205.01587L0.780047%205.17914L0.907027%205.48753L1.07029%205.77778L1.25837%206.04989L1.35147%206.17687L1.46032%206.30385L1.69615%206.53968L1.82313%206.64853L1.95011%206.74163L2.22222%206.92971L2.51247%207.09297L2.82086%207.21995L2.98413%207.27437L3.14739%207.31973L3.47392%207.39229L3.64626%207.41043L3.82767%207.42857H4.17233L4.35374%207.41043L4.52608%207.39229L4.85261%207.31973L5.01587%207.27437L5.17914%207.21995L5.48753%207.09297L5.77778%206.92971L6.04989%206.74163L6.17687%206.64853L6.30385%206.53968L6.53968%206.30385L6.64853%206.17687L6.74163%206.04989L6.92971%205.77778L7.09297%205.48753L7.21995%205.17914L7.27437%205.01587L7.31973%204.85261L7.39229%204.52608L7.41043%204.35374L7.42857%204.17233V3.82767L7.41043%203.64626L7.39229%203.47392L7.31973%203.14739L7.27437%202.98413L7.21995%202.82086L7.09297%202.51247L6.92971%202.22222L6.74163%201.95011L6.64853%201.82313L6.53968%201.69615L6.30385%201.46032L6.17687%201.35147L6.04989%201.25837L5.77778%201.07029L5.48753%200.907027L5.17914%200.780047L5.01587%200.725627L4.85261%200.680273L4.52608%200.60771L4.35374%200.589569L4.17233%200.571429H3.82767ZM4%200L4.20862%200.00907027L4.41149%200.0181405L4.60771%200.0453515L4.80392%200.0816327L4.9977%200.126984L5.18821%200.181405L5.37869%200.244898L5.56009%200.317461L5.73242%200.390023L5.90476%200.480726L6.07709%200.580499L6.24036%200.680273L6.39456%200.798187L6.53968%200.916102L6.82993%201.17007L6.95691%201.30612L7.08389%201.45125L7.31973%201.75964L7.41953%201.9229L7.51934%202.0951L7.61014%202.26757L7.68254%202.43991L7.75514%202.62131L7.81859%202.81179L7.87301%203.0056L7.8844%203.19274L7.95467%203.39229L7.98186%203.5885L7.99093%203.79138L8%204L7.99093%204.20862L7.98186%204.41149L7.95467%204.60771L7.8844%204.80392L7.87301%204.9977L7.81859%205.18821L7.75514%205.37869L7.68254%205.56009L7.61014%205.73242L7.51934%205.90476L7.41953%206.07709L7.31973%206.24036L7.08389%206.54875L6.95691%206.69388L6.82993%206.82993L6.69388%206.95691L6.54875%207.08389L6.24036%207.31973L6.07709%207.41953L5.90476%207.51934L5.73242%207.61014L5.56009%207.68254L5.37869%207.75514L5.18821%207.81859L4.9977%207.87301L4.80392%207.8844L4.60771%207.95467L4.41149%207.98186L4.20862%207.99093L4%208L3.79138%207.99093L3.5885%207.98186L3.39229%207.95467L3.19274%207.8844L3.0056%207.87301L2.81179%207.81859L2.62131%207.75514L2.43991%207.68254L2.26757%207.61014L2.0951%207.51934L1.9229%207.41953L1.75964%207.31973L1.45125%207.08389L1.30612%206.95691L1.17007%206.82993L0.916102%206.53968L0.798187%206.39456L0.680273%206.24036L0.580499%206.07709L0.480726%205.90476L0.390023%205.73242L0.317461%205.56009L0.244898%205.37869L0.181405%205.18821L0.126984%204.9977L0.0816327%204.80392L0.0453515%204.60771L0.0181405%204.41149L0.00907027%204.20862L0%204L0.00907027%203.79138L0.0181405%203.5885L0.0453515%203.39229L0.0816327%203.19274L0.126984%203.0056L0.181405%202.81179L0.244898%202.62131L0.317461%202.43991L0.390023%202.26757L0.480726%202.0951L0.580499%201.9229L0.680273%201.75964L0.798187%201.60544L0.916102%201.46032L1.17007%201.17007L1.30612%201.04309L1.45125%200.916102L1.75964%200.680273L1.9229%200.580499L2.0951%200.480726L2.26757%200.390023L2.43991%200.317461L2.62131%200.244898L2.81179%200.181405L3.0056%200.126984L3.19274%200.0816327L3.39229%200.0453515L3.5885%200.0181405L3.79138%200.00907027L4%200Z%22%20fill%3D%22%230F6CBD%22%2F%3E%0A%20%20%3C%2Fg%3E%0A%20%20%3Cdefs%3E%0A%20%20%20%20%3CclipPath%20id%3D%22clip0_circle_8%22%3E%0A%20%20%20%20%20%20%3Crect%20width%3D%228%22%20height%3D%228%22%20fill%3D%22white%22%2F%3E%0A%20%20%20%20%3C%2FclipPath%3E%0A%20%20%3C%2Fdefs%3E%0A%3C%2Fsvg%3E');\n}\n\n.e-icons.e-circle-add::before {\n  content: '';\n  display: inline-block;\n  width: 16px;\n  height: 16px;\n  background-image: url('data:image/svg+xml,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cg%20clip-path%3D%22url(%23clip0_1124_24361)%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22black%22%20fill-opacity%3D%220.01%22%2F%3E%0A%3Cpath%20d%3D%22M8.10169%204.27119L8.20339%204.30508L8.30508%204.35593L8.44068%204.49153L8.49153%204.59322L8.52542%204.69492L8.54237%204.79661V7.45763H11.2034L11.3051%207.47458L11.4068%207.50847L11.5085%207.55932L11.6441%207.69492L11.6949%207.79661L11.7288%207.89831V8.10169L11.6949%208.20339L11.6441%208.30508L11.5085%208.44068L11.4068%208.49153L11.3051%208.52542L11.2034%208.54237H8.54237V11.2034L8.52542%2011.3051L8.49153%2011.4068L8.44068%2011.5085L8.30508%2011.6441L8.20339%2011.6949L8.10169%2011.7288H7.89831L7.79661%2011.6949L7.69492%2011.6441L7.55932%2011.5085L7.50847%2011.4068L7.47458%2011.3051L7.45763%2011.2034V8.54237H4.79661L4.69492%208.52542L4.59322%208.49153L4.49153%208.44068L4.35593%208.30508L4.30508%208.20339L4.27119%208.10169V7.89831L4.30508%207.79661L4.35593%207.69492L4.49153%207.55932L4.59322%207.50847L4.69492%207.47458L4.79661%207.45763H7.45763V4.79661L7.47458%204.69492L7.50847%204.59322L7.55932%204.49153L7.69492%204.35593L7.79661%204.30508L7.89831%204.27119H8.10169ZM8%201.05085L7.64407%201.0678L7.28814%201.10169L6.94915%201.13559L6.59322%201.20339L6.27119%201.27119L5.9322%201.37288L5.61017%201.47458L5.30508%201.61017L4.98305%201.74576L4.69492%201.89831L4.11864%202.23729L3.84746%202.44068L3.59322%202.64407L3.08475%203.08475L2.64407%203.59322L2.44068%203.84746L2.23729%204.11864L1.89831%204.69492L1.74576%204.98305L1.61017%205.30508L1.47458%205.61017L1.37288%205.9322L1.27119%206.27119L1.20339%206.59322L1.13559%206.94915L1.10169%207.28814L1.0678%207.64407L1.05085%208L1.0678%208.35593L1.10169%208.71186L1.13559%209.05085L1.20339%209.40678L1.27119%209.72881L1.37288%2010.0678L1.47458%2010.3898L1.61017%2010.6949L1.74576%2011.0169L1.89831%2011.3051L2.23729%2011.8814L2.44068%2012.1525L2.64407%2012.4068L3.08475%2012.9153L3.59322%2013.3559L3.84746%2013.5593L4.11864%2013.7627L4.69492%2014.1017L4.98305%2014.2542L5.30508%2014.3898L5.61017%2014.5254L5.9322%2014.6271L6.27119%2014.7288L6.59322%2014.7966L6.94915%2014.8644L7.28814%2014.8983L7.64407%2014.9322L8%2014.9492L8.35593%2014.9322L8.71186%2014.8983L9.05085%2014.8644L9.40678%2014.7966L9.72881%2014.7288L10.0678%2014.6271L10.3898%2014.5254L10.6949%2014.3898L11.0169%2014.2542L11.3051%2014.1017L11.8814%2013.7627L12.1525%2013.5593L12.4068%2013.3559L12.9153%2012.9153L13.3559%2012.4068L13.5593%2012.1525L13.7627%2011.8814L14.1017%2011.3051L14.2542%2011.0169L14.3898%2010.6949L14.5254%2010.3898L14.6271%2010.0678L14.7288%209.72881L14.7966%209.40678L14.8644%209.05085L14.8983%208.71186L14.9322%208.35593L14.9492%208L14.9322%207.64407L14.8983%207.28814L14.8644%206.94915L14.7966%206.59322L14.7288%206.27119L14.6271%205.9322L14.5254%205.61017L14.3898%205.30508L14.2542%204.98305L14.1017%204.69492L13.7627%204.11864L13.5593%203.84746L13.3559%203.59322L12.9153%203.08475L12.4068%202.64407L12.1525%202.44068L11.8814%202.23729L11.3051%201.89831L11.0169%201.74576L10.6949%201.61017L10.3898%201.47458L10.0678%201.37288L9.72881%201.27119L9.40678%201.20339L9.05085%201.13559L8.71186%201.10169L8.35593%201.0678L8%201.05085ZM8.40678%200L8.81356%200.0338983L9.22034%200.0847458L9.61017%200.152542L10%200.237288L10.7458%200.474576L11.1186%200.627119L11.4746%200.779661L12.1525%201.15254L12.4746%201.35593L12.7966%201.57627L13.1017%201.81356L13.3898%202.0678L13.9322%202.61017L14.1864%202.89831L14.4237%203.20339L14.6441%203.52542L14.8475%203.84746L15.2203%204.52542L15.3729%204.88136L15.5254%205.25424L15.6441%205.61017L15.7627%206L15.8475%206.38983L15.9153%206.77966L15.9661%207.18644L16%207.59322V8.40678L15.9661%208.81356L15.9153%209.22034L15.8475%209.61017L15.7627%2010L15.6441%2010.3898L15.5254%2010.7458L15.3729%2011.1186L15.2203%2011.4746L14.8475%2012.1525L14.6441%2012.4746L14.4237%2012.7966L14.1864%2013.1017L13.9322%2013.3898L13.3898%2013.9322L13.1017%2014.1864L12.7966%2014.4237L12.4746%2014.6441L12.1525%2014.8475L11.4746%2015.2203L11.1186%2015.3729L10.7458%2015.5254L10%2015.7627L9.61017%2015.8475L9.22034%2015.9153L8.81356%2015.9661L8.40678%2016H7.59322L7.18644%2015.9661L6.77966%2015.9153L6.38983%2015.8475L6%2015.7627L5.25424%2015.5254L4.88136%2015.3729L4.52542%2015.2203L3.84746%2014.8475L3.52542%2014.6441L3.20339%2014.4237L2.89831%2014.1864L2.61017%2013.9322L2.0678%2013.3898L1.81356%2013.1017L1.57627%2012.7966L1.35593%2012.4746L1.15254%2012.1525L0.779661%2011.4746L0.627119%2011.1186L0.474576%2010.7458L0.237288%2010L0.152542%209.61017L0.0847458%209.22034L0.0338983%208.81356L0%208.40678V7.59322L0.0338983%207.18644L0.0847458%206.77966L0.152542%206.38983L0.237288%206L0.474576%205.25424L0.627119%204.88136L0.779661%204.52542L1.15254%203.84746L1.35593%203.52542L1.57627%203.20339L1.81356%202.89831L2.0678%202.61017L2.61017%202.0678L2.89831%201.81356L3.20339%201.57627L3.52542%201.35593L3.84746%201.15254L4.52542%200.779661L4.88136%200.627119L5.25424%200.474576L6%200.237288L6.38983%200.152542L6.77966%200.0847458L7.18644%200.0338983L7.59322%200H8.40678Z%22%20fill%3D%22%230F6CBD%22%2F%3E%0A%3C%2Fg%3E%0A%3Cdefs%3E%0A%3CclipPath%20id%3D%22clip0_1124_24361%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22white%22%2F%3E%0A%3C%2FclipPath%3E%0A%3C%2Fdefs%3E%0A%3C%2Fsvg%3E%20%20%0A');\n}\n\n.e-reicon::before {\n    border-bottom: 6px solid transparent;\n    border-right: 6px solid;\n    border-top: 6px solid transparent;\n    content: '';\n    display: block;\n    height: 0;\n    position: absolute;\n    right: 4px;\n    top: 4px;\n    width: 20px;\n}\n\n.e-reicon::after {\n    border-bottom: 6px solid transparent;\n    border-left: 6px solid;\n    border-top: 6px solid transparent;\n    content: '';\n    display: block;\n    height: 0;\n    left: 4px;\n    position: absolute;\n    top: 4px;\n    width: 20px;\n    z-index: 3;\n}\n\n.e-row-helper.e-reicon::after {\n    top: 10px;\n    transform: rotate(90deg);\n}\n\n.e-row-helper.e-reicon::before {\n    left: 4px;\n    top: -20px;\n    transform: rotate(90deg);\n}\n\n.e-table-rhelper {\n    background-color: #0F6CBD;\n}\n\n.e-rtl {\n    direction: rtl;\n}\n\n.e-rte-placeholder::before {\n    content: attr(placeholder);\n    opacity: 0.54;\n    overflow: hidden;\n    padding-top: 16px;\n    position: absolute;\n    text-align: start;\n    top: 0;\n    z-index: 1;\n}\n\n.e-resize-enabled,\n.e-count-enabled {\n    padding-bottom: 0px;\n}\npre[data-language] {\n    font-family: Space Mono;\n    border-radius: 6px;\n    padding: 20px 16px 16px;\n    position: relative;\n}\npre[data-language] code{\n    background: none;\n    color: #645454;\n}\npre[data-language]::before {\n    content: attr(data-language);\n    font-family: 'Helvetica Neue';\n    font-weight: 500;\n    font-size: 12px;\n    line-height: 18px;\n    right: 8px;\n    padding: 2px 4px;\n    top: -1px;\n    border-radius: 0px 0px 4px 4px;\n    position: absolute;\n}\n".replace(/[\n\t]/g,"")+(window.getComputedStyle(this.element.querySelector(".e-rte-container")).content.includes("dark-theme")?"\npre[data-language] {\n    background-color: rgba(157, 157, 157, 0.08);\n    color: rgba(245, 245, 245, 1);\n    border: 1px solid rgba(40, 47, 60, 1);\n}\npre[data-language]::before {\n    background-color: rgba(189, 186, 186, 1);\n    color: rgba(29, 36, 50, 1);\n}\n.e-rte-checklist > li::before {\n   border: 1px solid rgba(173, 173, 173, 1);\n}\n.e-rte-checklist li.e-rte-checklist-checked::before {\n  background: rgba(17, 94, 163, 1);\n  border: 1px solid rgba(17, 94, 163, 1);\n}\n.e-rte-checklist li.e-rte-checklist-checked::after {\n  border-color: rgba(255, 255, 255, 1);\n}\n":"\npre[data-language] {\n    background-color: rgba(157, 157, 157, 0.08);\n    color: rgba(46, 46, 46, 1);\n    border: 1px solid rgba(229, 231, 235, 1);\n}\npre[data-language]::before {\n    background-color: rgba(105, 105, 105, 1);\n    color: rgba(249, 250, 251, 1);\n}\n.e-rte-checklist > li::before {\n   border: 1px solid rgba(97, 97, 97, 1);\n}\n.e-rte-checklist li.e-rte-checklist-checked::before {\n  background: rgba(15, 108, 189, 1);\n  border: 1px solid rgba(15, 108, 189, 1);\n}\n.e-rte-checklist li.e-rte-checklist-checked::after {\n  border-color: rgba(255, 255, 255, 1);\n}\n").replace(/[\n\t]/g,"")},e.prototype.updateIframeHtmlContents=function(){var e=this.iframeHeader()+'<body contenteditable="true"></body></html>',t=this.contentPanel;if(t.srcdoc=e,t.setAttribute("role","none"),t.contentDocument.open(),e=this.setThemeColor(e,{color:"#333"}),t.contentDocument.write(e),t.contentDocument.close(),t.contentDocument.body.id=this.id+"_rte-edit-view",t.contentDocument.body.className="e-content",!sf.base.isNullOrUndefined(t.contentDocument.head)&&this.iframeSettings.metaTags.length>0){var n=t.contentDocument.head;this.iframeSettings.metaTags.forEach((function(e){var t=document.createElement("meta");for(var i in e)sf.base.isNullOrUndefined(e[i])||t.setAttribute("httpEquiv"===i?"http-equiv":i,e[i]);n.appendChild(t)}))}},e.prototype.setThemeColor=function(e,t){return e.replace(t.color,getComputedStyle(this.element,".e-richtexteditor").getPropertyValue("color"))},e.prototype.refresh=function(e){void 0===e&&(e={requestType:"refresh"}),this.observer.notify(e.requestType+"-begin",e)},e.prototype.openPasteDialog=function(){this.dotNetRef.invokeMethodAsync("PasteDialog")},e.prototype.getXhtml=function(){var e=D(this.value,this.editorMode);return this.enableXhtml&&(e=this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e)),e},e.prototype.getXhtmlString=function(e){return this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e)},e.prototype.getPanel=function(){return this.contentPanel},e.prototype.removeResizeElement=function(e){return D(e,this.editorMode)},e.prototype.saveSelection=function(){this.formatter.editorManager.nodeSelection.save(this.getRange(),this.getDocument())},e.prototype.restoreSelection=function(){this.formatter.editorManager.nodeSelection.restore()},e.prototype.getEditPanel=function(){return this.iframeSettings&&this.iframeSettings.enable?sf.base.isNullOrUndefined(this.contentPanel.contentDocument)?this.inputElement:this.contentPanel.contentDocument.body:this.element.querySelector(".e-rte-content .e-content")},e.prototype.getText=function(){return this.getEditPanel().innerText},e.prototype.getDocument=function(){return this.getEditPanel().ownerDocument},e.prototype.getRange=function(){return this.formatter.editorManager.nodeSelection.getRange(this.getDocument())},e.prototype.updateValueContainer=function(e){this.enableXhtml&&!sf.base.isNullOrUndefined(e)&&(e=this.getXhtmlString(e)),this.valueContainer.value=e,this.value!==D(this.cloneValue,this.editorMode)&&ee(this.valueContainer,"change")},e.prototype.getInputInnerHtml=function(){return this.inputElement.innerHTML.replace(/<!--!-->/gi,"")},e.prototype.refreshUI=function(){this.refresh(),("Markdown"===this.editorMode||this.iframeSettings.enable)&&this.autoResize()},e.prototype.getUpdatedValue=function(){var e,t=this.element.querySelector(".e-rte-srctextarea");if("HTML"===this.editorMode){var n=this.getInputInnerHtml();if(e=n===$(this)?null:this.enableHtmlEncode?this.encode(Z(this.removeResizeElement(n))):n,this.enableHtmlSanitizer&&!sf.base.isNullOrUndefined(e)&&/&(amp;)*((times)|(divide)|(ne))/.test(this.value)&&(e=e.replace(/&(amp;)*(times|divide|ne)/g,"&amp;amp;$2")),!sf.base.isNullOrUndefined(t)&&this.rootContainer.classList.contains("e-source-code-enabled")){var i=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(t.value):t.value;e=H(/&(amp;)*((times)|(divide)|(ne))/.test(i)?i.replace(/&(amp;)*(times|divide|ne)/g,"&amp;amp;$2"):i,this.element)}e=D(e,this.editorMode)}else e=""===this.inputElement.value?null:this.inputElement.value;return null==e||this.enableHtmlEncode||(e=this.removeResizeElement(e)),e},e.prototype.updateEnable=function(){this.enabled?(sf.base.removeClass([this.element],"e-disabled"),this.element.setAttribute("aria-disabled","false"),sf.base.isNullOrUndefined(this.htmlAttributes.tabindex)?this.inputElement.setAttribute("tabindex","0"):this.inputElement.setAttribute("tabindex",this.htmlAttributes.tabindex)):(this.getToolbar()&&(sf.base.removeClass(this.getToolbar().querySelectorAll(".e-active"),"e-active"),sf.base.removeClass([this.getToolbar().parentElement],["e-rte-tb-float"])),sf.base.addClass([this.element],"e-disabled"),this.element.tabIndex=-1,this.element.setAttribute("aria-disabled","true"),this.inputElement.setAttribute("tabindex","-1"))},e.prototype.setEnable=function(){this.updateEnable(),this.enabled?this.wireEvents():this.unWireEvents()},e.prototype.executeCommand=function(e,t,n){if("importWord"===e){var i=sf.base.createElement("div");i.innerHTML=t;for(var s=i.querySelectorAll("table:not(.e-rte-table):not(.e-rte-paste-table)"),r=0;r<s.length;r++)s[r].classList.add("e-rte-paste-table");t=i.innerHTML,i.remove(),e="insertHTML"}var o;if(t=this.htmlPurifier(e,t),"HTML"===this.editorMode){var a=this.getRange();this.iframeSettings.enable&&this.formatter.editorManager.nodeSelection.Clear(this.element.ownerDocument),(!(!this.iframeSettings.enable||a.startContainer!==this.inputElement)||!this.inputElement.contains(a.startContainer))&&this.focusIn()}var l=Q[e];n&&n.undo&&n.undo&&0===this.formatter.getUndoRedoStack().length&&this.formatter.saveData(),o=t,"CodeBlock"!==l.command||sf.base.isNullOrUndefined(t)||(t.action="createCodeBlock"),"NumberFormatList"!==l.subCommand&&"BulletFormatList"!==l.subCommand||(o={listStyle:t,type:l.subCommand}),this.formatter.editorManager.execCommand(l.command,l.subCommand?l.subCommand:t||l.value,null,null,t||l.value,o||("UL"===l.value||"OL"===l.value?null:l.value)),E(this.getDocument(),this.inputElement),n&&n.undo&&(this.formatter.saveData(),this.formatter.enableUndo(this)),this.setPlaceHolder(),this.observer.notify("content-changed",{}),this.value=this.inputElement.innerHTML,this.dotNetRef.invokeMethodAsync("UpdateValue",this.value)},e.prototype.htmlPurifier=function(e,t){var n,i,s,r;if("HTML"===this.editorMode)switch(e){case"insertHTML":this.enableHtmlSanitizer&&("string"==typeof t?(t=t.replace(/&(times|divide|ne)/g,"&amp;amp;$1"),t=this.htmlEditorModule.sanitizeHelper(t)):t=this.htmlEditorModule.sanitizeHelper(t.outerHTML));break;case"insertTable":sf.base.isNullOrUndefined(t.width)&&(t.width={minWidth:this.tableSettings.minWidth,maxWidth:this.tableSettings.maxWidth,width:this.tableSettings.width}),t.selection=this.formatter.editorManager.nodeSelection.save(this.getRange(),this.getDocument());break;case"insertImage":r=""!==(s=sf.base.createElement("img",{attrs:{src:t.url}}).outerHTML)&&sf.base.createElement("div",{innerHTML:s}).firstElementChild.getAttribute("src")||null,r=sf.base.isNullOrUndefined(r)?"":r,t.url=r,sf.base.isNullOrUndefined(t.width)&&(t.width={minWidth:this.insertImageSettings.minWidth,maxWidth:this.insertImageSettings.maxWidth,width:this.insertImageSettings.width}),sf.base.isNullOrUndefined(t.height)&&(t.height={minHeight:this.insertImageSettings.minHeight,maxHeight:this.insertImageSettings.maxHeight,height:this.insertImageSettings.height}),t.selection=this.formatter.editorManager.nodeSelection.save(this.getRange(),this.getDocument());break;case"createLink":n=""!==(i=sf.base.createElement("a",{attrs:{href:t.url}}).outerHTML)&&sf.base.createElement("div",{innerHTML:i}).firstElementChild.getAttribute("href")||null,n=sf.base.isNullOrUndefined(n)?"":n,t.url=n,t.selection=this.formatter.editorManager.nodeSelection.save(this.getRange(),this.getDocument())}return t},e.prototype.getInsertImgMaxWidth=function(){var e=this.insertImageSettings.maxWidth,t=this.getEditPanel();if("HTML"===this.editorMode&&!sf.base.isNullOrUndefined(this.formatter.editorManager.nodeSelection)&&!sf.base.isNullOrUndefined(this.formatter.editorManager.nodeSelection.range)){var n=this.formatter.editorManager.nodeSelection.range;3!==n.startContainer.nodeType&&n.startContainer.closest&&!sf.base.isNullOrUndefined(n.startContainer.closest("TD"))&&(t=n.startContainer)}var i=window.getComputedStyle(t),s=t.offsetWidth-(14+parseFloat(i.paddingLeft.split("px")[0])+parseFloat(i.paddingRight.split("px")[0])+parseFloat(i.marginLeft.split("px")[0])+parseFloat(i.marginRight.split("px")[0]));return sf.base.isNullOrUndefined(e)?s:e},e.prototype.serializeValue=function(e){return"HTML"!==this.editorMode||sf.base.isNullOrUndefined(e)||(e=H(e,this.element),this.enableXhtml||(e=U(e,this.enterKey,this.enableHtmlEncode)),this.enableHtmlEncode?(e=this.htmlEditorModule.sanitizeHelper(Z(e)),e=this.encode(e)):e=this.htmlEditorModule.sanitizeHelper(e)),e},e.prototype.selectAll=function(){this.observer.notify("selectAll",{})},e.prototype.selectRange=function(e){this.observer.notify("selectRange",{range:e})},e.prototype.showFullScreen=function(){this.fullScreenModule.showFullScreen()},e.prototype.sanitizeHtml=function(e){return this.serializeValue(e)},e.prototype.clipboardAction=function(e,t){switch(e.toLowerCase()){case"cut":this.onCut(t),this.formatter.onSuccess(this,{requestType:"Cut",editorMode:this.editorMode,event:t});break;case"copy":this.onCopy(t),this.formatter.onSuccess(this,{requestType:"Copy",editorMode:this.editorMode,event:t});break;case"paste":this.onPaste(t)}},e.prototype.getContent=function(){return this.iframeSettings.enable?this.inputElement:this.getPanel()},e.prototype.getSelectedHtml=function(){var e=sf.base.createElement("div"),t=this.getDocument().getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0).cloneContents();e.appendChild(n)}return e.innerHTML},e.prototype.getSelection=function(){var e="";return this.observer.notify("getSelectedHtml",{callBack:function(t){e=t}}),e},e.prototype.showInlineToolbar=function(){if(this.inlineMode.enable){var e=this.getRange();sf.base.isNullOrUndefined(sf.base.closest(e.startContainer.parentNode,".e-content"))&&(this.inputElement.focus(),e=this.getRange());var t="#text"===e.endContainer.nodeName?e.endContainer.parentElement:e.endContainer,n=Array.from(e.getClientRects(),(function(e){return e}));0===n.length&&(n=[e.startContainer.getBoundingClientRect()]),n.length>0&&this.quickToolbarModule.showInlineQTBar(t,null)}},e.prototype.hideInlineToolbar=function(){this.quickToolbarModule.hideInlineQTBar()},e.prototype.updateValueData=function(){if(this.enableHtmlEncode)this.setPanelValue(this.encode(Z(this.inputElement.innerHTML)));else{var e=/<[a-z][\s\S]*>/i.test(this.inputElement.innerHTML)?this.inputElement.innerHTML:Z(this.inputElement.innerHTML);this.setPanelValue(e)}},e.prototype.removeSheets=function(e){var t;for(t=0;t<e.length;t++)sf.base.detach(e[t])},e.prototype.updateReadOnly=function(){this.observer.notify("readOnlyMode",{editPanel:this.inputElement,mode:this.readonly})},e.prototype.setReadOnly=function(e){this.updateReadOnly(),e||(this.readonly&&this.enabled?this.unBindEvents():this.enabled&&(this.unBindEvents(),this.bindEvents()))},e.prototype.setIframeSettings=function(){if(this.iframeSettings.resources){var e=this.iframeSettings.resources.styles,t=this.iframeSettings.resources.scripts;!sf.base.isNullOrUndefined(this.iframeSettings.resources.styles)&&this.iframeSettings.resources.styles.length>0&&this.InjectSheet(!1,e),!sf.base.isNullOrUndefined(this.iframeSettings.resources.scripts)&&this.iframeSettings.resources.scripts.length>0&&this.InjectSheet(!0,t)}this.iframeSettings.attributes&&function(e,t,n,i){var s;if(s=n?t.getDocument().querySelector("body"):t.element,Object.keys(e).length)for(var r=0,o=Object.keys(e);r<o.length;r++){var a=o[r];if("class"===a)s.classList.add(e[a]);else if("disabled"===a&&"disabled"===e[a])t.enabled=!1,t.setEnable();else if("readonly"===a&&"readonly"===e[a])t.readonly=!0,t.setReadOnly(i);else if("style"===a)s.style.cssText=e[a];else if("tabindex"===a)t.inputElement.setAttribute("tabindex",e[a]);else if("placeholder"===a)t.placeholder=e[a],t.setPlaceHolder();else{["name","required"].indexOf(a)>-1?t.valueContainer.setAttribute(a,e[a]):s.setAttribute(a,e[a])}}}(this.iframeSettings.attributes,this,!0,!1),this.iframeSettings.enable&&this.enableRtl?this.inputElement.classList.add("e-rtl"):this.iframeSettings.enable&&!this.enableRtl&&this.inputElement.hasAttribute("class")&&this.inputElement.classList.contains("e-rtl")&&this.inputElement.classList.remove("e-rtl")},e.prototype.InjectSheet=function(e,t){try{if(t&&t.length>0)for(var n=this.getDocument().querySelector("head"),i=0;i<t.length;i++)if(e){var s=this.createScriptElement();s.src=t[i],n.appendChild(s)}else{var r=this.createStyleElement();r.href=t[i],n.appendChild(r)}}catch(e){return}},e.prototype.createScriptElement=function(){var e=sf.base.createElement("script",{className:"rte-iframe-script-sheet"});return e.type="text/javascript",e},e.prototype.createStyleElement=function(){var e=sf.base.createElement("link",{className:"rte-iframe-style-sheet"});return e.rel="stylesheet",e},e.prototype.updateResizeFlag=function(){this.isResizeInitialized=!0},e.prototype.getHtml=function(){return this.serializeValue(D(this.getEditPanel().innerHTML,this.editorMode))},e.prototype.showSourceCode=function(){this.readonly||this.observer.notify("sourceCode",{})},e.prototype.getCharCount=function(){var e="Markdown"===this.editorMode?this.getEditPanel().value.trim():this.getEditPanel().textContent.trim();return"Markdown"!==this.editorMode&&-1!==e.indexOf("​")?e.replace(/\u200B/g,"").length:e.length},e.prototype.focusOut=function(){this.enabled&&(this.inputElement.blur(),this.blurHandler({}))},e.prototype.getToolbar=function(){return this.inlineMode.enable?this.element.querySelector("#"+this.id+"_Inline_Quick_Popup"):this.toolbarSettings.enable?this.element.querySelector("#"+this.id+"_toolbar"):null},e.prototype.getToolbarElement=function(){return this.inlineMode.enable?this.element.querySelector("#"+this.id+"_Inline_Quick_Popup"):this.toolbarSettings.enable?this.element.querySelector("#"+this.id+"_toolbar"):null},e.prototype.updateIntervalValue=function(){clearTimeout(this.idleInterval),this.idleInterval=setTimeout(this.updateValueOnIdle.bind(this),0)},e.prototype.updateValueOnIdle=function(){(sf.base.isNullOrUndefined(this.tableModule)||sf.base.isNullOrUndefined(this.inputElement.querySelector(".e-table-box.e-rbox-select")))&&(this.value=this.getUpdatedValue(),this.updateValueContainer(this.value),this.invokeChangeEvent())},e.prototype.invokeChangeEvent=function(){this.enableXhtml&&!sf.base.isNullOrUndefined(this.value)&&(this.value=this.getXhtml()),this.value!==D(this.cloneValue,this.editorMode)&&(this.enablePersistence&&window.localStorage.setItem(this.id,this.value),this.dotNetRef.invokeMethodAsync("ChangeEvent"),this.cloneValue=this.value)},e.prototype.preventImgResize=function(e){"img"===e.target.nodeName.toLocaleLowerCase()&&e.preventDefault()},e.prototype.getCssClass=function(e){return sf.base.isNullOrUndefined(this.cssClass)?"":e?" "+this.cssClass:this.cssClass},e.prototype.preventDefaultResize=function(e,t){if("msie"===sf.base.Browser.info.name)t?this.getEditPanel().removeEventListener("mscontrolselect",this.preventImgResize):this.getEditPanel().addEventListener("mscontrolselect",this.preventImgResize);else if("mozilla"===sf.base.Browser.info.name){var n=t?"true":"false";this.getDocument().execCommand("enableObjectResizing",t,n),this.getDocument().execCommand("enableInlineTableEditing",t,n)}},e.prototype.encode=function(e){var t=document.createElement("div");return t.innerText=e.trim(),t.innerHTML.replace(/<br\s*\/?>/gi,"\n")},e.prototype.print=function(){var e,t=this;this.dotNetRef.invokeMethodAsync("ActionBeginEvent",{requestType:"print",cancel:!1}).then((function(n){if(e=window.open("","print","height="+window.outerHeight+",width="+window.outerWidth),"msie"===sf.base.Browser.info.name&&e.resizeTo(screen.availWidth,screen.availHeight),e=sf.base.print(t.inputElement,e),!n.cancel){t.dotNetRef.invokeMethodAsync("ActionCompleteEvent",{requestType:"print"})}}))},e.prototype.autoResize=function(){if("auto"===this.height){if("Markdown"===this.editorMode)this.setAutoHeight(this.inputElement);else if(this.iframeSettings.enable){var e=this.contentPanel;e&&this.setAutoHeight(e)}}else if("Markdown"===this.editorMode){var t=this.inputElement,n=this.enableResize||this.showCharCount?20:0;t&&(t.style.height=this.element.clientHeight-(this.toolbarModule.getToolbarHeight()+n+3)+"px")}else if(this.iframeSettings.enable){var i=this.contentPanel;n=this.enableResize||this.showCharCount?20:0;i&&(i.style.height=this.element.clientHeight-(this.toolbarModule.getToolbarHeight()+n+3)+"px")}},e.prototype.setAutoHeight=function(e){"TEXTAREA"===e.nodeName?(e.style.height="auto",e.style.height=this.inputElement.scrollHeight+16+"px",e.style.overflow="hidden"):"IFRAME"===e.nodeName&&(e.style.height=this.inputElement.parentElement.offsetHeight+"px")},e.prototype.restrict=function(e){if(this.maxLength>=0){for(var t="Markdown"===this.editorMode?this.getText():this.getText().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,""),n=[8,16,17,37,38,39,40,46,65],i=void 0,s=0;s<=n.length-1;s++)if(e.which===n[s]){if(e.ctrlKey&&65===e.which)return;if(65!==e.which)return void(i=n[s])}t.length>=this.maxLength&&-1!==this.maxLength&&e.which!==i&&e.preventDefault()}},e.prototype.beforeInputHandler=function(e){if(this.maxLength>=0){var t="Markdown"===this.editorMode?this.getText():this.getText().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"");e.data&&t.length>=this.maxLength&&!this.isSpecialInputType(e)&&e.preventDefault()}},e.prototype.isSpecialInputType=function(e){return e.inputType?-1!==e.inputType.indexOf("delete")||-1!==e.inputType.indexOf("backward")||"insertLineBreak"===e.inputType:-1!==[8,16,17,37,38,39,40,46,65].indexOf(e.which)},e.prototype.setPlaceHolder=function(){this.inputElement&&this.placeholder&&!0!==this.iframeSettings.enable&&("Markdown"!==this.editorMode?(this.placeHolderContainer||(this.placeHolderContainer=this.element.querySelector(".e-rte-placeholder")),this.placeHolderContainer.innerHTML=this.placeholder,!(0===this.inputElement.textContent.length&&this.inputElement.childNodes.length<2)||sf.base.isNullOrUndefined(this.inputElement.firstChild)||"BR"!==this.inputElement.firstChild.nodeName&&("P"!==this.inputElement.firstChild.nodeName&&"DIV"!==this.inputElement.firstChild.nodeName||sf.base.isNullOrUndefined(this.inputElement.firstChild.firstChild)||"BR"!==this.inputElement.firstChild.firstChild.nodeName)?(this.placeHolderContainer.classList.remove("e-placeholder-enabled"),sf.base.EventHandler.remove(this.inputElement,"input",this.setPlaceHolder)):(this.placeHolderContainer.classList.add("e-placeholder-enabled"),sf.base.EventHandler.add(this.inputElement,"input",this.setPlaceHolder,this))):this.inputElement.setAttribute("placeholder",this.placeholder)),this.placeholder&&this.iframeSettings.enable&&this.inputElement&&(!(0===this.inputElement.textContent.length&&this.inputElement.childNodes.length<2)||sf.base.isNullOrUndefined(this.inputElement.firstChild)||"BR"!==this.inputElement.firstChild.nodeName&&("P"!==this.inputElement.firstChild.nodeName&&"DIV"!==this.inputElement.firstChild.nodeName||sf.base.isNullOrUndefined(this.inputElement.firstChild.firstChild)||"BR"!==this.inputElement.firstChild.firstChild.nodeName)?(sf.base.removeClass([this.inputElement],"e-rte-placeholder"),sf.base.EventHandler.remove(this.inputElement,"input",this.setPlaceHolder)):(sf.base.addClass([this.inputElement],"e-rte-placeholder"),this.inputElement.setAttribute("placeholder",this.placeholder),sf.base.EventHandler.add(this.inputElement,"input",this.setPlaceHolder,this)))},e.prototype.replaceEntities=function(e){var t=this;if("HTML"!==this.editorMode||sf.base.isNullOrUndefined(e)||!/&(amp;)*((times)|(divide)|(ne))/.test(e))return" "===e?"<p><br></p>":e;for(var n=this.enableHtmlEncode||this.enableHtmlSanitizer,i=0,s=["times","divide","ne"].map((function(e){var i=n?"&amp;amp;"+e:"&amp;"+e,s=!t.enableHtmlEncode&&t.enableHtmlSanitizer?"&("+e+")":"&(amp;)*("+e+")";return[i,new RegExp(s,"g")]}));i<s.length;i++){var r=s[i],o=r[0],a=r[1];a.test(e)&&(e=e.replace(a,o))}return e},e.prototype.updatePanelValue=function(e,t){var n=this.replaceEntities(this.value);n=D(n=this.enableHtmlEncode&&e?Z(n):n,this.editorMode);var i=this.element.querySelector(".e-rte-srctextarea");n?(!sf.base.isNullOrUndefined(i)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(i.value=F(e)),this.valueContainer&&(this.valueContainer.value=""===t?"":this.enableHtmlEncode?e:n),"HTML"===this.editorMode&&this.inputElement&&this.inputElement.innerHTML.trim()!==n.trim()?this.inputElement.innerHTML=R(n,this.editorMode):"Markdown"===this.editorMode&&this.inputElement&&this.inputElement.value.trim()!==n.trim()&&(this.inputElement.value=n)):(!sf.base.isNullOrUndefined(i)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(i.value=""),"HTML"===this.editorMode?this.inputElement.innerHTML=R($(this),this.editorMode):this.inputElement.value="",this.valueContainer&&(this.valueContainer.value="")),this.showCharCount&&this.countModule&&this.countModule.refresh()},e.prototype.contentChanged=function(){this.autoSaveOnIdle&&(sf.base.isNullOrUndefined(this.saveInterval)||(clearTimeout(this.timeInterval),this.timeInterval=setTimeout(this.updateIntervalValue.bind(this),this.saveInterval)))},e.prototype.notifyMouseUp=function(e){var t=e.touches?e.changedTouches[0]:e;this.observer.notify("mouseUp",{member:"mouseUp",args:e,touchData:{prevClientX:this.clickPoints.clientX,prevClientY:this.clickPoints.clientY,clientX:t.clientX,clientY:t.clientY}}),this.inputElement&&("HTML"===this.editorMode&&(0!==this.inputElement.textContent.length||e.target&&!sf.base.isNullOrUndefined(e.target.querySelector("li")))||"Markdown"===this.editorMode&&0!==this.inputElement.value.length)&&this.observer.notify("toolbar-refresh",{args:e}),this.triggerEditArea(e),"HTML"===this.editorMode&&this.focusHR(e)},e.prototype.triggerEditArea=function(e){if(sf.base.Browser.isDevice&&sf.base.Browser.isIos){var t=e.touches?e.changedTouches[0]:e;this.clickPoints.clientX===t.clientX&&this.clickPoints.clientY===t.clientY&&this.observer.notify(c,{member:"editAreaClick",args:e})}else this.observer.notify(c,{member:"editAreaClick",args:e})},e.prototype.focusHR=function(e){"HR"===e.target.tagName&&e.target.classList.add("e-rte-hr-focus")},e.prototype.updateStatus=function(e){if(!sf.base.isNullOrUndefined(e.html)||!sf.base.isNullOrUndefined(e.markdown)){var t=this.formatter.editorManager.undoRedoManager.getUndoStatus();this.dotNetRef.invokeMethodAsync("UpdatedToolbarStatusEvent",{undo:t.undo,redo:t.redo,html:e.html,markdown:e.markdown})}},e.prototype.splitButtonClicked=function(e){sf.base.isNullOrUndefined(e)||"HTML"===this.editorMode&&this.observer.notify("html-toolbar-click",e)},e.prototype.toolbarCreated=function(){var e=this;this.userAgentData.isSafari()&&setTimeout((function(){var t=e.getToolbarElement()?e.getToolbarElement().querySelector("#"+e.id+"_toolbar_nav"):null;t&&("Expand"===e.toolbarSettings.type||"Popup"===e.toolbarSettings.type?(sf.base.EventHandler.add(t,"mousedown",e.extendedToolbarMouseDownHandler,e),sf.base.EventHandler.add(t,"click",e.extendedToolbarClickHandler,e)):(sf.base.EventHandler.remove(t,"mousedown",e.extendedToolbarMouseDownHandler),sf.base.EventHandler.remove(t,"click",e.extendedToolbarClickHandler)))}),40)},e.prototype.extendedToolbarMouseDownHandler=function(){this.userAgentData.isSafari()&&this.observer.notify(a,{})},e.prototype.extendedToolbarClickHandler=function(){this.userAgentData.isSafari()&&this.observer.notify(l,{})},e.prototype.toolbarItemClick=function(e,t,n){if((!!sf.base.isNullOrUndefined(e)||!("Preview"===e.requestType||"SourceCode"===e.requestType))&&this.userAgentData.isSafari()&&this.formatter.editorManager.nodeSelection&&!this.inputElement.contains(this.getRange().startContainer)&&this.observer.notify(l,{}),!sf.base.isNullOrUndefined(e)){var i,s=!sf.base.isNullOrUndefined(this.quickToolbarModule.textQTBar)&&!sf.base.isNullOrUndefined(this.quickToolbarModule.textQTBar.element)&&this.quickToolbarModule.textQTBar.element&&this.quickToolbarModule.textQTBar.element.classList.contains("e-popup-open");"Root"!==n||this.inlineMode.enable||s?(i=sf.base.select("#"+t,document.body),s&&i&&i.parentElement&&i.parentElement.classList&&i.parentElement.classList.contains("e-rte-text-popup")&&(i=i.parentElement)):i=sf.base.select("#"+t,this.element),e.originalEvent=cn(cn({},e.originalEvent),{target:i}),this.inlineCloseItems.indexOf(e.item.subCommand)>-1&&(this.quickToolbarModule.hideInlineQTBar(),s&&this.quickToolbarModule.hideTextQTBar()),"HTML"===this.editorMode?this.observer.notify("html-toolbar-click",e):this.observer.notify("markdown-toolbar-click",e)}},e.prototype.hideTableQuickToolbar=function(){this.quickToolbarModule.hideTableQTBar()},e.prototype.dropDownBeforeOpen=function(e){(this.formatter.editorManager.markdownSelection&&this.formatter.editorManager.markdownSelection.selectionStart||this.formatter.editorManager.nodeSelection&&this.inputElement.contains(this.getRange().startContainer))&&this.observer.notify(a,e),this.observer.notify("beforeDropDownOpen",e),this.observer.notify("hideToolTip",{target:e.element})},e.prototype.dropDownBeforeClose=function(e){e.element&&(e.element.classList&&e.element.classList.contains("e-quick-dropdown")||e.element.closest(".e-rte-quick-popup"))&&this.observer.notify("preventQuickToolbarClose",this.quickToolbarModule),this.observer.notify("beforeDropDownClose")},e.prototype.splitButtonAfterOpen=function(e){var t=this.getRange(),n=this.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(t.startContainer),i=this.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(t.endContainer),s="";if(!sf.base.isNullOrUndefined(n)||!sf.base.isNullOrUndefined(i)){s=(n||i).getAttribute("data-language")||"";for(var r=e.element.querySelectorAll("li"),o=0;o<r.length;o++){var a=r[o].getAttribute("data-language")||r[o].textContent.toLowerCase();s.toLowerCase()===a?sf.base.addClass([r[o]],"e-active"):sf.base.removeClass([r[o]],"e-active")}}},e.prototype.dropDownAfterOpen=function(e,t){if("Markdown"!==this.editorMode){var n=this.getRange().startContainer.parentElement,i=n.closest("table"),s=n.closest("tr"),r=e.element.firstChild;if(null!==i)for(var o=0;o<r.childNodes.length;o++){var a=r.children[o];i.classList.contains("e-dashed-border")&&a.classList.contains("e-dashed-borders")?sf.base.addClass([a],"e-active"):!i.classList.contains("e-dashed-border")&&a.classList.contains("e-dashed-borders")&&sf.base.removeClass([a],"e-active"),i.classList.contains("e-alternate-rows")&&null!==s&&""!==window.getComputedStyle(s).backgroundColor&&a.classList.contains("e-alternate-rows")?sf.base.addClass([a],"e-active"):!i.classList.contains("e-alternate-rows")&&a.classList.contains("e-alternate-rows")&&sf.base.removeClass([a],"e-active")}var l=n.closest("LI"),d=sf.base.isNullOrUndefined(l)?null:l.parentElement,c=t[0].subCommand;if(!sf.base.isNullOrUndefined(d)){var h="NumberFormatList"===c&&"OL"===d.nodeName,p="BulletFormatList"===c&&"UL"===d.nodeName;if(h||p){var u=d.style.listStyleType.split("-").join("").toLocaleLowerCase();u="decimal"===u?"number":u;for(o=0;o<e.element.firstElementChild.childNodes.length;o++){if(u===e.element.firstElementChild.childNodes[o].innerHTML.split(" ").join("").toLocaleLowerCase()){sf.base.addClass([e.element.firstElementChild.childNodes[o]],"e-active");break}if(""===u&&("Number"===e.element.firstElementChild.childNodes[o].innerHTML||"Disc"===e.element.firstElementChild.childNodes[o].innerHTML)){sf.base.addClass([e.element.firstElementChild.childNodes[o]],"e-active");break}}}}for(var f=this.getRange().startContainer;f!==this.inputElement&&!sf.base.isNullOrUndefined(f.parentElement);){"#text"===f.nodeName&&(f=f.parentElement);var m=window.getComputedStyle(f).textAlign;if("Alignments"===t[0].command){if(e.element.firstChild.childNodes.forEach((function(e){return sf.base.removeClass([e],"e-active")})),"Align Left"===t[0].text&&"left"===m||"start"===m){sf.base.addClass([e.element.firstChild.childNodes[0]],"e-active");break}if("Align Center"===t[1].text&&"center"===m){sf.base.addClass([e.element.firstChild.childNodes[1]],"e-active");break}if("Align Right"===t[2].text&&"right"===m){sf.base.addClass([e.element.firstChild.childNodes[2]],"e-active");break}if("Align Justify"===t[3].text&&"justify"===m){sf.base.addClass([e.element.firstChild.childNodes[3]],"e-active");break}}f=f.parentElement}var g=n.closest("img"),b=g||n.querySelector(".e-img-focus");if("Images"===t[0].command&&!sf.base.isNullOrUndefined(b)){o=void 0;e.element.firstChild.childNodes.forEach((function(e){return sf.base.removeClass([e],"e-active")})),b.classList.contains("e-imgleft")||b.classList.contains("e-imginline")?o=0:b.classList.contains("e-imgcenter")||b.classList.contains("e-imgbreak")?o=1:b.classList.contains("e-imgright")&&(o=2),sf.base.isNullOrUndefined(e.element.firstChild.childNodes[o])||sf.base.addClass([e.element.firstChild.childNodes[o]],"e-active")}var v=n.closest(".e-video-wrap"),y=v||n.querySelector(".e-video-focus");if(!sf.base.isNullOrUndefined(t[0])&&"Videos"===t[0].command&&!sf.base.isNullOrUndefined(y)){o=void 0;e.element.firstChild.childNodes.forEach((function(e){return sf.base.removeClass([e],"e-active")})),y.classList.contains("e-video-left")||y.classList.contains("e-video-inline")?o=0:y.classList.contains("e-video-center")||y.classList.contains("e-video-break")?o=1:y.classList.contains("e-video-right")&&(o=2),sf.base.isNullOrUndefined(e.element.firstChild.childNodes[o])||sf.base.addClass([e.element.firstChild.childNodes[o]],"e-active")}if("Formats"===t[0].command||"Font"===t[0].command){var C=[],N=[],E=!1;this.format.items.forEach((function(e){N.push(e.value.toLocaleLowerCase())})),this.fontFamily.items.forEach((function(e){C.push(e.value)}));var S=ct.get(this.getDocument(),this.getEditPanel(),N,null,C);for(o=0;o<e.element.firstChild.childNodes.length;o++){var T=this.inlineMode.enable?"#"+this.id+"_Inline_Quick_Popup":"",L=this.inlineMode.enable?this.element.ownerDocument:this.element,O="Formats"===t[0].command?L.querySelector(T+" .e-formats-tbar-btn .e-rte-dropdown-btn-text").textContent.trim():"FontName"===t[0].subCommand?L.querySelector(T+" .e-font-name-tbar-btn .e-rte-dropdown-btn-text").textContent.trim():L.querySelector(T+" .e-font-size-tbar-btn .e-rte-dropdown-btn-text").textContent.trim();!E&&(""!==O.trim()&&e.element.firstChild.childNodes[o].textContent.trim()===O.trim()||"Formats"===t[0].command&&!sf.base.isNullOrUndefined(S.formats)&&this.format.items[o].value.toLowerCase()===S.formats.toLowerCase()&&e.element.firstChild.childNodes[o].classList.contains(this.format.items[o].cssClass)||"FontName"===t[0].subCommand&&"Font"===t[0].command&&!sf.base.isNullOrUndefined(S.fontname)&&!sf.base.isNullOrUndefined(this.fontFamily.items[o])&&this.fontFamily.items[o].value.toLowerCase()===S.fontname.toLowerCase()&&e.element.firstChild.childNodes[o].classList.contains(this.fontFamily.items[o].cssClass)||"FontName"===t[0].subCommand&&""===this.fontFamily.items[o].value&&sf.base.isNullOrUndefined(S.fontname)&&e.element.firstChild.childNodes[o].classList.contains(this.fontFamily.items[o].cssClass)||"FontSize"===t[0].subCommand&&"Default"===e.element.firstChild.childNodes[o].textContent&&"Font Size"===O&&""===this.fontSize.items[o].value)?e.element.firstChild.childNodes[o].classList.contains("e-active")||(sf.base.addClass([e.element.firstChild.childNodes[o]],"e-active"),E=!0):sf.base.removeClass([e.element.firstChild.childNodes[o]],"e-active")}}}else if("Markdown"===this.editorMode&&"Formats"===t[0].command){var k=[];E=!1;this.format.items.forEach((function(e){k.push(e.value.toLocaleLowerCase())}));for(var x=this.element.querySelector(".e-formats-tbar-btn .e-rte-dropdown-btn-text"),w=e.element.firstChild.childNodes,A=0;A<w.length;A++){var B=w[A].textContent.trim();E||B!==x.textContent?sf.base.removeClass([w[A]],"e-active"):w[A].classList.contains("e-active")||(sf.base.addClass([w[A]],"e-active"),E=!0)}}if("Merge cells"===e.element.querySelector("li").textContent){var M=e.element.querySelectorAll("li"),R=this.inputElement.querySelectorAll(".e-cell-select");1===R.length?(sf.base.addClass([M[0]],"e-disabled"),sf.base.removeClass([M[1],M[2]],"e-disabled")):R.length>1&&(Array.from(R).every((function(e){return e.tagName.toLowerCase()===R[0].tagName.toLowerCase()}))?sf.base.removeClass([M[0]],"e-disabled"):sf.base.addClass([M[0]],"e-disabled"),sf.base.addClass([M[1],M[2]],"e-disabled"))}},e.prototype.dropDownClose=function(e){this.observer.notify(l,e)},e.prototype.dropDownSelect=function(e){if(e.name="dropDownSelect",!document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))||!e.item||"Images"!==e.item.command&&"Audios"!==e.item.command&&"Videos"!==e.item.command&&"Display"!==e.item.command&&"Table"!==e.item.command){this.observer.notify(l,{});if("Lists"===e.item.command){var t={listStyle:e.item.text.replace(/\s+/g,""),listImage:e.item.listImage,type:e.item.subCommand};this.formatter.process(this,e,e.originalEvent,t)}else if("CodeBlock"===e.item.command){var n=this.codeBlockSettings.languages.find((function(t){return t.label.toLowerCase()===e.item.text.toLowerCase()})),i={language:n.language,label:n.label,action:"createCodeBlock"};this.formatter.process(this,e,e.originalEvent,i)}else this.formatter.process(this,e,e.originalEvent,null);this.observer.notify(a,{})}this.observer.notify("dropDownSelect",e)},e.prototype.colorPickerAfterOpen=function(e){if(!sf.base.isNullOrUndefined(e)){var t=e.element.querySelector(".e-palette");t&&t.focus()}},e.prototype.colorIconSelected=function(e,t,n){var i=this.iframeSettings.enable?this.getPanel().ownerDocument:this.getDocument();if(i&&this.isColorIconBtnClicked(i)){if(this.inputElement.contains(this.getRange().startContainer)&&this.observer.notify(a,{}),this.observer.notify(l,{}),!sf.base.isNullOrUndefined(t)&&t.startsWith("#")){var s=t.substring(1);t="rgba("+parseInt(s.substring(0,2),16)+", "+parseInt(s.substring(2,4),16)+", "+parseInt(s.substring(4,6),16)+", 1)"}e.value=sf.base.isNullOrUndefined(t)?e.value:t;var r=this.formatter.editorManager.nodeSelection.getRange(this.getDocument()),o=r.startContainer.parentNode;("TD"===r.startContainer.nodeName||"TH"===r.startContainer.nodeName||sf.base.closest(r.startContainer.parentNode,"td,th")||this.iframeSettings.enable&&!te(o.ownerDocument.querySelector("body"),"e-lib"))&&r.collapsed&&"BackgroundColor"===e.subCommand&&"quick"===n?(e.command="Table",this.formatter.process(this,{item:e,name:"colorPickerChanged"},void 0,e.value)):(this.observer.notify(l,{}),this.formatter.process(this,{item:e,name:"colorPickerChanged"},void 0,null),this.observer.notify(a,{}));var d=i.querySelector("."+e.icon);this.observer.notify("hideToolTip",{target:d,isButton:!0})}},e.prototype.colorChanged=function(e,t,n){var i=this.iframeSettings.enable?this.getPanel().ownerDocument:this.getDocument();if(i&&!this.isColorIconBtnClicked(i)){this.inputElement.contains(this.getRange().startContainer)&&this.observer.notify(a,{}),this.observer.notify(l,{}),e.value=sf.base.isNullOrUndefined(t)?e.value:t;var s=this.formatter.editorManager.nodeSelection.getRange(this.getDocument()),r=!!(this.userAgentData&&"macOS"===this.userAgentData.getPlatform()&&!s.collapsed)||s.collapsed;("TD"===s.startContainer.nodeName||"TH"===s.startContainer.nodeName||sf.base.closest(s.startContainer.parentNode,"td,th"))&&r&&"BackgroundColor"===e.subCommand&&"quick"===n?(e.command="Table",this.formatter.process(this,{item:e,name:"colorPickerChanged"},void 0,e.value)):(this.observer.notify(l,{}),this.formatter.process(this,{item:e,name:"colorPickerChanged"},void 0,null),this.observer.notify(a,{}))}},e.prototype.isColorIconBtnClicked=function(e){return!(e.activeElement.querySelector(".e-active")||e.activeElement.classList.contains("e-palette")||e.activeElement.classList.contains("e-apply"))},e.prototype.toolbarKeyDownHandler=function(e){if("Enter"===e.key||13===e.keyCode){var t=e.target;if(!sf.base.isNullOrUndefined(t)){var n=t.querySelector(".e-dropdown-btn.e-icon-btn");if(!sf.base.isNullOrUndefined(n))return n.click(),void e.preventDefault()}}else if("Escape"===e.key||27===e.keyCode){var i=this.iframeSettings.enable?this.getPanel().ownerDocument:this.getDocument();if(i){var s=i.querySelector(".e-rte-font-colorpicker.e-dropdown-btn.e-active")||i.querySelector(".e-rte-background-colorpicker.e-dropdown-btn.e-active");s&&s.click()}}},e.prototype.changeTooltipText=function(e){switch(e.split("_")[2]){case"Minimize":document.querySelector("#"+e).setAttribute("sf-tooltip","Minimize (Esc)");break;case"Maximize":document.querySelector("#"+e).setAttribute("sf-tooltip","Maximize (Ctrl+Shift+F)");break;case"CreateLink":document.querySelector("#"+e).setAttribute("sf-tooltip","Insert link (Ctrl+K)");break;case"InlineCode":document.querySelector("#"+e).setAttribute("sf-tooltip","Inline Code (Ctrl+`)");break;case"FormatPainter":document.querySelector("#"+e).setAttribute("sf-tooltip","Format Painter (Alt+Shift+C,Alt+Shift+V)")}},e.prototype.cancelLinkDialog=function(){this.isBlur=!1,this.linkModule.cancelDialog()},e.prototype.cancelImageDialog=function(){this.isBlur=!1},e.prototype.cancelAudioDialog=function(){this.isBlur=!1},e.prototype.cancelVideoDialog=function(){this.isBlur=!1},e.prototype.linkDialogClosed=function(){this.isBlur=!1,this.linkModule.linkDialogClosed()},e.prototype.dialogClosed=function(e){this.isBlur=!1,"restore"===e&&this.observer.notify(l,{})},e.prototype.insertLink=function(e){this.linkModule.insertLink(e)},e.prototype.imageRemoving=function(){this.imageModule.removing()},e.prototype.uploadSuccess=function(e,t){this.imageModule.imageUploadSuccess(e,t)},e.prototype.imageSelected=function(){this.imageModule.imageSelected()},e.prototype.imageUploadComplete=function(e,t){this.imageModule.imageUploadComplete(e,t)},e.prototype.imageUploadChange=function(e,t){this.imageModule.imageUploadChange(e,t)},e.prototype.audioRemoving=function(){this.audioModule.fileRemoving()},e.prototype.audioUploadSuccess=function(e,t){this.audioModule.fileUploadSuccess(e,t)},e.prototype.audioSelected=function(){this.audioModule.fileSelected()},e.prototype.audioUploadComplete=function(e,t){this.audioModule.fileUploadComplete(e,t)},e.prototype.audioUploadChange=function(e,t){this.audioModule.fileUploadChange(e,t)},e.prototype.videoRemoving=function(){this.videoModule.fileRemoving()},e.prototype.videoUploadSuccess=function(e,t){this.videoModule.fileUploadSuccess(e,t)},e.prototype.videoSelected=function(){this.videoModule.fileSelected()},e.prototype.videoUploadComplete=function(e,t){this.videoModule.fileUploadComplete(e,t)},e.prototype.videoUploadChange=function(e,t){this.videoModule.fileUploadChange(e,t)},e.prototype.dropUploadChange=function(e,t){this.imageModule.dropUploadChange(e,t)},e.prototype.insertImage=function(){this.imageModule.insertImageUrl()},e.prototype.imageDialogOpened=function(){this.imageModule.dialogOpened()},e.prototype.imageDialogClosed=function(){this.isBlur=!1,this.imageModule.dialogClosed()},e.prototype.insertAudio=function(){this.audioModule.insertAudioUrl()},e.prototype.audioDialogOpened=function(){this.audioModule.dialogOpened()},e.prototype.audioDialogClosed=function(){this.isBlur=!1,this.audioModule.dialogClosed()},e.prototype.insertVideo=function(){this.videoModule.insertVideoUrl()},e.prototype.videoDialogOpened=function(){this.videoModule.dialogOpened()},e.prototype.videoDialogClosed=function(){this.isBlur=!1,this.videoModule.dialogClosed()},e.prototype.insertTable=function(e,t){this.tableModule.customTable(e,t)},e.prototype.applyTableProperties=function(e){this.tableModule.applyTableProperties(e)},e.prototype.createTablePopupOpened=function(){this.tableModule.createTablePopupOpened()},e.prototype.pasteContent=function(e){this.pasteCleanupModule.selectFormatting(e)},e.prototype.updatePasteContent=function(e){this.observer.notify("afterPasteCleanUp",{text:e})},e.prototype.imageDropInitialized=function(e){this.imageModule.imageDropInitialized(e)},e.prototype.preventEditable=function(){this.inputElement.contentEditable="false"},e.prototype.enableEditable=function(){this.inputElement.contentEditable="true"},e.prototype.removeDroppedImage=function(){this.imageModule.removeDroppedImage()},e.prototype.dropUploadSuccess=function(e,t){this.imageModule.dropUploadSuccess(e,t)},e.prototype.focusIn=function(){this.enabled&&(this.inputElement.focus(),this.focusHandler({}),this.observer.notify("toolbar-refresh",{}))},e.prototype.insertAlt=function(e){this.imageModule.insertAlt(e)},e.prototype.insertSize=function(e,t){this.imageModule.insertSize(e,t)},e.prototype.insertVideoSize=function(e,t){this.videoModule.insertVideoSize(e,t)},e.prototype.insertImageLink=function(e,t,n){this.imageModule.insertLink(e,t,n)},e.prototype.showLinkDialog=function(){this.linkModule.showDialog(!0)},e.prototype.showImageDialog=function(){this.imageModule.showDialog(!0)},e.prototype.showAudioDialog=function(){this.audioModule.showDialog(!0)},e.prototype.showVideoDialog=function(){this.videoModule.showDialog(!0)},e.prototype.showTableDialog=function(){this.tableModule.showDialog(!0)},e.prototype.beforeSlashMenuApply=function(){this.formatter.editorManager.beforeSlashMenuApplyFormat()},e.prototype.showWordDialog=function(){this.wordModule.showDialog(!0)},e.prototype.slashMenuToolbarRefresh=function(){this.observer.notify("toolbar-refresh",{})},e.prototype.destroy=function(){this.unWireEvents(),this.observer.notify(i,{}),window.sfBlazor.disposeWindowsInstance(this.dataId),this.isSelecting=!1,this.selectionTimeout=null,this.previousRange=null,sf.base.isNullOrUndefined(this.timeInterval)||(clearInterval(this.timeInterval),this.timeInterval=null)},e.prototype.wireEvents=function(){var e=this;this.element.addEventListener("focusin",this.onFocusHandler,!0),this.element.addEventListener("focusout",this.onBlurHandler,!0),"HTML"===this.editorMode&&(this.mutationObserver=new MutationObserver((function(t){t.length>0&&!e.isFocusOut&&(e.checkContentChanged(t)?(e.hasContentChanged=!0,!e.autoSaveOnIdle&&!sf.base.isNullOrUndefined(e.saveInterval)&&e.saveInterval>0&&sf.base.isNullOrUndefined(e.timeInterval)&&(e.timeInterval=setInterval((function(){e.hasContentChanged?(e.updateValueOnIdle(),e.hasContentChanged=!1):(clearInterval(e.timeInterval),e.timeInterval=null)}),e.saveInterval))):e.autoSaveOnIdle||sf.base.isNullOrUndefined(e.timeInterval)||(clearInterval(e.timeInterval),e.timeInterval=null))})),this.mutationObserver.observe(this.inputElement,{attributes:!0,childList:!0,subtree:!0,characterData:!0,attributeOldValue:!0})),this.observer.on("content-changed",this.contentChanged,this),this.observer.on("model-changed",this.refresh,this),this.wireResizeEvents(),this.observer.on("updateTbItemsStatus",this.updateStatus,this),this.observer.on("updateValueOnIdle",this.updateValueOnIdle,this),this.observer.on("cleanupResizeElements",this.cleanupResizeElements,this),this.iframeSettings.enable&&(this.onLoadHandler=this.iframeEditableElemLoad.bind(this),this.getEditPanel().addEventListener("load",this.onLoadHandler,!0)),this.readonly&&this.enabled||this.bindEvents()},e.prototype.checkContentChanged=function(e){var t=this;return e.some((function(e){if("characterData"===e.type)return!0;if("childList"===e.type&&(e.addedNodes.length>0||e.removedNodes.length>0))return!0;if("attributes"===e.type){var n=e.target;if(n.isContentEditable&&t.inputElement===n)return!1;var i=e.attributeName,s=n.getAttribute(i);return e.oldValue!==s}return!1}))},e.prototype.wireResizeEvents=function(){this.enableResize&&this.observer.on("resizeInitialized",this.updateResizeFlag,this)},e.prototype.bindEvents=function(){this.keyboardModule=new At(this.inputElement,{keyAction:this.keyDown.bind(this),keyConfigs:cn(cn({},this.formatter.keyConfig),this.keyConfig),eventName:"keydown"}),this.userAgentData&&"Android"===this.userAgentData.getPlatform()&&sf.base.EventHandler.add(this.inputElement,"beforeinput",this.beforeInputHandler,this);var e=sf.base.closest(this.valueContainer,"form");e&&sf.base.EventHandler.add(e,"reset",this.resetHandler,this),this.toolbarSettings.enable&&this.getToolbarElement()&&sf.base.EventHandler.add(this.getToolbarElement(),"keydown",this.toolbarKeyDownHandler,this),sf.base.EventHandler.add(this.inputElement,"keyup",this.keyUp,this),sf.base.EventHandler.add(this.inputElement,"paste",this.onPaste,this),sf.base.EventHandler.add(this.inputElement,"UpdateEditorValue",this.updateEditorValue,this),sf.base.EventHandler.add(this.inputElement,"input",this.inputHandler,this),this.mouseUpDebListener=sf.base.debounce(this.mouseUp,30),sf.base.EventHandler.add(this.inputElement,sf.base.Browser.touchEndEvent,this.mouseUpDebListener,this),sf.base.EventHandler.add(this.inputElement,sf.base.Browser.touchStartEvent,this.mouseDownHandler,this),sf.base.EventHandler.add(this.inputElement,"click",this.onClickBoundfn,this),this.wireContextEvent(),this.formatter.editorManager.observer.on("keydown-handler",this.editorKeyDown,this),this.element.ownerDocument.defaultView.addEventListener("resize",sf.base.debounce(this.onResizeHandler,10),!0),this.iframeSettings.enable&&(sf.base.EventHandler.add(this.inputElement,"focusin",this.focusHandler,this),sf.base.EventHandler.add(this.inputElement,"focusout",this.blurHandler,this),sf.base.EventHandler.add(this.inputElement.ownerDocument,"scroll",this.contentScrollHandler,this),sf.base.EventHandler.add(this.inputElement.ownerDocument,sf.base.Browser.touchStartEvent,this.onIframeMouseDown,this),sf.base.EventHandler.add(this.getPanel(),"load",this.iframeLoadHandler,this)),this.wireScrollElementsEvents(),sf.base.EventHandler.add(this.inputElement.ownerDocument,"selectionchange",this.selectionChangeHandler,this),sf.base.EventHandler.add(this.inputElement.ownerDocument,"mouseup",this.mouseUpHandlerForSelection,this)},e.prototype.clickHandler=function(e){e.target&&"A"===e.target.nodeName&&!e.ctrlKey&&e.stopPropagation()},e.prototype.wireContextEvent=function(){this.quickToolbarSettings.showOnRightClick&&(sf.base.EventHandler.add(this.inputElement,"contextmenu",this.contextHandler,this),sf.base.Browser.isDevice&&(this.touchModule=new sf.base.Touch(this.inputElement,{tapHold:this.touchHandler.bind(this),tapHoldThreshold:500})))},e.prototype.wireScrollElementsEvents=function(){this.scrollParentElements=sf.popups.getScrollableParent(this.element);for(var e=0,t=this.scrollParentElements;e<t.length;e++){var n=t[e];sf.base.EventHandler.add(n,"scroll",this.scrollHandler,this)}this.iframeSettings.enable||sf.base.EventHandler.add(this.inputElement,"scroll",this.contentScrollHandler,this)},e.prototype.unWireEvents=function(){this.element.removeEventListener("focusin",this.onFocusHandler,!0),this.element.removeEventListener("focusout",this.onBlurHandler,!0),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.observer.off("content-changed",this.contentChanged),this.unWireResizeEvents(),this.observer.off("updateTbItemsStatus",this.updateStatus),this.observer.off("updateValueOnIdle",this.updateValueOnIdle),this.observer.off("cleanupResizeElements",this.cleanupResizeElements),this.iframeSettings.enable&&(this.getEditPanel().removeEventListener("load",this.onLoadHandler,!0),this.onLoadHandler=null),this.unBindEvents()},e.prototype.unWireResizeEvents=function(){this.observer.off("resizeInitialized",this.updateResizeFlag)},e.prototype.unBindEvents=function(){this.keyboardModule&&this.keyboardModule.destroy();var e=sf.base.closest(this.valueContainer,"form");if(e&&sf.base.EventHandler.remove(e,"reset",this.resetHandler),this.toolbarSettings.enable&&this.getToolbarElement()&&sf.base.EventHandler.remove(this.getToolbarElement(),"keydown",this.toolbarKeyDownHandler),sf.base.EventHandler.remove(this.inputElement,"keyup",this.keyUp),sf.base.EventHandler.remove(this.inputElement,"paste",this.onPaste),sf.base.EventHandler.remove(this.inputElement,"UpdateEditorValue",this.updateEditorValue),sf.base.EventHandler.remove(this.inputElement,"input",this.inputHandler),sf.base.EventHandler.remove(this.inputElement,sf.base.Browser.touchEndEvent,this.mouseUpDebListener),this.mouseUpDebListener=null,sf.base.EventHandler.remove(this.inputElement,sf.base.Browser.touchStartEvent,this.mouseDownHandler),sf.base.EventHandler.remove(this.inputElement,"click",this.onClickBoundfn),this.unWireContextEvent(),this.formatter&&this.formatter.editorManager.observer.off("keydown-handler",this.editorKeyDown),this.element.ownerDocument.defaultView.removeEventListener("resize",sf.base.debounce(this.onResizeHandler,10),!0),this.iframeSettings.enable&&(sf.base.EventHandler.remove(this.inputElement,"focusin",this.focusHandler),sf.base.EventHandler.remove(this.inputElement,"focusout",this.blurHandler),sf.base.EventHandler.remove(this.inputElement.ownerDocument,"scroll",this.contentScrollHandler),sf.base.EventHandler.remove(this.inputElement.ownerDocument,sf.base.Browser.touchStartEvent,this.onIframeMouseDown),sf.base.EventHandler.remove(this.getPanel(),"load",this.iframeLoadHandler)),this.userAgentData&&"Android"===this.userAgentData.getPlatform()&&sf.base.EventHandler.remove(this.inputElement,"beforeinput",this.beforeInputHandler),this.unWireScrollElementsEvents(),this.onClickBoundfn=null,this.userAgentData.isSafari()&&"Expand"===this.toolbarSettings.type){var t=this.getToolbarElement().querySelector(".e-expended-nav");t&&(sf.base.EventHandler.remove(t,"mousedown",this.extendedToolbarMouseDownHandler),sf.base.EventHandler.remove(t,"click",this.extendedToolbarClickHandler))}sf.base.EventHandler.remove(this.inputElement.ownerDocument,"selectionchange",this.selectionChangeHandler),sf.base.EventHandler.remove(this.inputElement.ownerDocument,"mouseup",this.mouseUpHandlerForSelection)},e.prototype.unWireContextEvent=function(){sf.base.EventHandler.remove(this.inputElement,"contextmenu",this.contextHandler),sf.base.Browser.isDevice&&this.touchModule&&this.touchModule.destroy()},e.prototype.unWireScrollElementsEvents=function(){this.scrollParentElements=sf.popups.getScrollableParent(this.element);for(var e=0,t=this.scrollParentElements;e<t.length;e++){var n=t[e];sf.base.EventHandler.remove(n,"scroll",this.scrollHandler)}this.iframeSettings.enable||sf.base.EventHandler.remove(this.getPanel(),"scroll",this.contentScrollHandler)},e.prototype.focusHandler=function(e){if(!this.isRTE||this.isFocusOut){this.isRTE=!this.isFocusOut,this.isFocusOut=!1,sf.base.addClass([this.element],["e-focused"]),"HTML"===this.editorMode?this.cloneValue=this.inputElement.innerHTML===$(this)?null:this.enableHtmlEncode?this.encode(Z(this.inputElement.innerHTML)):this.inputElement.innerHTML:this.cloneValue=""===this.inputElement.value?null:this.inputElement.value;var t=document.activeElement;if((t===this.element||t===this.getToolbarElement()||t===this.getEditPanel()||this.iframeSettings.enable&&t===this.getPanel()&&e.target&&!e.target.classList.contains("e-img-inner")&&e.target&&e.target.parentElement&&!e.target.parentElement.classList.contains("e-img-wrap")||sf.base.closest(t,".e-rte-toolbar")===this.getToolbarElement())&&(this.getEditPanel().focus(),!sf.base.isNullOrUndefined(this.getToolbarElement()))){this.getToolbarElement().setAttribute("tabindex","-1");for(var n=this.getToolbarElement().querySelectorAll('[tabindex="0"]'),i=0;i<n.length;i++)n[i].setAttribute("tabindex","-1")}this.preventDefaultResize(e,!1);var s={isInteracted:0!==Object.keys(e).length};this.focusEnabled&&this.dotNetRef.invokeMethodAsync("FocusEvent",s),!sf.base.isNullOrUndefined(this.saveInterval)&&this.saveInterval>0&&!this.autoSaveOnIdle&&sf.base.isNullOrUndefined(this.timeInterval)&&"Markdown"===this.editorMode&&(this.timeInterval=setInterval(this.updateValueOnIdle.bind(this),this.saveInterval)),sf.base.EventHandler.add(document,"mousedown",this.onDocumentClick,this)}if(!this.readonly){var r=this.getCurrentFocus(e);"editArea"!==r&&"textArea"!==r&&"sourceCode"!==r||this.resetToolbarTabIndex()}},e.prototype.blurHandler=function(e){var t=e.relatedTarget;if(t){var n=sf.base.closest(t,".e-richtexteditor");n&&n===this.element?(this.isBlur=!1,t===this.getToolbarElement()&&t.setAttribute("tabindex","-1")):sf.base.closest(t,'[aria-owns="'+this.element.id+'"]')||!sf.base.isNullOrUndefined(sf.base.closest(t,".e-rte-elements"))?this.isBlur=!1:(this.isBlur=!0,t=null)}else this.isIframeRteElement||(this.isBlur=!0,this.isIframeRteElement=!0);if(this.isBlur&&sf.base.isNullOrUndefined(t)){sf.base.removeClass([this.element],["e-focused"]),I(this.inputElement),this.observer.notify("focusChange",{}),this.value=this.getUpdatedValue(),this.updateValueContainer(this.value),this.invokeChangeEvent(),this.isFocusOut=!0,this.isBlur=!1,this.enableXhtml&&(this.valueContainer.value=this.getXhtmlString(this.valueContainer.value)),ee(this.valueContainer,"focusout"),this.preventDefaultResize(e,!0);var i={isInteracted:0!==Object.keys(e).length};this.blurEnabled&&this.dotNetRef.invokeMethodAsync("BlurEvent",i),sf.base.isNullOrUndefined(this.timeInterval)||(clearInterval(this.timeInterval),this.timeInterval=null),sf.base.EventHandler.remove(document,"mousedown",this.onDocumentClick)}else this.isRTE=!0;this.readonly||"outside"!==this.getCurrentFocus(e)||this.resetToolbarTabIndex(),this.previousRange=null},e.prototype.resizeHandler=function(e,t){if(document.body.contains(this.element)){if(this.toolbarSettings.enable&&!this.inlineMode.enable){t||this.dotNetRef.invokeMethodAsync("RefreshToolbarOverflow");var n=this.element.querySelector(".e-rte-toolbar");n&&n.classList.contains("e-expand-open")}this.observer.notify("resize",{args:e})}else document.defaultView.removeEventListener("resize",sf.base.debounce(this.onResizeHandler,10),!0)},e.prototype.touchHandler=function(e){this.notifyMouseUp(e.originalEvent),this.triggerEditArea(e.originalEvent)},e.prototype.resetHandler=function(){var e=this.valueContainer.defaultValue.trim().replace(/<!--!-->/gi,"");this.value=""===e?null:this.defaultResetValue,this.setPanelValue(this.value,!0)},e.prototype.contextHandler=function(e){var t=sf.base.closest(e.target,"a, table, img, video, audio, .e-embed-video-wrap");!t&&e.target&&e.target.classList&&(e.target.classList.contains("e-audio-wrap")||e.target.classList.contains("e-clickelem"))&&(t=e.target.querySelector("audio")),!1!==this.inlineMode.onSelection&&(sf.base.isNullOrUndefined(t)||!this.inputElement.contains(t)||"IMG"!==t.tagName&&"TABLE"!==t.tagName&&"A"!==t.tagName&&"video"!==t.tagName.toLowerCase()&&"audio"!==t.tagName.toLowerCase()&&"SPAN"!==t.tagName)||e.preventDefault()},e.prototype.scrollHandler=function(e){this.observer.notify("scroll",{args:e})},e.prototype.contentScrollHandler=function(e){this.observer.notify("contentscroll",{args:e})},e.prototype.inputHandler=function(e){this.autoResize()},e.prototype.mouseUp=function(e){if(this.isSelectionStartInRTE=!1,this.isSelectionCollapsed()){var t=this.getDocument().getSelection(),n=t&&0!==t.rangeCount&&t.getRangeAt(0);this.previousRange=n&&n.cloneRange()}var i=e.target;if(!!(i&&-1!==["IMG","VIDEO","AUDIO","TABLE","TH","TD","TR","TBODY"].indexOf(i.tagName)||"#text"!==i.nodeName&&(i.closest(".e-audio-wrap")||i.closest(".e-video-wrap")))||"HTML"!==this.editorMode||sf.base.Browser.isDevice||this.isSelectionInRTE()){if(this.quickToolbarSettings.showOnRightClick&&sf.base.Browser.isDevice){var s=e.target,r=sf.base.closest(s,"table");if(s&&"A"===s.nodeName||"IMG"===s.nodeName||"TD"===s.nodeName||"TH"===s.nodeName||"TABLE"===s.nodeName||r&&this.getEditPanel().contains(r))return}this.notifyMouseUp(e),this.updateUndoRedoStack(e),this.isSelectionInRTE()&&(this.triggerOnSelectionChange(),this.isSelecting=!1)}},e.prototype.mouseDownHandler=function(e){this.isSelectionStartInRTE=!0;var t=e.touches?e.changedTouches[0]:e;sf.base.addClass([this.element],["e-focused"]),this.preventDefaultResize(e,!1),this.observer.notify(d,{args:e}),this.formatter.editorManager.observer.notify(d,{args:e}),this.clickPoints={clientX:t.clientX,clientY:t.clientY}},e.prototype.onIframeMouseDown=function(e){this.isBlur=!1,this.observer.notify("iframe-click",e),ee(document.body,"mousedown"),this.removeHrFocus(e)},e.prototype.cleanList=function(e){var t=this.getRange(),n=t.startContainer,i=t.endContainer,s=t.startOffset,r=n===i,o="#text"===t.endContainer.nodeName?t.endContainer.parentElement:t.endContainer,a=sf.base.closest(o,"LI"),l=!0;if(sf.base.isNullOrUndefined(a)||(l=sf.base.isNullOrUndefined(a.querySelector("#"+this.id))),!sf.base.isNullOrUndefined(a)&&o.textContent.trim().length===t.endOffset&&!t.collapsed&&sf.base.isNullOrUndefined(o.nextElementSibling)&&l&&!o.classList.contains("e-img-inner")){for(var d=0;d<a.childNodes.length;d++)"#text"===a.childNodes[d].nodeName&&0===a.childNodes[d].textContent.trim().length&&(sf.base.detach(a.childNodes[d]),d--);a.textContent.length-1;for(var c=a;null!==c.lastChild&&"#text"!==c.nodeName;)c=c.lastChild;this.formatter.editorManager.nodeSelection.setSelectionText(this.getDocument(),r?c:n,c,s,c.textContent.length)}},e.prototype.keyDown=function(e){this.isSelectionStartInRTE=!0;var t=-1!==navigator.userAgent.indexOf("Mac");if(((e.ctrlKey||e.metaKey&&t)&&e.shiftKey&&86===e.keyCode||e.metaKey&&t&&e.altKey&&e.shiftKey&&86===e.keyCode)&&(this.isPlainPaste=!0),this.inputElement.classList.contains("e-mention")&&!sf.base.isNullOrUndefined(this.inputElement.getAttribute("aria-owns"))){var n=this.inputElement.getAttribute("aria-owns").split("_options")[0],i=this.element.ownerDocument.getElementById(n+"_popup");if(-1!==xe.indexOf(e.key)&&i&&i.classList.contains("e-popup-open"))return}if("HTML"===this.editorMode){var s=this.getRange();if(this.formatter.editorManager.codeBlockObj.isActionDisallowedInCodeBlock(e,s))return void e.preventDefault()}if(this.enableTabKey){this.quickToolbarModule&&!e.altKey&&"F10"!==e.key&&"toolbar-focus"!==e.action&&this.quickToolbarModule.hideQuickToolbars();var r=!(!this.imageModule||!this.imageModule.imgResizeDiv),l=!(!this.videoModule||!this.videoModule.vidResizeDiv);r&&this.imageModule.cancelResizeAction(),l&&this.videoModule.cancelResizeAction()}var d=!1;if("HTML"===this.editorMode){var c=this.getRange();d=this.formatter.editorManager.codeBlockObj.isCodeBlockEnterAction(c,e)}if(this.observer.notify(o,{member:"keydown",args:e}),this.restrict(e),"HTML"===this.editorMode&&this.cleanList(e),this.iframeSettings.enable&&!this.enableTabKey&&9===e.which&&"Tab"===e.code&&"BODY"===e.target.nodeName&&(this.isIframeRteElement=!1),"HTML"===this.editorMode&&(8===e.which&&"Backspace"===e.code||46===e.which&&"Delete"===e.code)){var h="#text"===(c=this.getRange()).startContainer.nodeName?c.startContainer.parentElement:c.startContainer;if(sf.base.closest(h,"pre")&&8===e.which&&8203===c.startContainer.textContent.charCodeAt(c.startOffset-1)||46===e.which&&8203===c.startContainer.textContent.charCodeAt(c.startOffset)){var p=new RegExp("​","g"),u=8===e.which?c.startOffset-1:c.startOffset;c.startContainer.textContent=c.startContainer.textContent.replace(p,""),this.formatter.editorManager.nodeSelection.setCursorPoint(this.getDocument(),c.startContainer,u)}else if("Backspace"===e.code&&8===e.which&&8203===c.startContainer.textContent.charCodeAt(0)&&c.collapsed){var f=c.startContainer.parentElement,m=void 0,g=void 0;for(g=0;g<f.childNodes.length;g++)f.childNodes[g]===c.startContainer&&(m=g);var b=!0,v=[];for(g=m;g>=0;g--)3===f.childNodes[g].nodeType&&8203===f.childNodes[g].textContent.charCodeAt(0)&&b?v.push(g):b=!1;if(v.length>0)for(g=v.length-1;g>0;g--)f.childNodes[v[g]].textContent="";this.formatter.editorManager.nodeSelection.setCursorPoint(this.getDocument(),c.startContainer,c.startOffset)}}0===this.formatter.getUndoRedoStack().length&&this.formatter.saveData();var y=!0;if("HTML"===this.editorMode){c=this.getRange();var C=this.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(c.startContainer),N=this.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(c.endContainer);if(!sf.base.isNullOrUndefined(C)||!sf.base.isNullOrUndefined(N)){var E=e.action;y=-1!==["undo","redo","indents","outdents","ordered-list","unordered-list"].indexOf(E)}}if(-1===["insert-link","format-copy","format-paste","insert-image","insert-table","insert-audio","insert-video"].indexOf(e.action)&&"format-copy"!==e.action&&"format-paste"!==e.action&&(e.action&&"paste"!==e.action&&"space"!==e.action||9===e.which||"Backspace"===e.code&&8===e.which)||"undo"===e.action||"redo"===e.action){var S=!1;sf.base.isNullOrUndefined(this.formatPainterModule)||(S="escape"===this.formatPainterModule.previousAction);var T="undo"===e.action||"redo"===e.action;switch(S&&!T||!y||d||("HTML"!==this.editorMode||"increase-fontsize"!==e.action&&"decrease-fontsize"!==e.action?this.formatter.process(this,null,e):this.observer.notify("onHandleFontsizeChange",{member:"onHandleFontsizeChange",args:e})),e.action){case"toolbar-focus":if(this.toolbarSettings.enable&&this.getToolbarElement()){this.userAgentData.isSafari()&&"keydown"===e.type&&this.formatter.editorManager.nodeSelection&&this.formatter.editorManager.nodeSelection.get(this.getDocument()).rangeCount>0&&this.inputElement.contains(this.getRange().startContainer)&&this.observer.notify(a,{});var L=this.getToolbarElement().querySelector(".e-toolbar-item:not(.e-overlay)[title]"),O=this.getRenderedQuickToolbarElem(),k="toolbar";if(O&&(L=O.querySelector(".e-toolbar-item:not(.e-overlay)[title]"),k="quickToolbar"),L){var x=L.firstElementChild;x.removeAttribute("tabindex"),x.focus(),!this.userAgentData.isSafari()||"toolbar"!==k&&"quickToolbar"!==k||this.inputElement.ownerDocument.getSelection().removeAllRanges()}}break;case"escape":this.getEditPanel().focus()}}if(sf.base.isNullOrUndefined(this.placeholder)||this.setPlaceHolder(),this.observer.notify("afterKeyDown",{member:"afterKeyDown",args:e}),this.autoResize(),!("HTML"!==this.editorMode||sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.code)||"Backspace"!==e.code&&"Delete"!==e.code)){c=this.getDocument().getSelection().getRangeAt(0);var w=document.createElement("div");w.appendChild(c.cloneContents());var A=w.innerHTML;(A===this.inputElement.innerHTML||c.commonAncestorContainer===this.inputElement&&A===this.inputElement.textContent.trim())&&(this.isSelectAll=!0)}if(e.metaKey&&"Backspace"===e.key&&this.autoSaveOnIdle&&this.keyUp(e),"HTML"===this.editorMode){var B=this.getDocument().getSelection();c=B&&B.getRangeAt(0);this.previousRange=c&&c.cloneRange()}},e.prototype.editorKeyDown=function(e){switch(e.event.action){case"copy":this.onCopy(e.event);break;case"cut":this.onCut(e.event);break;case"print":e.event.preventDefault(),this.print()}!e.callBack||"copy"!==e.event.action&&"cut"!==e.event.action&&"delete"!==e.event.action||e.callBack({requestType:e.event.action,editorMode:"HTML",event:e.event})},e.prototype.clearSelectionTimeout=function(){this.selectionTimeout&&(clearTimeout(this.selectionTimeout),this.selectionTimeout=null)},e.prototype.triggerOnSelectionChange=function(){var e=this.getDocument().getSelection(),t=e&&e.rangeCount>0&&e.getRangeAt(0);if(!this.isSelectionCollapsed()&&!(this.previousRange&&this.previousRange.startContainer===t.startContainer&&this.previousRange.endContainer===t.endContainer&&this.previousRange.startOffset===t.startOffset&&this.previousRange.endOffset===t.endOffset)){var n={selectedContent:this.getSelectedHtml()};this.selectionChangedEnabled&&this.dotNetRef.invokeMethodAsync("SelectionChanged",n),this.previousRange=t.cloneRange()}},e.prototype.keyUp=function(e){var t=this;if("HTML"===this.editorMode){if(!(sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.code)||"Backspace"!==e.code&&"Delete"!==e.code&&"KeyX"!==e.code)){var n=this.getRange(),i=this.iframeSettings.enable?this.getPanel().ownerDocument.getSelection():this.getDocument().getSelection();if(this.isSelectAll){var s=document.createElement("br"),o="BR"===this.enterKey?s:document.createElement(this.enterKey).appendChild(s).parentElement;this.inputElement.innerHTML="",this.inputElement.appendChild(o),this.formatter.editorManager.nodeSelection.setCursorPoint(this.getDocument(),s,0),this.isSelectAll=!1}i.rangeCount>0&&"INPUT"!==this.getDocument().activeElement.tagName&&this.inputElement.contains(this.getDocument().activeElement)&&"<br>"===n.startContainer.innerHTML&&""===n.startContainer.textContent&&(i.removeAllRanges(),i.addRange(n))}var a=this.getRange();if(-1!==sf.base.Browser.userAgent.indexOf("Firefox")&&"#text"===a.startContainer.nodeName&&a.startContainer.parentElement===this.inputElement&&"BR"!==this.enterKey){var l=this.getRange(),d=sf.base.createElement(this.enterKey);l.startContainer.parentElement.insertBefore(d,l.startContainer),d.appendChild(l.startContainer),this.formatter.editorManager.nodeSelection.setSelectionText(this.getDocument(),d.childNodes[0],d.childNodes[0],d.childNodes[0].textContent.length,d.childNodes[0].textContent.length)}}0===this.formatter.getCurrentStackIndex()&&this.updateUndoRedoStack(e),this.observer.notify(r,{member:"keyup",args:e}),"KeyX"!==e.code||88!==e.which||88!==e.keyCode||!e.ctrlKey||""!==this.inputElement.innerHTML&&"<br>"!==this.inputElement.innerHTML||(this.inputElement.innerHTML=R(Y($(this),this),this.editorMode));var c=this.inputElement.classList.contains("e-mention"),h=32===e.which||13===e.which||8===e.which||46===e.which||9===e.which&&c;("shift"!==e.key&&!e.ctrlKey&&e.key&&1===e.key.length||h||"Markdown"===this.editorMode&&("shift"!==e.key&&!e.ctrlKey&&e.key&&1===e.key.length||h)||this.autoSaveOnIdle&&sf.base.Browser.isDevice&&!this.inlineMode.enable)&&this.formatter.onKeyHandler(this,e),(this.inputElement&&0!==this.inputElement.textContent.length||this.element.querySelectorAll(".e-toolbar-item.e-active").length>0||this.formatter.getUndoRedoStack().length>0)&&this.observer.notify("toolbar-refresh",{args:e}),sf.base.isNullOrUndefined(this.placeholder)||"Enter"===e.key&&13===e.keyCode||"<p><br></p>"!==this.inputElement.innerHTML&&"<div><br></div>"!==this.inputElement.innerHTML&&"<br>"!==this.inputElement.innerHTML||this.setPlaceHolder(),this.autoResize(),"HTML"===this.editorMode&&(this.clearSelectionTimeout(),this.selectionTimeout=window.setTimeout((function(){t.isSelecting&&(t.triggerOnSelectionChange(),t.isSelecting=!1,t.isSelectionStartInRTE=!1)}),600))},e.prototype.updateUndoRedoStack=function(e){var t=this.formatter.getUndoRedoStack(),n=this.formatter.getCurrentStackIndex(),i=-1!==["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].indexOf(e.key),s="keyup"!==e.type||i;if(0===t.length||0===n)if(0===t.length)this.formatter.saveData();else if(0===n&&"HTML"===this.editorMode&&s){var r=t[0],o=new et(this.inputElement).save(this.getRange(),this.getDocument());r.range=o}else if(0===n&&"Markdown"===this.editorMode&&s){var a=t[0],l=this.inputElement.selectionStart,d=this.inputElement.selectionEnd;a.start=l,a.end=d}},e.prototype.onCut=function(e){if(void 0===e&&(e=null),e&&"HTML"===this.editorMode&&this.handleTableCellCopy(!0))e.preventDefault();else{var t=this.getDocument().getSelection().getRangeAt(0),n=document.createElement("div");n.appendChild(t.cloneContents());var i=n.innerHTML;(i===this.inputElement.innerHTML||t.commonAncestorContainer===this.inputElement&&i===this.inputElement.textContent.trim())&&(this.isSelectAll=!0),this.getDocument().execCommand("cut",!1,null)}},e.prototype.onCopy=function(e){void 0===e&&(e=null),e&&"HTML"===this.editorMode&&this.handleTableCellCopy()?e.preventDefault():this.getDocument().execCommand("copy",!1,null)},e.prototype.handleTableCellCopy=function(e){void 0===e&&(e=!1);var t=this.getRange();return!!(t&&t.startContainer&&this.tableModule&&this.tableModule.tableObj&&this.tableModule.tableObj.curTable&&this.tableModule.tableObj.curTable.contains(t.startContainer)&&this.tableModule.tableObj.curTable.querySelectorAll(".e-cell-select.e-multi-cells-select").length>0)&&(this.tableModule.tableObj.copy(e),!0)},e.prototype.updateEditorValue=function(e){e.detail.click&&this.dotNetRef.invokeMethodAsync("UpdateValue",this.getUpdatedValue())},e.prototype.onPaste=function(e){if(sf.base.isNullOrUndefined(sf.base.select(".e-rte-img-dialog",this.element))){this.isPlainPaste=e&&e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length&&1===e.clipboardData.items.length&&"text/plain"===e.clipboardData.items[0].type;var t=this.getText().replace(/\u200B/g,"").replace("HTML"===this.editorMode?/(\r\n|\n|\r|\t)/gm:"","").length-this.getSelection().length+(sf.base.isNullOrUndefined(e)||sf.base.isNullOrUndefined(e.clipboardData)?0:e.clipboardData.getData("text/plain").replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length);if("Markdown"===this.editorMode){var n={requestType:"Paste",editorMode:this.editorMode,event:e};return this.formatter.onSuccess(this,n),void(-1===this.maxLength||t<=this.maxLength||e.preventDefault())}if("true"===this.inputElement.contentEditable&&(-1===this.maxLength||t<=this.maxLength)){var i=this.getRange(),s=this.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(i.startContainer)||this.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(i.endContainer);sf.base.isNullOrUndefined(s)?this.observer.notify("pasteClean",{args:e,isPlainPaste:this.isPlainPaste}):this.observer.notify("code-block-paste-content",{args:e})}else e.preventDefault();this.isPlainPaste=!1}},e.prototype.onDocumentClick=function(e){var t=e.target,n=sf.base.closest(t,".e-richtexteditor");this.element.contains(e.target)||document===e.target||n===this.element||sf.base.closest(t,'[aria-owns="'+this.element.id+'"]')||(this.isBlur=!0,this.isRTE=!1,sf.base.closest(t,".e-rte-elements")||ee(this.valueContainer,"focusout"));var i=this.quickToolbarModule&&!this.inlineMode.enable&&sf.base.isNullOrUndefined(this.quickToolbarModule.inlineQTBar);(i&&!sf.base.isNullOrUndefined(sf.base.closest(t,".e-toolbar-container"))||i&&(!sf.base.isNullOrUndefined(sf.base.closest(t,".e-rte-table-resize"))||!sf.base.isNullOrUndefined(sf.base.closest(t,".e-table-box"))))&&this.quickToolbarModule.hideQuickToolbars(),this.observer.notify(p,{args:e}),this.removeHrFocus(e)},e.prototype.removeHrFocus=function(e){if(e.target&&this.inputElement.querySelector("hr.e-rte-hr-focus")){var t=this.inputElement.querySelector("hr.e-rte-hr-focus");t.classList.remove("e-rte-hr-focus"),0===t.classList.length&&t.removeAttribute("class")}},e.prototype.propertyChangeHandler=function(e){for(var t,n,i,r={},o=0,a=Object.keys(e);o<a.length;o++){r[h=a[o]]=this[h]}var l=this.value;this.updateContext(e);for(var d=0,c=Object.keys(e);d<c.length;d++){var h;switch(h=c[d]){case"enableXhtml":case"enableHtmlSanitizer":case"value":case"enterKey":if("value"===h&&l===this.value)break;"enterKey"!==h||"<p><br/></p>"!==this.value&&"<div><br/></div>"!==this.value&&"<br/>"!==this.value&&"<p><br></p>"!==this.value&&"<div><br></div>"!==this.value&&"<br>"!==this.value||(this.value=$(this)),this.value="HTML"===this.editorMode?this.replaceEntities(this.value):this.value,this.setPanelValue(this.value),this.inputElement&&this.observer.notify("tableclass",{}),this.enableXhtml&&(this.value=this.getXhtml()),this.addAudioVideoWrapper();break;case"height":break;case"width":this.resizeHandler(null,!0);break;case"readonly":this.setReadOnly(!1);break;case"enabled":this.enabled&&!this.readonly?this.wireEvents():this.unWireEvents(),this.setEnable();break;case"placeholder":this.setPlaceHolder();break;case"enableResize":e[h]&&sf.base.isNullOrUndefined(this.resizeModule)?(this.resizeModule=new b(this),this.wireResizeEvents()):this.resizeModule&&(this.resizeModule.destroy(),this.unWireResizeEvents(),this.resizeModule=null);break;case"showCharCount":this.showCharCount?sf.base.isNullOrUndefined(this.countModule)&&(this.countModule=new g(this)):!1===this.showCharCount&&this.countModule&&(this.countModule.destroy(),this.countModule=null);break;case"maxLength":this.showCharCount&&this.countModule&&this.countModule.refresh();break;case"enableHtmlEncode":this.updateValueData(),this.updatePanelValue(this.value,this.value),this.setPlaceHolder(),this.showCharCount&&this.countModule.refresh();break;case"undoRedoSteps":case"undoRedoTimer":this.formatter.editorManager.observer.notify("model_changed",{newProp:e});break;case"adapter":i=this.getEditPanel(),n={undoRedoSteps:this.undoRedoSteps,undoRedoTimer:this.undoRedoTimer},"Markdown"===this.editorMode&&(this.formatter=new sn(sf.base.extend({},this.adapter,{element:i,options:n})));break;case"iframeSettings":if((t=r[h]).resources){var p=this.getDocument().querySelector("head"),u=void 0;t.resources.scripts&&(u=p.querySelectorAll(".rte-iframe-script-sheet"),this.removeSheets(u)),t.resources.styles&&(u=p.querySelectorAll(".rte-iframe-style-sheet"),this.removeSheets(u))}this.setIframeSettings();break;case"enableRtl":this.iframeSettings.enable&&this.enableRtl?this.inputElement.classList.add("e-rtl"):this.iframeSettings.enable&&!this.enableRtl&&this.inputElement.hasAttribute("class")&&this.inputElement.classList.contains("e-rtl")&&this.inputElement.classList.remove("e-rtl");break;case"quickToolbarSettings":this.quickToolbarSettings.enable?(sf.base.isNullOrUndefined(this.quickToolbarModule)&&(this.quickToolbarModule=new Dt(this)),this.quickToolbarSettings.showOnRightClick?this.wireContextEvent():this.unWireContextEvent()):(this.quickToolbarModule.destroy(),this.quickToolbarModule=null);break;case"toggleToolbar":this.toolbarSettings.enable=e[h],e[h]?sf.base.isNullOrUndefined(this.toolbarModule)&&(this.isUndoRedoStatus(),this.toolbarModule=new le(this),this.htmlEditorModule.toolbarUpdate=new Tt(this)):(this.toolbarModule.destroy(),this.toolbarModule=null);break;case"toolbarType":this.toolbarSettings.type=e[h],this.toolbarCreated();break;case"codeBlockSettings":this.codeBlockSettings=e[h];break;case"formatPainterSettings":this.formatter.editorManager.observer.notify("model_changed",{module:"formatPainter",newProp:e})}}this.autoResize(),this.formatter&&(this.formatter.editorManager.observer.notify(s,{}),this.observer.notify("updateProperty",{}))},e.prototype.getCurrentFocus=function(e){return e.target===this.inputElement&&document.activeElement===this.inputElement?"editArea":e.target===this.getToolbarElement()||!sf.base.isNullOrUndefined(e.relatedTarget)&&sf.base.closest(e.relatedTarget,".e-rte-toolbar")===this.getToolbarElement()?"toolbar":e.target===this.valueContainer&&document.activeElement===this.valueContainer?"textArea":!sf.base.isNullOrUndefined(e.target)&&e.target.classList.contains("e-rte-srctextarea")&&document.activeElement===e.target?"sourceCode":"outside"},e.prototype.resetToolbarTabIndex=function(){if(this.getToolbarElement())for(var e=this.getToolbarElement().querySelectorAll("input,select,button,a,[tabindex]"),t=0;t<e.length;t++)e[t].classList.contains("e-rte-dropdown-btn")||e[t].classList.contains("e-insert-table-btn")||e[t].hasAttribute("tabindex")&&"-1"===e[t].getAttribute("tabindex")||e[t].setAttribute("tabindex","-1")},e.prototype.cleanupResizeElements=function(e){var t=D(e.value,this.editorMode);e.callBack(t)},e.prototype.getDialogPosition=function(){var e=this.element.getBoundingClientRect().top;return e<0?(e=Math.abs(e)).toString():"top"},e.prototype.getRenderedQuickToolbarElem=function(){for(var e=this.quickToolbarModule.getQuickToolbarInstance(),t=0;t<e.length;t++)if(e[t]&&e[t].isRendered)return e[t].element;return null},e.prototype.iframeLoadHandler=function(){this.autoResize()},e.prototype.iframeEditableElemLoad=function(){this.autoResize()},e.prototype.clearUndoRedo=function(){sf.base.isNullOrUndefined(this.formatter)||(this.formatter.clearUndoRedoStack(),this.formatter.enableUndo(this))},e.prototype.closePopup=function(){this.tableModule.closePopup()},e.prototype.isSelectionInRTE=function(){var e=this.getDocument().getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0);if(t&&this.inputElement.contains(t.startContainer)&&this.inputElement.contains(t.endContainer))return!0}return!1},e.prototype.selectionChangeHandler=function(e){this.isSelectionInRTE()&&!this.isSelectionCollapsed()&&this.isSelectionStartInRTE&&(this.isSelecting=!0)},e.prototype.isMouseUpOutOfRTE=function(e){var t=e.target&&("HTML"===e.target.nodeName||"#document"===e.target.nodeName),n=!(e.target&&"#text"!==e.target.nodeName&&"#document"!==e.target.nodeName&&"HTML"!==e.target.nodeName&&(e.target.closest(".e-rte-elements")||e.target.closest(".e-rte-toolbar")));return!!(t||!this.inputElement.contains(e.target)&&n)},e.prototype.mouseUpHandlerForSelection=function(e){this.isSelecting&&this.isMouseUpOutOfRTE(e)&&this.endSelection(e),this.isSelectionStartInRTE=!1},e.prototype.endSelection=function(e){this.handleSelectionChange(e),this.isSelecting=!1},e.prototype.isSelectionCollapsed=function(){var e=this.getDocument().getSelection(),t=e&&0!==e.rangeCount&&e.getRangeAt(0);return t.startContainer===t.endContainer&&t.startOffset===t.endOffset},e.prototype.handleSelectionChange=function(e){!0===this.inlineMode.enable&&this.observer.notify("selectionChangeMouseUp",{args:e}),!this.inlineMode.enable&&this.quickToolbarSettings&&(this.quickToolbarSettings.text||this.quickToolbarSettings.link&&"mouseup"===e.type)&&this.observer.notify("selectionChangeMouseUp",{args:e}),this.quickToolbarModule.linkQTBar&&this.quickToolbarModule.linkQTBar.element&&this.quickToolbarModule.linkQTBar.element.classList.contains("e-popup-open")||this.observer.notify("toolbar-refresh",{args:e}),this.triggerOnSelectionChange()},e}();return{initialize:function(e){e.dataId&&new hn(e)},updateProperties:function(e){e.dataId&&window.sfBlazor.instances[e.dataId].updateContext(e)},setPanelValue:function(e,t){e&&window.sfBlazor.instances[e].setPanelValue(t)},toolbarCreated:function(e){e&&window.sfBlazor.instances[e].toolbarCreated()},toolbarItemClick:function(e,t,n,i){e&&window.sfBlazor.instances[e].toolbarItemClick(t,n,i)},splitButtonClicked:function(e,t){e&&window.sfBlazor.instances[e].splitButtonClicked(t)},splitButtonAfterOpen:function(e,t){e&&window.sfBlazor.instances[e].splitButtonAfterOpen(t)},dropDownBeforeOpen:function(e,t){e&&window.sfBlazor.instances[e].dropDownBeforeOpen(t)},dropDownAfterOpen:function(e,t,n){e&&window.sfBlazor.instances[e].dropDownAfterOpen(t,n)},dropDownClose:function(e,t){e&&window.sfBlazor.instances[e].dropDownClose(t)},dropDownBeforeClose:function(e,t){e&&window.sfBlazor.instances[e].dropDownBeforeClose(t)},dropDownButtonItemSelect:function(e,t){e&&window.sfBlazor.instances[e].dropDownSelect(t)},colorIconSelected:function(e,t,n,i){e&&window.sfBlazor.instances[e].colorIconSelected(t,n,i)},colorPickerAfterOpen:function(e,t,n,i){e&&window.sfBlazor.instances[e].colorPickerAfterOpen(t,n,i)},colorPickerChanged:function(e,t,n,i){e&&window.sfBlazor.instances[e].colorChanged(t,n,i)},cancelLinkDialog:function(e){e&&window.sfBlazor.instances[e].cancelLinkDialog()},cancelImageDialog:function(e){e&&window.sfBlazor.instances[e].cancelImageDialog()},linkDialogClosed:function(e){e&&window.sfBlazor.instances[e].linkDialogClosed()},dialogClosed:function(e,t){e&&window.sfBlazor.instances[e].dialogClosed(t)},insertLink:function(e,t){e&&window.sfBlazor.instances[e].insertLink(t)},imageRemoving:function(e){e&&window.sfBlazor.instances[e].imageRemoving()},audioRemoving:function(e){e&&window.sfBlazor.instances[e].audioRemoving()},videoRemoving:function(e){e&&window.sfBlazor.instances[e].videoRemoving()},uploadSuccess:function(e,t,n){e&&window.sfBlazor.instances[e].uploadSuccess(t,n)},audioUploadSuccess:function(e,t,n){e&&window.sfBlazor.instances[e].audioUploadSuccess(t,n)},videoUploadSuccess:function(e,t,n){e&&window.sfBlazor.instances[e].videoUploadSuccess(t,n)},imageSelected:function(e){e&&window.sfBlazor.instances[e].imageSelected()},audioSelected:function(e){e&&window.sfBlazor.instances[e].audioSelected()},videoSelected:function(e){e&&window.sfBlazor.instances[e].videoSelected()},imageUploadComplete:function(e){e.dataId&&window.sfBlazor.instances[e.dataId].imageUploadComplete(e.base64Str,e.altText)},audioUploadComplete:function(e){e.dataId&&window.sfBlazor.instances[e.dataId].audioUploadComplete(e.base64Str,e.fileName)},videoUploadComplete:function(e){e.dataId&&window.sfBlazor.instances[e.dataId].videoUploadComplete(e.base64Str,e.fileName)},imageUploadChange:function(e,t,n){e&&window.sfBlazor.instances[e].imageUploadChange(t,n)},audioUploadChange:function(e,t,n){e&&window.sfBlazor.instances[e].audioUploadChange(t,n)},videoUploadChange:function(e,t,n){e&&window.sfBlazor.instances[e].videoUploadChange(t,n)},dropUploadChange:function(e,t,n){e&&window.sfBlazor.instances[e].dropUploadChange(t,n)},insertImage:function(e){e&&window.sfBlazor.instances[e].insertImage()},insertAudio:function(e){e&&window.sfBlazor.instances[e].insertAudio()},insertVideo:function(e){e&&window.sfBlazor.instances[e].insertVideo()},imageDialogOpened:function(e){e&&window.sfBlazor.instances[e].imageDialogOpened()},imageDialogClosed:function(e){e&&window.sfBlazor.instances[e].imageDialogClosed()},audioDialogOpened:function(e){e&&window.sfBlazor.instances[e].audioDialogOpened()},audioDialogClosed:function(e){e&&window.sfBlazor.instances[e].audioDialogClosed()},videoDialogOpened:function(e){e&&window.sfBlazor.instances[e].videoDialogOpened()},videoDialogClosed:function(e){e&&window.sfBlazor.instances[e].videoDialogClosed()},propertyChangeHandler:function(e){e.dataId&&window.sfBlazor.instances[e.dataId].propertyChangeHandler(e)},insertTable:function(e,t,n){e&&window.sfBlazor.instances[e].insertTable(t,n)},applyTableProperties:function(e,t){e&&window.sfBlazor.instances[e].applyTableProperties(t)},createTablePopupOpened:function(e){e&&window.sfBlazor.instances[e].createTablePopupOpened()},pasteContent:function(e,t){e&&window.sfBlazor.instances[e].pasteContent(t)},updatePasteContent:function(e,t){e&&window.sfBlazor.instances[e].updatePasteContent(t)},imageDropInitialized:function(e,t){e&&window.sfBlazor.instances[e].imageDropInitialized(t)},preventEditable:function(e){e&&window.sfBlazor.instances[e].preventEditable()},enableEditable:function(e){e&&window.sfBlazor.instances[e].enableEditable()},removeDroppedImage:function(e){e&&window.sfBlazor.instances[e].removeDroppedImage()},dropUploadSuccess:function(e,t,n){e&&window.sfBlazor.instances[e].dropUploadSuccess(t,n)},executeCommand:function(e,t,n,i){e&&window.sfBlazor.instances[e].executeCommand(t,n,i)},getCharCount:function(e){return e&&window.sfBlazor.instances[e].getCharCount()},focusIn:function(e){return e&&window.sfBlazor.instances[e].focusIn()},focusOut:function(e){return e&&window.sfBlazor.instances[e].focusOut()},getContent:function(e){return e&&window.sfBlazor.instances[e].getContent()},getHtml:function(e){return e&&window.sfBlazor.instances[e].getHtml()},getSelectedHtml:function(e){return e&&window.sfBlazor.instances[e].getSelectedHtml()},getSelection:function(e){return e&&window.sfBlazor.instances[e].getSelection()},getText:function(e){return e&&window.sfBlazor.instances[e].getText()},print:function(e){return e&&window.sfBlazor.instances[e].print()},refreshUI:function(e){return e&&window.sfBlazor.instances[e].refreshUI()},sanitizeHtml:function(e,t){return e&&window.sfBlazor.instances[e].sanitizeHtml(t)},selectAll:function(e){return e&&window.sfBlazor.instances[e].selectAll()},selectRange:function(e,t){return e&&window.sfBlazor.instances[e].selectRange(t)},showFullScreen:function(e){return e&&window.sfBlazor.instances[e].showFullScreen()},showSourceCode:function(e){return e&&window.sfBlazor.instances[e].showSourceCode()},insertAlt:function(e,t){return e&&window.sfBlazor.instances[e].insertAlt(t)},insertSize:function(e,t,n){return e&&window.sfBlazor.instances[e].insertSize(t,n)},insertVideoSize:function(e,t,n){return e&&window.sfBlazor.instances[e].insertVideoSize(t,n)},insertImageLink:function(e,t,n,i){return e&&window.sfBlazor.instances[e].insertImageLink(t,n,i)},saveSelection:function(e){e&&window.sfBlazor.instances[e].saveSelection()},restoreSelection:function(e){e&&window.sfBlazor.instances[e].restoreSelection()},getXhtml:function(e){return e&&window.sfBlazor.instances[e].getXhtml()},changeTooltipText:function(e,t){e&&window.sfBlazor.instances[e].changeTooltipText(t)},showLinkDialog:function(e){e&&window.sfBlazor.instances[e].showLinkDialog()},showImageDialog:function(e){e&&window.sfBlazor.instances[e].showImageDialog()},showAudioDialog:function(e){e&&window.sfBlazor.instances[e].showAudioDialog()},showVideoDialog:function(e){e&&window.sfBlazor.instances[e].showVideoDialog()},showTableDialog:function(e){e&&window.sfBlazor.instances[e].showTableDialog()},showInlineToolbar:function(e){e&&window.sfBlazor.instances[e].showInlineToolbar()},hideInlineToolbar:function(e){e&&window.sfBlazor.instances[e].hideInlineToolbar()},destroy:function(e){e&&window.sfBlazor.instances[e].destroy()},resizeElement:function(e,t){return e&&window.sfBlazor.instances[e].removeResizeElement(t)},getDialogPosition:function(e){return e&&window.sfBlazor.instances[e].getDialogPosition()},beforeSlashMenuApply:function(e){e&&window.sfBlazor.instances[e].beforeSlashMenuApply()},clearUndoRedo:function(e){e&&window.sfBlazor.instances[e].clearUndoRedo()},closePopup:function(e){e&&window.sfBlazor.instances[e].closePopup()},importDialogOpened:function(e){e&&window.sfBlazor.instances[e].wordModule.dialogOpened()},cancelImportDialog:function(e){e&&window.sfBlazor.instances[e].wordModule.dialogClosed()},importDialogClosed:function(e){e&&window.sfBlazor.instances[e].wordModule.dialogClosed()},showWordDialog:function(e){e&&window.sfBlazor.instances[e].showWordDialog()},slashMenuToolbarRefresh:function(e){e&&window.sfBlazor.instances[e].slashMenuToolbarRefresh()}}}()}}]);(async()=>{await import(`${document.baseURI}_content/Syncfusion.Blazor/scripts/syncfusion-blazor-base.min.js`).then(()=>{sfBlazor.loadDependencies('sfrichtexteditor');})})();