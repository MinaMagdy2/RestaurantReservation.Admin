@using RestaurantReservation.Admin.Components.Authentication
@using RestaurantReservation.Admin.ExceptionHandling
@inherits LayoutComponentBase
@inject IJSRuntime JsRuntime

@* @inject IAppSettingService SettingService *@
@inject IJSRuntime JsRuntime
<MudLayout>
    <MudAppBar Elevation="1">
        <MudIconButton Icon="@MudBlazor.Icons.Material.Filled.Menu" Color="MudBlazor.Color.Inherit" Edge="Edge.Start" OnClick="@((_) => DrawerToggle())" />
        <MudText Typo="Typo.h5" Class="ml-3">@_companyName</MudText>
        <MudSpacer />
        @* <MudSwitch @bind-Checked="@AppState.DarkMode" Color="MudBlazor.Color.Primary" Class="ma-4" T="bool"
        Label="Toggle Light/Dark Mode" />*@
        <LoginDisplay LoginLinkAddress="/login"
                      LogoutLinkAddress="/authentication/login" />
    </MudAppBar>
    <MudDrawer @bind-Open="_drawerOpen"
               ClipMode="DrawerClipMode.Always" Elevation="3">
        <MyNavMenu />
    </MudDrawer>
    <MudMainContent>
        <CustomErrorBoundary @ref="_errorBoundary">
            <ChildContent>
                @Body
            </ChildContent>
            <ErrorContent Context="exception">
                <div class="alert alert-primary">
                    <h3>@exception.GetType()</h3>
                    <h3>@exception.Message</h3>
                    <button class="btn btn-info" @onclick="() => _errorBoundary.Recover()">Clear</button>
                </div>
                <p>Whoa, sorry about that! While we fix this problem, buy some shirts!</p>
            </ErrorContent>
        </CustomErrorBoundary>
        @* <button onclick="topFunction()" id="topBtn" title="Go to top">Top</button> *@
        <MudIconButton Icon="@Icons.Material.Filled.ArrowCircleUp"
                       Variant="Variant.Outlined" Color="Color.Primary"
                       Size="Size.Large" id="topBtn" OnClick="@GoToTopPage" />
    </MudMainContent>
</MudLayout>
@* <MudThemeProvider @ref="@_mudThemeProvider" @bind-IsDarkMode="@AppState.DarkMode" /> *@
@* Required *@
<MudThemeProvider />
<MudPopoverProvider />

<MudDialogProvider />

<MudSnackbarProvider />


<style>
    html, body {
        /* Dispaly scroll Automamticly */
        overflow-y: auto;
    }

    #topBtn {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 30px;
        z-index: 99;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 15px;
        border-radius: 25px;
    }

        #topBtn:hover {
            background-color: #008097;
            color: #fff;
        }
</style>

<script>

    window.onscroll = function () { scrollFunction() };
    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("topBtn").style.display = "block";
        } else {
            document.getElementById("topBtn").style.display = "none";
        }
    }

    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
</script>
@code {
    private CustomErrorBoundary _errorBoundary = null!;
    bool _drawerOpen = true;
    private readonly string _companyName = string.Empty;
    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }
    private async void GoToTopPage()
    {
        await JsRuntime.InvokeVoidAsync("topFunction");
    }

    protected override void OnInitialized()
    {
        _errorBoundary = new CustomErrorBoundary();
    }

}
